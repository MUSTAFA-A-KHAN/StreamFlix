function OT(s,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in s)){const i=Object.getOwnPropertyDescriptor(r,n);i&&Object.defineProperty(s,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Bc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function V0(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function MT(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var n=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return s[r]}})}),t}var G0={exports:{}},Jl={},H0={exports:{}},xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oa=Symbol.for("react.element"),FT=Symbol.for("react.portal"),jT=Symbol.for("react.fragment"),$T=Symbol.for("react.strict_mode"),UT=Symbol.for("react.profiler"),BT=Symbol.for("react.provider"),VT=Symbol.for("react.context"),GT=Symbol.for("react.forward_ref"),HT=Symbol.for("react.suspense"),zT=Symbol.for("react.memo"),KT=Symbol.for("react.lazy"),Tm=Symbol.iterator;function WT(s){return s===null||typeof s!="object"?null:(s=Tm&&s[Tm]||s["@@iterator"],typeof s=="function"?s:null)}var z0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},K0=Object.assign,W0={};function Ti(s,e,t){this.props=s,this.context=e,this.refs=W0,this.updater=t||z0}Ti.prototype.isReactComponent={};Ti.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};Ti.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function Y0(){}Y0.prototype=Ti.prototype;function Ih(s,e,t){this.props=s,this.context=e,this.refs=W0,this.updater=t||z0}var kh=Ih.prototype=new Y0;kh.constructor=Ih;K0(kh,Ti.prototype);kh.isPureReactComponent=!0;var bm=Array.isArray,q0=Object.prototype.hasOwnProperty,Ch={current:null},X0={key:!0,ref:!0,__self:!0,__source:!0};function Q0(s,e,t){var r,n={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)q0.call(e,r)&&!X0.hasOwnProperty(r)&&(n[r]=e[r]);var o=arguments.length-2;if(o===1)n.children=t;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];n.children=l}if(s&&s.defaultProps)for(r in o=s.defaultProps,o)n[r]===void 0&&(n[r]=o[r]);return{$$typeof:Oa,type:s,key:i,ref:a,props:n,_owner:Ch.current}}function YT(s,e){return{$$typeof:Oa,type:s.type,key:e,ref:s.ref,props:s.props,_owner:s._owner}}function Ph(s){return typeof s=="object"&&s!==null&&s.$$typeof===Oa}function qT(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(t){return e[t]})}var wm=/\/+/g;function Vc(s,e){return typeof s=="object"&&s!==null&&s.key!=null?qT(""+s.key):e.toString(36)}function Uo(s,e,t,r,n){var i=typeof s;(i==="undefined"||i==="boolean")&&(s=null);var a=!1;if(s===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(s.$$typeof){case Oa:case FT:a=!0}}if(a)return a=s,n=n(a),s=r===""?"."+Vc(a,0):r,bm(n)?(t="",s!=null&&(t=s.replace(wm,"$&/")+"/"),Uo(n,e,t,"",function(c){return c})):n!=null&&(Ph(n)&&(n=YT(n,t+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(wm,"$&/")+"/")+s)),e.push(n)),1;if(a=0,r=r===""?".":r+":",bm(s))for(var o=0;o<s.length;o++){i=s[o];var l=r+Vc(i,o);a+=Uo(i,e,t,l,n)}else if(l=WT(s),typeof l=="function")for(s=l.call(s),o=0;!(i=s.next()).done;)i=i.value,l=r+Vc(i,o++),a+=Uo(i,e,t,l,n);else if(i==="object")throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function io(s,e,t){if(s==null)return s;var r=[],n=0;return Uo(s,r,"","",function(i){return e.call(t,i,n++)}),r}function XT(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(t){(s._status===0||s._status===-1)&&(s._status=1,s._result=t)},function(t){(s._status===0||s._status===-1)&&(s._status=2,s._result=t)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var Dt={current:null},Bo={transition:null},QT={ReactCurrentDispatcher:Dt,ReactCurrentBatchConfig:Bo,ReactCurrentOwner:Ch};function J0(){throw Error("act(...) is not supported in production builds of React.")}xe.Children={map:io,forEach:function(s,e,t){io(s,function(){e.apply(this,arguments)},t)},count:function(s){var e=0;return io(s,function(){e++}),e},toArray:function(s){return io(s,function(e){return e})||[]},only:function(s){if(!Ph(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};xe.Component=Ti;xe.Fragment=jT;xe.Profiler=UT;xe.PureComponent=Ih;xe.StrictMode=$T;xe.Suspense=HT;xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QT;xe.act=J0;xe.cloneElement=function(s,e,t){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var r=K0({},s.props),n=s.key,i=s.ref,a=s._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=Ch.current),e.key!==void 0&&(n=""+e.key),s.type&&s.type.defaultProps)var o=s.type.defaultProps;for(l in e)q0.call(e,l)&&!X0.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];r.children=o}return{$$typeof:Oa,type:s.type,key:n,ref:i,props:r,_owner:a}};xe.createContext=function(s){return s={$$typeof:VT,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:BT,_context:s},s.Consumer=s};xe.createElement=Q0;xe.createFactory=function(s){var e=Q0.bind(null,s);return e.type=s,e};xe.createRef=function(){return{current:null}};xe.forwardRef=function(s){return{$$typeof:GT,render:s}};xe.isValidElement=Ph;xe.lazy=function(s){return{$$typeof:KT,_payload:{_status:-1,_result:s},_init:XT}};xe.memo=function(s,e){return{$$typeof:zT,type:s,compare:e===void 0?null:e}};xe.startTransition=function(s){var e=Bo.transition;Bo.transition={};try{s()}finally{Bo.transition=e}};xe.unstable_act=J0;xe.useCallback=function(s,e){return Dt.current.useCallback(s,e)};xe.useContext=function(s){return Dt.current.useContext(s)};xe.useDebugValue=function(){};xe.useDeferredValue=function(s){return Dt.current.useDeferredValue(s)};xe.useEffect=function(s,e){return Dt.current.useEffect(s,e)};xe.useId=function(){return Dt.current.useId()};xe.useImperativeHandle=function(s,e,t){return Dt.current.useImperativeHandle(s,e,t)};xe.useInsertionEffect=function(s,e){return Dt.current.useInsertionEffect(s,e)};xe.useLayoutEffect=function(s,e){return Dt.current.useLayoutEffect(s,e)};xe.useMemo=function(s,e){return Dt.current.useMemo(s,e)};xe.useReducer=function(s,e,t){return Dt.current.useReducer(s,e,t)};xe.useRef=function(s){return Dt.current.useRef(s)};xe.useState=function(s){return Dt.current.useState(s)};xe.useSyncExternalStore=function(s,e,t){return Dt.current.useSyncExternalStore(s,e,t)};xe.useTransition=function(){return Dt.current.useTransition()};xe.version="18.3.1";H0.exports=xe;var A=H0.exports;const rr=V0(A),JT=OT({__proto__:null,default:rr},[A]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZT=A,eb=Symbol.for("react.element"),tb=Symbol.for("react.fragment"),sb=Object.prototype.hasOwnProperty,rb=ZT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nb={key:!0,ref:!0,__self:!0,__source:!0};function Z0(s,e,t){var r,n={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)sb.call(e,r)&&!nb.hasOwnProperty(r)&&(n[r]=e[r]);if(s&&s.defaultProps)for(r in e=s.defaultProps,e)n[r]===void 0&&(n[r]=e[r]);return{$$typeof:eb,type:s,key:i,ref:a,props:n,_owner:rb.current}}Jl.Fragment=tb;Jl.jsx=Z0;Jl.jsxs=Z0;G0.exports=Jl;var h=G0.exports,Qu={},ey={exports:{}},cs={},ty={exports:{}},sy={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(P,B){var K=P.length;P.push(B);e:for(;0<K;){var O=K-1>>>1,F=P[O];if(0<n(F,B))P[O]=B,P[K]=F,K=O;else break e}}function t(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var B=P[0],K=P.pop();if(K!==B){P[0]=K;e:for(var O=0,F=P.length,Z=F>>>1;O<Z;){var te=2*(O+1)-1,z=P[te],Q=te+1,ge=P[Q];if(0>n(z,K))Q<F&&0>n(ge,z)?(P[O]=ge,P[Q]=K,O=Q):(P[O]=z,P[te]=K,O=te);else if(Q<F&&0>n(ge,K))P[O]=ge,P[Q]=K,O=Q;else break e}}return B}function n(P,B){var K=P.sortIndex-B.sortIndex;return K!==0?K:P.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;s.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();s.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,d=null,f=3,p=!1,m=!1,y=!1,g=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(P){for(var B=t(c);B!==null;){if(B.callback===null)r(c);else if(B.startTime<=P)r(c),B.sortIndex=B.expirationTime,e(l,B);else break;B=t(c)}}function T(P){if(y=!1,E(P),!m)if(t(l)!==null)m=!0,U(w);else{var B=t(c);B!==null&&W(T,B.startTime-P)}}function w(P,B){m=!1,y&&(y=!1,x(_),_=-1),p=!0;var K=f;try{for(E(B),d=t(l);d!==null&&(!(d.expirationTime>B)||P&&!N());){var O=d.callback;if(typeof O=="function"){d.callback=null,f=d.priorityLevel;var F=O(d.expirationTime<=B);B=s.unstable_now(),typeof F=="function"?d.callback=F:d===t(l)&&r(l),E(B)}else r(l);d=t(l)}if(d!==null)var Z=!0;else{var te=t(c);te!==null&&W(T,te.startTime-B),Z=!1}return Z}finally{d=null,f=K,p=!1}}var R=!1,b=null,_=-1,I=5,L=-1;function N(){return!(s.unstable_now()-L<I)}function M(){if(b!==null){var P=s.unstable_now();L=P;var B=!0;try{B=b(!0,P)}finally{B?$():(R=!1,b=null)}}else R=!1}var $;if(typeof v=="function")$=function(){v(M)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,Y=G.port2;G.port1.onmessage=M,$=function(){Y.postMessage(null)}}else $=function(){g(M,0)};function U(P){b=P,R||(R=!0,$())}function W(P,B){_=g(function(){P(s.unstable_now())},B)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(P){P.callback=null},s.unstable_continueExecution=function(){m||p||(m=!0,U(w))},s.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<P?Math.floor(1e3/P):5},s.unstable_getCurrentPriorityLevel=function(){return f},s.unstable_getFirstCallbackNode=function(){return t(l)},s.unstable_next=function(P){switch(f){case 1:case 2:case 3:var B=3;break;default:B=f}var K=f;f=B;try{return P()}finally{f=K}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(P,B){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var K=f;f=P;try{return B()}finally{f=K}},s.unstable_scheduleCallback=function(P,B,K){var O=s.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?O+K:O):K=O,P){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=K+F,P={id:u++,callback:B,priorityLevel:P,startTime:K,expirationTime:F,sortIndex:-1},K>O?(P.sortIndex=K,e(c,P),t(l)===null&&P===t(c)&&(y?(x(_),_=-1):y=!0,W(T,K-O))):(P.sortIndex=F,e(l,P),m||p||(m=!0,U(w))),P},s.unstable_shouldYield=N,s.unstable_wrapCallback=function(P){var B=f;return function(){var K=f;f=B;try{return P.apply(this,arguments)}finally{f=K}}}})(sy);ty.exports=sy;var ib=ty.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ab=A,ls=ib;function q(s){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+s,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ry=new Set,la={};function wn(s,e){li(s,e),li(s+"Capture",e)}function li(s,e){for(la[s]=e,s=0;s<e.length;s++)ry.add(e[s])}var ir=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ju=Object.prototype.hasOwnProperty,ob=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Am={},Lm={};function lb(s){return Ju.call(Lm,s)?!0:Ju.call(Am,s)?!1:ob.test(s)?Lm[s]=!0:(Am[s]=!0,!1)}function cb(s,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function ub(s,e,t,r){if(e===null||typeof e>"u"||cb(s,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Nt(s,e,t,r,n,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=t,this.propertyName=s,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var vt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){vt[s]=new Nt(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var e=s[0];vt[e]=new Nt(e,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){vt[s]=new Nt(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){vt[s]=new Nt(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){vt[s]=new Nt(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){vt[s]=new Nt(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){vt[s]=new Nt(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){vt[s]=new Nt(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){vt[s]=new Nt(s,5,!1,s.toLowerCase(),null,!1,!1)});var Dh=/[\-:]([a-z])/g;function Nh(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var e=s.replace(Dh,Nh);vt[e]=new Nt(e,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var e=s.replace(Dh,Nh);vt[e]=new Nt(e,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var e=s.replace(Dh,Nh);vt[e]=new Nt(e,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){vt[s]=new Nt(s,1,!1,s.toLowerCase(),null,!1,!1)});vt.xlinkHref=new Nt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){vt[s]=new Nt(s,1,!1,s.toLowerCase(),null,!0,!0)});function Oh(s,e,t,r){var n=vt.hasOwnProperty(e)?vt[e]:null;(n!==null?n.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ub(e,t,n,r)&&(t=null),r||n===null?lb(e)&&(t===null?s.removeAttribute(e):s.setAttribute(e,""+t)):n.mustUseProperty?s[n.propertyName]=t===null?n.type===3?!1:"":t:(e=n.attributeName,r=n.attributeNamespace,t===null?s.removeAttribute(e):(n=n.type,t=n===3||n===4&&t===!0?"":""+t,r?s.setAttributeNS(r,e,t):s.setAttribute(e,t))))}var cr=ab.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ao=Symbol.for("react.element"),Fn=Symbol.for("react.portal"),jn=Symbol.for("react.fragment"),Mh=Symbol.for("react.strict_mode"),Zu=Symbol.for("react.profiler"),ny=Symbol.for("react.provider"),iy=Symbol.for("react.context"),Fh=Symbol.for("react.forward_ref"),ed=Symbol.for("react.suspense"),td=Symbol.for("react.suspense_list"),jh=Symbol.for("react.memo"),Sr=Symbol.for("react.lazy"),ay=Symbol.for("react.offscreen"),_m=Symbol.iterator;function Pi(s){return s===null||typeof s!="object"?null:(s=_m&&s[_m]||s["@@iterator"],typeof s=="function"?s:null)}var Ge=Object.assign,Gc;function Hi(s){if(Gc===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Gc=e&&e[1]||""}return`
`+Gc+s}var Hc=!1;function zc(s,e){if(!s||Hc)return"";Hc=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(s,[],e)}else{try{e.call()}catch(c){r=c}s.call(e.prototype)}else{try{throw Error()}catch(c){r=c}s()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),i=r.stack.split(`
`),a=n.length-1,o=i.length-1;1<=a&&0<=o&&n[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||n[a]!==i[o]){var l=`
`+n[a].replace(" at new "," at ");return s.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",s.displayName)),l}while(1<=a&&0<=o);break}}}finally{Hc=!1,Error.prepareStackTrace=t}return(s=s?s.displayName||s.name:"")?Hi(s):""}function db(s){switch(s.tag){case 5:return Hi(s.type);case 16:return Hi("Lazy");case 13:return Hi("Suspense");case 19:return Hi("SuspenseList");case 0:case 2:case 15:return s=zc(s.type,!1),s;case 11:return s=zc(s.type.render,!1),s;case 1:return s=zc(s.type,!0),s;default:return""}}function sd(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case jn:return"Fragment";case Fn:return"Portal";case Zu:return"Profiler";case Mh:return"StrictMode";case ed:return"Suspense";case td:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case iy:return(s.displayName||"Context")+".Consumer";case ny:return(s._context.displayName||"Context")+".Provider";case Fh:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case jh:return e=s.displayName||null,e!==null?e:sd(s.type)||"Memo";case Sr:e=s._payload,s=s._init;try{return sd(s(e))}catch{}}return null}function hb(s){var e=s.type;switch(s.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=e.render,s=s.displayName||s.name||"",e.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sd(e);case 8:return e===Mh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Br(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function oy(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function fb(s){var e=oy(s)?"checked":"value",t=Object.getOwnPropertyDescriptor(s.constructor.prototype,e),r=""+s[e];if(!s.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var n=t.get,i=t.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return n.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(s,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function oo(s){s._valueTracker||(s._valueTracker=fb(s))}function ly(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return s&&(r=oy(s)?s.checked?"true":"false":s.value),s=r,s!==t?(e.setValue(s),!0):!1}function ul(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function rd(s,e){var t=e.checked;return Ge({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??s._wrapperState.initialChecked})}function Rm(s,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Br(e.value!=null?e.value:t),s._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function cy(s,e){e=e.checked,e!=null&&Oh(s,"checked",e,!1)}function nd(s,e){cy(s,e);var t=Br(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&s.value===""||s.value!=t)&&(s.value=""+t):s.value!==""+t&&(s.value=""+t);else if(r==="submit"||r==="reset"){s.removeAttribute("value");return}e.hasOwnProperty("value")?id(s,e.type,t):e.hasOwnProperty("defaultValue")&&id(s,e.type,Br(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(s.defaultChecked=!!e.defaultChecked)}function Im(s,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+s._wrapperState.initialValue,t||e===s.value||(s.value=e),s.defaultValue=e}t=s.name,t!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,t!==""&&(s.name=t)}function id(s,e,t){(e!=="number"||ul(s.ownerDocument)!==s)&&(t==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+t&&(s.defaultValue=""+t))}var zi=Array.isArray;function Qn(s,e,t,r){if(s=s.options,e){e={};for(var n=0;n<t.length;n++)e["$"+t[n]]=!0;for(t=0;t<s.length;t++)n=e.hasOwnProperty("$"+s[t].value),s[t].selected!==n&&(s[t].selected=n),n&&r&&(s[t].defaultSelected=!0)}else{for(t=""+Br(t),e=null,n=0;n<s.length;n++){if(s[n].value===t){s[n].selected=!0,r&&(s[n].defaultSelected=!0);return}e!==null||s[n].disabled||(e=s[n])}e!==null&&(e.selected=!0)}}function ad(s,e){if(e.dangerouslySetInnerHTML!=null)throw Error(q(91));return Ge({},e,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function km(s,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(q(92));if(zi(t)){if(1<t.length)throw Error(q(93));t=t[0]}e=t}e==null&&(e=""),t=e}s._wrapperState={initialValue:Br(t)}}function uy(s,e){var t=Br(e.value),r=Br(e.defaultValue);t!=null&&(t=""+t,t!==s.value&&(s.value=t),e.defaultValue==null&&s.defaultValue!==t&&(s.defaultValue=t)),r!=null&&(s.defaultValue=""+r)}function Cm(s){var e=s.textContent;e===s._wrapperState.initialValue&&e!==""&&e!==null&&(s.value=e)}function dy(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function od(s,e){return s==null||s==="http://www.w3.org/1999/xhtml"?dy(e):s==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var lo,hy=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,n){MSApp.execUnsafeLocalFunction(function(){return s(e,t,r,n)})}:s}(function(s,e){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=e;else{for(lo=lo||document.createElement("div"),lo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=lo.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;e.firstChild;)s.appendChild(e.firstChild)}});function ca(s,e){if(e){var t=s.firstChild;if(t&&t===s.lastChild&&t.nodeType===3){t.nodeValue=e;return}}s.textContent=e}var Xi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},mb=["Webkit","ms","Moz","O"];Object.keys(Xi).forEach(function(s){mb.forEach(function(e){e=e+s.charAt(0).toUpperCase()+s.substring(1),Xi[e]=Xi[s]})});function fy(s,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Xi.hasOwnProperty(s)&&Xi[s]?(""+e).trim():e+"px"}function my(s,e){s=s.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,n=fy(t,e[t],r);t==="float"&&(t="cssFloat"),r?s.setProperty(t,n):s[t]=n}}var pb=Ge({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ld(s,e){if(e){if(pb[s]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(q(137,s));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(q(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(q(61))}if(e.style!=null&&typeof e.style!="object")throw Error(q(62))}}function cd(s,e){if(s.indexOf("-")===-1)return typeof e.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ud=null;function $h(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var dd=null,Jn=null,Zn=null;function Pm(s){if(s=ja(s)){if(typeof dd!="function")throw Error(q(280));var e=s.stateNode;e&&(e=rc(e),dd(s.stateNode,s.type,e))}}function py(s){Jn?Zn?Zn.push(s):Zn=[s]:Jn=s}function gy(){if(Jn){var s=Jn,e=Zn;if(Zn=Jn=null,Pm(s),e)for(s=0;s<e.length;s++)Pm(e[s])}}function yy(s,e){return s(e)}function xy(){}var Kc=!1;function vy(s,e,t){if(Kc)return s(e,t);Kc=!0;try{return yy(s,e,t)}finally{Kc=!1,(Jn!==null||Zn!==null)&&(xy(),gy())}}function ua(s,e){var t=s.stateNode;if(t===null)return null;var r=rc(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(s=s.type,r=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!r;break e;default:s=!1}if(s)return null;if(t&&typeof t!="function")throw Error(q(231,e,typeof t));return t}var hd=!1;if(ir)try{var Di={};Object.defineProperty(Di,"passive",{get:function(){hd=!0}}),window.addEventListener("test",Di,Di),window.removeEventListener("test",Di,Di)}catch{hd=!1}function gb(s,e,t,r,n,i,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var Qi=!1,dl=null,hl=!1,fd=null,yb={onError:function(s){Qi=!0,dl=s}};function xb(s,e,t,r,n,i,a,o,l){Qi=!1,dl=null,gb.apply(yb,arguments)}function vb(s,e,t,r,n,i,a,o,l){if(xb.apply(this,arguments),Qi){if(Qi){var c=dl;Qi=!1,dl=null}else throw Error(q(198));hl||(hl=!0,fd=c)}}function An(s){var e=s,t=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(t=e.return),s=e.return;while(s)}return e.tag===3?t:null}function Ey(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function Dm(s){if(An(s)!==s)throw Error(q(188))}function Eb(s){var e=s.alternate;if(!e){if(e=An(s),e===null)throw Error(q(188));return e!==s?null:s}for(var t=s,r=e;;){var n=t.return;if(n===null)break;var i=n.alternate;if(i===null){if(r=n.return,r!==null){t=r;continue}break}if(n.child===i.child){for(i=n.child;i;){if(i===t)return Dm(n),s;if(i===r)return Dm(n),e;i=i.sibling}throw Error(q(188))}if(t.return!==r.return)t=n,r=i;else{for(var a=!1,o=n.child;o;){if(o===t){a=!0,t=n,r=i;break}if(o===r){a=!0,r=n,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,r=n;break}if(o===r){a=!0,r=i,t=n;break}o=o.sibling}if(!a)throw Error(q(189))}}if(t.alternate!==r)throw Error(q(190))}if(t.tag!==3)throw Error(q(188));return t.stateNode.current===t?s:e}function Sy(s){return s=Eb(s),s!==null?Ty(s):null}function Ty(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var e=Ty(s);if(e!==null)return e;s=s.sibling}return null}var by=ls.unstable_scheduleCallback,Nm=ls.unstable_cancelCallback,Sb=ls.unstable_shouldYield,Tb=ls.unstable_requestPaint,Je=ls.unstable_now,bb=ls.unstable_getCurrentPriorityLevel,Uh=ls.unstable_ImmediatePriority,wy=ls.unstable_UserBlockingPriority,fl=ls.unstable_NormalPriority,wb=ls.unstable_LowPriority,Ay=ls.unstable_IdlePriority,Zl=null,Bs=null;function Ab(s){if(Bs&&typeof Bs.onCommitFiberRoot=="function")try{Bs.onCommitFiberRoot(Zl,s,void 0,(s.current.flags&128)===128)}catch{}}var As=Math.clz32?Math.clz32:Rb,Lb=Math.log,_b=Math.LN2;function Rb(s){return s>>>=0,s===0?32:31-(Lb(s)/_b|0)|0}var co=64,uo=4194304;function Ki(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function ml(s,e){var t=s.pendingLanes;if(t===0)return 0;var r=0,n=s.suspendedLanes,i=s.pingedLanes,a=t&268435455;if(a!==0){var o=a&~n;o!==0?r=Ki(o):(i&=a,i!==0&&(r=Ki(i)))}else a=t&~n,a!==0?r=Ki(a):i!==0&&(r=Ki(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&n)&&(n=r&-r,i=e&-e,n>=i||n===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=s.entangledLanes,e!==0)for(s=s.entanglements,e&=r;0<e;)t=31-As(e),n=1<<t,r|=s[t],e&=~n;return r}function Ib(s,e){switch(s){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kb(s,e){for(var t=s.suspendedLanes,r=s.pingedLanes,n=s.expirationTimes,i=s.pendingLanes;0<i;){var a=31-As(i),o=1<<a,l=n[a];l===-1?(!(o&t)||o&r)&&(n[a]=Ib(o,e)):l<=e&&(s.expiredLanes|=o),i&=~o}}function md(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function Ly(){var s=co;return co<<=1,!(co&4194240)&&(co=64),s}function Wc(s){for(var e=[],t=0;31>t;t++)e.push(s);return e}function Ma(s,e,t){s.pendingLanes|=e,e!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,e=31-As(e),s[e]=t}function Cb(s,e){var t=s.pendingLanes&~e;s.pendingLanes=e,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=e,s.mutableReadLanes&=e,s.entangledLanes&=e,e=s.entanglements;var r=s.eventTimes;for(s=s.expirationTimes;0<t;){var n=31-As(t),i=1<<n;e[n]=0,r[n]=-1,s[n]=-1,t&=~i}}function Bh(s,e){var t=s.entangledLanes|=e;for(s=s.entanglements;t;){var r=31-As(t),n=1<<r;n&e|s[r]&e&&(s[r]|=e),t&=~n}}var _e=0;function _y(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var Ry,Vh,Iy,ky,Cy,pd=!1,ho=[],kr=null,Cr=null,Pr=null,da=new Map,ha=new Map,Ar=[],Pb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Om(s,e){switch(s){case"focusin":case"focusout":kr=null;break;case"dragenter":case"dragleave":Cr=null;break;case"mouseover":case"mouseout":Pr=null;break;case"pointerover":case"pointerout":da.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ha.delete(e.pointerId)}}function Ni(s,e,t,r,n,i){return s===null||s.nativeEvent!==i?(s={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[n]},e!==null&&(e=ja(e),e!==null&&Vh(e)),s):(s.eventSystemFlags|=r,e=s.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),s)}function Db(s,e,t,r,n){switch(e){case"focusin":return kr=Ni(kr,s,e,t,r,n),!0;case"dragenter":return Cr=Ni(Cr,s,e,t,r,n),!0;case"mouseover":return Pr=Ni(Pr,s,e,t,r,n),!0;case"pointerover":var i=n.pointerId;return da.set(i,Ni(da.get(i)||null,s,e,t,r,n)),!0;case"gotpointercapture":return i=n.pointerId,ha.set(i,Ni(ha.get(i)||null,s,e,t,r,n)),!0}return!1}function Py(s){var e=on(s.target);if(e!==null){var t=An(e);if(t!==null){if(e=t.tag,e===13){if(e=Ey(t),e!==null){s.blockedOn=e,Cy(s.priority,function(){Iy(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){s.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Vo(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var t=gd(s.domEventName,s.eventSystemFlags,e[0],s.nativeEvent);if(t===null){t=s.nativeEvent;var r=new t.constructor(t.type,t);ud=r,t.target.dispatchEvent(r),ud=null}else return e=ja(t),e!==null&&Vh(e),s.blockedOn=t,!1;e.shift()}return!0}function Mm(s,e,t){Vo(s)&&t.delete(e)}function Nb(){pd=!1,kr!==null&&Vo(kr)&&(kr=null),Cr!==null&&Vo(Cr)&&(Cr=null),Pr!==null&&Vo(Pr)&&(Pr=null),da.forEach(Mm),ha.forEach(Mm)}function Oi(s,e){s.blockedOn===e&&(s.blockedOn=null,pd||(pd=!0,ls.unstable_scheduleCallback(ls.unstable_NormalPriority,Nb)))}function fa(s){function e(n){return Oi(n,s)}if(0<ho.length){Oi(ho[0],s);for(var t=1;t<ho.length;t++){var r=ho[t];r.blockedOn===s&&(r.blockedOn=null)}}for(kr!==null&&Oi(kr,s),Cr!==null&&Oi(Cr,s),Pr!==null&&Oi(Pr,s),da.forEach(e),ha.forEach(e),t=0;t<Ar.length;t++)r=Ar[t],r.blockedOn===s&&(r.blockedOn=null);for(;0<Ar.length&&(t=Ar[0],t.blockedOn===null);)Py(t),t.blockedOn===null&&Ar.shift()}var ei=cr.ReactCurrentBatchConfig,pl=!0;function Ob(s,e,t,r){var n=_e,i=ei.transition;ei.transition=null;try{_e=1,Gh(s,e,t,r)}finally{_e=n,ei.transition=i}}function Mb(s,e,t,r){var n=_e,i=ei.transition;ei.transition=null;try{_e=4,Gh(s,e,t,r)}finally{_e=n,ei.transition=i}}function Gh(s,e,t,r){if(pl){var n=gd(s,e,t,r);if(n===null)ru(s,e,r,gl,t),Om(s,r);else if(Db(n,s,e,t,r))r.stopPropagation();else if(Om(s,r),e&4&&-1<Pb.indexOf(s)){for(;n!==null;){var i=ja(n);if(i!==null&&Ry(i),i=gd(s,e,t,r),i===null&&ru(s,e,r,gl,t),i===n)break;n=i}n!==null&&r.stopPropagation()}else ru(s,e,r,null,t)}}var gl=null;function gd(s,e,t,r){if(gl=null,s=$h(r),s=on(s),s!==null)if(e=An(s),e===null)s=null;else if(t=e.tag,t===13){if(s=Ey(e),s!==null)return s;s=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null);return gl=s,null}function Dy(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(bb()){case Uh:return 1;case wy:return 4;case fl:case wb:return 16;case Ay:return 536870912;default:return 16}default:return 16}}var _r=null,Hh=null,Go=null;function Ny(){if(Go)return Go;var s,e=Hh,t=e.length,r,n="value"in _r?_r.value:_r.textContent,i=n.length;for(s=0;s<t&&e[s]===n[s];s++);var a=t-s;for(r=1;r<=a&&e[t-r]===n[i-r];r++);return Go=n.slice(s,1<r?1-r:void 0)}function Ho(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function fo(){return!0}function Fm(){return!1}function us(s){function e(t,r,n,i,a){this._reactName=t,this._targetInst=n,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in s)s.hasOwnProperty(o)&&(t=s[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?fo:Fm,this.isPropagationStopped=Fm,this}return Ge(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=fo)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=fo)},persist:function(){},isPersistent:fo}),e}var bi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zh=us(bi),Fa=Ge({},bi,{view:0,detail:0}),Fb=us(Fa),Yc,qc,Mi,ec=Ge({},Fa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kh,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Mi&&(Mi&&s.type==="mousemove"?(Yc=s.screenX-Mi.screenX,qc=s.screenY-Mi.screenY):qc=Yc=0,Mi=s),Yc)},movementY:function(s){return"movementY"in s?s.movementY:qc}}),jm=us(ec),jb=Ge({},ec,{dataTransfer:0}),$b=us(jb),Ub=Ge({},Fa,{relatedTarget:0}),Xc=us(Ub),Bb=Ge({},bi,{animationName:0,elapsedTime:0,pseudoElement:0}),Vb=us(Bb),Gb=Ge({},bi,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Hb=us(Gb),zb=Ge({},bi,{data:0}),$m=us(zb),Kb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qb(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=Yb[s])?!!e[s]:!1}function Kh(){return qb}var Xb=Ge({},Fa,{key:function(s){if(s.key){var e=Kb[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=Ho(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Wb[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kh,charCode:function(s){return s.type==="keypress"?Ho(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Ho(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Qb=us(Xb),Jb=Ge({},ec,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Um=us(Jb),Zb=Ge({},Fa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kh}),e1=us(Zb),t1=Ge({},bi,{propertyName:0,elapsedTime:0,pseudoElement:0}),s1=us(t1),r1=Ge({},ec,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),n1=us(r1),i1=[9,13,27,32],Wh=ir&&"CompositionEvent"in window,Ji=null;ir&&"documentMode"in document&&(Ji=document.documentMode);var a1=ir&&"TextEvent"in window&&!Ji,Oy=ir&&(!Wh||Ji&&8<Ji&&11>=Ji),Bm=" ",Vm=!1;function My(s,e){switch(s){case"keyup":return i1.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fy(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var $n=!1;function o1(s,e){switch(s){case"compositionend":return Fy(e);case"keypress":return e.which!==32?null:(Vm=!0,Bm);case"textInput":return s=e.data,s===Bm&&Vm?null:s;default:return null}}function l1(s,e){if($n)return s==="compositionend"||!Wh&&My(s,e)?(s=Ny(),Go=Hh=_r=null,$n=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Oy&&e.locale!=="ko"?null:e.data;default:return null}}var c1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gm(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!c1[s.type]:e==="textarea"}function jy(s,e,t,r){py(r),e=yl(e,"onChange"),0<e.length&&(t=new zh("onChange","change",null,t,r),s.push({event:t,listeners:e}))}var Zi=null,ma=null;function u1(s){qy(s,0)}function tc(s){var e=Vn(s);if(ly(e))return s}function d1(s,e){if(s==="change")return e}var $y=!1;if(ir){var Qc;if(ir){var Jc="oninput"in document;if(!Jc){var Hm=document.createElement("div");Hm.setAttribute("oninput","return;"),Jc=typeof Hm.oninput=="function"}Qc=Jc}else Qc=!1;$y=Qc&&(!document.documentMode||9<document.documentMode)}function zm(){Zi&&(Zi.detachEvent("onpropertychange",Uy),ma=Zi=null)}function Uy(s){if(s.propertyName==="value"&&tc(ma)){var e=[];jy(e,ma,s,$h(s)),vy(u1,e)}}function h1(s,e,t){s==="focusin"?(zm(),Zi=e,ma=t,Zi.attachEvent("onpropertychange",Uy)):s==="focusout"&&zm()}function f1(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return tc(ma)}function m1(s,e){if(s==="click")return tc(e)}function p1(s,e){if(s==="input"||s==="change")return tc(e)}function g1(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var _s=typeof Object.is=="function"?Object.is:g1;function pa(s,e){if(_s(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var t=Object.keys(s),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var n=t[r];if(!Ju.call(e,n)||!_s(s[n],e[n]))return!1}return!0}function Km(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Wm(s,e){var t=Km(s);s=0;for(var r;t;){if(t.nodeType===3){if(r=s+t.textContent.length,s<=e&&r>=e)return{node:t,offset:e-s};s=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Km(t)}}function By(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?By(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function Vy(){for(var s=window,e=ul();e instanceof s.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)s=e.contentWindow;else break;e=ul(s.document)}return e}function Yh(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}function y1(s){var e=Vy(),t=s.focusedElem,r=s.selectionRange;if(e!==t&&t&&t.ownerDocument&&By(t.ownerDocument.documentElement,t)){if(r!==null&&Yh(t)){if(e=r.start,s=r.end,s===void 0&&(s=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(s,t.value.length);else if(s=(e=t.ownerDocument||document)&&e.defaultView||window,s.getSelection){s=s.getSelection();var n=t.textContent.length,i=Math.min(r.start,n);r=r.end===void 0?i:Math.min(r.end,n),!s.extend&&i>r&&(n=r,r=i,i=n),n=Wm(t,i);var a=Wm(t,r);n&&a&&(s.rangeCount!==1||s.anchorNode!==n.node||s.anchorOffset!==n.offset||s.focusNode!==a.node||s.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),s.removeAllRanges(),i>r?(s.addRange(e),s.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),s.addRange(e)))}}for(e=[],s=t;s=s.parentNode;)s.nodeType===1&&e.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)s=e[t],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var x1=ir&&"documentMode"in document&&11>=document.documentMode,Un=null,yd=null,ea=null,xd=!1;function Ym(s,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;xd||Un==null||Un!==ul(r)||(r=Un,"selectionStart"in r&&Yh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ea&&pa(ea,r)||(ea=r,r=yl(yd,"onSelect"),0<r.length&&(e=new zh("onSelect","select",null,e,t),s.push({event:e,listeners:r}),e.target=Un)))}function mo(s,e){var t={};return t[s.toLowerCase()]=e.toLowerCase(),t["Webkit"+s]="webkit"+e,t["Moz"+s]="moz"+e,t}var Bn={animationend:mo("Animation","AnimationEnd"),animationiteration:mo("Animation","AnimationIteration"),animationstart:mo("Animation","AnimationStart"),transitionend:mo("Transition","TransitionEnd")},Zc={},Gy={};ir&&(Gy=document.createElement("div").style,"AnimationEvent"in window||(delete Bn.animationend.animation,delete Bn.animationiteration.animation,delete Bn.animationstart.animation),"TransitionEvent"in window||delete Bn.transitionend.transition);function sc(s){if(Zc[s])return Zc[s];if(!Bn[s])return s;var e=Bn[s],t;for(t in e)if(e.hasOwnProperty(t)&&t in Gy)return Zc[s]=e[t];return s}var Hy=sc("animationend"),zy=sc("animationiteration"),Ky=sc("animationstart"),Wy=sc("transitionend"),Yy=new Map,qm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zr(s,e){Yy.set(s,e),wn(e,[s])}for(var eu=0;eu<qm.length;eu++){var tu=qm[eu],v1=tu.toLowerCase(),E1=tu[0].toUpperCase()+tu.slice(1);zr(v1,"on"+E1)}zr(Hy,"onAnimationEnd");zr(zy,"onAnimationIteration");zr(Ky,"onAnimationStart");zr("dblclick","onDoubleClick");zr("focusin","onFocus");zr("focusout","onBlur");zr(Wy,"onTransitionEnd");li("onMouseEnter",["mouseout","mouseover"]);li("onMouseLeave",["mouseout","mouseover"]);li("onPointerEnter",["pointerout","pointerover"]);li("onPointerLeave",["pointerout","pointerover"]);wn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));wn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));wn("onBeforeInput",["compositionend","keypress","textInput","paste"]);wn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));wn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));wn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),S1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wi));function Xm(s,e,t){var r=s.type||"unknown-event";s.currentTarget=t,vb(r,e,void 0,s),s.currentTarget=null}function qy(s,e){e=(e&4)!==0;for(var t=0;t<s.length;t++){var r=s[t],n=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&n.isPropagationStopped())break e;Xm(n,o,c),i=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==i&&n.isPropagationStopped())break e;Xm(n,o,c),i=l}}}if(hl)throw s=fd,hl=!1,fd=null,s}function Oe(s,e){var t=e[bd];t===void 0&&(t=e[bd]=new Set);var r=s+"__bubble";t.has(r)||(Xy(e,s,2,!1),t.add(r))}function su(s,e,t){var r=0;e&&(r|=4),Xy(t,s,r,e)}var po="_reactListening"+Math.random().toString(36).slice(2);function ga(s){if(!s[po]){s[po]=!0,ry.forEach(function(t){t!=="selectionchange"&&(S1.has(t)||su(t,!1,s),su(t,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[po]||(e[po]=!0,su("selectionchange",!1,e))}}function Xy(s,e,t,r){switch(Dy(e)){case 1:var n=Ob;break;case 4:n=Mb;break;default:n=Gh}t=n.bind(null,e,t,s),n=void 0,!hd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),r?n!==void 0?s.addEventListener(e,t,{capture:!0,passive:n}):s.addEventListener(e,t,!0):n!==void 0?s.addEventListener(e,t,{passive:n}):s.addEventListener(e,t,!1)}function ru(s,e,t,r,n){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;a=a.return}for(;o!==null;){if(a=on(o),a===null)return;if(l=a.tag,l===5||l===6){r=i=a;continue e}o=o.parentNode}}r=r.return}vy(function(){var c=i,u=$h(t),d=[];e:{var f=Yy.get(s);if(f!==void 0){var p=zh,m=s;switch(s){case"keypress":if(Ho(t)===0)break e;case"keydown":case"keyup":p=Qb;break;case"focusin":m="focus",p=Xc;break;case"focusout":m="blur",p=Xc;break;case"beforeblur":case"afterblur":p=Xc;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=jm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=$b;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=e1;break;case Hy:case zy:case Ky:p=Vb;break;case Wy:p=s1;break;case"scroll":p=Fb;break;case"wheel":p=n1;break;case"copy":case"cut":case"paste":p=Hb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Um}var y=(e&4)!==0,g=!y&&s==="scroll",x=y?f!==null?f+"Capture":null:f;y=[];for(var v=c,E;v!==null;){E=v;var T=E.stateNode;if(E.tag===5&&T!==null&&(E=T,x!==null&&(T=ua(v,x),T!=null&&y.push(ya(v,T,E)))),g)break;v=v.return}0<y.length&&(f=new p(f,m,null,t,u),d.push({event:f,listeners:y}))}}if(!(e&7)){e:{if(f=s==="mouseover"||s==="pointerover",p=s==="mouseout"||s==="pointerout",f&&t!==ud&&(m=t.relatedTarget||t.fromElement)&&(on(m)||m[ar]))break e;if((p||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,p?(m=t.relatedTarget||t.toElement,p=c,m=m?on(m):null,m!==null&&(g=An(m),m!==g||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=c),p!==m)){if(y=jm,T="onMouseLeave",x="onMouseEnter",v="mouse",(s==="pointerout"||s==="pointerover")&&(y=Um,T="onPointerLeave",x="onPointerEnter",v="pointer"),g=p==null?f:Vn(p),E=m==null?f:Vn(m),f=new y(T,v+"leave",p,t,u),f.target=g,f.relatedTarget=E,T=null,on(u)===c&&(y=new y(x,v+"enter",m,t,u),y.target=E,y.relatedTarget=g,T=y),g=T,p&&m)t:{for(y=p,x=m,v=0,E=y;E;E=_n(E))v++;for(E=0,T=x;T;T=_n(T))E++;for(;0<v-E;)y=_n(y),v--;for(;0<E-v;)x=_n(x),E--;for(;v--;){if(y===x||x!==null&&y===x.alternate)break t;y=_n(y),x=_n(x)}y=null}else y=null;p!==null&&Qm(d,f,p,y,!1),m!==null&&g!==null&&Qm(d,g,m,y,!0)}}e:{if(f=c?Vn(c):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var w=d1;else if(Gm(f))if($y)w=p1;else{w=f1;var R=h1}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(w=m1);if(w&&(w=w(s,c))){jy(d,w,t,u);break e}R&&R(s,f,c),s==="focusout"&&(R=f._wrapperState)&&R.controlled&&f.type==="number"&&id(f,"number",f.value)}switch(R=c?Vn(c):window,s){case"focusin":(Gm(R)||R.contentEditable==="true")&&(Un=R,yd=c,ea=null);break;case"focusout":ea=yd=Un=null;break;case"mousedown":xd=!0;break;case"contextmenu":case"mouseup":case"dragend":xd=!1,Ym(d,t,u);break;case"selectionchange":if(x1)break;case"keydown":case"keyup":Ym(d,t,u)}var b;if(Wh)e:{switch(s){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else $n?My(s,t)&&(_="onCompositionEnd"):s==="keydown"&&t.keyCode===229&&(_="onCompositionStart");_&&(Oy&&t.locale!=="ko"&&($n||_!=="onCompositionStart"?_==="onCompositionEnd"&&$n&&(b=Ny()):(_r=u,Hh="value"in _r?_r.value:_r.textContent,$n=!0)),R=yl(c,_),0<R.length&&(_=new $m(_,s,null,t,u),d.push({event:_,listeners:R}),b?_.data=b:(b=Fy(t),b!==null&&(_.data=b)))),(b=a1?o1(s,t):l1(s,t))&&(c=yl(c,"onBeforeInput"),0<c.length&&(u=new $m("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=b))}qy(d,e)})}function ya(s,e,t){return{instance:s,listener:e,currentTarget:t}}function yl(s,e){for(var t=e+"Capture",r=[];s!==null;){var n=s,i=n.stateNode;n.tag===5&&i!==null&&(n=i,i=ua(s,t),i!=null&&r.unshift(ya(s,i,n)),i=ua(s,e),i!=null&&r.push(ya(s,i,n))),s=s.return}return r}function _n(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function Qm(s,e,t,r,n){for(var i=e._reactName,a=[];t!==null&&t!==r;){var o=t,l=o.alternate,c=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&c!==null&&(o=c,n?(l=ua(t,i),l!=null&&a.unshift(ya(t,l,o))):n||(l=ua(t,i),l!=null&&a.push(ya(t,l,o)))),t=t.return}a.length!==0&&s.push({event:e,listeners:a})}var T1=/\r\n?/g,b1=/\u0000|\uFFFD/g;function Jm(s){return(typeof s=="string"?s:""+s).replace(T1,`
`).replace(b1,"")}function go(s,e,t){if(e=Jm(e),Jm(s)!==e&&t)throw Error(q(425))}function xl(){}var vd=null,Ed=null;function Sd(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Td=typeof setTimeout=="function"?setTimeout:void 0,w1=typeof clearTimeout=="function"?clearTimeout:void 0,Zm=typeof Promise=="function"?Promise:void 0,A1=typeof queueMicrotask=="function"?queueMicrotask:typeof Zm<"u"?function(s){return Zm.resolve(null).then(s).catch(L1)}:Td;function L1(s){setTimeout(function(){throw s})}function nu(s,e){var t=e,r=0;do{var n=t.nextSibling;if(s.removeChild(t),n&&n.nodeType===8)if(t=n.data,t==="/$"){if(r===0){s.removeChild(n),fa(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=n}while(t);fa(e)}function Dr(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return s}function ep(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return s;e--}else t==="/$"&&e++}s=s.previousSibling}return null}var wi=Math.random().toString(36).slice(2),js="__reactFiber$"+wi,xa="__reactProps$"+wi,ar="__reactContainer$"+wi,bd="__reactEvents$"+wi,_1="__reactListeners$"+wi,R1="__reactHandles$"+wi;function on(s){var e=s[js];if(e)return e;for(var t=s.parentNode;t;){if(e=t[ar]||t[js]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(s=ep(s);s!==null;){if(t=s[js])return t;s=ep(s)}return e}s=t,t=s.parentNode}return null}function ja(s){return s=s[js]||s[ar],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Vn(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(q(33))}function rc(s){return s[xa]||null}var wd=[],Gn=-1;function Kr(s){return{current:s}}function Me(s){0>Gn||(s.current=wd[Gn],wd[Gn]=null,Gn--)}function Ne(s,e){Gn++,wd[Gn]=s.current,s.current=e}var Vr={},_t=Kr(Vr),Ht=Kr(!1),pn=Vr;function ci(s,e){var t=s.type.contextTypes;if(!t)return Vr;var r=s.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var n={},i;for(i in t)n[i]=e[i];return r&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=e,s.__reactInternalMemoizedMaskedChildContext=n),n}function zt(s){return s=s.childContextTypes,s!=null}function vl(){Me(Ht),Me(_t)}function tp(s,e,t){if(_t.current!==Vr)throw Error(q(168));Ne(_t,e),Ne(Ht,t)}function Qy(s,e,t){var r=s.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var n in r)if(!(n in e))throw Error(q(108,hb(s)||"Unknown",n));return Ge({},t,r)}function El(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Vr,pn=_t.current,Ne(_t,s),Ne(Ht,Ht.current),!0}function sp(s,e,t){var r=s.stateNode;if(!r)throw Error(q(169));t?(s=Qy(s,e,pn),r.__reactInternalMemoizedMergedChildContext=s,Me(Ht),Me(_t),Ne(_t,s)):Me(Ht),Ne(Ht,t)}var er=null,nc=!1,iu=!1;function Jy(s){er===null?er=[s]:er.push(s)}function I1(s){nc=!0,Jy(s)}function Wr(){if(!iu&&er!==null){iu=!0;var s=0,e=_e;try{var t=er;for(_e=1;s<t.length;s++){var r=t[s];do r=r(!0);while(r!==null)}er=null,nc=!1}catch(n){throw er!==null&&(er=er.slice(s+1)),by(Uh,Wr),n}finally{_e=e,iu=!1}}return null}var Hn=[],zn=0,Sl=null,Tl=0,ds=[],hs=0,gn=null,tr=1,sr="";function tn(s,e){Hn[zn++]=Tl,Hn[zn++]=Sl,Sl=s,Tl=e}function Zy(s,e,t){ds[hs++]=tr,ds[hs++]=sr,ds[hs++]=gn,gn=s;var r=tr;s=sr;var n=32-As(r)-1;r&=~(1<<n),t+=1;var i=32-As(e)+n;if(30<i){var a=n-n%5;i=(r&(1<<a)-1).toString(32),r>>=a,n-=a,tr=1<<32-As(e)+n|t<<n|r,sr=i+s}else tr=1<<i|t<<n|r,sr=s}function qh(s){s.return!==null&&(tn(s,1),Zy(s,1,0))}function Xh(s){for(;s===Sl;)Sl=Hn[--zn],Hn[zn]=null,Tl=Hn[--zn],Hn[zn]=null;for(;s===gn;)gn=ds[--hs],ds[hs]=null,sr=ds[--hs],ds[hs]=null,tr=ds[--hs],ds[hs]=null}var as=null,is=null,je=!1,ws=null;function ex(s,e){var t=fs(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=s,e=s.deletions,e===null?(s.deletions=[t],s.flags|=16):e.push(t)}function rp(s,e){switch(s.tag){case 5:var t=s.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(s.stateNode=e,as=s,is=Dr(e.firstChild),!0):!1;case 6:return e=s.pendingProps===""||e.nodeType!==3?null:e,e!==null?(s.stateNode=e,as=s,is=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=gn!==null?{id:tr,overflow:sr}:null,s.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=fs(18,null,null,0),t.stateNode=e,t.return=s,s.child=t,as=s,is=null,!0):!1;default:return!1}}function Ad(s){return(s.mode&1)!==0&&(s.flags&128)===0}function Ld(s){if(je){var e=is;if(e){var t=e;if(!rp(s,e)){if(Ad(s))throw Error(q(418));e=Dr(t.nextSibling);var r=as;e&&rp(s,e)?ex(r,t):(s.flags=s.flags&-4097|2,je=!1,as=s)}}else{if(Ad(s))throw Error(q(418));s.flags=s.flags&-4097|2,je=!1,as=s}}}function np(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;as=s}function yo(s){if(s!==as)return!1;if(!je)return np(s),je=!0,!1;var e;if((e=s.tag!==3)&&!(e=s.tag!==5)&&(e=s.type,e=e!=="head"&&e!=="body"&&!Sd(s.type,s.memoizedProps)),e&&(e=is)){if(Ad(s))throw tx(),Error(q(418));for(;e;)ex(s,e),e=Dr(e.nextSibling)}if(np(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(q(317));e:{for(s=s.nextSibling,e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="/$"){if(e===0){is=Dr(s.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}s=s.nextSibling}is=null}}else is=as?Dr(s.stateNode.nextSibling):null;return!0}function tx(){for(var s=is;s;)s=Dr(s.nextSibling)}function ui(){is=as=null,je=!1}function Qh(s){ws===null?ws=[s]:ws.push(s)}var k1=cr.ReactCurrentBatchConfig;function Fi(s,e,t){if(s=t.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(q(309));var r=t.stateNode}if(!r)throw Error(q(147,s));var n=r,i=""+s;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=n.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof s!="string")throw Error(q(284));if(!t._owner)throw Error(q(290,s))}return s}function xo(s,e){throw s=Object.prototype.toString.call(e),Error(q(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s))}function ip(s){var e=s._init;return e(s._payload)}function sx(s){function e(x,v){if(s){var E=x.deletions;E===null?(x.deletions=[v],x.flags|=16):E.push(v)}}function t(x,v){if(!s)return null;for(;v!==null;)e(x,v),v=v.sibling;return null}function r(x,v){for(x=new Map;v!==null;)v.key!==null?x.set(v.key,v):x.set(v.index,v),v=v.sibling;return x}function n(x,v){return x=Fr(x,v),x.index=0,x.sibling=null,x}function i(x,v,E){return x.index=E,s?(E=x.alternate,E!==null?(E=E.index,E<v?(x.flags|=2,v):E):(x.flags|=2,v)):(x.flags|=1048576,v)}function a(x){return s&&x.alternate===null&&(x.flags|=2),x}function o(x,v,E,T){return v===null||v.tag!==6?(v=hu(E,x.mode,T),v.return=x,v):(v=n(v,E),v.return=x,v)}function l(x,v,E,T){var w=E.type;return w===jn?u(x,v,E.props.children,T,E.key):v!==null&&(v.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Sr&&ip(w)===v.type)?(T=n(v,E.props),T.ref=Fi(x,v,E),T.return=x,T):(T=Qo(E.type,E.key,E.props,null,x.mode,T),T.ref=Fi(x,v,E),T.return=x,T)}function c(x,v,E,T){return v===null||v.tag!==4||v.stateNode.containerInfo!==E.containerInfo||v.stateNode.implementation!==E.implementation?(v=fu(E,x.mode,T),v.return=x,v):(v=n(v,E.children||[]),v.return=x,v)}function u(x,v,E,T,w){return v===null||v.tag!==7?(v=hn(E,x.mode,T,w),v.return=x,v):(v=n(v,E),v.return=x,v)}function d(x,v,E){if(typeof v=="string"&&v!==""||typeof v=="number")return v=hu(""+v,x.mode,E),v.return=x,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ao:return E=Qo(v.type,v.key,v.props,null,x.mode,E),E.ref=Fi(x,null,v),E.return=x,E;case Fn:return v=fu(v,x.mode,E),v.return=x,v;case Sr:var T=v._init;return d(x,T(v._payload),E)}if(zi(v)||Pi(v))return v=hn(v,x.mode,E,null),v.return=x,v;xo(x,v)}return null}function f(x,v,E,T){var w=v!==null?v.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return w!==null?null:o(x,v,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case ao:return E.key===w?l(x,v,E,T):null;case Fn:return E.key===w?c(x,v,E,T):null;case Sr:return w=E._init,f(x,v,w(E._payload),T)}if(zi(E)||Pi(E))return w!==null?null:u(x,v,E,T,null);xo(x,E)}return null}function p(x,v,E,T,w){if(typeof T=="string"&&T!==""||typeof T=="number")return x=x.get(E)||null,o(v,x,""+T,w);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case ao:return x=x.get(T.key===null?E:T.key)||null,l(v,x,T,w);case Fn:return x=x.get(T.key===null?E:T.key)||null,c(v,x,T,w);case Sr:var R=T._init;return p(x,v,E,R(T._payload),w)}if(zi(T)||Pi(T))return x=x.get(E)||null,u(v,x,T,w,null);xo(v,T)}return null}function m(x,v,E,T){for(var w=null,R=null,b=v,_=v=0,I=null;b!==null&&_<E.length;_++){b.index>_?(I=b,b=null):I=b.sibling;var L=f(x,b,E[_],T);if(L===null){b===null&&(b=I);break}s&&b&&L.alternate===null&&e(x,b),v=i(L,v,_),R===null?w=L:R.sibling=L,R=L,b=I}if(_===E.length)return t(x,b),je&&tn(x,_),w;if(b===null){for(;_<E.length;_++)b=d(x,E[_],T),b!==null&&(v=i(b,v,_),R===null?w=b:R.sibling=b,R=b);return je&&tn(x,_),w}for(b=r(x,b);_<E.length;_++)I=p(b,x,_,E[_],T),I!==null&&(s&&I.alternate!==null&&b.delete(I.key===null?_:I.key),v=i(I,v,_),R===null?w=I:R.sibling=I,R=I);return s&&b.forEach(function(N){return e(x,N)}),je&&tn(x,_),w}function y(x,v,E,T){var w=Pi(E);if(typeof w!="function")throw Error(q(150));if(E=w.call(E),E==null)throw Error(q(151));for(var R=w=null,b=v,_=v=0,I=null,L=E.next();b!==null&&!L.done;_++,L=E.next()){b.index>_?(I=b,b=null):I=b.sibling;var N=f(x,b,L.value,T);if(N===null){b===null&&(b=I);break}s&&b&&N.alternate===null&&e(x,b),v=i(N,v,_),R===null?w=N:R.sibling=N,R=N,b=I}if(L.done)return t(x,b),je&&tn(x,_),w;if(b===null){for(;!L.done;_++,L=E.next())L=d(x,L.value,T),L!==null&&(v=i(L,v,_),R===null?w=L:R.sibling=L,R=L);return je&&tn(x,_),w}for(b=r(x,b);!L.done;_++,L=E.next())L=p(b,x,_,L.value,T),L!==null&&(s&&L.alternate!==null&&b.delete(L.key===null?_:L.key),v=i(L,v,_),R===null?w=L:R.sibling=L,R=L);return s&&b.forEach(function(M){return e(x,M)}),je&&tn(x,_),w}function g(x,v,E,T){if(typeof E=="object"&&E!==null&&E.type===jn&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case ao:e:{for(var w=E.key,R=v;R!==null;){if(R.key===w){if(w=E.type,w===jn){if(R.tag===7){t(x,R.sibling),v=n(R,E.props.children),v.return=x,x=v;break e}}else if(R.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===Sr&&ip(w)===R.type){t(x,R.sibling),v=n(R,E.props),v.ref=Fi(x,R,E),v.return=x,x=v;break e}t(x,R);break}else e(x,R);R=R.sibling}E.type===jn?(v=hn(E.props.children,x.mode,T,E.key),v.return=x,x=v):(T=Qo(E.type,E.key,E.props,null,x.mode,T),T.ref=Fi(x,v,E),T.return=x,x=T)}return a(x);case Fn:e:{for(R=E.key;v!==null;){if(v.key===R)if(v.tag===4&&v.stateNode.containerInfo===E.containerInfo&&v.stateNode.implementation===E.implementation){t(x,v.sibling),v=n(v,E.children||[]),v.return=x,x=v;break e}else{t(x,v);break}else e(x,v);v=v.sibling}v=fu(E,x.mode,T),v.return=x,x=v}return a(x);case Sr:return R=E._init,g(x,v,R(E._payload),T)}if(zi(E))return m(x,v,E,T);if(Pi(E))return y(x,v,E,T);xo(x,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,v!==null&&v.tag===6?(t(x,v.sibling),v=n(v,E),v.return=x,x=v):(t(x,v),v=hu(E,x.mode,T),v.return=x,x=v),a(x)):t(x,v)}return g}var di=sx(!0),rx=sx(!1),bl=Kr(null),wl=null,Kn=null,Jh=null;function Zh(){Jh=Kn=wl=null}function ef(s){var e=bl.current;Me(bl),s._currentValue=e}function _d(s,e,t){for(;s!==null;){var r=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),s===t)break;s=s.return}}function ti(s,e){wl=s,Jh=Kn=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&e&&(Vt=!0),s.firstContext=null)}function ps(s){var e=s._currentValue;if(Jh!==s)if(s={context:s,memoizedValue:e,next:null},Kn===null){if(wl===null)throw Error(q(308));Kn=s,wl.dependencies={lanes:0,firstContext:s}}else Kn=Kn.next=s;return e}var ln=null;function tf(s){ln===null?ln=[s]:ln.push(s)}function nx(s,e,t,r){var n=e.interleaved;return n===null?(t.next=t,tf(e)):(t.next=n.next,n.next=t),e.interleaved=t,or(s,r)}function or(s,e){s.lanes|=e;var t=s.alternate;for(t!==null&&(t.lanes|=e),t=s,s=s.return;s!==null;)s.childLanes|=e,t=s.alternate,t!==null&&(t.childLanes|=e),t=s,s=s.return;return t.tag===3?t.stateNode:null}var Tr=!1;function sf(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ix(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function nr(s,e){return{eventTime:s,lane:e,tag:0,payload:null,callback:null,next:null}}function Nr(s,e,t){var r=s.updateQueue;if(r===null)return null;if(r=r.shared,Te&2){var n=r.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),r.pending=e,or(s,t)}return n=r.interleaved,n===null?(e.next=e,tf(r)):(e.next=n.next,n.next=e),r.interleaved=e,or(s,t)}function zo(s,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=s.pendingLanes,t|=r,e.lanes=t,Bh(s,t)}}function ap(s,e){var t=s.updateQueue,r=s.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var n=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?n=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?n=i=e:i=i.next=e}else n=i=e;t={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:i,shared:r.shared,effects:r.effects},s.updateQueue=t;return}s=t.lastBaseUpdate,s===null?t.firstBaseUpdate=e:s.next=e,t.lastBaseUpdate=e}function Al(s,e,t,r){var n=s.updateQueue;Tr=!1;var i=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?i=c:a.next=c,a=l;var u=s.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(i!==null){var d=n.baseState;a=0,u=c=l=null,o=i;do{var f=o.lane,p=o.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=s,y=o;switch(f=e,p=t,y.tag){case 1:if(m=y.payload,typeof m=="function"){d=m.call(p,d,f);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,f=typeof m=="function"?m.call(p,d,f):m,f==null)break e;d=Ge({},d,f);break e;case 2:Tr=!0}}o.callback!==null&&o.lane!==0&&(s.flags|=64,f=n.effects,f===null?n.effects=[o]:f.push(o))}else p={eventTime:p,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=p,l=d):u=u.next=p,a|=f;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;f=o,o=f.next,f.next=null,n.lastBaseUpdate=f,n.shared.pending=null}}while(!0);if(u===null&&(l=d),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,e=n.shared.interleaved,e!==null){n=e;do a|=n.lane,n=n.next;while(n!==e)}else i===null&&(n.shared.lanes=0);xn|=a,s.lanes=a,s.memoizedState=d}}function op(s,e,t){if(s=e.effects,e.effects=null,s!==null)for(e=0;e<s.length;e++){var r=s[e],n=r.callback;if(n!==null){if(r.callback=null,r=t,typeof n!="function")throw Error(q(191,n));n.call(r)}}}var $a={},Vs=Kr($a),va=Kr($a),Ea=Kr($a);function cn(s){if(s===$a)throw Error(q(174));return s}function rf(s,e){switch(Ne(Ea,e),Ne(va,s),Ne(Vs,$a),s=e.nodeType,s){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:od(null,"");break;default:s=s===8?e.parentNode:e,e=s.namespaceURI||null,s=s.tagName,e=od(e,s)}Me(Vs),Ne(Vs,e)}function hi(){Me(Vs),Me(va),Me(Ea)}function ax(s){cn(Ea.current);var e=cn(Vs.current),t=od(e,s.type);e!==t&&(Ne(va,s),Ne(Vs,t))}function nf(s){va.current===s&&(Me(Vs),Me(va))}var Ue=Kr(0);function Ll(s){for(var e=s;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var au=[];function af(){for(var s=0;s<au.length;s++)au[s]._workInProgressVersionPrimary=null;au.length=0}var Ko=cr.ReactCurrentDispatcher,ou=cr.ReactCurrentBatchConfig,yn=0,Ve=null,it=null,ut=null,_l=!1,ta=!1,Sa=0,C1=0;function Tt(){throw Error(q(321))}function of(s,e){if(e===null)return!1;for(var t=0;t<e.length&&t<s.length;t++)if(!_s(s[t],e[t]))return!1;return!0}function lf(s,e,t,r,n,i){if(yn=i,Ve=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ko.current=s===null||s.memoizedState===null?O1:M1,s=t(r,n),ta){i=0;do{if(ta=!1,Sa=0,25<=i)throw Error(q(301));i+=1,ut=it=null,e.updateQueue=null,Ko.current=F1,s=t(r,n)}while(ta)}if(Ko.current=Rl,e=it!==null&&it.next!==null,yn=0,ut=it=Ve=null,_l=!1,e)throw Error(q(300));return s}function cf(){var s=Sa!==0;return Sa=0,s}function Ns(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ut===null?Ve.memoizedState=ut=s:ut=ut.next=s,ut}function gs(){if(it===null){var s=Ve.alternate;s=s!==null?s.memoizedState:null}else s=it.next;var e=ut===null?Ve.memoizedState:ut.next;if(e!==null)ut=e,it=s;else{if(s===null)throw Error(q(310));it=s,s={memoizedState:it.memoizedState,baseState:it.baseState,baseQueue:it.baseQueue,queue:it.queue,next:null},ut===null?Ve.memoizedState=ut=s:ut=ut.next=s}return ut}function Ta(s,e){return typeof e=="function"?e(s):e}function lu(s){var e=gs(),t=e.queue;if(t===null)throw Error(q(311));t.lastRenderedReducer=s;var r=it,n=r.baseQueue,i=t.pending;if(i!==null){if(n!==null){var a=n.next;n.next=i.next,i.next=a}r.baseQueue=n=i,t.pending=null}if(n!==null){i=n.next,r=r.baseState;var o=a=null,l=null,c=i;do{var u=c.lane;if((yn&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:s(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=d,a=r):l=l.next=d,Ve.lanes|=u,xn|=u}c=c.next}while(c!==null&&c!==i);l===null?a=r:l.next=o,_s(r,e.memoizedState)||(Vt=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,t.lastRenderedState=r}if(s=t.interleaved,s!==null){n=s;do i=n.lane,Ve.lanes|=i,xn|=i,n=n.next;while(n!==s)}else n===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function cu(s){var e=gs(),t=e.queue;if(t===null)throw Error(q(311));t.lastRenderedReducer=s;var r=t.dispatch,n=t.pending,i=e.memoizedState;if(n!==null){t.pending=null;var a=n=n.next;do i=s(i,a.action),a=a.next;while(a!==n);_s(i,e.memoizedState)||(Vt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function ox(){}function lx(s,e){var t=Ve,r=gs(),n=e(),i=!_s(r.memoizedState,n);if(i&&(r.memoizedState=n,Vt=!0),r=r.queue,uf(dx.bind(null,t,r,s),[s]),r.getSnapshot!==e||i||ut!==null&&ut.memoizedState.tag&1){if(t.flags|=2048,ba(9,ux.bind(null,t,r,n,e),void 0,null),dt===null)throw Error(q(349));yn&30||cx(t,e,n)}return n}function cx(s,e,t){s.flags|=16384,s={getSnapshot:e,value:t},e=Ve.updateQueue,e===null?(e={lastEffect:null,stores:null},Ve.updateQueue=e,e.stores=[s]):(t=e.stores,t===null?e.stores=[s]:t.push(s))}function ux(s,e,t,r){e.value=t,e.getSnapshot=r,hx(e)&&fx(s)}function dx(s,e,t){return t(function(){hx(e)&&fx(s)})}function hx(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!_s(s,t)}catch{return!0}}function fx(s){var e=or(s,1);e!==null&&Ls(e,s,1,-1)}function lp(s){var e=Ns();return typeof s=="function"&&(s=s()),e.memoizedState=e.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ta,lastRenderedState:s},e.queue=s,s=s.dispatch=N1.bind(null,Ve,s),[e.memoizedState,s]}function ba(s,e,t,r){return s={tag:s,create:e,destroy:t,deps:r,next:null},e=Ve.updateQueue,e===null?(e={lastEffect:null,stores:null},Ve.updateQueue=e,e.lastEffect=s.next=s):(t=e.lastEffect,t===null?e.lastEffect=s.next=s:(r=t.next,t.next=s,s.next=r,e.lastEffect=s)),s}function mx(){return gs().memoizedState}function Wo(s,e,t,r){var n=Ns();Ve.flags|=s,n.memoizedState=ba(1|e,t,void 0,r===void 0?null:r)}function ic(s,e,t,r){var n=gs();r=r===void 0?null:r;var i=void 0;if(it!==null){var a=it.memoizedState;if(i=a.destroy,r!==null&&of(r,a.deps)){n.memoizedState=ba(e,t,i,r);return}}Ve.flags|=s,n.memoizedState=ba(1|e,t,i,r)}function cp(s,e){return Wo(8390656,8,s,e)}function uf(s,e){return ic(2048,8,s,e)}function px(s,e){return ic(4,2,s,e)}function gx(s,e){return ic(4,4,s,e)}function yx(s,e){if(typeof e=="function")return s=s(),e(s),function(){e(null)};if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function xx(s,e,t){return t=t!=null?t.concat([s]):null,ic(4,4,yx.bind(null,e,s),t)}function df(){}function vx(s,e){var t=gs();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&of(e,r[1])?r[0]:(t.memoizedState=[s,e],s)}function Ex(s,e){var t=gs();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&of(e,r[1])?r[0]:(s=s(),t.memoizedState=[s,e],s)}function Sx(s,e,t){return yn&21?(_s(t,e)||(t=Ly(),Ve.lanes|=t,xn|=t,s.baseState=!0),e):(s.baseState&&(s.baseState=!1,Vt=!0),s.memoizedState=t)}function P1(s,e){var t=_e;_e=t!==0&&4>t?t:4,s(!0);var r=ou.transition;ou.transition={};try{s(!1),e()}finally{_e=t,ou.transition=r}}function Tx(){return gs().memoizedState}function D1(s,e,t){var r=Mr(s);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},bx(s))wx(e,t);else if(t=nx(s,e,t,r),t!==null){var n=Pt();Ls(t,s,r,n),Ax(t,e,r)}}function N1(s,e,t){var r=Mr(s),n={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(bx(s))wx(e,n);else{var i=s.alternate;if(s.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(n.hasEagerState=!0,n.eagerState=o,_s(o,a)){var l=e.interleaved;l===null?(n.next=n,tf(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}t=nx(s,e,n,r),t!==null&&(n=Pt(),Ls(t,s,r,n),Ax(t,e,r))}}function bx(s){var e=s.alternate;return s===Ve||e!==null&&e===Ve}function wx(s,e){ta=_l=!0;var t=s.pending;t===null?e.next=e:(e.next=t.next,t.next=e),s.pending=e}function Ax(s,e,t){if(t&4194240){var r=e.lanes;r&=s.pendingLanes,t|=r,e.lanes=t,Bh(s,t)}}var Rl={readContext:ps,useCallback:Tt,useContext:Tt,useEffect:Tt,useImperativeHandle:Tt,useInsertionEffect:Tt,useLayoutEffect:Tt,useMemo:Tt,useReducer:Tt,useRef:Tt,useState:Tt,useDebugValue:Tt,useDeferredValue:Tt,useTransition:Tt,useMutableSource:Tt,useSyncExternalStore:Tt,useId:Tt,unstable_isNewReconciler:!1},O1={readContext:ps,useCallback:function(s,e){return Ns().memoizedState=[s,e===void 0?null:e],s},useContext:ps,useEffect:cp,useImperativeHandle:function(s,e,t){return t=t!=null?t.concat([s]):null,Wo(4194308,4,yx.bind(null,e,s),t)},useLayoutEffect:function(s,e){return Wo(4194308,4,s,e)},useInsertionEffect:function(s,e){return Wo(4,2,s,e)},useMemo:function(s,e){var t=Ns();return e=e===void 0?null:e,s=s(),t.memoizedState=[s,e],s},useReducer:function(s,e,t){var r=Ns();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:e},r.queue=s,s=s.dispatch=D1.bind(null,Ve,s),[r.memoizedState,s]},useRef:function(s){var e=Ns();return s={current:s},e.memoizedState=s},useState:lp,useDebugValue:df,useDeferredValue:function(s){return Ns().memoizedState=s},useTransition:function(){var s=lp(!1),e=s[0];return s=P1.bind(null,s[1]),Ns().memoizedState=s,[e,s]},useMutableSource:function(){},useSyncExternalStore:function(s,e,t){var r=Ve,n=Ns();if(je){if(t===void 0)throw Error(q(407));t=t()}else{if(t=e(),dt===null)throw Error(q(349));yn&30||cx(r,e,t)}n.memoizedState=t;var i={value:t,getSnapshot:e};return n.queue=i,cp(dx.bind(null,r,i,s),[s]),r.flags|=2048,ba(9,ux.bind(null,r,i,t,e),void 0,null),t},useId:function(){var s=Ns(),e=dt.identifierPrefix;if(je){var t=sr,r=tr;t=(r&~(1<<32-As(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Sa++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=C1++,e=":"+e+"r"+t.toString(32)+":";return s.memoizedState=e},unstable_isNewReconciler:!1},M1={readContext:ps,useCallback:vx,useContext:ps,useEffect:uf,useImperativeHandle:xx,useInsertionEffect:px,useLayoutEffect:gx,useMemo:Ex,useReducer:lu,useRef:mx,useState:function(){return lu(Ta)},useDebugValue:df,useDeferredValue:function(s){var e=gs();return Sx(e,it.memoizedState,s)},useTransition:function(){var s=lu(Ta)[0],e=gs().memoizedState;return[s,e]},useMutableSource:ox,useSyncExternalStore:lx,useId:Tx,unstable_isNewReconciler:!1},F1={readContext:ps,useCallback:vx,useContext:ps,useEffect:uf,useImperativeHandle:xx,useInsertionEffect:px,useLayoutEffect:gx,useMemo:Ex,useReducer:cu,useRef:mx,useState:function(){return cu(Ta)},useDebugValue:df,useDeferredValue:function(s){var e=gs();return it===null?e.memoizedState=s:Sx(e,it.memoizedState,s)},useTransition:function(){var s=cu(Ta)[0],e=gs().memoizedState;return[s,e]},useMutableSource:ox,useSyncExternalStore:lx,useId:Tx,unstable_isNewReconciler:!1};function Ts(s,e){if(s&&s.defaultProps){e=Ge({},e),s=s.defaultProps;for(var t in s)e[t]===void 0&&(e[t]=s[t]);return e}return e}function Rd(s,e,t,r){e=s.memoizedState,t=t(r,e),t=t==null?e:Ge({},e,t),s.memoizedState=t,s.lanes===0&&(s.updateQueue.baseState=t)}var ac={isMounted:function(s){return(s=s._reactInternals)?An(s)===s:!1},enqueueSetState:function(s,e,t){s=s._reactInternals;var r=Pt(),n=Mr(s),i=nr(r,n);i.payload=e,t!=null&&(i.callback=t),e=Nr(s,i,n),e!==null&&(Ls(e,s,n,r),zo(e,s,n))},enqueueReplaceState:function(s,e,t){s=s._reactInternals;var r=Pt(),n=Mr(s),i=nr(r,n);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Nr(s,i,n),e!==null&&(Ls(e,s,n,r),zo(e,s,n))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var t=Pt(),r=Mr(s),n=nr(t,r);n.tag=2,e!=null&&(n.callback=e),e=Nr(s,n,r),e!==null&&(Ls(e,s,r,t),zo(e,s,r))}};function up(s,e,t,r,n,i,a){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!pa(t,r)||!pa(n,i):!0}function Lx(s,e,t){var r=!1,n=Vr,i=e.contextType;return typeof i=="object"&&i!==null?i=ps(i):(n=zt(e)?pn:_t.current,r=e.contextTypes,i=(r=r!=null)?ci(s,n):Vr),e=new e(t,i),s.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ac,s.stateNode=e,e._reactInternals=s,r&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=n,s.__reactInternalMemoizedMaskedChildContext=i),e}function dp(s,e,t,r){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==s&&ac.enqueueReplaceState(e,e.state,null)}function Id(s,e,t,r){var n=s.stateNode;n.props=t,n.state=s.memoizedState,n.refs={},sf(s);var i=e.contextType;typeof i=="object"&&i!==null?n.context=ps(i):(i=zt(e)?pn:_t.current,n.context=ci(s,i)),n.state=s.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Rd(s,e,i,t),n.state=s.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&ac.enqueueReplaceState(n,n.state,null),Al(s,t,n,r),n.state=s.memoizedState),typeof n.componentDidMount=="function"&&(s.flags|=4194308)}function fi(s,e){try{var t="",r=e;do t+=db(r),r=r.return;while(r);var n=t}catch(i){n=`
Error generating stack: `+i.message+`
`+i.stack}return{value:s,source:e,stack:n,digest:null}}function uu(s,e,t){return{value:s,source:null,stack:t??null,digest:e??null}}function kd(s,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var j1=typeof WeakMap=="function"?WeakMap:Map;function _x(s,e,t){t=nr(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){kl||(kl=!0,Ud=r),kd(s,e)},t}function Rx(s,e,t){t=nr(-1,t),t.tag=3;var r=s.type.getDerivedStateFromError;if(typeof r=="function"){var n=e.value;t.payload=function(){return r(n)},t.callback=function(){kd(s,e)}}var i=s.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){kd(s,e),typeof r!="function"&&(Or===null?Or=new Set([this]):Or.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function hp(s,e,t){var r=s.pingCache;if(r===null){r=s.pingCache=new j1;var n=new Set;r.set(e,n)}else n=r.get(e),n===void 0&&(n=new Set,r.set(e,n));n.has(t)||(n.add(t),s=J1.bind(null,s,e,t),e.then(s,s))}function fp(s){do{var e;if((e=s.tag===13)&&(e=s.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return s;s=s.return}while(s!==null);return null}function mp(s,e,t,r,n){return s.mode&1?(s.flags|=65536,s.lanes=n,s):(s===e?s.flags|=65536:(s.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=nr(-1,1),e.tag=2,Nr(t,e,1))),t.lanes|=1),s)}var $1=cr.ReactCurrentOwner,Vt=!1;function kt(s,e,t,r){e.child=s===null?rx(e,null,t,r):di(e,s.child,t,r)}function pp(s,e,t,r,n){t=t.render;var i=e.ref;return ti(e,n),r=lf(s,e,t,r,i,n),t=cf(),s!==null&&!Vt?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~n,lr(s,e,n)):(je&&t&&qh(e),e.flags|=1,kt(s,e,r,n),e.child)}function gp(s,e,t,r,n){if(s===null){var i=t.type;return typeof i=="function"&&!vf(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,Ix(s,e,i,r,n)):(s=Qo(t.type,null,r,e,e.mode,n),s.ref=e.ref,s.return=e,e.child=s)}if(i=s.child,!(s.lanes&n)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:pa,t(a,r)&&s.ref===e.ref)return lr(s,e,n)}return e.flags|=1,s=Fr(i,r),s.ref=e.ref,s.return=e,e.child=s}function Ix(s,e,t,r,n){if(s!==null){var i=s.memoizedProps;if(pa(i,r)&&s.ref===e.ref)if(Vt=!1,e.pendingProps=r=i,(s.lanes&n)!==0)s.flags&131072&&(Vt=!0);else return e.lanes=s.lanes,lr(s,e,n)}return Cd(s,e,t,r,n)}function kx(s,e,t){var r=e.pendingProps,n=r.children,i=s!==null?s.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ne(Yn,ss),ss|=t;else{if(!(t&1073741824))return s=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:s,cachePool:null,transitions:null},e.updateQueue=null,Ne(Yn,ss),ss|=s,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Ne(Yn,ss),ss|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Ne(Yn,ss),ss|=r;return kt(s,e,n,t),e.child}function Cx(s,e){var t=e.ref;(s===null&&t!==null||s!==null&&s.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Cd(s,e,t,r,n){var i=zt(t)?pn:_t.current;return i=ci(e,i),ti(e,n),t=lf(s,e,t,r,i,n),r=cf(),s!==null&&!Vt?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~n,lr(s,e,n)):(je&&r&&qh(e),e.flags|=1,kt(s,e,t,n),e.child)}function yp(s,e,t,r,n){if(zt(t)){var i=!0;El(e)}else i=!1;if(ti(e,n),e.stateNode===null)Yo(s,e),Lx(e,t,r),Id(e,t,r,n),r=!0;else if(s===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,c=t.contextType;typeof c=="object"&&c!==null?c=ps(c):(c=zt(t)?pn:_t.current,c=ci(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==c)&&dp(e,a,r,c),Tr=!1;var f=e.memoizedState;a.state=f,Al(e,r,a,n),l=e.memoizedState,o!==r||f!==l||Ht.current||Tr?(typeof u=="function"&&(Rd(e,t,u,r),l=e.memoizedState),(o=Tr||up(e,t,o,r,f,l,c))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,ix(s,e),o=e.memoizedProps,c=e.type===e.elementType?o:Ts(e.type,o),a.props=c,d=e.pendingProps,f=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=ps(l):(l=zt(t)?pn:_t.current,l=ci(e,l));var p=t.getDerivedStateFromProps;(u=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||f!==l)&&dp(e,a,r,l),Tr=!1,f=e.memoizedState,a.state=f,Al(e,r,a,n);var m=e.memoizedState;o!==d||f!==m||Ht.current||Tr?(typeof p=="function"&&(Rd(e,t,p,r),m=e.memoizedState),(c=Tr||up(e,t,c,r,f,m,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,m,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,m,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&f===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&f===s.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),a.props=r,a.state=m,a.context=l,r=c):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&f===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&f===s.memoizedState||(e.flags|=1024),r=!1)}return Pd(s,e,t,r,i,n)}function Pd(s,e,t,r,n,i){Cx(s,e);var a=(e.flags&128)!==0;if(!r&&!a)return n&&sp(e,t,!1),lr(s,e,i);r=e.stateNode,$1.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,s!==null&&a?(e.child=di(e,s.child,null,i),e.child=di(e,null,o,i)):kt(s,e,o,i),e.memoizedState=r.state,n&&sp(e,t,!0),e.child}function Px(s){var e=s.stateNode;e.pendingContext?tp(s,e.pendingContext,e.pendingContext!==e.context):e.context&&tp(s,e.context,!1),rf(s,e.containerInfo)}function xp(s,e,t,r,n){return ui(),Qh(n),e.flags|=256,kt(s,e,t,r),e.child}var Dd={dehydrated:null,treeContext:null,retryLane:0};function Nd(s){return{baseLanes:s,cachePool:null,transitions:null}}function Dx(s,e,t){var r=e.pendingProps,n=Ue.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=s!==null&&s.memoizedState===null?!1:(n&2)!==0),o?(i=!0,e.flags&=-129):(s===null||s.memoizedState!==null)&&(n|=1),Ne(Ue,n&1),s===null)return Ld(e),s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(e.mode&1?s.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,s=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=cc(a,r,0,null),s=hn(s,r,t,null),i.return=e,s.return=e,i.sibling=s,e.child=i,e.child.memoizedState=Nd(t),e.memoizedState=Dd,s):hf(e,a));if(n=s.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return U1(s,e,a,r,o,n,t);if(i){i=r.fallback,a=e.mode,n=s.child,o=n.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==n?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Fr(n,l),r.subtreeFlags=n.subtreeFlags&14680064),o!==null?i=Fr(o,i):(i=hn(i,a,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=s.child.memoizedState,a=a===null?Nd(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=s.childLanes&~t,e.memoizedState=Dd,r}return i=s.child,s=i.sibling,r=Fr(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,s!==null&&(t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)),e.child=r,e.memoizedState=null,r}function hf(s,e){return e=cc({mode:"visible",children:e},s.mode,0,null),e.return=s,s.child=e}function vo(s,e,t,r){return r!==null&&Qh(r),di(e,s.child,null,t),s=hf(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function U1(s,e,t,r,n,i,a){if(t)return e.flags&256?(e.flags&=-257,r=uu(Error(q(422))),vo(s,e,a,r)):e.memoizedState!==null?(e.child=s.child,e.flags|=128,null):(i=r.fallback,n=e.mode,r=cc({mode:"visible",children:r.children},n,0,null),i=hn(i,n,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&di(e,s.child,null,a),e.child.memoizedState=Nd(a),e.memoizedState=Dd,i);if(!(e.mode&1))return vo(s,e,a,null);if(n.data==="$!"){if(r=n.nextSibling&&n.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(q(419)),r=uu(i,r,void 0),vo(s,e,a,r)}if(o=(a&s.childLanes)!==0,Vt||o){if(r=dt,r!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(r.suspendedLanes|a)?0:n,n!==0&&n!==i.retryLane&&(i.retryLane=n,or(s,n),Ls(r,s,n,-1))}return xf(),r=uu(Error(q(421))),vo(s,e,a,r)}return n.data==="$?"?(e.flags|=128,e.child=s.child,e=Z1.bind(null,s),n._reactRetry=e,null):(s=i.treeContext,is=Dr(n.nextSibling),as=e,je=!0,ws=null,s!==null&&(ds[hs++]=tr,ds[hs++]=sr,ds[hs++]=gn,tr=s.id,sr=s.overflow,gn=e),e=hf(e,r.children),e.flags|=4096,e)}function vp(s,e,t){s.lanes|=e;var r=s.alternate;r!==null&&(r.lanes|=e),_d(s.return,e,t)}function du(s,e,t,r,n){var i=s.memoizedState;i===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:n}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=n)}function Nx(s,e,t){var r=e.pendingProps,n=r.revealOrder,i=r.tail;if(kt(s,e,r.children,t),r=Ue.current,r&2)r=r&1|2,e.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&vp(s,t,e);else if(s.tag===19)vp(s,t,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}r&=1}if(Ne(Ue,r),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(t=e.child,n=null;t!==null;)s=t.alternate,s!==null&&Ll(s)===null&&(n=t),t=t.sibling;t=n,t===null?(n=e.child,e.child=null):(n=t.sibling,t.sibling=null),du(e,!1,n,t,i);break;case"backwards":for(t=null,n=e.child,e.child=null;n!==null;){if(s=n.alternate,s!==null&&Ll(s)===null){e.child=n;break}s=n.sibling,n.sibling=t,t=n,n=s}du(e,!0,t,null,i);break;case"together":du(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Yo(s,e){!(e.mode&1)&&s!==null&&(s.alternate=null,e.alternate=null,e.flags|=2)}function lr(s,e,t){if(s!==null&&(e.dependencies=s.dependencies),xn|=e.lanes,!(t&e.childLanes))return null;if(s!==null&&e.child!==s.child)throw Error(q(153));if(e.child!==null){for(s=e.child,t=Fr(s,s.pendingProps),e.child=t,t.return=e;s.sibling!==null;)s=s.sibling,t=t.sibling=Fr(s,s.pendingProps),t.return=e;t.sibling=null}return e.child}function B1(s,e,t){switch(e.tag){case 3:Px(e),ui();break;case 5:ax(e);break;case 1:zt(e.type)&&El(e);break;case 4:rf(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,n=e.memoizedProps.value;Ne(bl,r._currentValue),r._currentValue=n;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ne(Ue,Ue.current&1),e.flags|=128,null):t&e.child.childLanes?Dx(s,e,t):(Ne(Ue,Ue.current&1),s=lr(s,e,t),s!==null?s.sibling:null);Ne(Ue,Ue.current&1);break;case 19:if(r=(t&e.childLanes)!==0,s.flags&128){if(r)return Nx(s,e,t);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),Ne(Ue,Ue.current),r)break;return null;case 22:case 23:return e.lanes=0,kx(s,e,t)}return lr(s,e,t)}var Ox,Od,Mx,Fx;Ox=function(s,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)s.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Od=function(){};Mx=function(s,e,t,r){var n=s.memoizedProps;if(n!==r){s=e.stateNode,cn(Vs.current);var i=null;switch(t){case"input":n=rd(s,n),r=rd(s,r),i=[];break;case"select":n=Ge({},n,{value:void 0}),r=Ge({},r,{value:void 0}),i=[];break;case"textarea":n=ad(s,n),r=ad(s,r),i=[];break;default:typeof n.onClick!="function"&&typeof r.onClick=="function"&&(s.onclick=xl)}ld(t,r);var a;t=null;for(c in n)if(!r.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var o=n[c];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(la.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var l=r[c];if(o=n!=null?n[c]:void 0,r.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(i||(i=[]),i.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(la.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Oe("scroll",s),i||o===l||(i=[])):(i=i||[]).push(c,l))}t&&(i=i||[]).push("style",t);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};Fx=function(s,e,t,r){t!==r&&(e.flags|=4)};function ji(s,e){if(!je)switch(s.tailMode){case"hidden":e=s.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?s.tail=null:t.sibling=null;break;case"collapsed":t=s.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:r.sibling=null}}function bt(s){var e=s.alternate!==null&&s.alternate.child===s.child,t=0,r=0;if(e)for(var n=s.child;n!==null;)t|=n.lanes|n.childLanes,r|=n.subtreeFlags&14680064,r|=n.flags&14680064,n.return=s,n=n.sibling;else for(n=s.child;n!==null;)t|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=s,n=n.sibling;return s.subtreeFlags|=r,s.childLanes=t,e}function V1(s,e,t){var r=e.pendingProps;switch(Xh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bt(e),null;case 1:return zt(e.type)&&vl(),bt(e),null;case 3:return r=e.stateNode,hi(),Me(Ht),Me(_t),af(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(s===null||s.child===null)&&(yo(e)?e.flags|=4:s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ws!==null&&(Gd(ws),ws=null))),Od(s,e),bt(e),null;case 5:nf(e);var n=cn(Ea.current);if(t=e.type,s!==null&&e.stateNode!=null)Mx(s,e,t,r,n),s.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(q(166));return bt(e),null}if(s=cn(Vs.current),yo(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[js]=e,r[xa]=i,s=(e.mode&1)!==0,t){case"dialog":Oe("cancel",r),Oe("close",r);break;case"iframe":case"object":case"embed":Oe("load",r);break;case"video":case"audio":for(n=0;n<Wi.length;n++)Oe(Wi[n],r);break;case"source":Oe("error",r);break;case"img":case"image":case"link":Oe("error",r),Oe("load",r);break;case"details":Oe("toggle",r);break;case"input":Rm(r,i),Oe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Oe("invalid",r);break;case"textarea":km(r,i),Oe("invalid",r)}ld(t,i),n=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&go(r.textContent,o,s),n=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&go(r.textContent,o,s),n=["children",""+o]):la.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Oe("scroll",r)}switch(t){case"input":oo(r),Im(r,i,!0);break;case"textarea":oo(r),Cm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=xl)}r=n,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=dy(t)),s==="http://www.w3.org/1999/xhtml"?t==="script"?(s=a.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof r.is=="string"?s=a.createElement(t,{is:r.is}):(s=a.createElement(t),t==="select"&&(a=s,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):s=a.createElementNS(s,t),s[js]=e,s[xa]=r,Ox(s,e,!1,!1),e.stateNode=s;e:{switch(a=cd(t,r),t){case"dialog":Oe("cancel",s),Oe("close",s),n=r;break;case"iframe":case"object":case"embed":Oe("load",s),n=r;break;case"video":case"audio":for(n=0;n<Wi.length;n++)Oe(Wi[n],s);n=r;break;case"source":Oe("error",s),n=r;break;case"img":case"image":case"link":Oe("error",s),Oe("load",s),n=r;break;case"details":Oe("toggle",s),n=r;break;case"input":Rm(s,r),n=rd(s,r),Oe("invalid",s);break;case"option":n=r;break;case"select":s._wrapperState={wasMultiple:!!r.multiple},n=Ge({},r,{value:void 0}),Oe("invalid",s);break;case"textarea":km(s,r),n=ad(s,r),Oe("invalid",s);break;default:n=r}ld(t,n),o=n;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?my(s,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&hy(s,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&ca(s,l):typeof l=="number"&&ca(s,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(la.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Oe("scroll",s):l!=null&&Oh(s,i,l,a))}switch(t){case"input":oo(s),Im(s,r,!1);break;case"textarea":oo(s),Cm(s);break;case"option":r.value!=null&&s.setAttribute("value",""+Br(r.value));break;case"select":s.multiple=!!r.multiple,i=r.value,i!=null?Qn(s,!!r.multiple,i,!1):r.defaultValue!=null&&Qn(s,!!r.multiple,r.defaultValue,!0);break;default:typeof n.onClick=="function"&&(s.onclick=xl)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return bt(e),null;case 6:if(s&&e.stateNode!=null)Fx(s,e,s.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(q(166));if(t=cn(Ea.current),cn(Vs.current),yo(e)){if(r=e.stateNode,t=e.memoizedProps,r[js]=e,(i=r.nodeValue!==t)&&(s=as,s!==null))switch(s.tag){case 3:go(r.nodeValue,t,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&go(r.nodeValue,t,(s.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[js]=e,e.stateNode=r}return bt(e),null;case 13:if(Me(Ue),r=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(je&&is!==null&&e.mode&1&&!(e.flags&128))tx(),ui(),e.flags|=98560,i=!1;else if(i=yo(e),r!==null&&r.dehydrated!==null){if(s===null){if(!i)throw Error(q(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(q(317));i[js]=e}else ui(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;bt(e),i=!1}else ws!==null&&(Gd(ws),ws=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(s!==null&&s.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(s===null||Ue.current&1?ot===0&&(ot=3):xf())),e.updateQueue!==null&&(e.flags|=4),bt(e),null);case 4:return hi(),Od(s,e),s===null&&ga(e.stateNode.containerInfo),bt(e),null;case 10:return ef(e.type._context),bt(e),null;case 17:return zt(e.type)&&vl(),bt(e),null;case 19:if(Me(Ue),i=e.memoizedState,i===null)return bt(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)ji(i,!1);else{if(ot!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(a=Ll(s),a!==null){for(e.flags|=128,ji(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,s=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,s=a.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t=t.sibling;return Ne(Ue,Ue.current&1|2),e.child}s=s.sibling}i.tail!==null&&Je()>mi&&(e.flags|=128,r=!0,ji(i,!1),e.lanes=4194304)}else{if(!r)if(s=Ll(a),s!==null){if(e.flags|=128,r=!0,t=s.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ji(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!je)return bt(e),null}else 2*Je()-i.renderingStartTime>mi&&t!==1073741824&&(e.flags|=128,r=!0,ji(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Je(),e.sibling=null,t=Ue.current,Ne(Ue,r?t&1|2:t&1),e):(bt(e),null);case 22:case 23:return yf(),r=e.memoizedState!==null,s!==null&&s.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ss&1073741824&&(bt(e),e.subtreeFlags&6&&(e.flags|=8192)):bt(e),null;case 24:return null;case 25:return null}throw Error(q(156,e.tag))}function G1(s,e){switch(Xh(e),e.tag){case 1:return zt(e.type)&&vl(),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return hi(),Me(Ht),Me(_t),af(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 5:return nf(e),null;case 13:if(Me(Ue),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error(q(340));ui()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return Me(Ue),null;case 4:return hi(),null;case 10:return ef(e.type._context),null;case 22:case 23:return yf(),null;case 24:return null;default:return null}}var Eo=!1,At=!1,H1=typeof WeakSet=="function"?WeakSet:Set,ie=null;function Wn(s,e){var t=s.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ye(s,e,r)}else t.current=null}function Md(s,e,t){try{t()}catch(r){Ye(s,e,r)}}var Ep=!1;function z1(s,e){if(vd=pl,s=Vy(),Yh(s)){if("selectionStart"in s)var t={start:s.selectionStart,end:s.selectionEnd};else e:{t=(t=s.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var n=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,c=0,u=0,d=s,f=null;t:for(;;){for(var p;d!==t||n!==0&&d.nodeType!==3||(o=a+n),d!==i||r!==0&&d.nodeType!==3||(l=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===s)break t;if(f===t&&++c===n&&(o=a),f===i&&++u===r&&(l=a),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Ed={focusedElem:s,selectionRange:t},pl=!1,ie=e;ie!==null;)if(e=ie,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,ie=s;else for(;ie!==null;){e=ie;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,g=m.memoizedState,x=e.stateNode,v=x.getSnapshotBeforeUpdate(e.elementType===e.type?y:Ts(e.type,y),g);x.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(q(163))}}catch(T){Ye(e,e.return,T)}if(s=e.sibling,s!==null){s.return=e.return,ie=s;break}ie=e.return}return m=Ep,Ep=!1,m}function sa(s,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do{if((n.tag&s)===s){var i=n.destroy;n.destroy=void 0,i!==void 0&&Md(e,t,i)}n=n.next}while(n!==r)}}function oc(s,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&s)===s){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Fd(s){var e=s.ref;if(e!==null){var t=s.stateNode;switch(s.tag){case 5:s=t;break;default:s=t}typeof e=="function"?e(s):e.current=s}}function jx(s){var e=s.alternate;e!==null&&(s.alternate=null,jx(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&(delete e[js],delete e[xa],delete e[bd],delete e[_1],delete e[R1])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function $x(s){return s.tag===5||s.tag===3||s.tag===4}function Sp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||$x(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function jd(s,e,t){var r=s.tag;if(r===5||r===6)s=s.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(s,e):t.insertBefore(s,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(s,t)):(e=t,e.appendChild(s)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=xl));else if(r!==4&&(s=s.child,s!==null))for(jd(s,e,t),s=s.sibling;s!==null;)jd(s,e,t),s=s.sibling}function $d(s,e,t){var r=s.tag;if(r===5||r===6)s=s.stateNode,e?t.insertBefore(s,e):t.appendChild(s);else if(r!==4&&(s=s.child,s!==null))for($d(s,e,t),s=s.sibling;s!==null;)$d(s,e,t),s=s.sibling}var mt=null,bs=!1;function yr(s,e,t){for(t=t.child;t!==null;)Ux(s,e,t),t=t.sibling}function Ux(s,e,t){if(Bs&&typeof Bs.onCommitFiberUnmount=="function")try{Bs.onCommitFiberUnmount(Zl,t)}catch{}switch(t.tag){case 5:At||Wn(t,e);case 6:var r=mt,n=bs;mt=null,yr(s,e,t),mt=r,bs=n,mt!==null&&(bs?(s=mt,t=t.stateNode,s.nodeType===8?s.parentNode.removeChild(t):s.removeChild(t)):mt.removeChild(t.stateNode));break;case 18:mt!==null&&(bs?(s=mt,t=t.stateNode,s.nodeType===8?nu(s.parentNode,t):s.nodeType===1&&nu(s,t),fa(s)):nu(mt,t.stateNode));break;case 4:r=mt,n=bs,mt=t.stateNode.containerInfo,bs=!0,yr(s,e,t),mt=r,bs=n;break;case 0:case 11:case 14:case 15:if(!At&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){n=r=r.next;do{var i=n,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Md(t,e,a),n=n.next}while(n!==r)}yr(s,e,t);break;case 1:if(!At&&(Wn(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){Ye(t,e,o)}yr(s,e,t);break;case 21:yr(s,e,t);break;case 22:t.mode&1?(At=(r=At)||t.memoizedState!==null,yr(s,e,t),At=r):yr(s,e,t);break;default:yr(s,e,t)}}function Tp(s){var e=s.updateQueue;if(e!==null){s.updateQueue=null;var t=s.stateNode;t===null&&(t=s.stateNode=new H1),e.forEach(function(r){var n=ew.bind(null,s,r);t.has(r)||(t.add(r),r.then(n,n))})}}function vs(s,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var n=t[r];try{var i=s,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:mt=o.stateNode,bs=!1;break e;case 3:mt=o.stateNode.containerInfo,bs=!0;break e;case 4:mt=o.stateNode.containerInfo,bs=!0;break e}o=o.return}if(mt===null)throw Error(q(160));Ux(i,a,n),mt=null,bs=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){Ye(n,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Bx(e,s),e=e.sibling}function Bx(s,e){var t=s.alternate,r=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(vs(e,s),ks(s),r&4){try{sa(3,s,s.return),oc(3,s)}catch(y){Ye(s,s.return,y)}try{sa(5,s,s.return)}catch(y){Ye(s,s.return,y)}}break;case 1:vs(e,s),ks(s),r&512&&t!==null&&Wn(t,t.return);break;case 5:if(vs(e,s),ks(s),r&512&&t!==null&&Wn(t,t.return),s.flags&32){var n=s.stateNode;try{ca(n,"")}catch(y){Ye(s,s.return,y)}}if(r&4&&(n=s.stateNode,n!=null)){var i=s.memoizedProps,a=t!==null?t.memoizedProps:i,o=s.type,l=s.updateQueue;if(s.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&cy(n,i),cd(o,a);var c=cd(o,i);for(a=0;a<l.length;a+=2){var u=l[a],d=l[a+1];u==="style"?my(n,d):u==="dangerouslySetInnerHTML"?hy(n,d):u==="children"?ca(n,d):Oh(n,u,d,c)}switch(o){case"input":nd(n,i);break;case"textarea":uy(n,i);break;case"select":var f=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Qn(n,!!i.multiple,p,!1):f!==!!i.multiple&&(i.defaultValue!=null?Qn(n,!!i.multiple,i.defaultValue,!0):Qn(n,!!i.multiple,i.multiple?[]:"",!1))}n[xa]=i}catch(y){Ye(s,s.return,y)}}break;case 6:if(vs(e,s),ks(s),r&4){if(s.stateNode===null)throw Error(q(162));n=s.stateNode,i=s.memoizedProps;try{n.nodeValue=i}catch(y){Ye(s,s.return,y)}}break;case 3:if(vs(e,s),ks(s),r&4&&t!==null&&t.memoizedState.isDehydrated)try{fa(e.containerInfo)}catch(y){Ye(s,s.return,y)}break;case 4:vs(e,s),ks(s);break;case 13:vs(e,s),ks(s),n=s.child,n.flags&8192&&(i=n.memoizedState!==null,n.stateNode.isHidden=i,!i||n.alternate!==null&&n.alternate.memoizedState!==null||(pf=Je())),r&4&&Tp(s);break;case 22:if(u=t!==null&&t.memoizedState!==null,s.mode&1?(At=(c=At)||u,vs(e,s),At=c):vs(e,s),ks(s),r&8192){if(c=s.memoizedState!==null,(s.stateNode.isHidden=c)&&!u&&s.mode&1)for(ie=s,u=s.child;u!==null;){for(d=ie=u;ie!==null;){switch(f=ie,p=f.child,f.tag){case 0:case 11:case 14:case 15:sa(4,f,f.return);break;case 1:Wn(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){Ye(r,t,y)}}break;case 5:Wn(f,f.return);break;case 22:if(f.memoizedState!==null){wp(d);continue}}p!==null?(p.return=f,ie=p):wp(d)}u=u.sibling}e:for(u=null,d=s;;){if(d.tag===5){if(u===null){u=d;try{n=d.stateNode,c?(i=n.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=fy("display",a))}catch(y){Ye(s,s.return,y)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(y){Ye(s,s.return,y)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===s)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break e;for(;d.sibling===null;){if(d.return===null||d.return===s)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:vs(e,s),ks(s),r&4&&Tp(s);break;case 21:break;default:vs(e,s),ks(s)}}function ks(s){var e=s.flags;if(e&2){try{e:{for(var t=s.return;t!==null;){if($x(t)){var r=t;break e}t=t.return}throw Error(q(160))}switch(r.tag){case 5:var n=r.stateNode;r.flags&32&&(ca(n,""),r.flags&=-33);var i=Sp(s);$d(s,i,n);break;case 3:case 4:var a=r.stateNode.containerInfo,o=Sp(s);jd(s,o,a);break;default:throw Error(q(161))}}catch(l){Ye(s,s.return,l)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function K1(s,e,t){ie=s,Vx(s)}function Vx(s,e,t){for(var r=(s.mode&1)!==0;ie!==null;){var n=ie,i=n.child;if(n.tag===22&&r){var a=n.memoizedState!==null||Eo;if(!a){var o=n.alternate,l=o!==null&&o.memoizedState!==null||At;o=Eo;var c=At;if(Eo=a,(At=l)&&!c)for(ie=n;ie!==null;)a=ie,l=a.child,a.tag===22&&a.memoizedState!==null?Ap(n):l!==null?(l.return=a,ie=l):Ap(n);for(;i!==null;)ie=i,Vx(i),i=i.sibling;ie=n,Eo=o,At=c}bp(s)}else n.subtreeFlags&8772&&i!==null?(i.return=n,ie=i):bp(s)}}function bp(s){for(;ie!==null;){var e=ie;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:At||oc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!At)if(t===null)r.componentDidMount();else{var n=e.elementType===e.type?t.memoizedProps:Ts(e.type,t.memoizedProps);r.componentDidUpdate(n,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&op(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}op(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&fa(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(q(163))}At||e.flags&512&&Fd(e)}catch(f){Ye(e,e.return,f)}}if(e===s){ie=null;break}if(t=e.sibling,t!==null){t.return=e.return,ie=t;break}ie=e.return}}function wp(s){for(;ie!==null;){var e=ie;if(e===s){ie=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ie=t;break}ie=e.return}}function Ap(s){for(;ie!==null;){var e=ie;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{oc(4,e)}catch(l){Ye(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var n=e.return;try{r.componentDidMount()}catch(l){Ye(e,n,l)}}var i=e.return;try{Fd(e)}catch(l){Ye(e,i,l)}break;case 5:var a=e.return;try{Fd(e)}catch(l){Ye(e,a,l)}}}catch(l){Ye(e,e.return,l)}if(e===s){ie=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ie=o;break}ie=e.return}}var W1=Math.ceil,Il=cr.ReactCurrentDispatcher,ff=cr.ReactCurrentOwner,ms=cr.ReactCurrentBatchConfig,Te=0,dt=null,st=null,xt=0,ss=0,Yn=Kr(0),ot=0,wa=null,xn=0,lc=0,mf=0,ra=null,Bt=null,pf=0,mi=1/0,Qs=null,kl=!1,Ud=null,Or=null,So=!1,Rr=null,Cl=0,na=0,Bd=null,qo=-1,Xo=0;function Pt(){return Te&6?Je():qo!==-1?qo:qo=Je()}function Mr(s){return s.mode&1?Te&2&&xt!==0?xt&-xt:k1.transition!==null?(Xo===0&&(Xo=Ly()),Xo):(s=_e,s!==0||(s=window.event,s=s===void 0?16:Dy(s.type)),s):1}function Ls(s,e,t,r){if(50<na)throw na=0,Bd=null,Error(q(185));Ma(s,t,r),(!(Te&2)||s!==dt)&&(s===dt&&(!(Te&2)&&(lc|=t),ot===4&&Lr(s,xt)),Kt(s,r),t===1&&Te===0&&!(e.mode&1)&&(mi=Je()+500,nc&&Wr()))}function Kt(s,e){var t=s.callbackNode;kb(s,e);var r=ml(s,s===dt?xt:0);if(r===0)t!==null&&Nm(t),s.callbackNode=null,s.callbackPriority=0;else if(e=r&-r,s.callbackPriority!==e){if(t!=null&&Nm(t),e===1)s.tag===0?I1(Lp.bind(null,s)):Jy(Lp.bind(null,s)),A1(function(){!(Te&6)&&Wr()}),t=null;else{switch(_y(r)){case 1:t=Uh;break;case 4:t=wy;break;case 16:t=fl;break;case 536870912:t=Ay;break;default:t=fl}t=Xx(t,Gx.bind(null,s))}s.callbackPriority=e,s.callbackNode=t}}function Gx(s,e){if(qo=-1,Xo=0,Te&6)throw Error(q(327));var t=s.callbackNode;if(si()&&s.callbackNode!==t)return null;var r=ml(s,s===dt?xt:0);if(r===0)return null;if(r&30||r&s.expiredLanes||e)e=Pl(s,r);else{e=r;var n=Te;Te|=2;var i=zx();(dt!==s||xt!==e)&&(Qs=null,mi=Je()+500,dn(s,e));do try{X1();break}catch(o){Hx(s,o)}while(!0);Zh(),Il.current=i,Te=n,st!==null?e=0:(dt=null,xt=0,e=ot)}if(e!==0){if(e===2&&(n=md(s),n!==0&&(r=n,e=Vd(s,n))),e===1)throw t=wa,dn(s,0),Lr(s,r),Kt(s,Je()),t;if(e===6)Lr(s,r);else{if(n=s.current.alternate,!(r&30)&&!Y1(n)&&(e=Pl(s,r),e===2&&(i=md(s),i!==0&&(r=i,e=Vd(s,i))),e===1))throw t=wa,dn(s,0),Lr(s,r),Kt(s,Je()),t;switch(s.finishedWork=n,s.finishedLanes=r,e){case 0:case 1:throw Error(q(345));case 2:sn(s,Bt,Qs);break;case 3:if(Lr(s,r),(r&130023424)===r&&(e=pf+500-Je(),10<e)){if(ml(s,0)!==0)break;if(n=s.suspendedLanes,(n&r)!==r){Pt(),s.pingedLanes|=s.suspendedLanes&n;break}s.timeoutHandle=Td(sn.bind(null,s,Bt,Qs),e);break}sn(s,Bt,Qs);break;case 4:if(Lr(s,r),(r&4194240)===r)break;for(e=s.eventTimes,n=-1;0<r;){var a=31-As(r);i=1<<a,a=e[a],a>n&&(n=a),r&=~i}if(r=n,r=Je()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*W1(r/1960))-r,10<r){s.timeoutHandle=Td(sn.bind(null,s,Bt,Qs),r);break}sn(s,Bt,Qs);break;case 5:sn(s,Bt,Qs);break;default:throw Error(q(329))}}}return Kt(s,Je()),s.callbackNode===t?Gx.bind(null,s):null}function Vd(s,e){var t=ra;return s.current.memoizedState.isDehydrated&&(dn(s,e).flags|=256),s=Pl(s,e),s!==2&&(e=Bt,Bt=t,e!==null&&Gd(e)),s}function Gd(s){Bt===null?Bt=s:Bt.push.apply(Bt,s)}function Y1(s){for(var e=s;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var n=t[r],i=n.getSnapshot;n=n.value;try{if(!_s(i(),n))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Lr(s,e){for(e&=~mf,e&=~lc,s.suspendedLanes|=e,s.pingedLanes&=~e,s=s.expirationTimes;0<e;){var t=31-As(e),r=1<<t;s[t]=-1,e&=~r}}function Lp(s){if(Te&6)throw Error(q(327));si();var e=ml(s,0);if(!(e&1))return Kt(s,Je()),null;var t=Pl(s,e);if(s.tag!==0&&t===2){var r=md(s);r!==0&&(e=r,t=Vd(s,r))}if(t===1)throw t=wa,dn(s,0),Lr(s,e),Kt(s,Je()),t;if(t===6)throw Error(q(345));return s.finishedWork=s.current.alternate,s.finishedLanes=e,sn(s,Bt,Qs),Kt(s,Je()),null}function gf(s,e){var t=Te;Te|=1;try{return s(e)}finally{Te=t,Te===0&&(mi=Je()+500,nc&&Wr())}}function vn(s){Rr!==null&&Rr.tag===0&&!(Te&6)&&si();var e=Te;Te|=1;var t=ms.transition,r=_e;try{if(ms.transition=null,_e=1,s)return s()}finally{_e=r,ms.transition=t,Te=e,!(Te&6)&&Wr()}}function yf(){ss=Yn.current,Me(Yn)}function dn(s,e){s.finishedWork=null,s.finishedLanes=0;var t=s.timeoutHandle;if(t!==-1&&(s.timeoutHandle=-1,w1(t)),st!==null)for(t=st.return;t!==null;){var r=t;switch(Xh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&vl();break;case 3:hi(),Me(Ht),Me(_t),af();break;case 5:nf(r);break;case 4:hi();break;case 13:Me(Ue);break;case 19:Me(Ue);break;case 10:ef(r.type._context);break;case 22:case 23:yf()}t=t.return}if(dt=s,st=s=Fr(s.current,null),xt=ss=e,ot=0,wa=null,mf=lc=xn=0,Bt=ra=null,ln!==null){for(e=0;e<ln.length;e++)if(t=ln[e],r=t.interleaved,r!==null){t.interleaved=null;var n=r.next,i=t.pending;if(i!==null){var a=i.next;i.next=n,r.next=a}t.pending=r}ln=null}return s}function Hx(s,e){do{var t=st;try{if(Zh(),Ko.current=Rl,_l){for(var r=Ve.memoizedState;r!==null;){var n=r.queue;n!==null&&(n.pending=null),r=r.next}_l=!1}if(yn=0,ut=it=Ve=null,ta=!1,Sa=0,ff.current=null,t===null||t.return===null){ot=1,wa=e,st=null;break}e:{var i=s,a=t.return,o=t,l=e;if(e=xt,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=fp(a);if(p!==null){p.flags&=-257,mp(p,a,o,i,e),p.mode&1&&hp(i,c,e),e=p,l=c;var m=e.updateQueue;if(m===null){var y=new Set;y.add(l),e.updateQueue=y}else m.add(l);break e}else{if(!(e&1)){hp(i,c,e),xf();break e}l=Error(q(426))}}else if(je&&o.mode&1){var g=fp(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),mp(g,a,o,i,e),Qh(fi(l,o));break e}}i=l=fi(l,o),ot!==4&&(ot=2),ra===null?ra=[i]:ra.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=_x(i,l,e);ap(i,x);break e;case 1:o=l;var v=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Or===null||!Or.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=Rx(i,o,e);ap(i,T);break e}}i=i.return}while(i!==null)}Wx(t)}catch(w){e=w,st===t&&t!==null&&(st=t=t.return);continue}break}while(!0)}function zx(){var s=Il.current;return Il.current=Rl,s===null?Rl:s}function xf(){(ot===0||ot===3||ot===2)&&(ot=4),dt===null||!(xn&268435455)&&!(lc&268435455)||Lr(dt,xt)}function Pl(s,e){var t=Te;Te|=2;var r=zx();(dt!==s||xt!==e)&&(Qs=null,dn(s,e));do try{q1();break}catch(n){Hx(s,n)}while(!0);if(Zh(),Te=t,Il.current=r,st!==null)throw Error(q(261));return dt=null,xt=0,ot}function q1(){for(;st!==null;)Kx(st)}function X1(){for(;st!==null&&!Sb();)Kx(st)}function Kx(s){var e=qx(s.alternate,s,ss);s.memoizedProps=s.pendingProps,e===null?Wx(s):st=e,ff.current=null}function Wx(s){var e=s;do{var t=e.alternate;if(s=e.return,e.flags&32768){if(t=G1(t,e),t!==null){t.flags&=32767,st=t;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{ot=6,st=null;return}}else if(t=V1(t,e,ss),t!==null){st=t;return}if(e=e.sibling,e!==null){st=e;return}st=e=s}while(e!==null);ot===0&&(ot=5)}function sn(s,e,t){var r=_e,n=ms.transition;try{ms.transition=null,_e=1,Q1(s,e,t,r)}finally{ms.transition=n,_e=r}return null}function Q1(s,e,t,r){do si();while(Rr!==null);if(Te&6)throw Error(q(327));t=s.finishedWork;var n=s.finishedLanes;if(t===null)return null;if(s.finishedWork=null,s.finishedLanes=0,t===s.current)throw Error(q(177));s.callbackNode=null,s.callbackPriority=0;var i=t.lanes|t.childLanes;if(Cb(s,i),s===dt&&(st=dt=null,xt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||So||(So=!0,Xx(fl,function(){return si(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=ms.transition,ms.transition=null;var a=_e;_e=1;var o=Te;Te|=4,ff.current=null,z1(s,t),Bx(t,s),y1(Ed),pl=!!vd,Ed=vd=null,s.current=t,K1(t),Tb(),Te=o,_e=a,ms.transition=i}else s.current=t;if(So&&(So=!1,Rr=s,Cl=n),i=s.pendingLanes,i===0&&(Or=null),Ab(t.stateNode),Kt(s,Je()),e!==null)for(r=s.onRecoverableError,t=0;t<e.length;t++)n=e[t],r(n.value,{componentStack:n.stack,digest:n.digest});if(kl)throw kl=!1,s=Ud,Ud=null,s;return Cl&1&&s.tag!==0&&si(),i=s.pendingLanes,i&1?s===Bd?na++:(na=0,Bd=s):na=0,Wr(),null}function si(){if(Rr!==null){var s=_y(Cl),e=ms.transition,t=_e;try{if(ms.transition=null,_e=16>s?16:s,Rr===null)var r=!1;else{if(s=Rr,Rr=null,Cl=0,Te&6)throw Error(q(331));var n=Te;for(Te|=4,ie=s.current;ie!==null;){var i=ie,a=i.child;if(ie.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(ie=c;ie!==null;){var u=ie;switch(u.tag){case 0:case 11:case 15:sa(8,u,i)}var d=u.child;if(d!==null)d.return=u,ie=d;else for(;ie!==null;){u=ie;var f=u.sibling,p=u.return;if(jx(u),u===c){ie=null;break}if(f!==null){f.return=p,ie=f;break}ie=p}}}var m=i.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var g=y.sibling;y.sibling=null,y=g}while(y!==null)}}ie=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ie=a;else e:for(;ie!==null;){if(i=ie,i.flags&2048)switch(i.tag){case 0:case 11:case 15:sa(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,ie=x;break e}ie=i.return}}var v=s.current;for(ie=v;ie!==null;){a=ie;var E=a.child;if(a.subtreeFlags&2064&&E!==null)E.return=a,ie=E;else e:for(a=v;ie!==null;){if(o=ie,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:oc(9,o)}}catch(w){Ye(o,o.return,w)}if(o===a){ie=null;break e}var T=o.sibling;if(T!==null){T.return=o.return,ie=T;break e}ie=o.return}}if(Te=n,Wr(),Bs&&typeof Bs.onPostCommitFiberRoot=="function")try{Bs.onPostCommitFiberRoot(Zl,s)}catch{}r=!0}return r}finally{_e=t,ms.transition=e}}return!1}function _p(s,e,t){e=fi(t,e),e=_x(s,e,1),s=Nr(s,e,1),e=Pt(),s!==null&&(Ma(s,1,e),Kt(s,e))}function Ye(s,e,t){if(s.tag===3)_p(s,s,t);else for(;e!==null;){if(e.tag===3){_p(e,s,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Or===null||!Or.has(r))){s=fi(t,s),s=Rx(e,s,1),e=Nr(e,s,1),s=Pt(),e!==null&&(Ma(e,1,s),Kt(e,s));break}}e=e.return}}function J1(s,e,t){var r=s.pingCache;r!==null&&r.delete(e),e=Pt(),s.pingedLanes|=s.suspendedLanes&t,dt===s&&(xt&t)===t&&(ot===4||ot===3&&(xt&130023424)===xt&&500>Je()-pf?dn(s,0):mf|=t),Kt(s,e)}function Yx(s,e){e===0&&(s.mode&1?(e=uo,uo<<=1,!(uo&130023424)&&(uo=4194304)):e=1);var t=Pt();s=or(s,e),s!==null&&(Ma(s,e,t),Kt(s,t))}function Z1(s){var e=s.memoizedState,t=0;e!==null&&(t=e.retryLane),Yx(s,t)}function ew(s,e){var t=0;switch(s.tag){case 13:var r=s.stateNode,n=s.memoizedState;n!==null&&(t=n.retryLane);break;case 19:r=s.stateNode;break;default:throw Error(q(314))}r!==null&&r.delete(e),Yx(s,t)}var qx;qx=function(s,e,t){if(s!==null)if(s.memoizedProps!==e.pendingProps||Ht.current)Vt=!0;else{if(!(s.lanes&t)&&!(e.flags&128))return Vt=!1,B1(s,e,t);Vt=!!(s.flags&131072)}else Vt=!1,je&&e.flags&1048576&&Zy(e,Tl,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Yo(s,e),s=e.pendingProps;var n=ci(e,_t.current);ti(e,t),n=lf(null,e,r,s,n,t);var i=cf();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,zt(r)?(i=!0,El(e)):i=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,sf(e),n.updater=ac,e.stateNode=n,n._reactInternals=e,Id(e,r,s,t),e=Pd(null,e,r,!0,i,t)):(e.tag=0,je&&i&&qh(e),kt(null,e,n,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Yo(s,e),s=e.pendingProps,n=r._init,r=n(r._payload),e.type=r,n=e.tag=sw(r),s=Ts(r,s),n){case 0:e=Cd(null,e,r,s,t);break e;case 1:e=yp(null,e,r,s,t);break e;case 11:e=pp(null,e,r,s,t);break e;case 14:e=gp(null,e,r,Ts(r.type,s),t);break e}throw Error(q(306,r,""))}return e;case 0:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:Ts(r,n),Cd(s,e,r,n,t);case 1:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:Ts(r,n),yp(s,e,r,n,t);case 3:e:{if(Px(e),s===null)throw Error(q(387));r=e.pendingProps,i=e.memoizedState,n=i.element,ix(s,e),Al(e,r,null,t);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){n=fi(Error(q(423)),e),e=xp(s,e,r,t,n);break e}else if(r!==n){n=fi(Error(q(424)),e),e=xp(s,e,r,t,n);break e}else for(is=Dr(e.stateNode.containerInfo.firstChild),as=e,je=!0,ws=null,t=rx(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ui(),r===n){e=lr(s,e,t);break e}kt(s,e,r,t)}e=e.child}return e;case 5:return ax(e),s===null&&Ld(e),r=e.type,n=e.pendingProps,i=s!==null?s.memoizedProps:null,a=n.children,Sd(r,n)?a=null:i!==null&&Sd(r,i)&&(e.flags|=32),Cx(s,e),kt(s,e,a,t),e.child;case 6:return s===null&&Ld(e),null;case 13:return Dx(s,e,t);case 4:return rf(e,e.stateNode.containerInfo),r=e.pendingProps,s===null?e.child=di(e,null,r,t):kt(s,e,r,t),e.child;case 11:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:Ts(r,n),pp(s,e,r,n,t);case 7:return kt(s,e,e.pendingProps,t),e.child;case 8:return kt(s,e,e.pendingProps.children,t),e.child;case 12:return kt(s,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,n=e.pendingProps,i=e.memoizedProps,a=n.value,Ne(bl,r._currentValue),r._currentValue=a,i!==null)if(_s(i.value,a)){if(i.children===n.children&&!Ht.current){e=lr(s,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=nr(-1,t&-t),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),_d(i.return,t,e),o.lanes|=t;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(q(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),_d(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}kt(s,e,n.children,t),e=e.child}return e;case 9:return n=e.type,r=e.pendingProps.children,ti(e,t),n=ps(n),r=r(n),e.flags|=1,kt(s,e,r,t),e.child;case 14:return r=e.type,n=Ts(r,e.pendingProps),n=Ts(r.type,n),gp(s,e,r,n,t);case 15:return Ix(s,e,e.type,e.pendingProps,t);case 17:return r=e.type,n=e.pendingProps,n=e.elementType===r?n:Ts(r,n),Yo(s,e),e.tag=1,zt(r)?(s=!0,El(e)):s=!1,ti(e,t),Lx(e,r,n),Id(e,r,n,t),Pd(null,e,r,!0,s,t);case 19:return Nx(s,e,t);case 22:return kx(s,e,t)}throw Error(q(156,e.tag))};function Xx(s,e){return by(s,e)}function tw(s,e,t,r){this.tag=s,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fs(s,e,t,r){return new tw(s,e,t,r)}function vf(s){return s=s.prototype,!(!s||!s.isReactComponent)}function sw(s){if(typeof s=="function")return vf(s)?1:0;if(s!=null){if(s=s.$$typeof,s===Fh)return 11;if(s===jh)return 14}return 2}function Fr(s,e){var t=s.alternate;return t===null?(t=fs(s.tag,e,s.key,s.mode),t.elementType=s.elementType,t.type=s.type,t.stateNode=s.stateNode,t.alternate=s,s.alternate=t):(t.pendingProps=e,t.type=s.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=s.flags&14680064,t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=s.sibling,t.index=s.index,t.ref=s.ref,t}function Qo(s,e,t,r,n,i){var a=2;if(r=s,typeof s=="function")vf(s)&&(a=1);else if(typeof s=="string")a=5;else e:switch(s){case jn:return hn(t.children,n,i,e);case Mh:a=8,n|=8;break;case Zu:return s=fs(12,t,e,n|2),s.elementType=Zu,s.lanes=i,s;case ed:return s=fs(13,t,e,n),s.elementType=ed,s.lanes=i,s;case td:return s=fs(19,t,e,n),s.elementType=td,s.lanes=i,s;case ay:return cc(t,n,i,e);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case ny:a=10;break e;case iy:a=9;break e;case Fh:a=11;break e;case jh:a=14;break e;case Sr:a=16,r=null;break e}throw Error(q(130,s==null?s:typeof s,""))}return e=fs(a,t,e,n),e.elementType=s,e.type=r,e.lanes=i,e}function hn(s,e,t,r){return s=fs(7,s,r,e),s.lanes=t,s}function cc(s,e,t,r){return s=fs(22,s,r,e),s.elementType=ay,s.lanes=t,s.stateNode={isHidden:!1},s}function hu(s,e,t){return s=fs(6,s,null,e),s.lanes=t,s}function fu(s,e,t){return e=fs(4,s.children!==null?s.children:[],s.key,e),e.lanes=t,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}function rw(s,e,t,r,n){this.tag=e,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Wc(0),this.expirationTimes=Wc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wc(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Ef(s,e,t,r,n,i,a,o,l){return s=new rw(s,e,t,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=fs(3,null,null,e),s.current=i,i.stateNode=s,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},sf(i),s}function nw(s,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fn,key:r==null?null:""+r,children:s,containerInfo:e,implementation:t}}function Qx(s){if(!s)return Vr;s=s._reactInternals;e:{if(An(s)!==s||s.tag!==1)throw Error(q(170));var e=s;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(zt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(q(171))}if(s.tag===1){var t=s.type;if(zt(t))return Qy(s,t,e)}return e}function Jx(s,e,t,r,n,i,a,o,l){return s=Ef(t,r,!0,s,n,i,a,o,l),s.context=Qx(null),t=s.current,r=Pt(),n=Mr(t),i=nr(r,n),i.callback=e??null,Nr(t,i,n),s.current.lanes=n,Ma(s,n,r),Kt(s,r),s}function uc(s,e,t,r){var n=e.current,i=Pt(),a=Mr(n);return t=Qx(t),e.context===null?e.context=t:e.pendingContext=t,e=nr(i,a),e.payload={element:s},r=r===void 0?null:r,r!==null&&(e.callback=r),s=Nr(n,e,a),s!==null&&(Ls(s,n,a,i),zo(s,n,a)),a}function Dl(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function Rp(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var t=s.retryLane;s.retryLane=t!==0&&t<e?t:e}}function Sf(s,e){Rp(s,e),(s=s.alternate)&&Rp(s,e)}function iw(){return null}var Zx=typeof reportError=="function"?reportError:function(s){console.error(s)};function Tf(s){this._internalRoot=s}dc.prototype.render=Tf.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error(q(409));uc(s,e,null,null)};dc.prototype.unmount=Tf.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;vn(function(){uc(null,s,null,null)}),e[ar]=null}};function dc(s){this._internalRoot=s}dc.prototype.unstable_scheduleHydration=function(s){if(s){var e=ky();s={blockedOn:null,target:s,priority:e};for(var t=0;t<Ar.length&&e!==0&&e<Ar[t].priority;t++);Ar.splice(t,0,s),t===0&&Py(s)}};function bf(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function hc(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function Ip(){}function aw(s,e,t,r,n){if(n){if(typeof r=="function"){var i=r;r=function(){var c=Dl(a);i.call(c)}}var a=Jx(e,r,s,0,null,!1,!1,"",Ip);return s._reactRootContainer=a,s[ar]=a.current,ga(s.nodeType===8?s.parentNode:s),vn(),a}for(;n=s.lastChild;)s.removeChild(n);if(typeof r=="function"){var o=r;r=function(){var c=Dl(l);o.call(c)}}var l=Ef(s,0,!1,null,null,!1,!1,"",Ip);return s._reactRootContainer=l,s[ar]=l.current,ga(s.nodeType===8?s.parentNode:s),vn(function(){uc(e,l,t,r)}),l}function fc(s,e,t,r,n){var i=t._reactRootContainer;if(i){var a=i;if(typeof n=="function"){var o=n;n=function(){var l=Dl(a);o.call(l)}}uc(e,a,s,n)}else a=aw(t,e,s,n,r);return Dl(a)}Ry=function(s){switch(s.tag){case 3:var e=s.stateNode;if(e.current.memoizedState.isDehydrated){var t=Ki(e.pendingLanes);t!==0&&(Bh(e,t|1),Kt(e,Je()),!(Te&6)&&(mi=Je()+500,Wr()))}break;case 13:vn(function(){var r=or(s,1);if(r!==null){var n=Pt();Ls(r,s,1,n)}}),Sf(s,1)}};Vh=function(s){if(s.tag===13){var e=or(s,134217728);if(e!==null){var t=Pt();Ls(e,s,134217728,t)}Sf(s,134217728)}};Iy=function(s){if(s.tag===13){var e=Mr(s),t=or(s,e);if(t!==null){var r=Pt();Ls(t,s,e,r)}Sf(s,e)}};ky=function(){return _e};Cy=function(s,e){var t=_e;try{return _e=s,e()}finally{_e=t}};dd=function(s,e,t){switch(e){case"input":if(nd(s,t),e=t.name,t.type==="radio"&&e!=null){for(t=s;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==s&&r.form===s.form){var n=rc(r);if(!n)throw Error(q(90));ly(r),nd(r,n)}}}break;case"textarea":uy(s,t);break;case"select":e=t.value,e!=null&&Qn(s,!!t.multiple,e,!1)}};yy=gf;xy=vn;var ow={usingClientEntryPoint:!1,Events:[ja,Vn,rc,py,gy,gf]},$i={findFiberByHostInstance:on,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},lw={bundleType:$i.bundleType,version:$i.version,rendererPackageName:$i.rendererPackageName,rendererConfig:$i.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:cr.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=Sy(s),s===null?null:s.stateNode},findFiberByHostInstance:$i.findFiberByHostInstance||iw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var To=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!To.isDisabled&&To.supportsFiber)try{Zl=To.inject(lw),Bs=To}catch{}}cs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ow;cs.createPortal=function(s,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bf(e))throw Error(q(200));return nw(s,e,null,t)};cs.createRoot=function(s,e){if(!bf(s))throw Error(q(299));var t=!1,r="",n=Zx;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=Ef(s,1,!1,null,null,t,!1,r,n),s[ar]=e.current,ga(s.nodeType===8?s.parentNode:s),new Tf(e)};cs.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error(q(188)):(s=Object.keys(s).join(","),Error(q(268,s)));return s=Sy(e),s=s===null?null:s.stateNode,s};cs.flushSync=function(s){return vn(s)};cs.hydrate=function(s,e,t){if(!hc(e))throw Error(q(200));return fc(null,s,e,!0,t)};cs.hydrateRoot=function(s,e,t){if(!bf(s))throw Error(q(405));var r=t!=null&&t.hydratedSources||null,n=!1,i="",a=Zx;if(t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=Jx(e,null,s,1,t??null,n,!1,i,a),s[ar]=e.current,ga(s),r)for(s=0;s<r.length;s++)t=r[s],n=t._getVersion,n=n(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n);return new dc(e)};cs.render=function(s,e,t){if(!hc(e))throw Error(q(200));return fc(null,s,e,!1,t)};cs.unmountComponentAtNode=function(s){if(!hc(s))throw Error(q(40));return s._reactRootContainer?(vn(function(){fc(null,null,s,!1,function(){s._reactRootContainer=null,s[ar]=null})}),!0):!1};cs.unstable_batchedUpdates=gf;cs.unstable_renderSubtreeIntoContainer=function(s,e,t,r){if(!hc(t))throw Error(q(200));if(s==null||s._reactInternals===void 0)throw Error(q(38));return fc(s,e,t,!1,r)};cs.version="18.3.1-next-f1338f8080-20240426";function ev(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ev)}catch(s){console.error(s)}}ev(),ey.exports=cs;var cw=ey.exports,kp=cw;Qu.createRoot=kp.createRoot,Qu.hydrateRoot=kp.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Aa(){return Aa=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},Aa.apply(this,arguments)}var Ir;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(Ir||(Ir={}));const Cp="popstate";function uw(s){s===void 0&&(s={});function e(n,i){let{pathname:a="/",search:o="",hash:l=""}=Ln(n.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),Hd("",{pathname:a,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(n,i){let a=n.document.querySelector("base"),o="";if(a&&a.getAttribute("href")){let l=n.location.href,c=l.indexOf("#");o=c===-1?l:l.slice(0,c)}return o+"#"+(typeof i=="string"?i:Nl(i))}function r(n,i){mc(n.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(i)+")")}return hw(e,t,r,s)}function qe(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function mc(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function dw(){return Math.random().toString(36).substr(2,8)}function Pp(s,e){return{usr:s.state,key:s.key,idx:e}}function Hd(s,e,t,r){return t===void 0&&(t=null),Aa({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof e=="string"?Ln(e):e,{state:t,key:e&&e.key||r||dw()})}function Nl(s){let{pathname:e="/",search:t="",hash:r=""}=s;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Ln(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substr(t),s=s.substr(0,t));let r=s.indexOf("?");r>=0&&(e.search=s.substr(r),s=s.substr(0,r)),s&&(e.pathname=s)}return e}function hw(s,e,t,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:i=!1}=r,a=n.history,o=Ir.Pop,l=null,c=u();c==null&&(c=0,a.replaceState(Aa({},a.state,{idx:c}),""));function u(){return(a.state||{idx:null}).idx}function d(){o=Ir.Pop;let g=u(),x=g==null?null:g-c;c=g,l&&l({action:o,location:y.location,delta:x})}function f(g,x){o=Ir.Push;let v=Hd(y.location,g,x);t&&t(v,g),c=u()+1;let E=Pp(v,c),T=y.createHref(v);try{a.pushState(E,"",T)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;n.location.assign(T)}i&&l&&l({action:o,location:y.location,delta:1})}function p(g,x){o=Ir.Replace;let v=Hd(y.location,g,x);t&&t(v,g),c=u();let E=Pp(v,c),T=y.createHref(v);a.replaceState(E,"",T),i&&l&&l({action:o,location:y.location,delta:0})}function m(g){let x=n.location.origin!=="null"?n.location.origin:n.location.href,v=typeof g=="string"?g:Nl(g);return v=v.replace(/ $/,"%20"),qe(x,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,x)}let y={get action(){return o},get location(){return s(n,a)},listen(g){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(Cp,d),l=g,()=>{n.removeEventListener(Cp,d),l=null}},createHref(g){return e(n,g)},createURL:m,encodeLocation(g){let x=m(g);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:f,replace:p,go(g){return a.go(g)}};return y}var Dp;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(Dp||(Dp={}));function fw(s,e,t){return t===void 0&&(t="/"),mw(s,e,t)}function mw(s,e,t,r){let n=typeof e=="string"?Ln(e):e,i=pi(n.pathname||"/",t);if(i==null)return null;let a=tv(s);pw(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=Lw(i);o=ww(a[l],c)}return o}function tv(s,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let n=(i,a,o)=>{let l={relativePath:o===void 0?i.path||"":o,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};l.relativePath.startsWith("/")&&(qe(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=jr([r,l.relativePath]),u=t.concat(l);i.children&&i.children.length>0&&(qe(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),tv(i.children,e,u,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:Tw(c,i.index),routesMeta:u})};return s.forEach((i,a)=>{var o;if(i.path===""||!((o=i.path)!=null&&o.includes("?")))n(i,a);else for(let l of sv(i.path))n(i,a,l)}),e}function sv(s){let e=s.split("/");if(e.length===0)return[];let[t,...r]=e,n=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return n?[i,""]:[i];let a=sv(r.join("/")),o=[];return o.push(...a.map(l=>l===""?i:[i,l].join("/"))),n&&o.push(...a),o.map(l=>s.startsWith("/")&&l===""?"/":l)}function pw(s){s.sort((e,t)=>e.score!==t.score?t.score-e.score:bw(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const gw=/^:[\w-]+$/,yw=3,xw=2,vw=1,Ew=10,Sw=-2,Np=s=>s==="*";function Tw(s,e){let t=s.split("/"),r=t.length;return t.some(Np)&&(r+=Sw),e&&(r+=xw),t.filter(n=>!Np(n)).reduce((n,i)=>n+(gw.test(i)?yw:i===""?vw:Ew),r)}function bw(s,e){return s.length===e.length&&s.slice(0,-1).every((r,n)=>r===e[n])?s[s.length-1]-e[e.length-1]:0}function ww(s,e,t){let{routesMeta:r}=s,n={},i="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],c=o===r.length-1,u=i==="/"?e:e.slice(i.length)||"/",d=zd({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!d)return null;Object.assign(n,d.params),a.push({params:n,pathname:jr([i,d.pathname]),pathnameBase:Cw(jr([i,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(i=jr([i,d.pathnameBase]))}return a}function zd(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[t,r]=Aw(s.path,s.caseSensitive,s.end),n=e.match(t);if(!n)return null;let i=n[0],a=i.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:r.reduce((c,u,d)=>{let{paramName:f,isOptional:p}=u;if(f==="*"){let y=o[d]||"";a=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const m=o[d];return p&&!m?c[f]=void 0:c[f]=(m||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:a,pattern:s}}function Aw(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),mc(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let r=[],n="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(r.push({paramName:"*"}),n+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":s!==""&&s!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),r]}function Lw(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return mc(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),s}}function pi(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=s.charAt(t);return r&&r!=="/"?null:s.slice(t)||"/"}const _w=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Rw=s=>_w.test(s);function Iw(s,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:n=""}=typeof s=="string"?Ln(s):s,i;if(t)if(Rw(t))i=t;else{if(t.includes("//")){let a=t;t=t.replace(/\/\/+/g,"/"),mc(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+t))}t.startsWith("/")?i=Op(t.substring(1),"/"):i=Op(t,e)}else i=e;return{pathname:i,search:Pw(r),hash:Dw(n)}}function Op(s,e){let t=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function mu(s,e,t,r){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function kw(s){return s.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function rv(s,e){let t=kw(s);return e?t.map((r,n)=>n===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function nv(s,e,t,r){r===void 0&&(r=!1);let n;typeof s=="string"?n=Ln(s):(n=Aa({},s),qe(!n.pathname||!n.pathname.includes("?"),mu("?","pathname","search",n)),qe(!n.pathname||!n.pathname.includes("#"),mu("#","pathname","hash",n)),qe(!n.search||!n.search.includes("#"),mu("#","search","hash",n)));let i=s===""||n.pathname==="",a=i?"/":n.pathname,o;if(a==null)o=t;else{let d=e.length-1;if(!r&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),d-=1;n.pathname=f.join("/")}o=d>=0?e[d]:"/"}let l=Iw(n,o),c=a&&a!=="/"&&a.endsWith("/"),u=(i||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const jr=s=>s.join("/").replace(/\/\/+/g,"/"),Cw=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),Pw=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,Dw=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function Nw(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const iv=["post","put","patch","delete"];new Set(iv);const Ow=["get",...iv];new Set(Ow);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function La(){return La=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},La.apply(this,arguments)}const pc=A.createContext(null),av=A.createContext(null),Yr=A.createContext(null),gc=A.createContext(null),ur=A.createContext({outlet:null,matches:[],isDataRoute:!1}),ov=A.createContext(null);function Mw(s,e){let{relative:t}=e===void 0?{}:e;Ua()||qe(!1);let{basename:r,navigator:n}=A.useContext(Yr),{hash:i,pathname:a,search:o}=yc(s,{relative:t}),l=a;return r!=="/"&&(l=a==="/"?r:jr([r,a])),n.createHref({pathname:l,search:o,hash:i})}function Ua(){return A.useContext(gc)!=null}function dr(){return Ua()||qe(!1),A.useContext(gc).location}function lv(s){A.useContext(Yr).static||A.useLayoutEffect(s)}function Rs(){let{isDataRoute:s}=A.useContext(ur);return s?Qw():Fw()}function Fw(){Ua()||qe(!1);let s=A.useContext(pc),{basename:e,future:t,navigator:r}=A.useContext(Yr),{matches:n}=A.useContext(ur),{pathname:i}=dr(),a=JSON.stringify(rv(n,t.v7_relativeSplatPath)),o=A.useRef(!1);return lv(()=>{o.current=!0}),A.useCallback(function(c,u){if(u===void 0&&(u={}),!o.current)return;if(typeof c=="number"){r.go(c);return}let d=nv(c,JSON.parse(a),i,u.relative==="path");s==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:jr([e,d.pathname])),(u.replace?r.replace:r.push)(d,u.state,u)},[e,r,a,i,s])}const jw=A.createContext(null);function $w(s){let e=A.useContext(ur).outlet;return e&&A.createElement(jw.Provider,{value:s},e)}function Ba(){let{matches:s}=A.useContext(ur),e=s[s.length-1];return e?e.params:{}}function yc(s,e){let{relative:t}=e===void 0?{}:e,{future:r}=A.useContext(Yr),{matches:n}=A.useContext(ur),{pathname:i}=dr(),a=JSON.stringify(rv(n,r.v7_relativeSplatPath));return A.useMemo(()=>nv(s,JSON.parse(a),i,t==="path"),[s,a,i,t])}function Uw(s,e){return Bw(s,e)}function Bw(s,e,t,r){Ua()||qe(!1);let{navigator:n}=A.useContext(Yr),{matches:i}=A.useContext(ur),a=i[i.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let c=dr(),u;if(e){var d;let g=typeof e=="string"?Ln(e):e;l==="/"||(d=g.pathname)!=null&&d.startsWith(l)||qe(!1),u=g}else u=c;let f=u.pathname||"/",p=f;if(l!=="/"){let g=l.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(g.length).join("/")}let m=fw(s,{pathname:p}),y=Kw(m&&m.map(g=>Object.assign({},g,{params:Object.assign({},o,g.params),pathname:jr([l,n.encodeLocation?n.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?l:jr([l,n.encodeLocation?n.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),i,t,r);return e&&y?A.createElement(gc.Provider,{value:{location:La({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Ir.Pop}},y):y}function Vw(){let s=Xw(),e=Nw(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),t=s instanceof Error?s.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),t?A.createElement("pre",{style:n},t):null,null)}const Gw=A.createElement(Vw,null);class Hw extends A.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?A.createElement(ur.Provider,{value:this.props.routeContext},A.createElement(ov.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function zw(s){let{routeContext:e,match:t,children:r}=s,n=A.useContext(pc);return n&&n.static&&n.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=t.route.id),A.createElement(ur.Provider,{value:e},r)}function Kw(s,e,t,r){var n;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),s==null){var i;if(!t)return null;if(t.errors)s=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)s=t.matches;else return null}let a=s,o=(n=t)==null?void 0:n.errors;if(o!=null){let u=a.findIndex(d=>d.route.id&&(o==null?void 0:o[d.route.id])!==void 0);u>=0||qe(!1),a=a.slice(0,Math.min(a.length,u+1))}let l=!1,c=-1;if(t&&r&&r.v7_partialHydration)for(let u=0;u<a.length;u++){let d=a[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:f,errors:p}=t,m=d.route.loader&&f[d.route.id]===void 0&&(!p||p[d.route.id]===void 0);if(d.route.lazy||m){l=!0,c>=0?a=a.slice(0,c+1):a=[a[0]];break}}}return a.reduceRight((u,d,f)=>{let p,m=!1,y=null,g=null;t&&(p=o&&d.route.id?o[d.route.id]:void 0,y=d.route.errorElement||Gw,l&&(c<0&&f===0?(Jw("route-fallback"),m=!0,g=null):c===f&&(m=!0,g=d.route.hydrateFallbackElement||null)));let x=e.concat(a.slice(0,f+1)),v=()=>{let E;return p?E=y:m?E=g:d.route.Component?E=A.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=u,A.createElement(zw,{match:d,routeContext:{outlet:u,matches:x,isDataRoute:t!=null},children:E})};return t&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?A.createElement(Hw,{location:t.location,revalidation:t.revalidation,component:y,error:p,children:v(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):v()},null)}var cv=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(cv||{}),uv=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(uv||{});function Ww(s){let e=A.useContext(pc);return e||qe(!1),e}function Yw(s){let e=A.useContext(av);return e||qe(!1),e}function qw(s){let e=A.useContext(ur);return e||qe(!1),e}function dv(s){let e=qw(),t=e.matches[e.matches.length-1];return t.route.id||qe(!1),t.route.id}function Xw(){var s;let e=A.useContext(ov),t=Yw(),r=dv();return e!==void 0?e:(s=t.errors)==null?void 0:s[r]}function Qw(){let{router:s}=Ww(cv.UseNavigateStable),e=dv(uv.UseNavigateStable),t=A.useRef(!1);return lv(()=>{t.current=!0}),A.useCallback(function(n,i){i===void 0&&(i={}),t.current&&(typeof n=="number"?s.navigate(n):s.navigate(n,La({fromRouteId:e},i)))},[s,e])}const Mp={};function Jw(s,e,t){Mp[s]||(Mp[s]=!0)}function Zw(s,e){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function eA(s){return $w(s.context)}function $t(s){qe(!1)}function tA(s){let{basename:e="/",children:t=null,location:r,navigationType:n=Ir.Pop,navigator:i,static:a=!1,future:o}=s;Ua()&&qe(!1);let l=e.replace(/^\/*/,"/"),c=A.useMemo(()=>({basename:l,navigator:i,static:a,future:La({v7_relativeSplatPath:!1},o)}),[l,o,i,a]);typeof r=="string"&&(r=Ln(r));let{pathname:u="/",search:d="",hash:f="",state:p=null,key:m="default"}=r,y=A.useMemo(()=>{let g=pi(u,l);return g==null?null:{location:{pathname:g,search:d,hash:f,state:p,key:m},navigationType:n}},[l,u,d,f,p,m,n]);return y==null?null:A.createElement(Yr.Provider,{value:c},A.createElement(gc.Provider,{children:t,value:y}))}function sA(s){let{children:e,location:t}=s;return Uw(Kd(e),t)}new Promise(()=>{});function Kd(s,e){e===void 0&&(e=[]);let t=[];return A.Children.forEach(s,(r,n)=>{if(!A.isValidElement(r))return;let i=[...e,n];if(r.type===A.Fragment){t.push.apply(t,Kd(r.props.children,i));return}r.type!==$t&&qe(!1),!r.props.index||!r.props.children||qe(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Kd(r.props.children,i)),t.push(a)}),t}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ol(){return Ol=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},Ol.apply(this,arguments)}function hv(s,e){if(s==null)return{};var t={},r=Object.keys(s),n,i;for(i=0;i<r.length;i++)n=r[i],!(e.indexOf(n)>=0)&&(t[n]=s[n]);return t}function rA(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function nA(s,e){return s.button===0&&(!e||e==="_self")&&!rA(s)}function Wd(s){return s===void 0&&(s=""),new URLSearchParams(typeof s=="string"||Array.isArray(s)||s instanceof URLSearchParams?s:Object.keys(s).reduce((e,t)=>{let r=s[t];return e.concat(Array.isArray(r)?r.map(n=>[t,n]):[[t,r]])},[]))}function iA(s,e){let t=Wd(s);return e&&e.forEach((r,n)=>{t.has(n)||e.getAll(n).forEach(i=>{t.append(n,i)})}),t}const aA=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],oA=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],lA="6";try{window.__reactRouterVersion=lA}catch{}const cA=A.createContext({isTransitioning:!1}),uA="startTransition",Fp=JT[uA];function dA(s){let{basename:e,children:t,future:r,window:n}=s,i=A.useRef();i.current==null&&(i.current=uw({window:n,v5Compat:!0}));let a=i.current,[o,l]=A.useState({action:a.action,location:a.location}),{v7_startTransition:c}=r||{},u=A.useCallback(d=>{c&&Fp?Fp(()=>l(d)):l(d)},[l,c]);return A.useLayoutEffect(()=>a.listen(u),[a,u]),A.useEffect(()=>Zw(r),[r]),A.createElement(tA,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:r})}const hA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",fA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ve=A.forwardRef(function(e,t){let{onClick:r,relative:n,reloadDocument:i,replace:a,state:o,target:l,to:c,preventScrollReset:u,viewTransition:d}=e,f=hv(e,aA),{basename:p}=A.useContext(Yr),m,y=!1;if(typeof c=="string"&&fA.test(c)&&(m=c,hA))try{let E=new URL(window.location.href),T=c.startsWith("//")?new URL(E.protocol+c):new URL(c),w=pi(T.pathname,p);T.origin===E.origin&&w!=null?c=w+T.search+T.hash:y=!0}catch{}let g=Mw(c,{relative:n}),x=pA(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:n,viewTransition:d});function v(E){r&&r(E),E.defaultPrevented||x(E)}return A.createElement("a",Ol({},f,{href:m||g,onClick:y||i?r:v,ref:t,target:l}))}),pu=A.forwardRef(function(e,t){let{"aria-current":r="page",caseSensitive:n=!1,className:i="",end:a=!1,style:o,to:l,viewTransition:c,children:u}=e,d=hv(e,oA),f=yc(l,{relative:d.relative}),p=dr(),m=A.useContext(av),{navigator:y,basename:g}=A.useContext(Yr),x=m!=null&&gA(f)&&c===!0,v=y.encodeLocation?y.encodeLocation(f).pathname:f.pathname,E=p.pathname,T=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;n||(E=E.toLowerCase(),T=T?T.toLowerCase():null,v=v.toLowerCase()),T&&g&&(T=pi(T,g)||T);const w=v!=="/"&&v.endsWith("/")?v.length-1:v.length;let R=E===v||!a&&E.startsWith(v)&&E.charAt(w)==="/",b=T!=null&&(T===v||!a&&T.startsWith(v)&&T.charAt(v.length)==="/"),_={isActive:R,isPending:b,isTransitioning:x},I=R?r:void 0,L;typeof i=="function"?L=i(_):L=[i,R?"active":null,b?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let N=typeof o=="function"?o(_):o;return A.createElement(ve,Ol({},d,{"aria-current":I,className:L,ref:t,style:N,to:l,viewTransition:c}),typeof u=="function"?u(_):u)});var Yd;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(Yd||(Yd={}));var jp;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(jp||(jp={}));function mA(s){let e=A.useContext(pc);return e||qe(!1),e}function pA(s,e){let{target:t,replace:r,state:n,preventScrollReset:i,relative:a,viewTransition:o}=e===void 0?{}:e,l=Rs(),c=dr(),u=yc(s,{relative:a});return A.useCallback(d=>{if(nA(d,t)){d.preventDefault();let f=r!==void 0?r:Nl(c)===Nl(u);l(s,{replace:f,state:n,preventScrollReset:i,relative:a,viewTransition:o})}},[c,l,u,r,n,t,s,i,a,o])}function Va(s){let e=A.useRef(Wd(s)),t=A.useRef(!1),r=dr(),n=A.useMemo(()=>iA(r.search,t.current?null:e.current),[r.search]),i=Rs(),a=A.useCallback((o,l)=>{const c=Wd(typeof o=="function"?o(n):o);t.current=!0,i("?"+c,l)},[i,n]);return[n,a]}function gA(s,e){e===void 0&&(e={});let t=A.useContext(cA);t==null&&qe(!1);let{basename:r}=mA(Yd.useViewTransitionState),n=yc(s,{relative:e.relative});if(!t.isTransitioning)return!1;let i=pi(t.currentLocation.pathname,r)||t.currentLocation.pathname,a=pi(t.nextLocation.pathname,r)||t.nextLocation.pathname;return zd(n.pathname,a)!=null||zd(n.pathname,i)!=null}const yA=({onVerified:s})=>{const[e,t]=A.useState(!1),r=()=>{localStorage.setItem("ageVerified","true"),s()},n=()=>{t(!0)};return e?h.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md flex items-center justify-center z-50",children:h.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg text-center max-w-md mx-4",children:[h.jsx("h1",{className:"text-4xl font-bold text-red-500 mb-4",children:"18+"}),h.jsx("p",{className:"text-white text-lg mb-6",children:"Sorry, you must be 18 or older to access this content."}),h.jsx("button",{onClick:()=>t(!1),className:"px-6 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Back"})]})}):h.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md flex items-center justify-center z-50",children:h.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg text-center max-w-md mx-4",children:[h.jsx("h1",{className:"text-6xl font-bold text-red-500 mb-6",children:"18+"}),h.jsx("p",{className:"text-white text-xl mb-8",children:"Are you above 18 years old?"}),h.jsxs("div",{className:"flex gap-4 justify-center",children:[h.jsx("button",{onClick:r,className:"px-8 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors",children:"Yes"}),h.jsx("button",{onClick:n,className:"px-8 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition-colors",children:"No"})]})]})})};var fv={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},$p=rr.createContext&&rr.createContext(fv),$r=function(){return $r=Object.assign||function(s){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},$r.apply(this,arguments)},xA=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};function mv(s){return s&&s.map(function(e,t){return rr.createElement(e.tag,$r({key:t},e.attr),mv(e.child))})}function he(s){return function(e){return rr.createElement(vA,$r({attr:$r({},s.attr)},e),mv(s.child))}}function vA(s){var e=function(t){var r=s.attr,n=s.size,i=s.title,a=xA(s,["attr","size","title"]),o=n||t.size||"1em",l;return t.className&&(l=t.className),s.className&&(l=(l?l+" ":"")+s.className),rr.createElement("svg",$r({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,a,{className:l,style:$r($r({color:s.color||t.color},t.style),s.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),i&&rr.createElement("title",null,i),s.children)};return $p!==void 0?rr.createElement($p.Consumer,null,function(t){return e(t)}):e(fv)}function Ml(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12.01",y2:"16"}}]})(s)}function xc(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"}},{tag:"polyline",attr:{points:"12 19 5 12 12 5"}}]})(s)}function EA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}},{tag:"path",attr:{d:"M13.73 21a2 2 0 0 1-3.46 0"}}]})(s)}function qd(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"}},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"}}]})(s)}function vc(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"6 9 12 15 18 9"}}]})(s)}function wf(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"15 18 9 12 15 6"}}]})(s)}function Af(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"9 18 15 12 9 6"}}]})(s)}function Fl(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"polyline",attr:{points:"12 6 12 12 16 14"}}]})(s)}function SA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"polygon",attr:{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"}}]})(s)}function Xd(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}},{tag:"polyline",attr:{points:"15 3 21 3 21 9"}},{tag:"line",attr:{x1:"10",y1:"14",x2:"21",y2:"3"}}]})(s)}function Up(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"13 19 22 12 13 5 13 19"}},{tag:"polygon",attr:{points:"2 19 11 12 2 5 2 19"}}]})(s)}function En(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(s)}function pv(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"7",height:"7"}},{tag:"rect",attr:{x:"14",y:"3",width:"7",height:"7"}},{tag:"rect",attr:{x:"14",y:"14",width:"7",height:"7"}},{tag:"rect",attr:{x:"3",y:"14",width:"7",height:"7"}}]})(s)}function qr(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"}}]})(s)}function Bp(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}},{tag:"polyline",attr:{points:"9 22 9 12 15 12 15 22"}}]})(s)}function Ai(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(s)}function Ga(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"8",y1:"6",x2:"21",y2:"6"}},{tag:"line",attr:{x1:"8",y1:"12",x2:"21",y2:"12"}},{tag:"line",attr:{x1:"8",y1:"18",x2:"21",y2:"18"}},{tag:"line",attr:{x1:"3",y1:"6",x2:"3.01",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"12",x2:"3.01",y2:"12"}},{tag:"line",attr:{x1:"3",y1:"18",x2:"3.01",y2:"18"}}]})(s)}function gi(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"2",x2:"12",y2:"6"}},{tag:"line",attr:{x1:"12",y1:"18",x2:"12",y2:"22"}},{tag:"line",attr:{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}},{tag:"line",attr:{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"6",y2:"12"}},{tag:"line",attr:{x1:"18",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}},{tag:"line",attr:{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"}}]})(s)}function TA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"15 3 21 3 21 9"}},{tag:"polyline",attr:{points:"9 21 3 21 3 15"}},{tag:"line",attr:{x1:"21",y1:"3",x2:"14",y2:"10"}},{tag:"line",attr:{x1:"3",y1:"21",x2:"10",y2:"14"}}]})(s)}function bA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"}}]})(s)}function wA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"3",y1:"12",x2:"21",y2:"12"}},{tag:"line",attr:{x1:"3",y1:"6",x2:"21",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"18",x2:"21",y2:"18"}}]})(s)}function AA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}},{tag:"path",attr:{d:"M19 10v2a7 7 0 0 1-14 0v-2"}},{tag:"line",attr:{x1:"12",y1:"19",x2:"12",y2:"23"}},{tag:"line",attr:{x1:"8",y1:"23",x2:"16",y2:"23"}}]})(s)}function LA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"4 14 10 14 10 20"}},{tag:"polyline",attr:{points:"20 10 14 10 14 4"}},{tag:"line",attr:{x1:"14",y1:"10",x2:"21",y2:"3"}},{tag:"line",attr:{x1:"3",y1:"21",x2:"10",y2:"14"}}]})(s)}function _A(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"}}]})(s)}function gv(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"8",y1:"21",x2:"16",y2:"21"}},{tag:"line",attr:{x1:"12",y1:"17",x2:"12",y2:"21"}}]})(s)}function RA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"6",y:"4",width:"4",height:"16"}},{tag:"rect",attr:{x:"14",y:"4",width:"4",height:"16"}}]})(s)}function ke(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"5 3 19 12 5 21 5 3"}}]})(s)}function Lf(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"}},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"}}]})(s)}function Vp(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 19 2 12 11 5 11 19"}},{tag:"polygon",attr:{points:"22 19 13 12 22 5 22 19"}}]})(s)}function qn(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"}},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}}]})(s)}function IA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"8",rx:"2",ry:"2"}},{tag:"rect",attr:{x:"2",y:"14",width:"20",height:"8",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"6",y1:"6",x2:"6.01",y2:"6"}},{tag:"line",attr:{x1:"6",y1:"18",x2:"6.01",y2:"18"}}]})(s)}function _f(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(s)}function Gp(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"18",cy:"5",r:"3"}},{tag:"circle",attr:{cx:"6",cy:"12",r:"3"}},{tag:"circle",attr:{cx:"18",cy:"19",r:"3"}},{tag:"line",attr:{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}},{tag:"line",attr:{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"}}]})(s)}function kA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"5 4 15 12 5 20 5 4"}},{tag:"line",attr:{x1:"19",y1:"5",x2:"19",y2:"19"}}]})(s)}function Ha(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(s)}function Hp(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(s)}function yv(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 6 13.5 15.5 8.5 10.5 1 18"}},{tag:"polyline",attr:{points:"17 6 23 6 23 12"}}]})(s)}function nn(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"7",width:"20",height:"15",rx:"2",ry:"2"}},{tag:"polyline",attr:{points:"17 2 12 7 7 2"}}]})(s)}function Rf(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"}}]})(s)}function CA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(s)}function PA(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(s)}function Qd(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(s)}function xv(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"line",attr:{x1:"23",y1:"9",x2:"17",y2:"15"}},{tag:"line",attr:{x1:"17",y1:"9",x2:"23",y2:"15"}}]})(s)}function jl(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"}},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"}}]})(s)}function gu(s){return he({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"}},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}},{tag:"line",attr:{x1:"11",y1:"8",x2:"11",y2:"14"}},{tag:"line",attr:{x1:"8",y1:"11",x2:"14",y2:"11"}}]})(s)}const Jd={BASE_URL:"https://api.themoviedb.org/3",IMAGE_BASE_URL:"https://image.tmdb.org/t/p",API_KEY:"YOUR_TMDB_API_KEY"},He={TRENDING:"/trending/all/week",POPULAR_MOVIES:"/movie/popular",TOP_RATED_MOVIES:"/movie/top_rated",UPCOMING_MOVIES:"/movie/upcoming",NOW_PLAYING_MOVIES:"/movie/now_playing",POPULAR_TV:"/tv/popular",TOP_RATED_TV:"/tv/top_rated",ON_THE_AIR_TV:"/tv/on_the_air",MOVIE_DETAILS:s=>`/movie/${s}`,TV_DETAILS:s=>`/tv/${s}`,MOVIE_CREDITS:s=>`/movie/${s}/credits`,TV_CREDITS:s=>`/tv/${s}/credits`,MOVIE_VIDEOS:s=>`/movie/${s}/videos`,TV_VIDEOS:s=>`/tv/${s}/videos`,MOVIE_WATCH_PROVIDERS:s=>`/movie/${s}/watch/providers`,TV_WATCH_PROVIDERS:s=>`/tv/${s}/watch/providers`,SEARCH_MOVIES:"/search/movie",SEARCH_MULTI:"/search/multi",DISCOVER_MOVIE:"/discover/movie",DISCOVER_TV:"/discover/tv",GENRE_MOVIES:"/genre/movie/list",GENRE_TV:"/genre/tv/list",MOVIE_RECOMMENDATIONS:s=>`/movie/${s}/recommendations`,TV_RECOMMENDATIONS:s=>`/tv/${s}/recommendations`,PERSON_DETAILS:s=>`/person/${s}`,PERSON_MOVIE_CREDITS:s=>`/person/${s}/movie_credits`,PERSON_TV_CREDITS:s=>`/person/${s}/tv_credits`},yi={MOVIE:[{id:28,name:"Action"},{id:12,name:"Adventure"},{id:16,name:"Animation"},{id:35,name:"Comedy"},{id:80,name:"Crime"},{id:99,name:"Documentary"},{id:18,name:"Drama"},{id:10751,name:"Family"},{id:14,name:"Fantasy"},{id:36,name:"History"},{id:27,name:"Horror"},{id:10402,name:"Music"},{id:9648,name:"Mystery"},{id:10749,name:"Romance"},{id:878,name:"Science Fiction"},{id:10770,name:"TV Movie"},{id:53,name:"Thriller"},{id:10752,name:"War"},{id:37,name:"Western"}],TV:[{id:10759,name:"Action & Adventure"},{id:16,name:"Animation"},{id:35,name:"Comedy"},{id:80,name:"Crime"},{id:99,name:"Documentary"},{id:18,name:"Drama"},{id:10751,name:"Family"},{id:10762,name:"Kids"},{id:9648,name:"Mystery"},{id:10763,name:"News"},{id:10764,name:"Reality"},{id:10765,name:"Sci-Fi & Fantasy"},{id:10766,name:"Soap"},{id:10767,name:"Talk"},{id:10768,name:"War & Politics"},{id:37,name:"Western"}]},yu={EXCELLENT:8,GOOD:7,AVERAGE:6},DA={free:"Free",subscription:"Subscription",rent:"Rent",buy:"Buy"},Ms=(s,e="w500")=>s?`${Jd.IMAGE_BASE_URL}/${e}${s}`:null,Gs=s=>s?new Date(s).getFullYear():"N/A",NA=s=>{if(!s)return"N/A";const e=Math.floor(s/60),t=s%60;return e>0?`${e}h ${t}m`:`${t}m`},Zd=s=>s?s.toFixed(1):"0.0",OA=s=>s>=yu.EXCELLENT?"text-green-500":s>=yu.GOOD?"text-yellow-500":s>=yu.AVERAGE?"text-orange-500":"text-red-500",zp=(s,e=150)=>s?s.length<=e?s:s.substring(0,e).trim()+"...":"",MA=(s,e)=>!s||!e?[]:s.map(t=>e.find(r=>r.id===t)).filter(Boolean).map(t=>t.name),FA=(s,e)=>{let t;return function(...n){const i=()=>{clearTimeout(t),s(...n)};clearTimeout(t),t=setTimeout(i,e)}},jA=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),$A=s=>{if(!s)return null;const e=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,t=s.match(e);return t&&t[2].length===11?t[2]:null},Kp=(s,e="movie",t=1,r=1)=>{if(!s)return null;const n=s.startsWith("tt")?s:`tt${s}`,i=s.replace("tt","");return e==="tv"?`https://vidsrc-embed.ru/embed/tv?tmdb=${i}&season=${t}&episode=${r}`:`https://vidsrc-embed.ru/embed/movie?imdb=${n}`},vv=A.createContext(),Wp="streamflix_watchlist",UA=({children:s})=>{const[e,t]=A.useState([]),[r,n]=A.useState(!0),[i,a]=A.useState(null);A.useEffect(()=>{try{const T=localStorage.getItem(Wp);T&&t(JSON.parse(T))}catch(T){console.error("Error loading watchlist from localStorage:",T),a("Failed to load watchlist")}finally{n(!1)}},[]),A.useEffect(()=>{if(!r)try{localStorage.setItem(Wp,JSON.stringify(e))}catch(T){console.error("Error saving watchlist to localStorage:",T),a("Failed to save watchlist")}},[e,r]);const o=A.useCallback(T=>e.some(w=>w.id===T),[e]),l=A.useCallback(T=>{if(!T||!T.id)return console.warn("Invalid item for watchlist"),!1;if(o(T.id))return console.warn("Item already in watchlist:",T.id),!1;const w={...T,addedAt:new Date().toISOString(),uniqueId:jA()};return t(R=>[w,...R]),!0},[o]),c=A.useCallback(T=>(t(w=>w.filter(R=>R.id!==T)),!0),[]),u=A.useCallback(T=>o(T.id)?(c(T.id),!1):(l(T),!0),[o,l,c]),d=A.useCallback(()=>{t([])},[]),f=A.useCallback((T,w)=>{t(R=>R.map(b=>b.id===T?{...b,...w}:b))},[]),p=A.useCallback(()=>e.length,[e]),m=A.useCallback(()=>[...e],[e]),y=A.useCallback((T="addedAt",w="desc")=>{t(R=>[...R].sort((_,I)=>{let L=_[T],N=I[T];return T==="addedAt"&&(L=new Date(L),N=new Date(N)),w==="desc"?N>L?1:-1:L>N?1:-1}))},[]),g=A.useCallback(T=>e.filter(T),[e]),x=A.useCallback(()=>JSON.stringify(e,null,2),[e]),v=A.useCallback(T=>{try{const w=JSON.parse(T);if(Array.isArray(w)){const R=w.filter(b=>b&&b.id);return t(R),!0}return!1}catch(w){return console.error("Error importing watchlist:",w),!1}},[]),E={watchlist:e,isLoading:r,error:i,isInWatchlist:o,addToWatchlist:l,removeFromWatchlist:c,toggleWatchlist:u,clearWatchlist:d,updateWatchlistItem:f,getWatchlistCount:p,getWatchlistItems:m,sortWatchlist:y,filterWatchlist:g,exportWatchlist:x,importWatchlist:v};return h.jsx(vv.Provider,{value:E,children:s})},za=()=>{const s=A.useContext(vv);if(!s)throw new Error("useWatchlist must be used within a WatchlistProvider");return s};function Ev(s,e){return function(){return s.apply(e,arguments)}}const{toString:BA}=Object.prototype,{getPrototypeOf:If}=Object,{iterator:Ec,toStringTag:Sv}=Symbol,Sc=(s=>e=>{const t=BA.call(e);return s[t]||(s[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Is=s=>(s=s.toLowerCase(),e=>Sc(e)===s),Tc=s=>e=>typeof e===s,{isArray:Li}=Array,xi=Tc("undefined");function Ka(s){return s!==null&&!xi(s)&&s.constructor!==null&&!xi(s.constructor)&&Wt(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Tv=Is("ArrayBuffer");function VA(s){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&Tv(s.buffer),e}const GA=Tc("string"),Wt=Tc("function"),bv=Tc("number"),Wa=s=>s!==null&&typeof s=="object",HA=s=>s===!0||s===!1,Jo=s=>{if(Sc(s)!=="object")return!1;const e=If(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Sv in s)&&!(Ec in s)},zA=s=>{if(!Wa(s)||Ka(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},KA=Is("Date"),WA=Is("File"),YA=Is("Blob"),qA=Is("FileList"),XA=s=>Wa(s)&&Wt(s.pipe),QA=s=>{let e;return s&&(typeof FormData=="function"&&s instanceof FormData||Wt(s.append)&&((e=Sc(s))==="formdata"||e==="object"&&Wt(s.toString)&&s.toString()==="[object FormData]"))},JA=Is("URLSearchParams"),[ZA,eL,tL,sL]=["ReadableStream","Request","Response","Headers"].map(Is),rL=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ya(s,e,{allOwnKeys:t=!1}={}){if(s===null||typeof s>"u")return;let r,n;if(typeof s!="object"&&(s=[s]),Li(s))for(r=0,n=s.length;r<n;r++)e.call(null,s[r],r,s);else{if(Ka(s))return;const i=t?Object.getOwnPropertyNames(s):Object.keys(s),a=i.length;let o;for(r=0;r<a;r++)o=i[r],e.call(null,s[o],o,s)}}function wv(s,e){if(Ka(s))return null;e=e.toLowerCase();const t=Object.keys(s);let r=t.length,n;for(;r-- >0;)if(n=t[r],e===n.toLowerCase())return n;return null}const un=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Av=s=>!xi(s)&&s!==un;function eh(){const{caseless:s,skipUndefined:e}=Av(this)&&this||{},t={},r=(n,i)=>{const a=s&&wv(t,i)||i;Jo(t[a])&&Jo(n)?t[a]=eh(t[a],n):Jo(n)?t[a]=eh({},n):Li(n)?t[a]=n.slice():(!e||!xi(n))&&(t[a]=n)};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Ya(arguments[n],r);return t}const nL=(s,e,t,{allOwnKeys:r}={})=>(Ya(e,(n,i)=>{t&&Wt(n)?Object.defineProperty(s,i,{value:Ev(n,t),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(s,i,{value:n,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:r}),s),iL=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),aL=(s,e,t,r)=>{s.prototype=Object.create(e.prototype,r),Object.defineProperty(s.prototype,"constructor",{value:s,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(s,"super",{value:e.prototype}),t&&Object.assign(s.prototype,t)},oL=(s,e,t,r)=>{let n,i,a;const o={};if(e=e||{},s==null)return e;do{for(n=Object.getOwnPropertyNames(s),i=n.length;i-- >0;)a=n[i],(!r||r(a,s,e))&&!o[a]&&(e[a]=s[a],o[a]=!0);s=t!==!1&&If(s)}while(s&&(!t||t(s,e))&&s!==Object.prototype);return e},lL=(s,e,t)=>{s=String(s),(t===void 0||t>s.length)&&(t=s.length),t-=e.length;const r=s.indexOf(e,t);return r!==-1&&r===t},cL=s=>{if(!s)return null;if(Li(s))return s;let e=s.length;if(!bv(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=s[e];return t},uL=(s=>e=>s&&e instanceof s)(typeof Uint8Array<"u"&&If(Uint8Array)),dL=(s,e)=>{const r=(s&&s[Ec]).call(s);let n;for(;(n=r.next())&&!n.done;){const i=n.value;e.call(s,i[0],i[1])}},hL=(s,e)=>{let t;const r=[];for(;(t=s.exec(e))!==null;)r.push(t);return r},fL=Is("HTMLFormElement"),mL=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,n){return r.toUpperCase()+n}),Yp=(({hasOwnProperty:s})=>(e,t)=>s.call(e,t))(Object.prototype),pL=Is("RegExp"),Lv=(s,e)=>{const t=Object.getOwnPropertyDescriptors(s),r={};Ya(t,(n,i)=>{let a;(a=e(n,i,s))!==!1&&(r[i]=a||n)}),Object.defineProperties(s,r)},gL=s=>{Lv(s,(e,t)=>{if(Wt(s)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=s[t];if(Wt(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},yL=(s,e)=>{const t={},r=n=>{n.forEach(i=>{t[i]=!0})};return Li(s)?r(s):r(String(s).split(e)),t},xL=()=>{},vL=(s,e)=>s!=null&&Number.isFinite(s=+s)?s:e;function EL(s){return!!(s&&Wt(s.append)&&s[Sv]==="FormData"&&s[Ec])}const SL=s=>{const e=new Array(10),t=(r,n)=>{if(Wa(r)){if(e.indexOf(r)>=0)return;if(Ka(r))return r;if(!("toJSON"in r)){e[n]=r;const i=Li(r)?[]:{};return Ya(r,(a,o)=>{const l=t(a,n+1);!xi(l)&&(i[o]=l)}),e[n]=void 0,i}}return r};return t(s,0)},TL=Is("AsyncFunction"),bL=s=>s&&(Wa(s)||Wt(s))&&Wt(s.then)&&Wt(s.catch),_v=((s,e)=>s?setImmediate:e?((t,r)=>(un.addEventListener("message",({source:n,data:i})=>{n===un&&i===t&&r.length&&r.shift()()},!1),n=>{r.push(n),un.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Wt(un.postMessage)),wL=typeof queueMicrotask<"u"?queueMicrotask.bind(un):typeof process<"u"&&process.nextTick||_v,AL=s=>s!=null&&Wt(s[Ec]),j={isArray:Li,isArrayBuffer:Tv,isBuffer:Ka,isFormData:QA,isArrayBufferView:VA,isString:GA,isNumber:bv,isBoolean:HA,isObject:Wa,isPlainObject:Jo,isEmptyObject:zA,isReadableStream:ZA,isRequest:eL,isResponse:tL,isHeaders:sL,isUndefined:xi,isDate:KA,isFile:WA,isBlob:YA,isRegExp:pL,isFunction:Wt,isStream:XA,isURLSearchParams:JA,isTypedArray:uL,isFileList:qA,forEach:Ya,merge:eh,extend:nL,trim:rL,stripBOM:iL,inherits:aL,toFlatObject:oL,kindOf:Sc,kindOfTest:Is,endsWith:lL,toArray:cL,forEachEntry:dL,matchAll:hL,isHTMLForm:fL,hasOwnProperty:Yp,hasOwnProp:Yp,reduceDescriptors:Lv,freezeMethods:gL,toObjectSet:yL,toCamelCase:mL,noop:xL,toFiniteNumber:vL,findKey:wv,global:un,isContextDefined:Av,isSpecCompliantForm:EL,toJSONObject:SL,isAsyncFn:TL,isThenable:bL,setImmediate:_v,asap:wL,isIterable:AL};let le=class Rv extends Error{static from(e,t,r,n,i,a){const o=new Rv(e.message,t||e.code,r,n,i);return o.cause=e,o.name=e.name,a&&Object.assign(o,a),o}constructor(e,t,r,n,i){super(e),this.name="AxiosError",this.isAxiosError=!0,t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:j.toJSONObject(this.config),code:this.code,status:this.status}}};le.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";le.ERR_BAD_OPTION="ERR_BAD_OPTION";le.ECONNABORTED="ECONNABORTED";le.ETIMEDOUT="ETIMEDOUT";le.ERR_NETWORK="ERR_NETWORK";le.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";le.ERR_DEPRECATED="ERR_DEPRECATED";le.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";le.ERR_BAD_REQUEST="ERR_BAD_REQUEST";le.ERR_CANCELED="ERR_CANCELED";le.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";le.ERR_INVALID_URL="ERR_INVALID_URL";const LL=null;function th(s){return j.isPlainObject(s)||j.isArray(s)}function Iv(s){return j.endsWith(s,"[]")?s.slice(0,-2):s}function qp(s,e,t){return s?s.concat(e).map(function(n,i){return n=Iv(n),!t&&i?"["+n+"]":n}).join(t?".":""):e}function _L(s){return j.isArray(s)&&!s.some(th)}const RL=j.toFlatObject(j,{},null,function(e){return/^is[A-Z]/.test(e)});function bc(s,e,t){if(!j.isObject(s))throw new TypeError("target must be an object");e=e||new FormData,t=j.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,g){return!j.isUndefined(g[y])});const r=t.metaTokens,n=t.visitor||u,i=t.dots,a=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&j.isSpecCompliantForm(e);if(!j.isFunction(n))throw new TypeError("visitor must be a function");function c(m){if(m===null)return"";if(j.isDate(m))return m.toISOString();if(j.isBoolean(m))return m.toString();if(!l&&j.isBlob(m))throw new le("Blob is not supported. Use a Buffer instead.");return j.isArrayBuffer(m)||j.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,y,g){let x=m;if(m&&!g&&typeof m=="object"){if(j.endsWith(y,"{}"))y=r?y:y.slice(0,-2),m=JSON.stringify(m);else if(j.isArray(m)&&_L(m)||(j.isFileList(m)||j.endsWith(y,"[]"))&&(x=j.toArray(m)))return y=Iv(y),x.forEach(function(E,T){!(j.isUndefined(E)||E===null)&&e.append(a===!0?qp([y],T,i):a===null?y:y+"[]",c(E))}),!1}return th(m)?!0:(e.append(qp(g,y,i),c(m)),!1)}const d=[],f=Object.assign(RL,{defaultVisitor:u,convertValue:c,isVisitable:th});function p(m,y){if(!j.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+y.join("."));d.push(m),j.forEach(m,function(x,v){(!(j.isUndefined(x)||x===null)&&n.call(e,x,j.isString(v)?v.trim():v,y,f))===!0&&p(x,y?y.concat(v):[v])}),d.pop()}}if(!j.isObject(s))throw new TypeError("data must be an object");return p(s),e}function Xp(s){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function kf(s,e){this._pairs=[],s&&bc(s,this,e)}const kv=kf.prototype;kv.append=function(e,t){this._pairs.push([e,t])};kv.toString=function(e){const t=e?function(r){return e.call(this,r,Xp)}:Xp;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function IL(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Cv(s,e,t){if(!e)return s;const r=t&&t.encode||IL,n=j.isFunction(t)?{serialize:t}:t,i=n&&n.serialize;let a;if(i?a=i(e,n):a=j.isURLSearchParams(e)?e.toString():new kf(e,n).toString(r),a){const o=s.indexOf("#");o!==-1&&(s=s.slice(0,o)),s+=(s.indexOf("?")===-1?"?":"&")+a}return s}class Qp{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){j.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Pv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},kL=typeof URLSearchParams<"u"?URLSearchParams:kf,CL=typeof FormData<"u"?FormData:null,PL=typeof Blob<"u"?Blob:null,DL={isBrowser:!0,classes:{URLSearchParams:kL,FormData:CL,Blob:PL},protocols:["http","https","file","blob","url","data"]},Cf=typeof window<"u"&&typeof document<"u",sh=typeof navigator=="object"&&navigator||void 0,NL=Cf&&(!sh||["ReactNative","NativeScript","NS"].indexOf(sh.product)<0),OL=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ML=Cf&&window.location.href||"http://localhost",FL=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Cf,hasStandardBrowserEnv:NL,hasStandardBrowserWebWorkerEnv:OL,navigator:sh,origin:ML},Symbol.toStringTag,{value:"Module"})),Lt={...FL,...DL};function jL(s,e){return bc(s,new Lt.classes.URLSearchParams,{visitor:function(t,r,n,i){return Lt.isNode&&j.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function $L(s){return j.matchAll(/\w+|\[(\w*)]/g,s).map(e=>e[0]==="[]"?"":e[1]||e[0])}function UL(s){const e={},t=Object.keys(s);let r;const n=t.length;let i;for(r=0;r<n;r++)i=t[r],e[i]=s[i];return e}function Dv(s){function e(t,r,n,i){let a=t[i++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),l=i>=t.length;return a=!a&&j.isArray(n)?n.length:a,l?(j.hasOwnProp(n,a)?n[a]=[n[a],r]:n[a]=r,!o):((!n[a]||!j.isObject(n[a]))&&(n[a]=[]),e(t,r,n[a],i)&&j.isArray(n[a])&&(n[a]=UL(n[a])),!o)}if(j.isFormData(s)&&j.isFunction(s.entries)){const t={};return j.forEachEntry(s,(r,n)=>{e($L(r),n,t,0)}),t}return null}function BL(s,e,t){if(j.isString(s))try{return(e||JSON.parse)(s),j.trim(s)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(s)}const qa={transitional:Pv,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=j.isObject(e);if(i&&j.isHTMLForm(e)&&(e=new FormData(e)),j.isFormData(e))return n?JSON.stringify(Dv(e)):e;if(j.isArrayBuffer(e)||j.isBuffer(e)||j.isStream(e)||j.isFile(e)||j.isBlob(e)||j.isReadableStream(e))return e;if(j.isArrayBufferView(e))return e.buffer;if(j.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return jL(e,this.formSerializer).toString();if((o=j.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return bc(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),BL(e)):e}],transformResponse:[function(e){const t=this.transitional||qa.transitional,r=t&&t.forcedJSONParsing,n=this.responseType==="json";if(j.isResponse(e)||j.isReadableStream(e))return e;if(e&&j.isString(e)&&(r&&!this.responseType||n)){const a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(o){if(a)throw o.name==="SyntaxError"?le.from(o,le.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Lt.classes.FormData,Blob:Lt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};j.forEach(["delete","get","head","post","put","patch"],s=>{qa.headers[s]={}});const VL=j.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),GL=s=>{const e={};let t,r,n;return s&&s.split(`
`).forEach(function(a){n=a.indexOf(":"),t=a.substring(0,n).trim().toLowerCase(),r=a.substring(n+1).trim(),!(!t||e[t]&&VL[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},Jp=Symbol("internals");function Ui(s){return s&&String(s).trim().toLowerCase()}function Zo(s){return s===!1||s==null?s:j.isArray(s)?s.map(Zo):String(s)}function HL(s){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(s);)e[r[1]]=r[2];return e}const zL=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function xu(s,e,t,r,n){if(j.isFunction(r))return r.call(this,e,t);if(n&&(e=t),!!j.isString(e)){if(j.isString(r))return e.indexOf(r)!==-1;if(j.isRegExp(r))return r.test(e)}}function KL(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function WL(s,e){const t=j.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(s,r+t,{value:function(n,i,a){return this[r].call(this,e,n,i,a)},configurable:!0})})}let Yt=class{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function i(o,l,c){const u=Ui(l);if(!u)throw new Error("header name must be a non-empty string");const d=j.findKey(n,u);(!d||n[d]===void 0||c===!0||c===void 0&&n[d]!==!1)&&(n[d||l]=Zo(o))}const a=(o,l)=>j.forEach(o,(c,u)=>i(c,u,l));if(j.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(j.isString(e)&&(e=e.trim())&&!zL(e))a(GL(e),t);else if(j.isObject(e)&&j.isIterable(e)){let o={},l,c;for(const u of e){if(!j.isArray(u))throw TypeError("Object iterator must return a key-value pair");o[c=u[0]]=(l=o[c])?j.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}a(o,t)}else e!=null&&i(t,e,r);return this}get(e,t){if(e=Ui(e),e){const r=j.findKey(this,e);if(r){const n=this[r];if(!t)return n;if(t===!0)return HL(n);if(j.isFunction(t))return t.call(this,n,r);if(j.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ui(e),e){const r=j.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||xu(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let n=!1;function i(a){if(a=Ui(a),a){const o=j.findKey(r,a);o&&(!t||xu(r,r[o],o,t))&&(delete r[o],n=!0)}}return j.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const i=t[r];(!e||xu(this,this[i],i,e,!0))&&(delete this[i],n=!0)}return n}normalize(e){const t=this,r={};return j.forEach(this,(n,i)=>{const a=j.findKey(r,i);if(a){t[a]=Zo(n),delete t[i];return}const o=e?KL(i):String(i).trim();o!==i&&delete t[i],t[o]=Zo(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return j.forEach(this,(r,n)=>{r!=null&&r!==!1&&(t[n]=e&&j.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[Jp]=this[Jp]={accessors:{}}).accessors,n=this.prototype;function i(a){const o=Ui(a);r[o]||(WL(n,a),r[o]=!0)}return j.isArray(e)?e.forEach(i):i(e),this}};Yt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);j.reduceDescriptors(Yt.prototype,({value:s},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>s,set(r){this[t]=r}}});j.freezeMethods(Yt);function vu(s,e){const t=this||qa,r=e||t,n=Yt.from(r.headers);let i=r.data;return j.forEach(s,function(o){i=o.call(t,i,n.normalize(),e?e.status:void 0)}),n.normalize(),i}function Nv(s){return!!(s&&s.__CANCEL__)}let Xa=class extends le{constructor(e,t,r){super(e??"canceled",le.ERR_CANCELED,t,r),this.name="CanceledError",this.__CANCEL__=!0}};function Ov(s,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?s(t):e(new le("Request failed with status code "+t.status,[le.ERR_BAD_REQUEST,le.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function YL(s){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return e&&e[1]||""}function qL(s,e){s=s||10;const t=new Array(s),r=new Array(s);let n=0,i=0,a;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=r[i];a||(a=c),t[n]=l,r[n]=c;let d=i,f=0;for(;d!==n;)f+=t[d++],d=d%s;if(n=(n+1)%s,n===i&&(i=(i+1)%s),c-a<e)return;const p=u&&c-u;return p?Math.round(f*1e3/p):void 0}}function XL(s,e){let t=0,r=1e3/e,n,i;const a=(c,u=Date.now())=>{t=u,n=null,i&&(clearTimeout(i),i=null),s(...c)};return[(...c)=>{const u=Date.now(),d=u-t;d>=r?a(c,u):(n=c,i||(i=setTimeout(()=>{i=null,a(n)},r-d)))},()=>n&&a(n)]}const $l=(s,e,t=3)=>{let r=0;const n=qL(50,250);return XL(i=>{const a=i.loaded,o=i.lengthComputable?i.total:void 0,l=a-r,c=n(l),u=a<=o;r=a;const d={loaded:a,total:o,progress:o?a/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&u?(o-a)/c:void 0,event:i,lengthComputable:o!=null,[e?"download":"upload"]:!0};s(d)},t)},Zp=(s,e)=>{const t=s!=null;return[r=>e[0]({lengthComputable:t,total:s,loaded:r}),e[1]]},eg=s=>(...e)=>j.asap(()=>s(...e)),QL=Lt.hasStandardBrowserEnv?((s,e)=>t=>(t=new URL(t,Lt.origin),s.protocol===t.protocol&&s.host===t.host&&(e||s.port===t.port)))(new URL(Lt.origin),Lt.navigator&&/(msie|trident)/i.test(Lt.navigator.userAgent)):()=>!0,JL=Lt.hasStandardBrowserEnv?{write(s,e,t,r,n,i,a){if(typeof document>"u")return;const o=[`${s}=${encodeURIComponent(e)}`];j.isNumber(t)&&o.push(`expires=${new Date(t).toUTCString()}`),j.isString(r)&&o.push(`path=${r}`),j.isString(n)&&o.push(`domain=${n}`),i===!0&&o.push("secure"),j.isString(a)&&o.push(`SameSite=${a}`),document.cookie=o.join("; ")},read(s){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+s+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(s){this.write(s,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ZL(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function e_(s,e){return e?s.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):s}function Mv(s,e,t){let r=!ZL(e);return s&&(r||t==!1)?e_(s,e):e}const tg=s=>s instanceof Yt?{...s}:s;function Sn(s,e){e=e||{};const t={};function r(c,u,d,f){return j.isPlainObject(c)&&j.isPlainObject(u)?j.merge.call({caseless:f},c,u):j.isPlainObject(u)?j.merge({},u):j.isArray(u)?u.slice():u}function n(c,u,d,f){if(j.isUndefined(u)){if(!j.isUndefined(c))return r(void 0,c,d,f)}else return r(c,u,d,f)}function i(c,u){if(!j.isUndefined(u))return r(void 0,u)}function a(c,u){if(j.isUndefined(u)){if(!j.isUndefined(c))return r(void 0,c)}else return r(void 0,u)}function o(c,u,d){if(d in e)return r(c,u);if(d in s)return r(void 0,c)}const l={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(c,u,d)=>n(tg(c),tg(u),d,!0)};return j.forEach(Object.keys({...s,...e}),function(u){const d=l[u]||n,f=d(s[u],e[u],u);j.isUndefined(f)&&d!==o||(t[u]=f)}),t}const Fv=s=>{const e=Sn({},s);let{data:t,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:i,headers:a,auth:o}=e;if(e.headers=a=Yt.from(a),e.url=Cv(Mv(e.baseURL,e.url,e.allowAbsoluteUrls),s.params,s.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),j.isFormData(t)){if(Lt.hasStandardBrowserEnv||Lt.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(j.isFunction(t.getHeaders)){const l=t.getHeaders(),c=["content-type","content-length"];Object.entries(l).forEach(([u,d])=>{c.includes(u.toLowerCase())&&a.set(u,d)})}}if(Lt.hasStandardBrowserEnv&&(r&&j.isFunction(r)&&(r=r(e)),r||r!==!1&&QL(e.url))){const l=n&&i&&JL.read(i);l&&a.set(n,l)}return e},t_=typeof XMLHttpRequest<"u",s_=t_&&function(s){return new Promise(function(t,r){const n=Fv(s);let i=n.data;const a=Yt.from(n.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=n,u,d,f,p,m;function y(){p&&p(),m&&m(),n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}let g=new XMLHttpRequest;g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout;function x(){if(!g)return;const E=Yt.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),w={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:E,config:s,request:g};Ov(function(b){t(b),y()},function(b){r(b),y()},w),g=null}"onloadend"in g?g.onloadend=x:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(x)},g.onabort=function(){g&&(r(new le("Request aborted",le.ECONNABORTED,s,g)),g=null)},g.onerror=function(T){const w=T&&T.message?T.message:"Network Error",R=new le(w,le.ERR_NETWORK,s,g);R.event=T||null,r(R),g=null},g.ontimeout=function(){let T=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const w=n.transitional||Pv;n.timeoutErrorMessage&&(T=n.timeoutErrorMessage),r(new le(T,w.clarifyTimeoutError?le.ETIMEDOUT:le.ECONNABORTED,s,g)),g=null},i===void 0&&a.setContentType(null),"setRequestHeader"in g&&j.forEach(a.toJSON(),function(T,w){g.setRequestHeader(w,T)}),j.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),o&&o!=="json"&&(g.responseType=n.responseType),c&&([f,m]=$l(c,!0),g.addEventListener("progress",f)),l&&g.upload&&([d,p]=$l(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",p)),(n.cancelToken||n.signal)&&(u=E=>{g&&(r(!E||E.type?new Xa(null,s,g):E),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const v=YL(n.url);if(v&&Lt.protocols.indexOf(v)===-1){r(new le("Unsupported protocol "+v+":",le.ERR_BAD_REQUEST,s));return}g.send(i||null)})},r_=(s,e)=>{const{length:t}=s=s?s.filter(Boolean):[];if(e||t){let r=new AbortController,n;const i=function(c){if(!n){n=!0,o();const u=c instanceof Error?c:this.reason;r.abort(u instanceof le?u:new Xa(u instanceof Error?u.message:u))}};let a=e&&setTimeout(()=>{a=null,i(new le(`timeout of ${e}ms exceeded`,le.ETIMEDOUT))},e);const o=()=>{s&&(a&&clearTimeout(a),a=null,s.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),s=null)};s.forEach(c=>c.addEventListener("abort",i));const{signal:l}=r;return l.unsubscribe=()=>j.asap(o),l}},n_=function*(s,e){let t=s.byteLength;if(t<e){yield s;return}let r=0,n;for(;r<t;)n=r+e,yield s.slice(r,n),r=n},i_=async function*(s,e){for await(const t of a_(s))yield*n_(t,e)},a_=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const e=s.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},sg=(s,e,t,r)=>{const n=i_(s,e);let i=0,a,o=l=>{a||(a=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await n.next();if(c){o(),l.close();return}let d=u.byteLength;if(t){let f=i+=d;t(f)}l.enqueue(new Uint8Array(u))}catch(c){throw o(c),c}},cancel(l){return o(l),n.return()}},{highWaterMark:2})},rg=64*1024,{isFunction:bo}=j,o_=(({Request:s,Response:e})=>({Request:s,Response:e}))(j.global),{ReadableStream:ng,TextEncoder:ig}=j.global,ag=(s,...e)=>{try{return!!s(...e)}catch{return!1}},l_=s=>{s=j.merge.call({skipUndefined:!0},o_,s);const{fetch:e,Request:t,Response:r}=s,n=e?bo(e):typeof fetch=="function",i=bo(t),a=bo(r);if(!n)return!1;const o=n&&bo(ng),l=n&&(typeof ig=="function"?(m=>y=>m.encode(y))(new ig):async m=>new Uint8Array(await new t(m).arrayBuffer())),c=i&&o&&ag(()=>{let m=!1;const y=new t(Lt.origin,{body:new ng,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!y}),u=a&&o&&ag(()=>j.isReadableStream(new r("").body)),d={stream:u&&(m=>m.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!d[m]&&(d[m]=(y,g)=>{let x=y&&y[m];if(x)return x.call(y);throw new le(`Response type '${m}' is not supported`,le.ERR_NOT_SUPPORT,g)})});const f=async m=>{if(m==null)return 0;if(j.isBlob(m))return m.size;if(j.isSpecCompliantForm(m))return(await new t(Lt.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(j.isArrayBufferView(m)||j.isArrayBuffer(m))return m.byteLength;if(j.isURLSearchParams(m)&&(m=m+""),j.isString(m))return(await l(m)).byteLength},p=async(m,y)=>{const g=j.toFiniteNumber(m.getContentLength());return g??f(y)};return async m=>{let{url:y,method:g,data:x,signal:v,cancelToken:E,timeout:T,onDownloadProgress:w,onUploadProgress:R,responseType:b,headers:_,withCredentials:I="same-origin",fetchOptions:L}=Fv(m),N=e||fetch;b=b?(b+"").toLowerCase():"text";let M=r_([v,E&&E.toAbortSignal()],T),$=null;const G=M&&M.unsubscribe&&(()=>{M.unsubscribe()});let Y;try{if(R&&c&&g!=="get"&&g!=="head"&&(Y=await p(_,x))!==0){let O=new t(y,{method:"POST",body:x,duplex:"half"}),F;if(j.isFormData(x)&&(F=O.headers.get("content-type"))&&_.setContentType(F),O.body){const[Z,te]=Zp(Y,$l(eg(R)));x=sg(O.body,rg,Z,te)}}j.isString(I)||(I=I?"include":"omit");const U=i&&"credentials"in t.prototype,W={...L,signal:M,method:g.toUpperCase(),headers:_.normalize().toJSON(),body:x,duplex:"half",credentials:U?I:void 0};$=i&&new t(y,W);let P=await(i?N($,L):N(y,W));const B=u&&(b==="stream"||b==="response");if(u&&(w||B&&G)){const O={};["status","statusText","headers"].forEach(z=>{O[z]=P[z]});const F=j.toFiniteNumber(P.headers.get("content-length")),[Z,te]=w&&Zp(F,$l(eg(w),!0))||[];P=new r(sg(P.body,rg,Z,()=>{te&&te(),G&&G()}),O)}b=b||"text";let K=await d[j.findKey(d,b)||"text"](P,m);return!B&&G&&G(),await new Promise((O,F)=>{Ov(O,F,{data:K,headers:Yt.from(P.headers),status:P.status,statusText:P.statusText,config:m,request:$})})}catch(U){throw G&&G(),U&&U.name==="TypeError"&&/Load failed|fetch/i.test(U.message)?Object.assign(new le("Network Error",le.ERR_NETWORK,m,$),{cause:U.cause||U}):le.from(U,U&&U.code,m,$)}}},c_=new Map,jv=s=>{let e=s&&s.env||{};const{fetch:t,Request:r,Response:n}=e,i=[r,n,t];let a=i.length,o=a,l,c,u=c_;for(;o--;)l=i[o],c=u.get(l),c===void 0&&u.set(l,c=o?new Map:l_(e)),u=c;return c};jv();const Pf={http:LL,xhr:s_,fetch:{get:jv}};j.forEach(Pf,(s,e)=>{if(s){try{Object.defineProperty(s,"name",{value:e})}catch{}Object.defineProperty(s,"adapterName",{value:e})}});const og=s=>`- ${s}`,u_=s=>j.isFunction(s)||s===null||s===!1;function d_(s,e){s=j.isArray(s)?s:[s];const{length:t}=s;let r,n;const i={};for(let a=0;a<t;a++){r=s[a];let o;if(n=r,!u_(r)&&(n=Pf[(o=String(r)).toLowerCase()],n===void 0))throw new le(`Unknown adapter '${o}'`);if(n&&(j.isFunction(n)||(n=n.get(e))))break;i[o||"#"+a]=n}if(!n){const a=Object.entries(i).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=t?a.length>1?`since :
`+a.map(og).join(`
`):" "+og(a[0]):"as no adapter specified";throw new le("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n}const $v={getAdapter:d_,adapters:Pf};function Eu(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new Xa(null,s)}function lg(s){return Eu(s),s.headers=Yt.from(s.headers),s.data=vu.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),$v.getAdapter(s.adapter||qa.adapter,s)(s).then(function(r){return Eu(s),r.data=vu.call(s,s.transformResponse,r),r.headers=Yt.from(r.headers),r},function(r){return Nv(r)||(Eu(s),r&&r.response&&(r.response.data=vu.call(s,s.transformResponse,r.response),r.response.headers=Yt.from(r.response.headers))),Promise.reject(r)})}const Uv="1.13.4",wc={};["object","boolean","number","function","string","symbol"].forEach((s,e)=>{wc[s]=function(r){return typeof r===s||"a"+(e<1?"n ":" ")+s}});const cg={};wc.transitional=function(e,t,r){function n(i,a){return"[Axios v"+Uv+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return(i,a,o)=>{if(e===!1)throw new le(n(a," has been removed"+(t?" in "+t:"")),le.ERR_DEPRECATED);return t&&!cg[a]&&(cg[a]=!0,console.warn(n(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};wc.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function h_(s,e,t){if(typeof s!="object")throw new le("options must be an object",le.ERR_BAD_OPTION_VALUE);const r=Object.keys(s);let n=r.length;for(;n-- >0;){const i=r[n],a=e[i];if(a){const o=s[i],l=o===void 0||a(o,i,s);if(l!==!0)throw new le("option "+i+" must be "+l,le.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new le("Unknown option "+i,le.ERR_BAD_OPTION)}}const el={assertOptions:h_,validators:wc},Cs=el.validators;let fn=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Qp,response:new Qp}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const i=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Sn(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:i}=t;r!==void 0&&el.assertOptions(r,{silentJSONParsing:Cs.transitional(Cs.boolean),forcedJSONParsing:Cs.transitional(Cs.boolean),clarifyTimeoutError:Cs.transitional(Cs.boolean)},!1),n!=null&&(j.isFunction(n)?t.paramsSerializer={serialize:n}:el.assertOptions(n,{encode:Cs.function,serialize:Cs.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),el.assertOptions(t,{baseUrl:Cs.spelling("baseURL"),withXsrfToken:Cs.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&j.merge(i.common,i[t.method]);i&&j.forEach(["delete","get","head","post","put","patch","common"],m=>{delete i[m]}),t.headers=Yt.concat(a,i);const o=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(l=l&&y.synchronous,o.unshift(y.fulfilled,y.rejected))});const c=[];this.interceptors.response.forEach(function(y){c.push(y.fulfilled,y.rejected)});let u,d=0,f;if(!l){const m=[lg.bind(this),void 0];for(m.unshift(...o),m.push(...c),f=m.length,u=Promise.resolve(t);d<f;)u=u.then(m[d++],m[d++]);return u}f=o.length;let p=t;for(;d<f;){const m=o[d++],y=o[d++];try{p=m(p)}catch(g){y.call(this,g);break}}try{u=lg.call(this,p)}catch(m){return Promise.reject(m)}for(d=0,f=c.length;d<f;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=Sn(this.defaults,e);const t=Mv(e.baseURL,e.url,e.allowAbsoluteUrls);return Cv(t,e.params,e.paramsSerializer)}};j.forEach(["delete","get","head","options"],function(e){fn.prototype[e]=function(t,r){return this.request(Sn(r||{},{method:e,url:t,data:(r||{}).data}))}});j.forEach(["post","put","patch"],function(e){function t(r){return function(i,a,o){return this.request(Sn(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}fn.prototype[e]=t(),fn.prototype[e+"Form"]=t(!0)});let f_=class Bv{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(n=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](n);r._listeners=null}),this.promise.then=n=>{let i;const a=new Promise(o=>{r.subscribe(o),i=o}).then(n);return a.cancel=function(){r.unsubscribe(i)},a},e(function(i,a,o){r.reason||(r.reason=new Xa(i,a,o),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Bv(function(n){e=n}),cancel:e}}};function m_(s){return function(t){return s.apply(null,t)}}function p_(s){return j.isObject(s)&&s.isAxiosError===!0}const rh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(rh).forEach(([s,e])=>{rh[e]=s});function Vv(s){const e=new fn(s),t=Ev(fn.prototype.request,e);return j.extend(t,fn.prototype,e,{allOwnKeys:!0}),j.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return Vv(Sn(s,n))},t}const et=Vv(qa);et.Axios=fn;et.CanceledError=Xa;et.CancelToken=f_;et.isCancel=Nv;et.VERSION=Uv;et.toFormData=bc;et.AxiosError=le;et.Cancel=et.CanceledError;et.all=function(e){return Promise.all(e)};et.spread=m_;et.isAxiosError=p_;et.mergeConfig=Sn;et.AxiosHeaders=Yt;et.formToJSON=s=>Dv(j.isHTMLForm(s)?new FormData(s):s);et.getAdapter=$v.getAdapter;et.HttpStatusCode=rh;et.default=et;const{Axios:lO,AxiosError:cO,CanceledError:uO,isCancel:dO,CancelToken:hO,VERSION:fO,all:mO,Cancel:pO,isAxiosError:gO,spread:yO,toFormData:xO,AxiosHeaders:vO,HttpStatusCode:EO,formToJSON:SO,getAdapter:TO,mergeConfig:bO}=et,Df=et.create({baseURL:Jd.BASE_URL,params:{api_key:Jd.API_KEY,language:"en-US"}});Df.interceptors.request.use(s=>{var e;return console.log(`TMDB API Request: ${(e=s.method)==null?void 0:e.toUpperCase()} ${s.url}`),s},s=>(console.error("TMDB API Request Error:",s),Promise.reject(s)));Df.interceptors.response.use(s=>(console.log(`TMDB API Response: ${s.status} ${s.config.url}`),s),s=>{var e,t,r,n;return console.error("TMDB API Response Error:",((e=s.response)==null?void 0:e.data)||s.message),((t=s.response)==null?void 0:t.status)===401?console.error("TMDB API Key is invalid or expired"):((r=s.response)==null?void 0:r.status)===404?console.error("TMDB Resource not found"):((n=s.response)==null?void 0:n.status)>=500&&console.error("TMDB Server error"),Promise.reject(s)});const ze=async(s,e={})=>{try{return(await Df.get(s,{params:e})).data}catch(t){throw console.error(`Error fetching ${s}:`,t),t}},g_=async(s="week",e="all")=>ze(He.TRENDING,{time_window:s}),y_=async(s=1)=>ze(He.POPULAR_MOVIES,{page:s}),x_=async(s=1)=>ze(He.TOP_RATED_MOVIES,{page:s}),v_=async(s=1)=>ze(He.UPCOMING_MOVIES,{page:s}),E_=async(s=1)=>ze(He.NOW_PLAYING_MOVIES,{page:s}),Nf=async s=>ze(He.MOVIE_DETAILS(s)),S_=async s=>ze(He.MOVIE_CREDITS(s)),Gv=async s=>ze(He.MOVIE_VIDEOS(s)),T_=async(s,e=1)=>ze(He.MOVIE_RECOMMENDATIONS(s),{page:e}),Of=async s=>ze(He.TV_DETAILS(s)),b_=async s=>ze(He.TV_CREDITS(s)),Hv=async s=>ze(He.TV_VIDEOS(s)),w_=async(s,e=1)=>ze(He.TV_RECOMMENDATIONS(s),{page:e}),A_=async(s,e=1)=>!s||s.trim()===""?{results:[],total_results:0}:ze(He.SEARCH_MOVIES,{query:s.trim(),page:e,include_adult:!1}),zv=async(s,e=1)=>!s||s.trim()===""?{results:[],total_results:0}:ze(He.SEARCH_MULTI,{query:s.trim(),page:e,include_adult:!1}),ug=async s=>ze(He.TV_DETAILS(s)),dg=async(s={})=>{const e={page:1,sort_by:"popularity.desc",include_adult:!1,language:"en-US"};return ze(He.DISCOVER_MOVIE,{...e,...s})},hg=async(s={})=>{const e={page:1,sort_by:"popularity.desc",include_adult:!1,language:"en-US"};return ze(He.DISCOVER_TV,{...e,...s})},L_=async s=>ze(He.PERSON_DETAILS(s)),__=async s=>ze(He.PERSON_MOVIE_CREDITS(s)),R_=async s=>ze(He.PERSON_TV_CREDITS(s)),I_=async s=>ze(He.MOVIE_WATCH_PROVIDERS(s)),k_=async s=>ze(He.TV_WATCH_PROVIDERS(s)),C_=async(s,e)=>{var t,r;try{const n=e==="tv"?await k_(s):await I_(s),i=(t=n.results)==null?void 0:t.US;if(!i)return{flatrate:null,rent:null,buy:null,free:null,link:null};const a=i.free||null,o=i.flatrate||null,l=i.rent||null,c=i.buy||null,u=((r=n.results)==null?void 0:r.link)||null;return{flatrate:o,rent:l,buy:c,free:a,link:u,all:{...a&&{free:a},...o&&{flatrate:o},...l&&{rent:l},...c&&{buy:c}}}}catch(n){return console.error("Error fetching watch providers:",n),{flatrate:null,rent:null,buy:null,free:null,link:null}}},nh=({onSearch:s,placeholder:e="Search movies, TV shows, actors...",showSuggestions:t=!0,className:r=""})=>{const[n,i]=A.useState(""),[a,o]=A.useState(!1),[l,c]=A.useState([]),[u,d]=A.useState(!1),f=A.useRef(null),p=A.useRef(null),m=Rs();A.useEffect(()=>{const b=_=>{f.current&&!f.current.contains(_.target)&&o(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]);const y=async b=>{if(b.length<2){c([]);return}d(!0);try{const I=(await zv(b)).results.filter(L=>L.media_type==="movie"||L.media_type==="tv"||L.media_type==="person").slice(0,6).map(L=>({id:L.id,title:L.title||L.name,media_type:L.media_type,poster_path:L.poster_path,profile_path:L.profile_path,release_date:L.release_date||L.first_air_date,known_for:L.known_for?L.known_for.slice(0,2).map(N=>N.title||N.name):[]}));c(I)}catch(_){console.error("Error fetching suggestions:",_),c([])}finally{d(!1)}},g=A.useCallback(FA(b=>{y(b)},300),[]),x=b=>{const _=b.target.value;i(_),t&&_.length>=2?(g(_),o(!0)):(c([]),_.length<2&&o(!1))},v=b=>{n.trim()&&(m(`/browse?q=${encodeURIComponent(n.trim())}`),o(!1),s==null||s(n.trim()))},E=()=>{i(""),c([]),o(!1),p.current&&p.current.focus()},T=b=>{b.media_type==="movie"?m(`/movie/${b.id}`):b.media_type==="tv"?m(`/tv/${b.id}`):b.media_type==="person"&&m(`/person/${b.id}`),o(!1),i("")},w=()=>{n.length>=2&&l.length>0&&o(!0)},R=b=>{switch(b){case"movie":return{icon:En,color:"text-blue-400",bg:"bg-blue-400/10",label:"Movie"};case"tv":return{icon:nn,color:"text-purple-400",bg:"bg-purple-400/10",label:"TV Show"};case"person":return{icon:Rf,color:"text-green-400",bg:"bg-green-400/10",label:"Person"};default:return{icon:En,color:"text-gray-400",bg:"bg-gray-400/10",label:b}}};return h.jsxs("div",{ref:f,className:`relative w-full ${r}`,children:[h.jsxs("div",{className:"relative group",children:[h.jsx("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 z-10",children:h.jsx(qn,{className:"text-gray-400 group-focus-within:text-netflix-red transition-colors duration-200",size:20})}),h.jsx("input",{ref:p,type:"text",value:n,onChange:x,onFocus:w,placeholder:e,autoComplete:"off",className:`w-full pl-12 pr-28 py-3.5
            bg-gray-800/80 backdrop-blur-sm
            text-white placeholder-gray-400
            border border-gray-700/50 rounded-full
            focus:border-netflix-red focus:outline-none focus:ring-2 focus:ring-red-500/20
            transition-all duration-200
            cursor-text
            text-base`}),h.jsxs("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[h.jsx("button",{type:"button",className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-full transition-all duration-200",title:"Voice Search",children:h.jsx(AA,{size:18})}),n&&h.jsx("button",{type:"button",onClick:E,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-full transition-all duration-200",title:"Clear",children:h.jsx(jl,{size:18})})]})]}),t&&a&&h.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 z-50",children:[u&&h.jsx("div",{className:"bg-gray-800/95 backdrop-blur-xl rounded-xl shadow-2xl overflow-hidden p-4",children:h.jsxs("div",{className:"flex items-center justify-center gap-3 text-gray-400",children:[h.jsx(gi,{className:"animate-spin",size:20}),h.jsx("span",{className:"text-sm",children:"Searching..."})]})}),!u&&l.length>0&&h.jsxs("div",{className:"bg-gray-800/95 backdrop-blur-xl rounded-xl shadow-2xl overflow-hidden",children:[h.jsx("div",{className:"py-2",children:l.map(b=>{const _=R(b.media_type),I=_.icon,L=b.media_type==="person"?b.profile_path:b.poster_path;return h.jsxs("button",{type:"button",onClick:()=>T(b),className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-700/70 transition-all duration-150 group",children:[L?h.jsx("img",{src:`https://image.tmdb.org/t/p/w92${L}`,alt:b.title,className:"w-10 h-14 object-cover rounded-lg shadow-md group-hover:scale-105 transition-transform duration-200"}):h.jsx("div",{className:"w-10 h-14 bg-gray-700 rounded-lg flex items-center justify-center shadow-md",children:h.jsx(I,{className:_.color,size:20})}),h.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[h.jsx("span",{className:"text-white truncate block font-medium",children:b.title}),h.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[h.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${_.bg} ${_.color}`,children:[h.jsx(I,{size:10}),_.label]}),b.release_date&&h.jsx("span",{className:"text-xs text-gray-500",children:b.release_date.split("-")[0]}),b.media_type==="person"&&b.known_for&&b.known_for.length>0&&h.jsxs("span",{className:"text-xs text-gray-500 truncate",children:["Known for: ",b.known_for.join(", ")]})]})]}),h.jsx(qn,{className:"text-gray-600 group-hover:text-netflix-red transition-colors duration-200",size:16})]},b.id)})}),h.jsx("div",{className:"px-4 py-2 bg-gray-700/30 border-t border-gray-700/50",children:h.jsxs("button",{onClick:b=>{b.preventDefault(),v()},className:"w-full flex items-center justify-center gap-2 py-2 text-sm text-netflix-red hover:text-red-400 transition-colors font-medium",children:[h.jsx(qn,{size:16}),'Search all results for "',n,'"']})})]}),!u&&n.length>=2&&l.length===0&&h.jsx("div",{className:"bg-gray-800/95 backdrop-blur-xl rounded-xl shadow-2xl overflow-hidden p-6",children:h.jsxs("div",{className:"text-center",children:[h.jsx(qn,{className:"mx-auto text-gray-500 mb-3",size:32}),h.jsxs("p",{className:"text-gray-400",children:['No results found for "',n,'"']}),h.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Try searching for movies, TV shows, or actors"})]})})]})]})},P_=({onMenuClick:s})=>{const[e,t]=A.useState(!1),r=dr();Rs();const{getWatchlistCount:n}=za(),i=n(),a=r.pathname==="/";return A.useEffect(()=>{const o=()=>{t(window.scrollY>50)};return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[]),r.pathname==="/watch-trailer"||r.pathname==="/watchlist"?null:h.jsx("nav",{className:`
        fixed top-0 left-0 right-0 z-40
        transition-all duration-300
        ${e||!a?"bg-gray-900/95 backdrop-blur-md shadow-lg":"bg-gradient-to-b from-black/80 to-transparent"}
      `,children:h.jsxs("div",{className:"container mx-auto px-3 sm:px-4 md:px-6 lg:px-8",children:[h.jsxs("div",{className:"flex items-center justify-between h-14 sm:h-16 md:h-20",children:[h.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 md:gap-6",children:[h.jsx("button",{onClick:s,className:"md:hidden text-white hover:text-netflix-red transition-colors p-1",children:h.jsx(wA,{size:20})}),h.jsx(ve,{to:"/",className:"flex items-center gap-1 sm:gap-2",children:h.jsx("span",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-netflix-red",children:"StreamFlix"})}),h.jsxs("div",{className:"hidden md:flex items-center gap-4 lg:gap-6",children:[h.jsx(Su,{to:"/",active:r.pathname==="/",children:"Home"}),h.jsx(Su,{to:"/browse",active:r.pathname==="/browse",children:"Browse"}),h.jsx(Su,{to:"/watchlist",active:r.pathname==="/watchlist",children:"Watchlist"})]})]}),h.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 md:gap-4",children:[h.jsx("div",{className:"hidden md:block w-48 lg:w-64 xl:w-80",children:h.jsx(nh,{showSuggestions:!0,placeholder:"Search movies, TV shows..."})}),h.jsxs("button",{className:"hidden md:flex text-white hover:text-netflix-red transition-colors relative p-1",children:[h.jsx(EA,{size:18}),h.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-netflix-red text-white text-xs rounded-full flex items-center justify-center",children:"3"})]}),h.jsxs(ve,{to:"/watchlist",className:"text-white hover:text-netflix-red transition-colors relative p-1",children:[h.jsx("span",{className:"hidden md:inline text-sm",children:"Watchlist"}),h.jsx("span",{className:"md:hidden text-sm",children:"List"}),i>0&&h.jsx("span",{className:"absolute -top-2 -right-2 w-4 h-4 sm:w-5 sm:h-5 bg-netflix-red text-white text-xs rounded-full flex items-center justify-center",children:i>9?"9+":i})]}),h.jsx("button",{className:"hidden md:flex text-white hover:text-netflix-red transition-colors p-1",children:h.jsx(Rf,{size:18})})]})]}),h.jsx("div",{className:"md:hidden pb-3 sm:pb-4",children:h.jsx(nh,{showSuggestions:!0,placeholder:"Search movies, TV shows..."})})]})})},Su=({to:s,children:e,active:t})=>h.jsx(ve,{to:s,className:`
        text-sm font-medium transition-colors
        ${t?"text-white":"text-gray-300 hover:text-white"}
      `,children:e}),D_=({isOpen:s,onClose:e})=>{const t=[{icon:Bp,label:"Home",to:"/"},{icon:SA,label:"Browse",to:"/browse"},{icon:yv,label:"Trending",to:"/browse?sort=trending"},{icon:nn,label:"Movies",to:"/browse?type=movie"},{icon:nn,label:"TV Shows",to:"/browse?type=tv"},{icon:nn,label:"Anime",to:"/anime"},{icon:nn,label:"Anime Server-2",to:"https://MUSTAFA-A-KHAN.github.io/AnimeFlix/"},{icon:qr,label:"Watchlist",to:"/watchlist"}],r=[{icon:Fl,label:"Coming Soon",to:"/browse?sort=upcoming"},{icon:Ha,label:"Top Rated",to:"/browse?sort=top_rated"}];return h.jsxs(h.Fragment,{children:[s&&h.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:e}),h.jsxs("aside",{className:`
          fixed top-0 left-0 h-full w-64 bg-gray-900 z-50
          transform transition-transform duration-300 ease-in-out
          md:static md:transform-none md:transition-none md:h-auto md:min-h-full md:top-0 md:z-auto
          ${s?"translate-x-0":"-translate-x-full"}
        `,children:[h.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800 md:hidden",children:[h.jsx("span",{className:"text-2xl font-bold text-netflix-red",children:"StreamFlix"}),h.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:h.jsx(Bp,{size:24})})]}),h.jsxs("nav",{className:"p-3 sm:p-4 space-y-4 sm:space-y-6",children:[h.jsxs("div",{children:[h.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 sm:mb-3 px-2 sm:px-3",children:"Menu"}),h.jsx("ul",{className:"space-y-1",children:t.map(n=>h.jsx("li",{children:h.jsxs(pu,{to:n.to,onClick:e,className:({isActive:i})=>`
                      flex items-center gap-2 sm:gap-3 px-2 sm:px-3 py-2 sm:py-2.5 rounded-md
                      transition-colors duration-200 text-sm sm:text-base
                      ${i?"bg-gray-800 text-white":"text-gray-400 hover:text-white hover:bg-gray-800/50"}
                    `,children:[h.jsx(n.icon,{size:18,className:"sm:w-5 sm:h-5"}),h.jsx("span",{className:"font-medium",children:n.label})]})},n.to))})]}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 sm:mb-3 px-2 sm:px-3",children:"Categories"}),h.jsx("ul",{className:"space-y-1",children:r.map(n=>h.jsx("li",{children:h.jsxs(pu,{to:n.to,onClick:e,className:({isActive:i})=>`
                      flex items-center gap-2 sm:gap-3 px-2 sm:px-3 py-2 sm:py-2.5 rounded-md
                      transition-colors duration-200 text-sm sm:text-base
                      ${i?"bg-gray-800 text-white":"text-gray-400 hover:text-white hover:bg-gray-800/50"}
                    `,children:[h.jsx(n.icon,{size:18,className:"sm:w-5 sm:h-5"}),h.jsx("span",{className:"font-medium",children:n.label})]})},n.to))})]}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 sm:mb-3 px-2 sm:px-3",children:"Popular Genres"}),h.jsx("ul",{className:"space-y-1",children:[{name:"Action",path:"/browse?genre=28"},{name:"Comedy",path:"/browse?genre=35"},{name:"Drama",path:"/browse?genre=18"},{name:"Thriller",path:"/browse?genre=53"},{name:"Sci-Fi",path:"/browse?genre=878"}].map(n=>h.jsx("li",{children:h.jsxs(pu,{to:n.path,onClick:e,className:({isActive:i})=>`
                      flex items-center gap-2 sm:gap-3 px-2 sm:px-3 py-2 sm:py-2.5 rounded-md
                      transition-colors duration-200 text-sm sm:text-base
                      ${i?"bg-gray-800 text-white":"text-gray-400 hover:text-white hover:bg-gray-800/50"}
                    `,children:[h.jsx(nn,{size:18,className:"sm:w-5 sm:h-5"}),h.jsx("span",{className:"font-medium",children:n.name})]})},n.path))})]})]}),h.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-800",children:h.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white cursor-pointer transition-colors",children:[h.jsx(Fl,{size:20}),h.jsx("span",{children:"Recently Watched"})]})})]})]})},N_=()=>{const[s,e]=A.useState(!1);return h.jsxs("div",{className:"min-h-screen bg-gray-900",children:[h.jsx(P_,{onMenuClick:()=>e(!0)}),h.jsxs("div",{className:"pt-16 md:pt-20 flex flex-col md:flex-row min-h-screen w-full max-w-full overflow-x-hidden",children:[h.jsx(D_,{isOpen:s,onClose:()=>e(!1)}),h.jsx("main",{className:"flex-1 min-w-0 overflow-x-hidden",children:h.jsx(eA,{})})]})]})},tt=({className:s="",variant:e="text",height:t,width:r})=>{const n="skeleton rounded",i={text:"h-4",circular:"rounded-full",rectangular:"rounded-md",card:"rounded-lg",avatar:"rounded-full"},a={height:t||void 0,width:r||void 0};return h.jsx("div",{className:`${n} ${i[e]||i.text} ${s}`,style:a,"aria-hidden":"true"})},Ac=()=>h.jsxs("div",{className:"flex-shrink-0 w-40 md:w-48 lg:w-56 xl:w-64 animate-pulse",children:[h.jsx(tt,{variant:"card",className:"aspect-[2/3] bg-gray-800"}),h.jsxs("div",{className:"mt-3 space-y-2",children:[h.jsx(tt,{className:"h-4 w-3/4"}),h.jsx(tt,{className:"h-4 w-1/2"})]})]}),Lc=()=>h.jsxs("div",{className:"relative h-[70vh] w-full animate-pulse",children:[h.jsx(tt,{className:"h-full w-full bg-gray-800"}),h.jsx("div",{className:"absolute inset-0 hero-gradient flex items-end p-8 md:p-16",children:h.jsxs("div",{className:"max-w-2xl space-y-4 w-full",children:[h.jsx(tt,{className:"h-10 w-3/4 bg-gray-700"}),h.jsx(tt,{className:"h-6 w-full bg-gray-700"}),h.jsx(tt,{className:"h-6 w-2/3 bg-gray-700"}),h.jsxs("div",{className:"flex gap-4 pt-4",children:[h.jsx(tt,{className:"h-12 w-32 bg-gray-700"}),h.jsx(tt,{className:"h-12 w-32 bg-gray-700"})]})]})})]}),ri=({title:s})=>h.jsxs("div",{className:"py-6",children:[h.jsx("h3",{className:"text-xl md:text-2xl font-bold mb-4",children:s}),h.jsx("div",{className:"flex gap-4 overflow-x-auto carousel-container pb-4",children:[...Array(6)].map((e,t)=>h.jsx(Ac,{},t))})]}),O_=({size:s="md",color:e="red"})=>{const t={sm:"w-5 h-5",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"},r={red:"border-netflix-red border-t-transparent",white:"border-white border-t-transparent",gray:"border-gray-500 border-t-transparent"};return h.jsx("div",{className:`
        ${t[s]}
        ${r[e]}
        border-4 rounded-full animate-spin
      `})},M_=()=>h.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:h.jsxs("div",{className:"text-center",children:[h.jsx(O_,{size:"xl",color:"red"}),h.jsx("p",{className:"mt-4 text-gray-400",children:"Loading..."})]})}),Tn=new Map,Tu=new Map,Mf=5*60*1e3;function F_(){const s=Date.now();for(const[e,t]of Tn.entries())s-t.timestamp>Mf&&Tn.delete(e)}setInterval(F_,10*60*1e3);function j_(s){const e=Tn.get(s);return e?Date.now()-e.timestamp>Mf?(Tn.delete(s),null):e.data:null}function Kv(s,e){Tn.set(s,{data:e,timestamp:Date.now()})}function hr(s,e,t=Mf){const r=Tu.get(s);if(r)return console.log(`[API Dedupe] Reusing in-flight request for: ${s}`),r;const n=new AbortController,i=e({signal:n.signal,cacheKey:s}).then(a=>(Kv(s,a),a)).finally(()=>{Tu.delete(s),setTimeout(()=>{const a=Tn.get(s);a&&Date.now()-a.timestamp>t&&Tn.delete(s)},t)});return Tu.set(s,i),console.log(`[API Dedupe] Created new request for: ${s}`),i.abort=()=>n.abort(),i}const $_="https://hianimeapi-6uju.onrender.com/api/v1",Xr=$_,U_="https://hianimeapi-6uju.onrender.com/api/v1",B_={animekai:{templates:{search:"/anime/animekai/{query}",info:"/anime/animekai/info?id={id}",episodes:"/anime/animekai/episodes/{id}",watch:"/anime/animekai/watch/{episodeId}"}},animepahe:{templates:{search:"/anime/animepahe/{query}",info:"/anime/animepahe/info/{id}",episodes:"/anime/animepahe/episodes/{id}",watch:"/anime/animepahe/watch?episodeId={episodeId}"}},"hianime-scrap":{templates:{search:"/search?keyword={query}&page=1",info:"/anime/{id}",episodes:"/episodes/{id}",servers:"/servers?id={id}",stream:"/stream?id={id}&type={type}&server={server}"}}},Ff="hianime-scrap";function fg(s,e={}){return`anime_${s}_${JSON.stringify(e)}`.replace(/[^a-zA-Z0-9]/g,"_")}function Qr(s,e={}){return`${s}::${JSON.stringify(e)}`}function _c(s,e,t={}){const r=B_[s],n=r==null?void 0:r.templates[e];if(!n)return"";let i=n;return Object.keys(t).forEach(a=>{const o=encodeURIComponent(String(t[a]||""));i=i.replace(new RegExp(`\\{${a}\\}`,"g"),o)}),i}async function fr(s,e={}){const{signal:t,cacheKey:r,timeout:n=3e4}=e,i=j_(r||s);if(i&&e.method!=="POST")return console.log(`[anime.js] Cache hit for: ${s}`),i;const a=new AbortController,o=t||a.signal,l=fetch(s,{...e,headers:{...e.headers},signal:o}),c=new Promise((u,d)=>{setTimeout(()=>{a.abort(),d(new Error(`Request timeout: ${s}`))},n)});try{const u=await Promise.race([l,c]);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const d=await u.json();return(r||s)&&Kv(r||s,d),d}catch(u){throw u.name==="AbortError"?(console.log(`[anime.js] Request aborted: ${s}`),new Error("Request cancelled")):(console.error(`[anime.js] Fetch error for ${s}:`,u),u)}}const V_=async(s={})=>{const e="/home",t=`anime_home_${fg(e)}`;return fg(e),hr(t,async({signal:r})=>await fr(`${Xr}${e}`,{...s,signal:r,cacheKey:t}),5*60*1e3).catch(r=>{if(r.message==="Request cancelled")return{data:null};throw r})},G_=async(s,e=1,t=Ff,r={})=>{const n=_c(t,"search",{query:s}),i=`${U_}${n}`,a=`anime_search_${Qr("search",{keyword:s,page:e,provider:t})}`;return hr(a,async({signal:o})=>{const l=await fr(i,{...r,signal:o,cacheKey:a});let c=[];return l&&l.data&&l.data.response&&Array.isArray(l.data.response)?c=l.data.response:Array.isArray(l)?c=l:l&&l.results&&Array.isArray(l.results)?c=l.results:l&&l.anime&&Array.isArray(l.anime)?c=l.anime:l&&l.data&&Array.isArray(l.data)&&(c=l.data),{data:{response:c}}},2*60*1e3).catch(o=>{if(o.message==="Request cancelled")return{data:{response:[]}};throw o})},Wv=async(s,e={})=>{const t=`/anime/${encodeURIComponent(s)}`,r=`anime_details_${Qr("details",{id:s})}`;return hr(r,async({signal:n})=>await fr(`${Xr}${t}`,{...e,signal:n,cacheKey:r}),5*60*1e3).catch(n=>{if(n.message==="Request cancelled")return{data:null};throw n})},Yv=async(s,e=Ff,t={})=>{const r=_c(e,"episodes",{id:s}),n=`anime_episodes_${Qr("episodes",{id:s,provider:e})}`;return hr(n,async({signal:i})=>{const a=await fr(`${Xr}${r}`,{...t,signal:i,cacheKey:n});return{data:q_(a,e)}},5*60*1e3).catch(i=>{if(i.message==="Request cancelled")return{data:[]};throw i})},qv=async(s,e={})=>{let t=_c("hianime-scrap","servers",{id:s});t=t.replace("?","/");const r=`anime_servers_${Qr("servers",{id:s})}`;return hr(r,async({signal:n})=>await fr(`${Xr}${t}`,{...e,signal:n,cacheKey:r}),2*60*1e3).catch(n=>{if(n.message==="Request cancelled")return{data:null};throw n})},ih=async(s,e="hd-1",t="sub",r=Ff,n={})=>{const i=_c(r,r==="hianime-scrap"?"stream":"watch",{id:s,episodeId:s,type:t,server:e}),o=i.includes("stream")?`https://hianimeapi-6uju.onrender.com/api/v1${i}`:`${Xr}${i}`,l=`anime_stream_${Qr("stream",{streamId:s,server:e,type:t,provider:r})}`;return hr(l,async({signal:c})=>await fr(o,{...n,signal:c,cacheKey:l,timeout:15e3}),1*60*1e3).catch(c=>{if(c.message==="Request cancelled")return{data:null};throw c})},Xv="https://rust-proxy-fy7g.onrender.com",H_=(s,e="https://megacloud.tv")=>{if(!s)return null;const t=`${Xv}/?url=${encodeURIComponent(s)}&referer=${encodeURIComponent(e)}`;return console.log("[anime.js] Proxied Stream URL (Render):",t),t},z_=(s,e="https://hianime.to")=>{if(!s)return null;if(s.startsWith("blob:")||s.startsWith("data:")||s.includes("localhost")||s.includes("127.0.0.1"))return s;const t=`${Xv}/proxy?url=${encodeURIComponent(s)}&referer=${encodeURIComponent(e)}`;return console.log("[anime.js] Proxied Subtitle URL (Render):",t),t},K_=async(s,e=1,t={})=>{if(!["top-airing","most-popular","most-favorite","completed","recently-added","recently-updated","top-upcoming","subbed-anime","dubbed-anime","movie","tv","ova","ona","special"].includes(s))throw new Error(`Invalid query: ${s}`);const n=`/${s}?page=${e}`,i=`anime_browse_${Qr("browse",{query:s,page:e})}`;return hr(i,async({signal:a})=>await fr(`${Xr}${n}`,{...t,signal:a,cacheKey:i}),5*60*1e3).catch(a=>{if(a.message==="Request cancelled")return{data:{response:[]}};throw a})},W_=async(s,e={})=>{const t=`/schedule/next/${encodeURIComponent(s)}`,r=`anime_next_ep_${Qr("nextEpisode",{animeId:s})}`;return hr(r,async({signal:n})=>fr(`${Xr}${t}`,{...e,signal:n,cacheKey:r}),5*60*1e3)},Y_=async(s,e=1,t={})=>{const r=`/characters/${encodeURIComponent(s)}?page=${e}`,n=`anime_characters_${Qr("characters",{id:s,page:e})}`;return hr(n,async({signal:i})=>fr(`${Xr}${r}`,{...t,signal:i,cacheKey:n}),10*60*1e3)};function q_(s,e){return s?e==="hianime-scrap"&&s&&s.data&&Array.isArray(s.data)?s.data.map((t,r)=>({id:t.id||`${r+1}`,number:t.episodeNumber||t.number||r+1,title:t.title||t.alternativeTitle||`Episode ${t.episodeNumber||t.number||r+1}`,isFiller:t.isFiller||!1})):Array.isArray(s)?s.map((t,r)=>({id:t.id||t.episodeId||`${r+1}`,number:t.number||t.episode||t.ep||t.episodeNumber||r+1,title:t.title||t.name||`Episode ${r+1}`})):s.episodes&&Array.isArray(s.episodes)?s.episodes.map((t,r)=>({id:t.id||t.episodeId||`${r+1}`,number:t.number||t.episode||t.ep||t.episodeNumber||r+1,title:t.title||t.name||`Episode ${r+1}`})):s.data&&Array.isArray(s.data)?s.data.map((t,r)=>({id:t.id||t.episodeId||`${r+1}`,number:t.number||t.episode||t.ep||t.episodeNumber||r+1,title:t.title||t.name||`Episode ${r+1}`})):[]:[]}function X_(s,e,t){var r,n,i;if(s&&s.data&&t==="hianime-scrap")return{...s.data,id:s.data.id||e,title:s.data.title,poster:s.data.poster,image:s.data.poster,type:s.data.type,status:s.data.status,genres:s.data.genres||[],description:s.data.description||s.data.synopsis||"",totalEpisodes:((r=s.data.episodes)==null?void 0:r.eps)||((n=s.data.episodes)==null?void 0:n.sub)||((i=s.data.episodes)==null?void 0:i.dub)||"Unknown"};if(Array.isArray(s)){const a=s.find(o=>o&&o.id===e)||s[0];return a?{...a,id:a.id||e}:{id:e,episodes:[]}}if(s&&s.results&&Array.isArray(s.results)){const a=s.results.find(o=>o&&o.id===e)||s.results[0];return a?{...a,id:a.id||e}:{...s,id:s.id||e}}return s&&s.data?{...s.data,id:s.data.id||e}:s&&(s.title||s.name||s.englishName)?{...s,id:s.id||e}:{id:e,...s||{}}}const Rc=s=>s?(s.startsWith("http"),s):"https://via.placeholder.com/300x450?text=No+Image",Ul=({children:s,variant:e="primary",size:t="md",loading:r=!1,disabled:n=!1,leftIcon:i,rightIcon:a,className:o="",onClick:l,type:c="button",...u})=>{const d={primary:"bg-netflix-red text-white hover:bg-red-700 focus:ring-netflix-red",secondary:"bg-gray-700 text-white hover:bg-gray-600 focus:ring-gray-500",outline:"border border-gray-600 text-gray-300 hover:bg-gray-700 hover:text-white focus:ring-gray-500",ghost:"text-gray-300 hover:bg-gray-700 hover:text-white focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500"}[e],f={sm:"px-3 py-1.5 text-sm gap-1.5",md:"px-5 py-2.5 text-base gap-2",lg:"px-7 py-3.5 text-lg gap-2.5",xl:"px-8 py-4 text-xl gap-3"}[t];return h.jsxs("button",{className:`
        inline-flex items-center justify-center
        font-medium rounded-md transition-all duration-200
        disabled:opacity-50 disabled:cursor-not-allowed
        focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900
        min-h-[44px] touch-manipulation
        ${d[e]}
        ${f}
        ${o}
      `,onClick:l,disabled:n||r,type:c,...u,children:[r&&h.jsx(gi,{className:"animate-spin mr-2",size:16}),i&&h.jsx("span",{className:"mr-2",children:i}),s,a&&h.jsx("span",{className:"ml-2",children:a})]})},Q_=({anime:s,showInfoOnHover:e=!0,size:t="md"})=>{const[r,n]=A.useState(!1),[i,a]=A.useState(!1),o=Rs(),{isInWatchlist:l,addToWatchlist:c,removeFromWatchlist:u}=za(),d=l(s.id),f={sm:"w-32 sm:w-40",md:"w-40 sm:w-48",lg:"w-48 sm:w-56",xl:"w-56 sm:w-64"}[t],p={sm:"h-48 sm:h-60",md:"h-60 sm:h-72",lg:"h-72 sm:h-84",xl:"h-84 sm:h-96"}[t],m=x=>{x.preventDefault(),x.stopPropagation(),d?u(s.id):c({id:s.id,title:s.title,poster_path:s.poster,vote_average:s.rating||s.score||0,media_type:"anime"})},y=x=>{x.preventDefault(),x.stopPropagation(),o(`/watch/anime/${encodeURIComponent(s.id)}?ep=1`)},g=x=>x?typeof x=="number"?x.toFixed(1):x:"N/A";return h.jsx("div",{className:"relative group flex-shrink-0",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:h.jsxs(ve,{to:`/anime/${encodeURIComponent(s.id)}`,className:"block",children:[h.jsxs("div",{className:`
            ${f} ${p} 
            rounded-lg overflow-hidden
            transition-all duration-300
            ${i&&e?"scale-105 shadow-2xl":""}
            movie-card
          `,children:[r?h.jsx("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center",children:h.jsx("span",{className:"text-gray-500 text-sm",children:"No Image"})}):h.jsx("img",{src:Rc(s.poster),alt:s.title,className:"w-full h-full object-cover",onError:()=>n(!0),loading:"lazy"}),s.episodes&&h.jsxs("div",{className:"absolute top-2 right-2 bg-purple-600 text-white text-xs px-2 py-1 rounded font-medium",children:[s.episodes.eps||s.episodes.sub||s.episodes.dub||0," eps"]}),s.type&&h.jsx("div",{className:"absolute top-2 left-2 bg-gray-900/80 text-gray-300 text-xs px-2 py-1 rounded font-medium",children:s.type}),i&&e&&h.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent flex flex-col justify-end p-4 transition-opacity duration-300",children:[h.jsx("h3",{className:"font-bold text-white text-lg mb-1 line-clamp-2",children:s.title}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300 mb-3 flex-wrap",children:[s.rating&&h.jsxs("span",{className:"text-yellow-400 flex items-center gap-1",children:[h.jsx(Ha,{size:12}),g(s.rating)]}),s.type&&h.jsxs(h.Fragment,{children:[h.jsx("span",{children:""}),h.jsx("span",{children:s.type})]}),s.rank&&h.jsxs(h.Fragment,{children:[h.jsx("span",{children:""}),h.jsxs("span",{className:"text-purple-400",children:["#",s.rank]})]})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(Ul,{size:"sm",onClick:y,leftIcon:h.jsx(ke,{size:14}),className:"flex-1",children:"Watch"}),h.jsx("button",{onClick:m,className:`
                    p-2 rounded-full transition-colors
                    ${d?"bg-netflix-red text-white":"bg-gray-700 text-white hover:bg-gray-600"}
                  `,title:d?"Remove from Watchlist":"Add to Watchlist",children:d?h.jsx(qr,{size:16,fill:"currentColor"}):h.jsx(Lf,{size:16})}),h.jsx(ve,{to:`/anime/${encodeURIComponent(s.id)}`,onClick:x=>x.stopPropagation(),className:"p-2 rounded-full bg-gray-700 text-white hover:bg-gray-600 transition-colors",title:"More Info",children:h.jsx(Ai,{size:16})})]})]})]}),!e&&h.jsxs("div",{className:"mt-2",children:[h.jsx("h3",{className:"font-medium text-white text-sm line-clamp-1 hover:text-purple-400 transition-colors",children:s.title}),s.alternativeTitle&&h.jsx("p",{className:"text-gray-500 text-xs mt-0.5 truncate",children:s.alternativeTitle})]})]})})},xr=({title:s,anime:e=[],loading:t=!1,error:r=null,showInfoOnHover:n=!0,size:i="md",className:a=""})=>{const o=A.useRef(null),l=c=>{if(o.current){const u=o.current,d=u.clientWidth*.8;c==="left"?u.scrollBy({left:-d,behavior:"smooth"}):u.scrollBy({left:d,behavior:"smooth"})}};return h.jsxs("div",{className:`py-6 ${a}`,children:[s&&h.jsx("h2",{className:"text-xl md:text-2xl font-bold text-white mb-4 px-4 md:px-8",children:s}),h.jsxs("div",{className:"relative group",children:[e.length>0&&h.jsx("button",{onClick:()=>l("left"),className:"absolute left-0 top-0 bottom-0 z-10 hidden md:flex items-center justify-center w-12 bg-black/50 hover:bg-black/70 text-white transition-colors opacity-0 group-hover:opacity-100","aria-label":"Scroll left",children:h.jsx(wf,{size:24})}),h.jsxs("div",{ref:o,className:"flex gap-3 md:gap-4 overflow-x-auto carousel-container px-4 md:px-8 pb-4 group",style:{scrollBehavior:"smooth"},children:[t&&[...Array(6)].map((c,u)=>h.jsx(Ac,{},u)),r&&h.jsx("div",{className:"flex items-center justify-center w-full h-48 text-gray-400",children:h.jsxs("p",{children:["Error loading anime: ",r]})}),!t&&!r&&e.length===0&&h.jsx("div",{className:"flex items-center justify-center w-full h-48 text-gray-400",children:h.jsx("p",{children:"No anime found"})}),!t&&!r&&e.map(c=>h.jsx(Q_,{anime:c,showInfoOnHover:n,size:i},c.id))]}),e.length>0&&h.jsx("button",{onClick:()=>l("right"),className:"absolute right-0 top-0 bottom-0 z-10 hidden md:flex items-center justify-center w-12 bg-black/50 hover:bg-black/70 text-white transition-colors opacity-0 group-hover:opacity-100","aria-label":"Scroll right",children:h.jsx(Af,{size:24})})]})]})},J_=[{id:"hianime-scrap",label:"HiAnime"},{id:"animekai",label:"AnimeKai"},{id:"animepahe",label:"AnimePahe"},{id:"hianime-scrap",label:"hianime-scrap"}],Z_=[{id:"top-airing",label:"Top Airing",icon:h.jsx(yv,{})},{id:"most-popular",label:"Most Popular",icon:h.jsx(Ha,{})},{id:"most-favorite",label:"Most Favorite",icon:h.jsx(qr,{})},{id:"completed",label:"Completed",icon:h.jsx(Ga,{})},{id:"recently-added",label:"Recently Added",icon:h.jsx(Fl,{})},{id:"top-upcoming",label:"Top Upcoming",icon:h.jsx(qd,{})},{id:"subbed-anime",label:"Subbed Anime",icon:h.jsx(ke,{})},{id:"dubbed-anime",label:"Dubbed Anime",icon:h.jsx(ke,{})}],eR=()=>{const[s,e]=A.useState(""),[t,r]=A.useState(null),[n,i]=A.useState([]),[a,o]=A.useState({trending:{data:[],loading:!0,error:null},topAiring:{data:[],loading:!0,error:null},mostPopular:{data:[],loading:!0,error:null},mostFavorite:{data:[],loading:!0,error:null},completed:{data:[],loading:!0,error:null},recentlyAdded:{data:[],loading:!0,error:null},topUpcoming:{data:[],loading:!0,error:null}}),[l,c]=A.useState(!0),[u,d]=A.useState(null),[f,p]=A.useState("trending"),[m,y]=A.useState(1),[g,x]=A.useState(1),[v,E]=A.useState(!1),[T,w]=A.useState("hianime-scrap"),[R,b]=A.useState(!1);A.useEffect(()=>{let M=!0,$=!1;return(async()=>{var Y;if(!$){$=!0;try{c(!0),d(null);const U=await V_();if(!M)return;const W=U.data||{};r(W),i(((Y=W.spotlight)==null?void 0:Y.slice(0,5))||[]),o({trending:{data:W.trending||[],loading:!1,error:null},topAiring:{data:W.topAiring||[],loading:!1,error:null},mostPopular:{data:W.mostPopular||[],loading:!1,error:null},mostFavorite:{data:W.mostFavorite||[],loading:!1,error:null},completed:{data:W.latestCompleted||[],loading:!1,error:null},recentlyAdded:{data:W.newAdded||[],loading:!1,error:null},topUpcoming:{data:W.topUpcoming||[],loading:!1,error:null}})}catch(U){if(!M)return;console.error("Home data error:",U),d("Failed to load anime data")}finally{M&&c(!1)}}})(),()=>{M=!1}},[]);const _=async M=>{var $;E(!1),p(M),y(1),b(!1),o(G=>({...G,[M]:{...G[M],loading:!0}}));try{const G=await K_(M,1);G.data&&G.data.response&&(o(Y=>({...Y,[M]:{data:G.data.response,loading:!1,error:null}})),x((($=G.data.pageInfo)==null?void 0:$.totalPages)||1))}catch(G){console.error("Category fetch error:",G),o(Y=>({...Y,[M]:{data:[],loading:!1,error:G.message}}))}},I=A.useCallback(async()=>{var M;if(!s.trim()){E(!1);return}E(!0),o($=>({...$,trending:{...$.trending,loading:!0,error:null}}));try{const $=await G_(s.trim(),1,T);$.data&&$.data.response?(o(G=>({...G,trending:{data:$.data.response,loading:!1,error:null}})),x(((M=$.data.pageInfo)==null?void 0:M.totalPages)||1)):o(G=>({...G,trending:{data:[],loading:!1,error:null}}))}catch($){console.error("Search error:",$),o(G=>({...G,trending:{data:[],loading:!1,error:$.message||"Failed to search anime"}}))}},[s,T]),L=M=>{M.key==="Enter"&&I()},N=()=>{e(""),E(!1),y(1),b(!1)};return l?h.jsx(sR,{}):h.jsxs("div",{className:"min-h-screen bg-gray-900",children:[h.jsx("section",{className:"relative",children:n.length>0?h.jsx(tR,{anime:n}):h.jsx(Lc,{})}),h.jsx("div",{className:"sticky top-0 z-40 bg-gray-900/95 backdrop-blur-sm border-b border-gray-800",children:h.jsxs("div",{className:"container mx-auto px-3 sm:px-4 py-3 sm:py-4",children:[h.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-3 sm:gap-4",children:[h.jsx("div",{className:"flex-1 w-full md:max-w-xl",children:h.jsxs("div",{className:"relative",children:[h.jsx("input",{type:"text",value:s,onChange:M=>e(M.target.value),onKeyPress:L,placeholder:"Search anime...",className:"w-full px-4 sm:px-5 py-2.5 sm:py-3 pr-20 sm:pr-24 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all text-sm sm:text-base touch-manipulation"}),s&&h.jsx("button",{onClick:N,className:"absolute right-10 sm:right-12 top-1/2 -translate-y-1/2 p-1.5 sm:p-2 text-gray-400 hover:text-white transition-colors touch-manipulation",children:h.jsx(jl,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),h.jsx("button",{onClick:I,className:"absolute right-1.5 sm:right-2 top-1/2 -translate-y-1/2 p-1.5 sm:p-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md transition-colors touch-manipulation",children:h.jsx(qn,{size:16,className:"sm:w-[18px] sm:h-[18px]"})})]})}),h.jsxs("button",{onClick:()=>b(!R),className:`flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg font-medium transition-colors text-sm sm:text-base touch-manipulation ${R?"bg-purple-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[h.jsx(Ga,{size:16,className:"sm:w-[18px] sm:h-[18px]"}),h.jsx("span",{className:"hidden xs:inline",children:"Filters"})]}),h.jsx("select",{value:T,onChange:M=>w(M.target.value),className:"px-3 sm:px-4 py-2.5 sm:py-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-purple-500 text-sm sm:text-base touch-manipulation",children:J_.map(M=>h.jsx("option",{value:M.id,children:M.label},M.id))})]}),R&&h.jsx("div",{className:"mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-gray-800",children:h.jsx("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:Z_.map(M=>h.jsxs("button",{onClick:()=>_(M.id),className:`flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm touch-manipulation ${f===M.id&&!v?"bg-purple-600 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-800 hover:text-white"}`,children:[M.icon,h.jsx("span",{children:M.label})]},M.id))})})]})}),h.jsx("div",{className:"relative -mt-32 z-10 pb-12",children:v?h.jsxs("div",{className:"container mx-auto px-4 py-8",children:[h.jsxs("div",{className:"flex items-center justify-between mb-6",children:[h.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[h.jsx(qn,{className:"text-purple-500"}),'Search Results for "',s,'"']}),h.jsxs("button",{onClick:N,className:"text-sm text-gray-400 hover:text-white flex items-center gap-1",children:[h.jsx(jl,{size:16}),"Clear"]})]}),u&&h.jsxs("div",{className:"text-center py-16",children:[h.jsx("p",{className:"text-red-500 mb-4",children:u}),h.jsx("button",{onClick:I,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors",children:"Try Again"})]}),!u&&a.trending.data.length===0&&h.jsxs("div",{className:"text-center py-16",children:[h.jsx("div",{className:"text-6xl mb-4",children:""}),h.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"No Results Found"}),h.jsx("p",{className:"text-gray-400",children:"Try a different search term"})]}),h.jsx(xr,{anime:a.trending.data,loading:a.trending.loading,error:a.trending.error,size:"md"})]}):h.jsxs(h.Fragment,{children:[h.jsx(xr,{title:"Trending Now",anime:a.trending.data,loading:a.trending.loading,error:a.trending.error,size:"md"}),h.jsx(xr,{title:"Top Airing",anime:a.topAiring.data,loading:a.topAiring.loading,error:a.topAiring.error,size:"md"}),h.jsx(xr,{title:"Most Popular",anime:a.mostPopular.data,loading:a.mostPopular.loading,error:a.mostFavorite.error,size:"md"}),h.jsx(xr,{title:"Most Favorite",anime:a.mostFavorite.data,loading:a.mostFavorite.loading,error:a.mostFavorite.error,size:"md"}),h.jsx(xr,{title:"Completed Series",anime:a.completed.data,loading:a.completed.loading,error:a.completed.error,size:"md"}),h.jsx(xr,{title:"Recently Added",anime:a.recentlyAdded.data,loading:a.recentlyAdded.loading,error:a.recentlyAdded.error,size:"md"}),h.jsx(xr,{title:"Top Upcoming",anime:a.topUpcoming.data,loading:a.topUpcoming.loading,error:a.topUpcoming.error,size:"md"})]})}),h.jsx("section",{className:"py-16 bg-gradient-to-t from-black to-gray-900",children:h.jsxs("div",{className:"container mx-auto px-8 text-center",children:[h.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"Ready to watch anime?"}),h.jsx("p",{className:"text-gray-400 text-lg mb-8 max-w-2xl mx-auto",children:"Discover thousands of anime series and movies. From classics to the latest releases!"}),h.jsxs(ve,{to:"/",className:"inline-flex items-center gap-2 px-8 py-4 bg-purple-600 text-white font-bold rounded-md hover:bg-purple-700 transition-colors text-lg",children:[h.jsx(ke,{size:24}),"Browse All"]})]})})]})},tR=({anime:s})=>{const[e,t]=A.useState(0);A.useEffect(()=>{const n=setInterval(()=>{t(i=>(i+1)%s.length)},5e3);return()=>clearInterval(n)},[s.length]);const r=s[e];return h.jsxs("div",{className:"relative h-[70vh] overflow-hidden",children:[h.jsxs("div",{className:"absolute inset-0",children:[h.jsx("img",{src:Rc(r.poster),alt:r.title,className:"w-full h-full object-cover"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-900/90 via-gray-900/50 to-transparent"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent"})]}),h.jsx("div",{className:"relative h-full flex items-center px-8 md:px-16 lg:px-24",children:h.jsxs("div",{className:"max-w-2xl space-y-6",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("span",{className:"text-purple-500 font-bold tracking-wider uppercase text-sm",children:"Featured"}),r.rank&&h.jsxs("span",{className:"bg-purple-600 text-white text-xs px-2 py-1 rounded font-medium",children:["#",r.rank]})]}),h.jsx("h1",{className:"text-4xl md:text-5xl lg:text-6xl font-bold text-white leading-tight",children:r.title}),h.jsx("p",{className:"text-gray-300 text-lg line-clamp-3",children:r.description||r.synopsis||"No description available."}),h.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[r.type&&h.jsx("span",{children:r.type}),r.episodes&&h.jsxs("span",{children:[r.episodes.eps||r.episodes.sub||r.episodes.dub||"?"," Episodes"]}),r.rating&&h.jsxs("span",{className:"text-yellow-400 flex items-center gap-1",children:[h.jsx(Ha,{size:14}),r.rating]})]}),h.jsxs("div",{className:"flex gap-4 pt-4",children:[h.jsxs(ve,{to:`/watch/anime/${encodeURIComponent(r.id)}?ep=1`,className:"inline-flex items-center gap-2 px-6 py-3 bg-purple-600 text-white font-semibold rounded-md hover:bg-purple-700 transition-colors",children:[h.jsx(ke,{size:20}),"Watch Now"]}),h.jsxs(ve,{to:`/anime/${encodeURIComponent(r.id)}`,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-700/80 text-white font-semibold rounded-md hover:bg-gray-600 transition-colors",children:[h.jsx(Ai,{size:20}),"More Info"]})]})]})}),h.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-2",children:s.map((n,i)=>h.jsx("button",{onClick:()=>t(i),className:`
              w-2 h-2 rounded-full transition-all
              ${i===e?"bg-white w-8":"bg-white/50 hover:bg-white/70"}
            `,"aria-label":`Go to slide ${i+1}`},i))})]})},sR=()=>h.jsxs("div",{className:"min-h-screen bg-gray-900",children:[h.jsx(Lc,{}),h.jsxs("div",{className:"relative -mt-32 z-10 pb-12",children:[h.jsx(ri,{title:"Trending Now"}),h.jsx(ri,{title:"Top Airing"}),h.jsx(ri,{title:"Most Popular"})]})]}),rR=()=>{var K;const{id:s}=Ba(),[e]=Va(),t=e.get("provider")||"hianime-scrap",[r,n]=A.useState(null),[i,a]=A.useState([]),[o,l]=A.useState([]),[c,u]=A.useState({sub:[],dub:[]}),[d,f]=A.useState(!0),[p,m]=A.useState(null),[y,g]=A.useState(!1),[x,v]=A.useState(1),[E,T]=A.useState("sub"),[w,R]=A.useState(null),[b,_]=A.useState("episodes"),[I,L]=A.useState(!1),[N,M]=A.useState(null),[$,G]=A.useState(!1),Y=A.useCallback(async O=>{var F;f(!0),m(null);try{const Z=await Wv(s,{signal:O});let te=X_(Z,s,t);te.__provider=t,n(te);try{const Q=(await Yv(s,t,{signal:O})).data||[];l(Q),Q.length>0&&v(Q[0].number)}catch(z){console.warn("Could not fetch episodes:",z);const Q=te.totalEpisodes||((F=te.episodes)==null?void 0:F.eps)||0;if(Q>0){const ge=Array.from({length:Q},(se,fe)=>({number:fe+1,id:`${s}::ep=${fe+1}`}));l(ge),v(1)}}Y_(s,1).then(z=>{var Q;(Q=z.data)!=null&&Q.response&&a(z.data.response)}).catch(()=>{}),W_(s).then(z=>{var Q;(Q=z.data)!=null&&Q.time&&M(z.data.time)}).catch(()=>{})}catch(Z){if(Z.message==="Request cancelled")return;m(Z.message||"Failed to load anime details")}finally{f(!1)}},[s,t]),U=A.useCallback(async O=>{if(!(!s||!x||o.length===0)){g(!0);try{const F=o.find(te=>te.number===x),Z=(F==null?void 0:F.id)||`${s}::ep=${x}`;if(t==="hianime-scrap"){const te=await qv(Z,{signal:O}),z=te.data||te;if(z){u({sub:z.sub||[],dub:z.dub||[]});const Q=z[E]||z.sub||[];Q.length>0&&(R(Q[0]),await ih(Z,Q[0].name,E,t,{signal:O}))}}else{const te=await ih(Z,"",E,t,{signal:O});if(te.data){u({sub:te.data.sources||[],dub:[]});const z=te.data.sources||[];z.length>0&&R(z[0])}}}catch(F){if(F.message==="Request cancelled")return;console.error("Stream error:",F)}finally{g(!1)}}},[s,x,E,t,o]);A.useEffect(()=>{const O=new AbortController;let F=!1;return(async()=>{F||(F=!0,await Y(O.signal))})(),()=>{O.abort()}},[Y]),A.useEffect(()=>{const O=new AbortController,Z=setTimeout(async()=>{r&&await U(O.signal)},300);return()=>{clearTimeout(Z),O.abort()}},[U,r,x]);const W=Rs(),P=O=>{W(`/watch/anime/${s}?ep=${O}&provider=${t}`)};if(d)return h.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:h.jsx(gi,{className:"animate-spin text-purple-500 text-4xl"})});if(p||!r)return h.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-red-500 mb-4",children:p||"Anime not found"}),h.jsxs(ve,{to:"/anime",className:"bg-gray-800 px-6 py-2 rounded-lg text-white inline-flex items-center gap-2",children:[h.jsx(xc,{})," Back"]})]})});const B=Rc(r.poster);return h.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[h.jsxs("div",{className:"relative",children:[h.jsxs("div",{className:"absolute inset-0 h-[60vh]",children:[h.jsx("img",{src:B,className:"w-full h-full object-cover opacity-20",alt:"backdrop"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent to-gray-900"})]}),h.jsx("div",{className:"relative z-10 container mx-auto px-3 sm:px-4 pt-6 sm:pt-8 pb-8 sm:pb-12",children:h.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 sm:gap-8",children:[h.jsxs("div",{className:"w-full lg:w-72 flex-shrink-0",children:[h.jsx("img",{src:B,className:"w-full rounded-2xl shadow-2xl border border-gray-700",alt:r.title}),h.jsxs("div",{className:"mt-4 sm:mt-6 flex flex-col gap-2 sm:gap-3",children:[h.jsxs(ve,{to:`/watch/anime/${s}?ep=${x}`,className:"bg-purple-600 hover:bg-purple-700 py-2.5 sm:py-3 rounded-xl flex items-center justify-center gap-1.5 sm:gap-2 font-bold transition text-sm sm:text-base touch-manipulation",children:[h.jsx(ke,{size:16,className:"sm:w-5 sm:h-5"})," WATCH NOW"]}),h.jsxs("button",{className:"bg-gray-800 hover:bg-gray-700 py-2.5 sm:py-3 rounded-xl flex items-center justify-center gap-1.5 sm:gap-2 transition text-sm sm:text-base touch-manipulation",children:[h.jsx(qr,{size:16,className:"sm:w-5 sm:h-5"})," WATCHLIST"]})]})]}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-black mb-2",children:r.title}),h.jsx("p",{className:"text-gray-400 text-lg sm:text-xl mb-4 sm:mb-6 italic",children:r.japanese}),h.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-3 mb-6 sm:mb-8",children:[h.jsxs("span",{className:"flex items-center gap-1 bg-yellow-500/10 text-yellow-500 px-2 sm:px-3 py-1 rounded-lg border border-yellow-500/20 text-sm",children:[h.jsx(Ha,{size:12,className:"sm:w-[14px] sm:h-[14px]"})," ",r.rating]}),h.jsx("span",{className:"bg-purple-500/10 text-purple-400 px-2 sm:px-3 py-1 rounded-lg border border-purple-500/20 text-sm",children:r.type}),h.jsx("span",{className:"bg-gray-800 px-2 sm:px-3 py-1 rounded-lg text-sm",children:r.status})]}),h.jsxs("div",{className:"mb-6 sm:mb-8",children:[h.jsxs("h3",{className:"flex items-center gap-1.5 sm:gap-2 text-gray-400 text-xs sm:text-sm font-bold uppercase tracking-widest mb-2",children:[h.jsx(Ai,{size:12,className:"sm:w-[14px] sm:h-[14px]"})," Synopsis"]}),h.jsxs("p",{className:"text-gray-300 leading-relaxed text-sm sm:text-base",children:[$?r.synopsis:`${(K=r.synopsis)==null?void 0:K.slice(0,350)}...`,h.jsx("button",{onClick:()=>G(!$),className:"text-purple-400 ml-2 font-bold text-sm sm:text-base touch-manipulation",children:$?"Show Less":"Read More"})]})]}),h.jsxs("div",{className:"bg-gray-800/40 rounded-2xl p-6 border border-gray-700/50",children:[h.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[h.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[h.jsx(Ga,{})," Episodes"]}),h.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[h.jsxs("div",{className:"text-gray-400",children:[o.length," Episodes Total"]}),o.some(O=>O.isFiller)&&h.jsxs("div",{className:"flex items-center gap-2 text-amber-400 bg-amber-400/10 px-3 py-1 rounded-full border border-amber-400/20",children:[h.jsx(Ml,{className:"w-4 h-4"}),h.jsxs("span",{className:"font-medium",children:[o.filter(O=>O.isFiller).length," Filler"]})]})]})]}),o.some(O=>O.isFiller)&&h.jsxs("div",{className:"mb-4 p-3 bg-amber-400/5 border border-amber-400/10 rounded-lg flex items-start gap-2 text-sm text-amber-200/80",children:[h.jsx(Ml,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),h.jsxs("span",{children:["Filler episodes are marked in ",h.jsx("span",{className:"text-amber-400 font-medium",children:"amber"}),". These episodes may not follow the main storyline."]})]}),h.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 max-h-96 overflow-y-auto pr-2 custom-scrollbar",children:o.map(O=>{const F=x===O.number,Z=O.isFiller;return h.jsxs("button",{onClick:()=>P(O.number),className:`
                          group relative p-3 rounded-xl text-left transition-all duration-200 border
                          ${F?"bg-purple-600 border-purple-500 shadow-lg shadow-purple-600/25 scale-[1.02]":Z?"bg-amber-900/20 border-amber-700/30 hover:bg-amber-900/30 hover:border-amber-600/50":"bg-gray-700/50 border-gray-600/30 hover:bg-gray-700 hover:border-gray-500/50"}
                        `,children:[h.jsx("div",{className:`
                          inline-flex items-center justify-center w-8 h-8 rounded-lg text-sm font-bold mb-2
                          ${F?"bg-white/20 text-white":Z?"bg-amber-500/20 text-amber-400":"bg-gray-600/50 text-gray-300"}
                        `,children:O.number}),Z&&h.jsx("div",{className:"absolute top-2 right-2",children:h.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-amber-500 text-amber-950 uppercase tracking-wider",children:"Filler"})}),h.jsx("div",{className:"space-y-1",children:h.jsx("p",{className:`
                            text-xs font-medium line-clamp-2 leading-relaxed
                            ${F?"text-white":Z?"text-amber-200/70":"text-gray-400"}
                          `,children:O.title||`Episode ${O.number}`})}),F&&h.jsx("div",{className:"absolute bottom-2 right-2",children:h.jsx("div",{className:"w-2 h-2 rounded-full bg-white animate-pulse"})})]},O.number)})})]})]})]})})]}),i.length>0&&h.jsxs("div",{className:"container mx-auto px-4 py-12 border-t border-gray-800",children:[h.jsxs("h2",{className:"text-2xl font-bold mb-8 flex items-center gap-2",children:[h.jsx(CA,{})," Cast"]}),h.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4",children:i.slice(0,10).map((O,F)=>h.jsxs("div",{className:"bg-gray-800/30 rounded-xl overflow-hidden flex items-center gap-4 p-2 border border-gray-800",children:[h.jsx("img",{src:O.imageUrl,className:"w-16 h-16 object-cover rounded-lg",alt:O.name}),h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"font-bold text-sm truncate",children:O.name}),h.jsx("p",{className:"text-xs text-purple-400 truncate",children:O.role})]})]},F))})]})]})},ee=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},nR=Number.isSafeInteger||function(s){return typeof s=="number"&&Math.abs(s)<=iR},iR=Number.MAX_SAFE_INTEGER||9007199254740991;let ae=function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s}({}),C=function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",s.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",s.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.ASSET_LIST_LOAD_ERROR="assetListLoadError",s.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",s.ASSET_LIST_PARSING_ERROR="assetListParsingError",s.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.ATTACH_MEDIA_ERROR="attachMediaError",s.UNKNOWN="unknown",s}({}),S=function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.MEDIA_ENDED="hlsMediaEnded",s.STALL_RESOLVED="hlsStallResolved",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFERED_TO_END="hlsBufferedToEnd",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",s.ASSET_LIST_LOADING="hlsAssetListLoading",s.ASSET_LIST_LOADED="hlsAssetListLoaded",s.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",s.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",s.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",s.INTERSTITIAL_STARTED="hlsInterstitialStarted",s.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",s.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",s.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",s.INTERSTITIAL_ENDED="hlsInterstitialEnded",s.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",s.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",s.EVENT_CUE_ENTER="hlsEventCueEnter",s}({});var ye={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},re={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Rn{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class aR{constructor(e,t,r,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Rn(e),this.fast_=new Rn(t),this.defaultTTFB_=n,this.ttfb_=new Rn(e)}update(e,t){const{slow_:r,fast_:n,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Rn(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==t&&(this.fast_=new Rn(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Rn(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,n=e/1e3,i=r/n;this.fast_.sample(n,i),this.slow_.sample(n,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function oR(s,e,t){return(e=cR(e))in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Re(){return Re=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},Re.apply(null,arguments)}function mg(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function Ae(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mg(Object(t),!0).forEach(function(r){oR(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):mg(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function lR(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function cR(s){var e=lR(s,"string");return typeof e=="symbol"?e:e+""}class xs{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=br,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const br=function(){},uR={trace:br,debug:br,log:br,warn:br,info:br,error:br};function ah(){return Re({},uR)}function dR(s,e){const t=self.console[s];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${s}] >`):br}function pg(s,e,t){return e[s]?e[s].bind(e):dR(s,t)}const oh=ah();function hR(s,e,t){const r=ah();if(typeof console=="object"&&s===!0||typeof s=="object"){const n=["debug","log","info","warn","error"];n.forEach(i=>{r[i]=pg(i,s,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return ah()}n.forEach(i=>{oh[i]=pg(i,s)})}else Re(oh,r);return r}const Le=oh;function Gr(s=!0){return typeof self>"u"?void 0:(s||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function fR(s){return typeof self<"u"&&s===self.ManagedMediaSource}function Qv(s,e){const t=Object.keys(s),r=Object.keys(e),n=t.length,i=r.length;return!n||!i||n===i&&!t.some(a=>r.indexOf(a)===-1)}function os(s,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(s);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=s.length;let r,n,i,a="",o=0;for(;o<t;){if(r=s[o++],r===0&&e)return a;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:n=s[o++],a+=String.fromCharCode((r&31)<<6|n&63);break;case 14:n=s[o++],i=s[o++],a+=String.fromCharCode((r&15)<<12|(n&63)<<6|(i&63)<<0);break}}return a}function gt(s){let e="";for(let t=0;t<s.length;t++){let r=s[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function Jv(s){return Uint8Array.from(s.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function mR(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var bu={exports:{}},gg;function pR(){return gg||(gg=1,function(s,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var f=o.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=o.normalizePath(f.path),o.buildURLFromParts(f)):c;var p=o.parseURL(l);if(!p)throw new Error("Error trying to parse base URL.");if(!p.netLoc&&p.path&&p.path[0]!=="/"){var m=n.exec(p.path);p.netLoc=m[1],p.path=m[2]}p.netLoc&&!p.path&&(p.path="/");var y={scheme:p.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(y.netLoc=p.netLoc,f.path[0]!=="/"))if(!f.path)y.path=p.path,f.params||(y.params=p.params,f.query||(y.query=p.query));else{var g=p.path,x=g.substring(0,g.lastIndexOf("/")+1)+f.path;y.path=o.normalizePath(x)}return y.path===null&&(y.path=u.alwaysNormalize?o.normalizePath(f.path):f.path),o.buildURLFromParts(y)},parseURL:function(l){var c=r.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};s.exports=o})()}(bu)),bu.exports}var jf=pR();class $f{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ie={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Zv{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,yR(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let n;r.length===1?n=(t==null?void 0:t.byteRangeEndOffset)||0:n=parseInt(r[1]),this._byteRange=[n,parseInt(r[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ie.AUDIO]:null,[Ie.VIDEO]:null,[Ie.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new $f),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=jf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ie.AUDIO]=null,e[Ie.VIDEO]=null,e[Ie.AUDIOVIDEO]=null}}function Ze(s){return s.sn!=="initSegment"}class wu extends Zv{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(ee(e)&&ee(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const n=this._decryptdata=t[r[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ee(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),n=r.length;if(n>1||n===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ee(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ze(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const n=t[e];n&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,n,i,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:i,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,n),l.endDTS=Math.max(l.endDTS,i)}}class gR extends Zv{constructor(e,t,r,n,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function eE(s,e){const t=Object.getPrototypeOf(s);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||eE(t,e)}}function yR(s,e){const t=eE(s,e);t&&(t.enumerable=!0,Object.defineProperty(s,e,t))}const yg=Math.pow(2,32)-1,xR=[].push,tE={video:1,audio:2,id3:3,text:4};function nt(s){return String.fromCharCode.apply(null,s)}function sE(s,e){const t=s[e]<<8|s[e+1];return t<0?65536+t:t}function ce(s,e){const t=rE(s,e);return t<0?4294967296+t:t}function xg(s,e){let t=ce(s,e);return t*=Math.pow(2,32),t+=ce(s,e+4),t}function rE(s,e){return s[e]<<24|s[e+1]<<16|s[e+2]<<8|s[e+3]}function vR(s){const e=s.byteLength;for(let t=0;t<e;){const r=ce(s,t);if(r>8&&s[t+4]===109&&s[t+5]===111&&s[t+6]===111&&s[t+7]===102)return!0;t=r>1?t+r:e}return!1}function pe(s,e){const t=[];if(!e.length)return t;const r=s.byteLength;for(let n=0;n<r;){const i=ce(s,n),a=nt(s.subarray(n+4,n+8)),o=i>1?n+i:r;if(a===e[0])if(e.length===1)t.push(s.subarray(n+8,o));else{const l=pe(s.subarray(n+8,o),e.slice(1));l.length&&xR.apply(t,l)}n=o}return t}function ER(s){const e=[],t=s[0];let r=8;const n=ce(s,r);r+=4;let i=0,a=0;t===0?(i=ce(s,r),a=ce(s,r+4),r+=8):(i=xg(s,r),a=xg(s,r+8),r+=16),r+=2;let o=s.length+a;const l=sE(s,r);r+=2;for(let c=0;c<l;c++){let u=r;const d=ce(s,u);u+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return Le.warn("SIDX has hierarchical references (not supported)"),null;const m=ce(s,u);u+=4,e.push({referenceSize:f,subsegmentDuration:m,info:{duration:m/n,start:o,end:o+f-1}}),o+=f,u+=4,r=u}return{earliestPresentationTime:i,timescale:n,version:t,referencesCount:l,references:e}}function nE(s){const e=[],t=pe(s,["moov","trak"]);for(let n=0;n<t.length;n++){const i=t[n],a=pe(i,["tkhd"])[0];if(a){let o=a[0];const l=ce(a,o===0?12:20),c=pe(i,["mdia","mdhd"])[0];if(c){o=c[0];const u=ce(c,o===0?12:20),d=pe(i,["mdia","hdlr"])[0];if(d){const f=nt(d.subarray(8,12)),p={soun:Ie.AUDIO,vide:Ie.VIDEO}[f],m=pe(i,["mdia","minf","stbl","stsd"])[0],y=SR(m);p?(e[l]={timescale:u,type:p,stsd:y},e[p]=Ae({timescale:u,id:l},y)):e[l]={timescale:u,type:f,stsd:y}}}}}return pe(s,["moov","mvex","trex"]).forEach(n=>{const i=ce(n,4),a=e[i];a&&(a.default={duration:ce(n,12),flags:ce(n,20)})}),e}function SR(s){const e=s.subarray(8),t=e.subarray(86),r=nt(e.subarray(4,8));let n=r,i;const a=r==="enca"||r==="encv";if(a){const c=pe(e,[r])[0].subarray(r==="enca"?28:78);pe(c,["sinf"]).forEach(d=>{const f=pe(d,["schm"])[0];if(f){const p=nt(f.subarray(4,8));if(p==="cbcs"||p==="cenc"){const m=pe(d,["frma"])[0];m&&(n=nt(m))}}})}const o=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const l=pe(t,["avcC"])[0];l&&l.length>3&&(n+="."+Ao(l[1])+Ao(l[2])+Ao(l[3]),i=wo(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=pe(e,[r])[0],c=pe(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=Au(c,u),u+=2;const d=c[u++];if(d&128&&(u+=2),d&64&&(u+=c[u++]),c[u++]!==4)break;u=Au(c,u);const f=c[u++];if(f===64)n+="."+Ao(f);else break;if(u+=12,c[u++]!==5)break;u=Au(c,u);const p=c[u++];let m=(p&248)>>3;m===31&&(m+=1+((p&7)<<3)+((c[u]&224)>>5)),n+="."+m}break}case"hvc1":case"hev1":{const l=pe(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],d=c&31,f=ce(l,2),p=(c&32)>>5?"H":"L",m=l[12],y=l.subarray(6,12);n+="."+u+d,n+="."+TR(f).toString(16).toUpperCase(),n+="."+p+m;let g="";for(let x=y.length;x--;){const v=y[x];(v||g)&&(g="."+v.toString(16).toUpperCase()+g)}n+=g}i=wo(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=wo(n,t)||n;break}case"vp09":{const l=pe(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],d=l[6]>>4&15;n+="."+Os(c)+"."+Os(u)+"."+Os(d)}break}case"av01":{const l=pe(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,d=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,p=(l[2]&32)>>5,m=c===2&&f?p?12:10:f?10:8,y=(l[2]&16)>>4,g=(l[2]&8)>>3,x=(l[2]&4)>>2,v=l[2]&3;n+="."+c+"."+Os(u)+d+"."+Os(m)+"."+y+"."+g+x+v+"."+Os(1)+"."+Os(1)+"."+Os(1)+"."+0,i=wo("dav1",t)}break}}return{codec:n,encrypted:a,supplemental:i}}function wo(s,e){const t=pe(e,["dvvC"]),r=t.length?t[0]:pe(e,["dvcC"])[0];if(r){const n=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return s+"."+Os(n)+"."+Os(i)}}function TR(s){let e=0;for(let t=0;t<32;t++)e|=(s>>t&1)<<31-t;return e>>>0}function Au(s,e){const t=e+5;for(;s[e++]&128&&e<t;);return e}function Ao(s){return("0"+s.toString(16).toUpperCase()).slice(-2)}function Os(s){return(s<10?"0":"")+s}function bR(s,e){if(!s||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&iE(s,(r,n)=>{const i=r.subarray(8,24);i.some(a=>a!==0)||(Le.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${gt(i)} -> ${gt(t)}`),r.set(t,8))})}function wR(s){const e=[];return iE(s,t=>e.push(t.subarray(8,24))),e}function iE(s,e){pe(s,["moov","trak"]).forEach(r=>{const n=pe(r,["mdia","minf","stbl","stsd"])[0];if(!n)return;const i=n.subarray(8);let a=pe(i,["enca"]);const o=a.length>0;o||(a=pe(i,["encv"])),a.forEach(l=>{const c=o?l.subarray(28):l.subarray(78);pe(c,["sinf"]).forEach(d=>{const f=aE(d);f&&e(f,o)})})})}function aE(s){const e=pe(s,["schm"])[0];if(e){const t=nt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=pe(s,["schi","tenc"])[0];if(r)return r}}}function AR(s,e,t){const r={},n=pe(s,["moof","traf"]);for(let i=0;i<n.length;i++){const a=n[i],o=pe(a,["tfhd"])[0],l=ce(o,4),c=e[l];if(!c)continue;r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=r[l],d=pe(a,["tfdt"])[0];if(d){const E=d[0];let T=ce(d,4);E===1&&(T===yg?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(T*=yg+1,T+=ce(d,8))),ee(T)&&(!ee(u.start)||T<u.start)&&(u.start=T)}const f=c.default,p=ce(o,0)|(f==null?void 0:f.flags);let m=(f==null?void 0:f.duration)||0;p&8&&(p&2?m=ce(o,12):m=ce(o,8));const y=pe(a,["trun"]);let g=u.start||0,x=0,v=m;for(let E=0;E<y.length;E++){const T=y[E],w=ce(T,4),R=u.sampleCount;u.sampleCount+=w;const b=T[3]&1,_=T[3]&4,I=T[2]&1,L=T[2]&2,N=T[2]&4,M=T[2]&8;let $=8,G=w;for(b&&($+=4),_&&w&&(!(T[$+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=R),$+=4,I?(v=ce(T,$),$+=4):v=m,L&&($+=4),M&&($+=4),g+=v,x+=v,G--);G--;)I?(v=ce(T,$),$+=4):v=m,L&&($+=4),N&&(T[$+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(G+1),u.keyFrameStart=g),$+=4),M&&($+=4),g+=v,x+=v;!x&&m&&(x+=m*w)}u.duration+=x}if(!Object.keys(r).some(i=>r[i].duration)){let i=1/0,a=0;const o=pe(s,["sidx"]);for(let l=0;l<o.length;l++){const c=ER(o[l]);if(c!=null&&c.references){i=Math.min(i,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((d,f)=>d+f.info.duration||0,0);a=Math.max(a,u+c.earliestPresentationTime/c.timescale)}}a&&ee(a)&&Object.keys(r).forEach(l=>{r[l].duration||(r[l].duration=a*r[l].timescale-r[l].start)})}return r}function LR(s){const e={valid:null,remainder:null},t=pe(s,["moof"]);if(t.length<2)return e.remainder=s,e;const r=t[t.length-1];return e.valid=s.slice(0,r.byteOffset-8),e.remainder=s.slice(r.byteOffset-8),e}function ys(s,e){const t=new Uint8Array(s.length+e.length);return t.set(s),t.set(e,s.length),t}function vg(s,e){const t=[],r=e.samples,n=e.timescale,i=e.id;let a=!1;return pe(r,["moof"]).map(l=>{const c=l.byteOffset-8;pe(l,["traf"]).map(d=>{const f=pe(d,["tfdt"]).map(p=>{const m=p[0];let y=ce(p,4);return m===1&&(y*=Math.pow(2,32),y+=ce(p,8)),y/n})[0];return f!==void 0&&(s=f),pe(d,["tfhd"]).map(p=>{const m=ce(p,4),y=ce(p,0)&16777215,g=(y&1)!==0,x=(y&2)!==0,v=(y&8)!==0;let E=0;const T=(y&16)!==0;let w=0;const R=(y&32)!==0;let b=8;m===i&&(g&&(b+=8),x&&(b+=4),v&&(E=ce(p,b),b+=4),T&&(w=ce(p,b),b+=4),R&&(b+=4),e.type==="video"&&(a=Ic(e.codec)),pe(d,["trun"]).map(_=>{const I=_[0],L=ce(_,0)&16777215,N=(L&1)!==0;let M=0;const $=(L&4)!==0,G=(L&256)!==0;let Y=0;const U=(L&512)!==0;let W=0;const P=(L&1024)!==0,B=(L&2048)!==0;let K=0;const O=ce(_,4);let F=8;N&&(M=ce(_,F),F+=4),$&&(F+=4);let Z=M+c;for(let te=0;te<O;te++){if(G?(Y=ce(_,F),F+=4):Y=E,U?(W=ce(_,F),F+=4):W=w,P&&(F+=4),B&&(I===0?K=ce(_,F):K=rE(_,F),F+=4),e.type===Ie.VIDEO){let z=0;for(;z<W;){const Q=ce(r,Z);if(Z+=4,_R(a,r[Z])){const ge=r.subarray(Z,Z+Q);Uf(ge,a?2:1,s+K/n,t)}Z+=Q,z+=Q+4}}s+=Y/n}}))})})}),t}function Ic(s){if(!s)return!1;const e=s.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function _R(s,e){if(s){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Uf(s,e,t,r){const n=oE(s);let i=0;i+=e;let a=0,o=0,l=0;for(;i<n.length;){a=0;do{if(i>=n.length)break;l=n[i++],a+=l}while(l===255);o=0;do{if(i>=n.length)break;l=n[i++],o+=l}while(l===255);const c=n.length-i;let u=i;if(o<c)i+=o;else if(o>c){Le.error(`Malformed SEI payload. ${o} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(n[u++]===181){const f=sE(n,u);if(u+=2,f===49){const p=ce(n,u);if(u+=4,p===1195456820){const m=n[u++];if(m===3){const y=n[u++],g=31&y,x=64&y,v=x?2+g*3:0,E=new Uint8Array(v);if(x){E[0]=y;for(let T=1;T<v;T++)E[T]=n[u++]}r.push({type:m,payloadType:a,pts:t,bytes:E})}}}}}else if(a===5&&o>16){const d=[];for(let m=0;m<16;m++){const y=n[u++].toString(16);d.push(y.length==1?"0"+y:y),(m===3||m===5||m===7||m===9)&&d.push("-")}const f=o-16,p=new Uint8Array(f);for(let m=0;m<f;m++)p[m]=n[u++];r.push({payloadType:a,pts:t,uuid:d.join(""),userData:os(p),userDataBytes:p})}}}function oE(s){const e=s.byteLength,t=[];let r=1;for(;r<e-2;)s[r]===0&&s[r+1]===0&&s[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return s;const n=e-t.length,i=new Uint8Array(n);let a=0;for(r=0;r<n;a++,r++)a===t[0]&&(a++,t.shift()),i[r]=s[a];return i}function RR(s){const e=s[0];let t="",r="",n=0,i=0,a=0,o=0,l=0,c=0;if(e===0){for(;nt(s.subarray(c,c+1))!=="\0";)t+=nt(s.subarray(c,c+1)),c+=1;for(t+=nt(s.subarray(c,c+1)),c+=1;nt(s.subarray(c,c+1))!=="\0";)r+=nt(s.subarray(c,c+1)),c+=1;r+=nt(s.subarray(c,c+1)),c+=1,n=ce(s,12),i=ce(s,16),o=ce(s,20),l=ce(s,24),c=28}else if(e===1){c+=4,n=ce(s,c),c+=4;const d=ce(s,c);c+=4;const f=ce(s,c);for(c+=4,a=2**32*d+f,nR(a)||(a=Number.MAX_SAFE_INTEGER,Le.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ce(s,c),c+=4,l=ce(s,c),c+=4;nt(s.subarray(c,c+1))!=="\0";)t+=nt(s.subarray(c,c+1)),c+=1;for(t+=nt(s.subarray(c,c+1)),c+=1;nt(s.subarray(c,c+1))!=="\0";)r+=nt(s.subarray(c,c+1)),c+=1;r+=nt(s.subarray(c,c+1)),c+=1}const u=s.subarray(c,s.byteLength);return{schemeIdUri:t,value:r,timeScale:n,presentationTime:a,presentationTimeDelta:i,eventDuration:o,id:l,payload:u}}function IR(s,...e){const t=e.length;let r=8,n=t;for(;n--;)r+=e[n].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(s,4),n=0,r=8;n<t;n++)i.set(e[n],r),r+=e[n].byteLength;return i}function kR(s,e,t){if(s.byteLength!==16)throw new RangeError("Invalid system id");let r,n;r=0,n=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),IR([112,115,115,104],new Uint8Array([r,0,0,0]),s,i,n,a,t)}function CR(s){const e=[];if(s instanceof ArrayBuffer){const t=s.byteLength;let r=0;for(;r+32<t;){const n=new DataView(s,r),i=PR(n);e.push(i),r+=i.size}}return e}function PR(s){const e=s.getUint32(0),t=s.byteOffset,r=s.byteLength;if(r<e)return{offset:t,size:r};if(s.getUint32(4)!==1886614376)return{offset:t,size:e};const i=s.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const a=s.buffer,o=gt(new Uint8Array(a,t+12,16));let l=null,c=null,u=0;if(i===0)u=28;else{const f=s.getUint32(28);if(!f||r<32+f*16)return{offset:t,size:e};l=[];for(let p=0;p<f;p++)l.push(new Uint8Array(a,t+32+p*16,16));u=32+f*16}if(!u)return{offset:t,size:e};const d=s.getUint32(u);return e-32<d?{offset:t,size:e}:(c=new Uint8Array(a,t+u+4,d),{version:i,systemId:o,kids:l,data:c,offset:t,size:e})}const lE=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),vi={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Bf(s,e){const t=vi[e];return!!t&&!!t[s.slice(0,4)]}function _a(s,e,t=!0){return!s.split(",").some(r=>!Vf(r,e,t))}function Vf(s,e,t=!0){var r;const n=Gr(t);return(r=n==null?void 0:n.isTypeSupported(Ra(s,e)))!=null?r:!1}function Ra(s,e){return`${e}/mp4;codecs=${s}`}function Eg(s){if(s){const e=s.substring(0,4);return vi.video[e]}return 2}function Bl(s){const e=lE();return s.split(",").reduce((t,r)=>{const i=e&&Ic(r)?9:vi.video[r];return i?(i*2+t)/(t?3:2):(vi.audio[r]+t)/(t?2:1)},0)}const Lu={};function DR(s,e=!0){if(Lu[s])return Lu[s];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[s];for(let n=0;n<t.length;n++){var r;if(Vf(t[n],"audio",e))return Lu[s]=t[n],t[n];if(t[n]==="mp3"&&(r=Gr(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return s}const NR=/flac|opus|mp4a\.40\.34/i;function Vl(s,e=!0){return s.replace(NR,t=>DR(t.toLowerCase(),e))}function OR(s,e){const t=[];if(s){const r=s.split(",");for(let n=0;n<r.length;n++)Bf(r[n],"video")||t.push(r[n])}return e&&t.push(e),t.join(",")}function tl(s,e){if(s&&(s.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(s)!==-1)&&(Sg(s,"audio")||Sg(s,"video")))return s;if(e){const t=e.split(",");if(t.length>1){if(s){for(let r=t.length;r--;)if(t[r].substring(0,4)===s.substring(0,4))return t[r]}return t[0]}}return e||s}function Sg(s,e){return Bf(s,e)&&Vf(s,e)}function MR(s){const e=s.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function FR(s){if(s.startsWith("av01.")){const e=s.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return s}function Tg(s){const e=Gr(s)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function lh(s){return s.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const jR={supported:!0,powerEfficient:!0,smooth:!0},$R={supported:!1,smooth:!1,powerEfficient:!1},cE={supported:!0,configurations:[],decodingInfoResults:[jR]};function uE(s,e){return{supported:!1,configurations:e,decodingInfoResults:[$R],error:s}}function UR(s,e,t,r,n,i){const a=s.videoCodec,o=s.audioCodec?s.audioGroups:null,l=i==null?void 0:i.audioCodec,c=i==null?void 0:i.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(o!=null&&o.length)try{o.length===1&&o[0]?d=e.groups[o[0]].channels:d=o.reduce((f,p)=>{if(p){const m=e.groups[p];if(!m)throw new Error(`Audio track group ${p} not found`);Object.keys(m.channels).forEach(y=>{f[y]=(f[y]||0)+m.channels[y]})}return f},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(f=>Ic(f))||s.width>1920&&s.height>1088||s.height>1920&&s.width>1088||s.frameRate>Math.max(r,30)||s.videoRange!=="SDR"&&s.videoRange!==t||s.bitrate>Math.max(n,8e6))||!!d&&ee(u)&&Object.keys(d).some(f=>parseInt(f)>u)}function dE(s,e,t,r={}){const n=s.videoCodec;if(!n&&!s.audioCodec||!t)return Promise.resolve(cE);const i=[],a=BR(s),o=a.length,l=VR(s,e,o>0),c=l.length;for(let u=o||1*c||1;u--;){const d={type:"media-source"};if(o&&(d.video=a[u%o]),c){d.audio=l[u%c];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}i.push(d)}if(n){const u=navigator.userAgent;if(n.split(",").some(d=>Ic(d))&&lE())return Promise.resolve(uE(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),i))}return Promise.all(i.map(u=>{const d=HR(u);return r[d]||(r[d]=t.decodingInfo(u))})).then(u=>({supported:!u.some(d=>!d.supported),configurations:i,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:i,decodingInfoResults:[],error:u}))}function BR(s){var e;const t=(e=s.videoCodec)==null?void 0:e.split(","),r=hE(s),n=s.width||640,i=s.height||480,a=s.frameRate||30,o=s.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:Ra(FR(l),"video"),width:n,height:i,bitrate:r,framerate:a};return o!=="sdr"&&(c.transferFunction=o),c}):[]}function VR(s,e,t){var r;const n=(r=s.audioCodec)==null?void 0:r.split(","),i=hE(s);return n&&s.audioGroups?s.audioGroups.reduce((a,o)=>{var l;const c=o?(l=e.groups[o])==null?void 0:l.tracks:null;return c?c.reduce((u,d)=>{if(d.groupId===o){const f=parseFloat(d.channels||"");n.forEach(p=>{const m={contentType:Ra(p,"audio"),bitrate:t?GR(p,i):i};f&&(m.channels=""+f),u.push(m)})}return u},a):a},[]):[]}function GR(s,e){if(e<=1)return 1;let t=128e3;return s==="ec-3"?t=768e3:s==="ac-3"&&(t=64e4),Math.min(e/2,t)}function hE(s){return Math.ceil(Math.max(s.bitrate*.9,s.averageBitrate)/1e3)*1e3||1}function HR(s){let e="";const{audio:t,video:r}=s;if(r){const n=lh(r.contentType);e+=`${n}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const n=lh(t.contentType);e+=`${r?"_":""}${n}_c${t.channels}`}return e}const ch=["NONE","TYPE-0","TYPE-1",null];function zR(s){return ch.indexOf(s)>-1}const Gl=["SDR","PQ","HLG"];function KR(s){return!!s&&Gl.indexOf(s)>-1}var sl={No:"",Yes:"YES",v2:"v2"};function bg(s){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=s,n=r<e/2;return e&&n?t?sl.v2:sl.Yes:sl.No}class wg{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ia{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Ag(this._audioGroups,e)}hasSubtitleGroup(e){return Ag(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Ag(s,e){return!e||!s?!1:s.indexOf(e)!==-1}function WR(){if(typeof matchMedia=="function"){const s=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(s.media!==e.media)return s.matches===!0}return!1}function YR(s,e){let t=!1,r=[];if(s&&(t=s!=="SDR",r=[s]),e){r=e.allowedVideoRanges||Gl.slice(0);const n=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&WR(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const qR=s=>{const e=new WeakSet;return(t,r)=>{if(s&&(r=s(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},Ce=(s,e)=>JSON.stringify(s,qR(e));function XR(s,e,t,r,n){const i=Object.keys(s),a=r==null?void 0:r.channels,o=r==null?void 0:r.audioCodec,l=n==null?void 0:n.videoCodec,c=a&&parseInt(a)===2;let u=!1,d=!1,f=1/0,p=1/0,m=1/0,y=1/0,g=0,x=[];const{preferHDR:v,allowedVideoRanges:E}=YR(e,n);for(let _=i.length;_--;){const I=s[i[_]];u||(u=I.channels[2]>0),f=Math.min(f,I.minHeight),p=Math.min(p,I.minFramerate),m=Math.min(m,I.minBitrate),E.filter(N=>I.videoRanges[N]>0).length>0&&(d=!0)}f=ee(f)?f:0,p=ee(p)?p:0;const T=Math.max(1080,f),w=Math.max(30,p);m=ee(m)?m:t,t=Math.max(m,t),d||(e=void 0);const R=i.length>1;return{codecSet:i.reduce((_,I)=>{const L=s[I];if(I===_)return _;if(x=d?E.filter(N=>L.videoRanges[N]>0):[],R){if(L.minBitrate>t)return Ps(I,`min bitrate of ${L.minBitrate} > current estimate of ${t}`),_;if(!L.hasDefaultAudio)return Ps(I,"no renditions with default or auto-select sound found"),_;if(o&&I.indexOf(o.substring(0,4))%5!==0)return Ps(I,`audio codec preference "${o}" not found`),_;if(a&&!c){if(!L.channels[a])return Ps(I,`no renditions with ${a} channel sound found (channels options: ${Object.keys(L.channels)})`),_}else if((!o||c)&&u&&L.channels[2]===0)return Ps(I,"no renditions with stereo sound found"),_;if(L.minHeight>T)return Ps(I,`min resolution of ${L.minHeight} > maximum of ${T}`),_;if(L.minFramerate>w)return Ps(I,`min framerate of ${L.minFramerate} > maximum of ${w}`),_;if(!x.some(N=>L.videoRanges[N]>0))return Ps(I,`no variants with VIDEO-RANGE of ${Ce(x)} found`),_;if(l&&I.indexOf(l.substring(0,4))%5!==0)return Ps(I,`video codec preference "${l}" not found`),_;if(L.maxScore<g)return Ps(I,`max score of ${L.maxScore} < selected max of ${g}`),_}return _&&(Bl(I)>=Bl(_)||L.fragmentError>s[_].fragmentError)?_:(y=L.minIndex,g=L.maxScore,I)},void 0),videoRanges:x,preferHDR:v,minFramerate:p,minBitrate:m,minIndex:y}}function Ps(s,e){Le.log(`[abr] start candidates with "${s}" ignored because ${e}`)}function fE(s){return s.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const n=t.channels||"2";return r.channels[n]=(r.channels[n]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function QR(s,e,t,r){return s.slice(t,r+1).reduce((n,i,a)=>{if(!i.codecSet)return n;const o=i.audioGroups;let l=n[i.codecSet];l||(n[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const c=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,o&&o.forEach(u=>{if(!u)return;const d=e.groups[u];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+d.channels[f]}))}),n},{})}function Lg(s){if(!s)return s;const{lang:e,assocLang:t,characteristics:r,channels:n,audioCodec:i}=s;return{lang:e,assocLang:t,characteristics:r,channels:n,audioCodec:i}}function $s(s,e,t){if("attrs"in s){const r=e.indexOf(s);if(r!==-1)return r}for(let r=0;r<e.length;r++){const n=e[r];if(mn(s,n,t))return r}return-1}function mn(s,e,t){const{groupId:r,name:n,lang:i,assocLang:a,default:o}=s,l=s.forced;return(r===void 0||e.groupId===r)&&(n===void 0||e.name===n)&&(i===void 0||JR(i,e.lang))&&(i===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in s)||ZR(s.characteristics||"",e.characteristics))&&(t===void 0||t(s,e))}function JR(s,e="--"){return s.length===e.length?s===e:s.startsWith(e)||e.startsWith(s)}function ZR(s,e=""){const t=s.split(","),r=e.split(",");return t.length===r.length&&!t.some(n=>r.indexOf(n)===-1)}function rn(s,e){const{audioCodec:t,channels:r}=s;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function eI(s,e,t,r,n){const i=e[r],o=e.reduce((f,p,m)=>{const y=p.uri;return(f[y]||(f[y]=[])).push(m),f},{})[i.uri];o.length>1&&(r=Math.max.apply(Math,o));const l=i.videoRange,c=i.frameRate,u=i.codecSet.substring(0,4),d=_g(e,r,f=>{if(f.videoRange!==l||f.frameRate!==c||f.codecSet.substring(0,4)!==u)return!1;const p=f.audioGroups,m=t.filter(y=>!p||p.indexOf(y.groupId)!==-1);return $s(s,m,n)>-1});return d>-1?d:_g(e,r,f=>{const p=f.audioGroups,m=t.filter(y=>!p||p.indexOf(y.groupId)!==-1);return $s(s,m,n)>-1})}function _g(s,e,t){for(let r=e;r>-1;r--)if(t(s[r]))return r;for(let r=e+1;r<s.length;r++)if(t(s[r]))return r;return-1}function Hl(s,e){var t;return!!s&&s!==((t=e.loadLevelObj)==null?void 0:t.uri)}class tI extends xs{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:n,partCurrent:i,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!n||!l)return;const c=performance.now(),u=i?i.stats:n.stats,d=i?i.duration:n.duration,f=c-u.loading.start,p=a.minAutoLevel,m=n.level,y=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||m<=p){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const g=y>-1&&y!==m,x=!!t||g;if(!x&&(l.paused||!l.playbackRate||!l.readyState))return;const v=a.mainForwardBufferInfo;if(!x&&v===null)return;const E=this.bwEstimator.getEstimateTTFB(),T=Math.abs(l.playbackRate);if(f<=Math.max(E,1e3*(d/(T*2))))return;const w=v?v.len/T:0,R=u.loading.first?u.loading.first-u.loading.start:-1,b=u.loaded&&R>-1,_=this.getBwEstimate(),I=a.levels,L=I[m],N=Math.max(u.loaded,Math.round(d*(n.bitrate||L.averageBitrate)/8));let M=b?f-R:f;M<1&&b&&(M=Math.min(f,u.loaded*8/_));const $=b?u.loaded*1e3/M:0,G=E/1e3,Y=$?(N-u.loaded)/$:N*8/_+G;if(Y<=w)return;const U=$?$*8:_,W=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,P=this.hls.config.abrBandWidthUpFactor;let B=Number.POSITIVE_INFINITY,K;for(K=m-1;K>p;K--){const te=I[K].maxBitrate,z=!I[K].details||W;if(B=this.getTimeToLoadFrag(G,U,d*te,z),B<Math.min(w,d+G))break}if(B>=Y||B>d*10)return;b?this.bwEstimator.sample(f-Math.min(E,R),u.loaded):this.bwEstimator.sampleTTFB(f);const O=I[K].maxBitrate;this.getBwEstimate()*P>O&&this.resetEstimator(O);const F=this.findBestLevel(O,p,K,0,w,1,1);F>-1&&(K=F),this.warn(`Fragment ${n.sn}${i?" part "+i.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${w.toFixed(3)} s
      Estimated load time for current fragment: ${Y.toFixed(3)} s
      Estimated load time for down switch fragment: ${B.toFixed(3)} s
      TTFB estimate: ${R|0} ms
      Current BW estimate: ${ee(_)?_|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${K} @ ${O|0} bps`),a.nextLoadLevel=a.nextAutoLevel=K,this.clearTimer();const Z=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===K&&K>0){const te=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${K>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${te.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,K>p){let z=this.findBestLevel(this.hls.levels[p].bitrate,p,K,0,te,1,1);z===-1&&(z=p),this.hls.nextLoadLevel=this.hls.nextAutoLevel=z,this.resetEstimator(this.hls.levels[z].bitrate)}}};g||Y>B*2?Z():this.timer=self.setInterval(Z,B*1e3),a.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:i,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new aR(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var n;this.fragCurrent=r,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case C.BUFFER_ADD_CODEC_ERROR:case C.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case C.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:n,partCurrent:i}=this;if(r&&n&&r.sn===n.sn&&r.level===n.level){const a=performance.now(),o=i?i.stats:r.stats,l=a-o.loading.start,c=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&c>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,c),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,n){const i=e+r/t,a=n?e+this.lastLevelLoadSec:0;return i+a}onLevelLoaded(e,t){const r=this.hls.config,{loading:n}=t.stats,i=n.end-n.first;ee(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const n=r?r.stats:t.stats;if(t.type===re.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+n.loaded,l=(a.loaded?a.loaded.duration:0)+i;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const i={stats:n,frag:t,part:r,id:t.type};this.onFragBuffered(S.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:n}=t,i=n!=null&&n.stats.loaded?n.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const a=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==re.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,n,1,1);if(i>-1)return i;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,i)&&a[e].loadError<=a[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:n,config:i,minAutoLevel:a}=r,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(c){const g=this.findBestLevel(l,a,n,c,0,u,d);if(g>=0)return this.rebufferNotice=-1,g}let f=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay;if(!c){const g=this.bitrateTestDelay;g&&(f=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-g,this.info(`bitrate test took ${Math.round(1e3*g)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=d=1)}const p=this.findBestLevel(l,a,n,c,f,u,d);if(this.rebufferNotice!==p&&(this.rebufferNotice=p,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${p}`)),p>-1)return p;const m=r.levels[a],y=r.loadLevelObj;return y&&(m==null?void 0:m.bitrate)<y.bitrate?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,n,i,a,o){var l;const c=n+i,u=this.lastLoadedFragLevel,d=u===-1?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:p}=this,{levels:m,allAudioTracks:y,loadLevel:g,config:x}=this.hls;if(m.length===1)return 0;const v=m[d],E=!!((l=this.hls.latestLevelDetails)!=null&&l.live),T=g===-1||u===-1;let w,R="SDR",b=(v==null?void 0:v.frameRate)||0;const{audioPreference:_,videoPreference:I}=x,L=this.audioTracksByGroup||(this.audioTracksByGroup=fE(y));let N=-1;if(T){if(this.firstSelection!==-1)return this.firstSelection;const U=this.codecTiers||(this.codecTiers=QR(m,L,t,r)),W=XR(U,R,e,_,I),{codecSet:P,videoRanges:B,minFramerate:K,minBitrate:O,minIndex:F,preferHDR:Z}=W;N=F,w=P,R=Z?B[B.length-1]:B[0],b=K,e=Math.max(e,O),this.log(`picked start tier ${Ce(W)}`)}else w=v==null?void 0:v.codecSet,R=v==null?void 0:v.videoRange;const M=p?p.duration:f?f.duration:0,$=this.bwEstimator.getEstimateTTFB()/1e3,G=[];for(let U=r;U>=t;U--){var Y;const W=m[U],P=U>d;if(!W)continue;if(x.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){const z=navigator.mediaCapabilities;typeof(z==null?void 0:z.decodingInfo)=="function"&&UR(W,L,R,b,e,_)?(W.supportedPromise=dE(W,L,z,this.supportedCache),W.supportedPromise.then(Q=>{if(!this.hls)return;W.supportedResult=Q;const ge=this.hls.levels,se=ge.indexOf(W);Q.error?this.warn(`MediaCapabilities decodingInfo error: "${Q.error}" for level ${se} ${Ce(Q)}`):Q.supported?Q.decodingInfoResults.some(fe=>fe.smooth===!1||fe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${se} not smooth or powerEfficient: ${Ce(Q)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${se} ${Ce(Q)}`),se>-1&&ge.length>1&&(this.log(`Removing unsupported level ${se}`),this.hls.removeLevel(se),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Q=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Q}`)})):W.supportedResult=cE}if((w&&W.codecSet!==w||R&&W.videoRange!==R||P&&b>W.frameRate||!P&&b>0&&b<W.frameRate||(Y=W.supportedResult)!=null&&(Y=Y.decodingInfoResults)!=null&&Y.some(z=>z.smooth===!1))&&(!T||U!==N)){G.push(U);continue}const B=W.details,K=(p?B==null?void 0:B.partTarget:B==null?void 0:B.averagetargetduration)||M;let O;P?O=o*e:O=a*e;const F=M&&n>=M*2&&i===0?W.averageBitrate:W.maxBitrate,Z=this.getTimeToLoadFrag($,O,F*K,B===void 0);if(O>=F&&(U===u||W.loadError===0&&W.fragmentError===0)&&(Z<=$||!ee(Z)||E&&!this.bitrateTestDelay||Z<c)){const z=this.forcedAutoLevel;return U!==g&&(z===-1||z!==g)&&(G.length&&this.trace(`Skipped level(s) ${G.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${m[G[0]].codecs}" ${m[G[0]].videoRange}; not compatible with "${w}" ${R}`),this.info(`switch candidate:${d}->${U} adjustedbw(${Math.round(O)})-bitrate=${Math.round(O-F)} ttfb:${$.toFixed(1)} avgDuration:${K.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${Z.toFixed(1)} firstSelection:${T} codecSet:${W.codecSet} videoRange:${W.videoRange} hls.loadLevel:${g}`)),T&&(this.firstSelection=U),U}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const mE={search:function(s,e){let t=0,r=s.length-1,n=null,i=null;for(;t<=r;){n=(t+r)/2|0,i=s[n];const a=e(i);if(a>0)t=n+1;else if(a<0)r=n-1;else return i}return null}};function sI(s,e,t){if(e===null||!Array.isArray(s)||!s.length||!ee(e))return null;const r=s[0].programDateTime;if(e<(r||0))return null;const n=s[s.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let i=0;i<s.length;++i){const a=s[i];if(nI(e,t,a))return a}return null}function bn(s,e,t=0,r=0,n=.005){let i=null;if(s){i=e[1+s.sn-e[0].sn]||null;const o=s.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),i&&s.level!==i.level&&i.end<=s.end&&(i=e[2+s.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!s||s.level===i.level)&&Rg(t,r,i)===0||rI(i,s,Math.min(n,r))))return i;const a=mE.search(e,Rg.bind(null,t,r));return a&&(a!==s||!i)?a:i}function rI(s,e,t){if(e&&e.start===0&&e.level<s.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((n,i)=>(i[0]==="INF"&&(n+=parseFloat(i[1])),n),t);return s.start<=r}return!1}function Rg(s=0,e=0,t){if(t.start<=s&&t.start+t.duration>s)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=s?1:t.start-r>s&&t.start?-1:0}function nI(s,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>s}function pE(s,e,t){if(s&&s.startCC<=e&&s.endCC>=e){let r=s.fragments;const{fragmentHint:n}=s;n&&(r=r.concat(n));let i;return mE.search(r,a=>a.cc<e?1:a.cc>e?-1:(i=a,a.end<=t?1:a.start>t?-1:0)),i||null}return null}function zl(s){switch(s.details){case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_TIMEOUT:case C.LEVEL_LOAD_TIMEOUT:case C.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function gE(s){return s.details.startsWith("key")}function yE(s){return gE(s)&&!!s.frag&&!s.frag.decryptdata}function Ig(s,e){const t=zl(e);return s.default[`${t?"timeout":"error"}Retry`]}function Gf(s,e){const t=s.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*s.retryDelayMs,s.maxRetryDelayMs)}function kg(s){return Ae(Ae({},s),{errorRetry:null,timeoutRetry:null})}function Kl(s,e,t,r){if(!s)return!1;const n=r==null?void 0:r.code,i=e<s.maxNumRetry&&(iI(n)||!!t);return s.shouldRetry?s.shouldRetry(s,e,t,r,i):i}function iI(s){return uh(s)||!!s&&(s<400||s>499)}function uh(s){return s===0&&navigator.onLine===!1}var pt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},es={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class aI extends xs{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===re.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const n=e.audioGroups;if(n)return this.hls.allAudioTracks.filter(a=>n.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const n=this.hls,i=t.context;switch(t.details){case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case C.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=ni();return}case C.FRAG_GAP:case C.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=pt.SendAlternateToPenaltyBox;return}case C.LEVEL_EMPTY_ERROR:case C.LEVEL_PARSING_ERROR:{var a;const l=t.parent===re.MAIN?t.level:n.loadLevel;t.details===C.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case C.LEVEL_LOAD_ERROR:case C.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case C.AUDIO_TRACK_LOAD_ERROR:case C.AUDIO_TRACK_LOAD_TIMEOUT:case C.SUBTITLE_LOAD_ERROR:case C.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=n.loadLevelObj;if(l&&(i.type===ye.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===ye.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=pt.SendAlternateToPenaltyBox,t.errorAction.flags=es.MoveAllAlternatesMatchingHost;return}}return;case C.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:pt.SendAlternateToPenaltyBox,flags:es.MoveAllAlternatesMatchingHDCP};return;case C.KEY_SYSTEM_SESSION_UPDATE_FAILED:case C.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case C.KEY_SYSTEM_NO_SESSION:t.errorAction={action:pt.SendAlternateToPenaltyBox,flags:es.MoveAllAlternatesMatchingKey};return;case C.BUFFER_ADD_CODEC_ERROR:case C.REMUX_ALLOC_ERROR:case C.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:n.loadLevel)}return;case C.INTERNAL_EXCEPTION:case C.BUFFER_APPENDING_ERROR:case C.BUFFER_FULL_ERROR:case C.LEVEL_SWITCH_ERROR:case C.BUFFER_STALLED_ERROR:case C.BUFFER_SEEK_OVER_HOLE:case C.BUFFER_NUDGE_ON_STALL:t.errorAction=ni();return}t.type===ae.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ni())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,n=Ig(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(Kl(n,i,zl(e),e.response))return{action:pt.RetryRequest,flags:es.None,retryConfig:n,retryCount:i};const o=this.getLevelSwitchAction(e,t);return n&&(o.retryConfig=n,o.retryCount=i),o}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),n=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:a}=t.config,o=Ig(gE(e)?a:i,e),l=t.levels.reduce((u,d)=>u+d.fragmentError,0);if(n&&(e.details!==C.FRAG_GAP&&n.fragmentError++,!yE(e)&&Kl(o,l,zl(e),e.response)))return{action:pt.RetryRequest,flags:es.None,retryConfig:o,retryCount:l};const c=this.getLevelSwitchAction(e,r);return o&&(c.retryConfig=o,c.retryCount=l),c}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const n=this.hls.levels[t];if(n){var i,a;const c=e.details;n.loadError++,c===C.BUFFER_APPEND_ERROR&&n.fragmentError++;let u=-1;const{levels:d,loadLevel:f,minAutoLevel:p,maxAutoLevel:m}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const y=(i=e.frag)==null?void 0:i.type,x=(y===re.AUDIO&&c===C.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===C.BUFFER_ADD_CODEC_ERROR||c===C.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:R})=>n.audioCodec!==R),E=e.sourceBufferName==="video"&&(c===C.BUFFER_ADD_CODEC_ERROR||c===C.BUFFER_APPEND_ERROR)&&d.some(({codecSet:R,audioCodec:b})=>n.codecSet!==R&&n.audioCodec===b),{type:T,groupId:w}=(a=e.context)!=null?a:{};for(let R=d.length;R--;){const b=(R+f)%d.length;if(b!==f&&b>=p&&b<=m&&d[b].loadError===0){var o,l;const _=d[b];if(c===C.FRAG_GAP&&y===re.MAIN&&e.frag){const I=d[b].details;if(I){const L=bn(e.frag,I.fragments,e.frag.start);if(L!=null&&L.gap)continue}}else{if(T===ye.AUDIO_TRACK&&_.hasAudioGroup(w)||T===ye.SUBTITLE_TRACK&&_.hasSubtitleGroup(w))continue;if(y===re.AUDIO&&(o=n.audioGroups)!=null&&o.some(I=>_.hasAudioGroup(I))||y===re.SUBTITLE&&(l=n.subtitleGroups)!=null&&l.some(I=>_.hasSubtitleGroup(I))||x&&n.audioCodec===_.audioCodec||E&&n.codecSet===_.codecSet||!x&&n.codecSet!==_.codecSet)continue}u=b;break}}if(u>-1&&r.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:pt.SendAlternateToPenaltyBox,flags:es.None,nextAutoLevel:u}}return{action:pt.SendAlternateToPenaltyBox,flags:es.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case pt.DoNothing:break;case pt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==C.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:n}=r,i=r.nextAutoLevel;switch(n){case es.None:this.switchLevel(e,i);break;case es.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],u=c==null?void 0:c.attrs["HDCP-LEVEL"];if(r.hdcpLevel=u,u==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(u){t.maxHdcpLevel=ch[ch.indexOf(u)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case es.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels,u=c.length;for(let f=u;f--;)if(this.variantHasKey(c[f],l)){var a,o;this.log(`Banned key found in level ${f} (${c[f].bitrate}bps) or audio group "${(a=c[f].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${gt(l.keyId||[])}`),c[f].fragmentError++,c[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const d=e.frag;if(this.hls.levels.length<u)r.resolved=!0;else if(d&&d.type!==re.MAIN){const f=d.decryptdata;f&&!l.matches(f)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===C.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=lh(e.mimeType),n=this.hls.levels;for(let i=n.length;i--;)n[i][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${i} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(i))}}}function ni(s){const e={action:pt.DoNothing,flags:es.None};return s&&(e.resolved=!0),e}var at={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class oI{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let n=r.length;n--;){const i=r[n];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:n}=this,i=Object.keys(n);for(let a=i.length;a--;){const o=n[i[a]];if((o==null?void 0:o.body.type)===t&&(!r||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,r,n,i){this.timeRanges&&(this.timeRanges[e]=t);const a=(n==null?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===r&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const d=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,n=In(r),i=this.fragments[n];if(!i||i.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(o=>{const l=r.elementaryStreams[o];if(!l)return;const c=t[o],u=a||l.partial===!0;i.range[o]=this.getBufferedTimes(r,e.part,u,c)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,r),Lo(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=Cg(r,n=>n.fragment.sn>=e))}fragBuffered(e,t){const r=In(e);let n=this.fragments[r];!n&&t&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,this.bufferedEnd(n,e))}getBufferedTimes(e,t,r,n){const i={time:[],partial:r},a=e.start,o=e.end,l=e.minEndPTS||o,c=e.maxStartPTS||a;for(let u=0;u<n.length;u++){const d=n.start(u)-this.bufferPadding,f=n.end(u)+this.bufferPadding;if(c>=d&&l<=f){i.time.push({startPTS:Math.max(a,n.start(u)),endPTS:Math.min(o,n.end(u))});break}else if(a<f&&o>d){const p=Math.max(a,n.start(u)),m=Math.min(o,n.end(u));m>p&&(i.partial=!0,i.time.push({startPTS:p,endPTS:m}))}else if(o<=d)break}return i}getPartialFragment(e){let t=null,r,n,i,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&Lo(u)&&(n=u.body.start-o,i=u.body.end+o,e>=n&&e<=i&&(r=Math.min(e-n,i-e),a<=r&&(t=u.body,a=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Lo(t))}getState(e){const t=In(e),r=this.fragments[t];return r?r.buffered?Lo(r)?at.PARTIAL:at.OK:at.APPENDING:at.NOT_LOADED}isTimeBuffered(e,t,r){let n,i;for(let a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,n=t.part?null:t,i=In(r);this.fragments[i]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:n,timeRanges:i,type:a}=t;if(r.sn==="initSegment")return;const o=r.type;if(n){let c=this.activePartLists[o];c||(this.activePartLists[o]=c=[]),c.push(n)}this.timeRanges=i;const l=i[a];this.detectEvictedFragments(a,l,o,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=In(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let n=r.length;n--;){const i=t[r[n]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,n,i){n&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==r||n&&!l.gap||l.start<t&&l.end>e&&(o.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=In(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const n=e.sn;this.activePartLists[e.type]=Cg(r,i=>i.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function Lo(s){var e,t,r;return s.buffered&&!!(s.body.gap||(e=s.range.video)!=null&&e.partial||(t=s.range.audio)!=null&&t.partial||(r=s.range.audiovideo)!=null&&r.partial)}function In(s){return`${s.type}_${s.level}_${s.sn}`}function Cg(s,e){return s.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Hr={cbc:0,ctr:1};class lI{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Hr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Hr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function cI(s){const e=s.byteLength,t=e&&new DataView(s.buffer).getUint8(e-1);return t?s.slice(0,e-t):s}class uI{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let n=0;n<4;n++)r[n]=t.getUint32(n*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],a=r[2],o=r[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],f=l[3],p=new Uint32Array(256);let m=0,y=0,g=0;for(g=0;g<256;g++)g<128?p[g]=g<<1:p[g]=g<<1^283;for(g=0;g<256;g++){let x=y^y<<1^y<<2^y<<3^y<<4;x=x>>>8^x&255^99,e[m]=x,t[x]=m;const v=p[m],E=p[v],T=p[E];let w=p[x]*257^x*16843008;n[m]=w<<24|w>>>8,i[m]=w<<16|w>>>16,a[m]=w<<8|w>>>24,o[m]=w,w=T*16843009^E*65537^v*257^m*16843008,c[x]=w<<24|w>>>8,u[x]=w<<16|w>>>16,d[x]=w<<8|w>>>24,f[x]=w,m?(m=v^p[p[p[T^v]]],y^=p[p[y]]):m=y=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,n=0;for(;n<t.length&&r;)r=t[n]===this.key[n],n++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const a=this.ksRows=(i+6+1)*4;let o,l;const c=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),d=this.sBox,f=this.rcon,p=this.invSubMix,m=p[0],y=p[1],g=p[2],x=p[3];let v,E;for(o=0;o<a;o++){if(o<i){v=c[o]=t[o];continue}E=v,o%i===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=f[o/i|0]<<24):i>6&&o%i===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),c[o]=v=(c[o-i]^E)>>>0}for(l=0;l<a;l++)o=a-l,l&3?E=c[o]:E=c[o-4],l<4||o<=4?u[l]=E:u[l]=m[d[E>>>24]]^y[d[E>>>16&255]]^g[d[E>>>8&255]]^x[d[E&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const n=this.keySize+6,i=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],u=o[2],d=o[3],f=this.uint8ArrayToUint32Array_(r);let p=f[0],m=f[1],y=f[2],g=f[3];const x=new Int32Array(e),v=new Int32Array(x.length);let E,T,w,R,b,_,I,L,N,M,$,G,Y,U;const W=this.networkToHostOrderSwap;for(;t<x.length;){for(N=W(x[t]),M=W(x[t+1]),$=W(x[t+2]),G=W(x[t+3]),b=N^i[0],_=G^i[1],I=$^i[2],L=M^i[3],Y=4,U=1;U<n;U++)E=l[b>>>24]^c[_>>16&255]^u[I>>8&255]^d[L&255]^i[Y],T=l[_>>>24]^c[I>>16&255]^u[L>>8&255]^d[b&255]^i[Y+1],w=l[I>>>24]^c[L>>16&255]^u[b>>8&255]^d[_&255]^i[Y+2],R=l[L>>>24]^c[b>>16&255]^u[_>>8&255]^d[I&255]^i[Y+3],b=E,_=T,I=w,L=R,Y=Y+4;E=a[b>>>24]<<24^a[_>>16&255]<<16^a[I>>8&255]<<8^a[L&255]^i[Y],T=a[_>>>24]<<24^a[I>>16&255]<<16^a[L>>8&255]<<8^a[b&255]^i[Y+1],w=a[I>>>24]<<24^a[L>>16&255]<<16^a[b>>8&255]<<8^a[_&255]^i[Y+2],R=a[L>>>24]<<24^a[b>>16&255]<<16^a[_>>8&255]<<8^a[I&255]^i[Y+3],v[t]=W(E^p),v[t+1]=W(R^m),v[t+2]=W(w^y),v[t+3]=W(T^g),p=N,m=M,y=$,g=G,t=t+4}return v.buffer}}class dI{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=hI(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function hI(s){switch(s){case Hr.cbc:return"AES-CBC";case Hr.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${s}`)}}const fI=16;class Hf{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?cI(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,n){return this.useSoftware?new Promise((i,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,r,n);const l=this.flush();l?i(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,n)}softwareDecrypt(e,t,r,n){const{currentIV:i,currentResult:a,remainderData:o}=this;if(n!==Hr.cbc||t.byteLength!==16)return Le.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=ys(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(r=i);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new uI),c.expandKey(t);const u=a;return this.currentResult=c.decrypt(l.buffer,0,r),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,r,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,n));this.key=t,this.fastAesKey=new dI(this.subtle,t,n)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new lI(this.subtle,new Uint8Array(r),n).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(Le.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,n)))}onWebCryptoError(e,t,r,n){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,n);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%fI;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Le.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Pg=Math.pow(2,17);class mI{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Js({type:ae.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,i=n.fLoader,a=n.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(Ng(e));return}else e.gap=!1;const c=this.loader=i?new i(n):new a(n),u=Dg(e);e.loader=c;const d=kg(n.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Pg};e.stats=c.stats;const p={onSuccess:(m,y,g,x)=>{this.resetLoader(e,c);let v=m.data;g.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),o({frag:e,part:null,payload:v,networkDetails:x})},onError:(m,y,g,x)=>{this.resetLoader(e,c),l(new Js({type:ae.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ae({url:r,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:g,stats:x}))},onAbort:(m,y,g)=>{this.resetLoader(e,c),l(new Js({type:ae.NETWORK_ERROR,details:C.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:g,stats:m}))},onTimeout:(m,y,g)=>{this.resetLoader(e,c),l(new Js({type:ae.NETWORK_ERROR,details:C.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:m}))}};t&&(p.onProgress=(m,y,g,x)=>t({frag:e,part:null,payload:g,networkDetails:x})),c.load(u,f,p)})}loadPart(e,t,r){this.abort();const n=this.config,i=n.fLoader,a=n.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Ng(e,t));return}const c=this.loader=i?new i(n):new a(n),u=Dg(e,t);e.loader=c;const d=kg(n.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Pg};t.stats=c.stats,c.load(u,f,{onSuccess:(p,m,y,g)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const x={frag:e,part:t,payload:p.data,networkDetails:g};r(x),o(x)},onError:(p,m,y,g)=>{this.resetLoader(e,c),l(new Js({type:ae.NETWORK_ERROR,details:C.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ae({url:u.url,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:y,stats:g}))},onAbort:(p,m,y)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Js({type:ae.NETWORK_ERROR,details:C.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:y,stats:p}))},onTimeout:(p,m,y)=>{this.resetLoader(e,c),l(new Js({type:ae.NETWORK_ERROR,details:C.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:y,stats:p}))}})})}updateStatsFromPart(e,t){const r=e.stats,n=t.stats,i=n.total;if(r.loaded+=n.loaded,i){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(r.loaded/i),l),d=(l-c)*Math.round(r.loaded/c);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const a=r.loading,o=n.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Dg(s,e=null){const t=e||s,r={frag:s,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(ee(n)&&ee(i)){var a;let o=n,l=i;if(s.sn==="initSegment"&&pI((a=s.decryptdata)==null?void 0:a.method)){const c=i-n;c%16&&(l=i+(16-c%16)),n!==0&&(r.resetIV=!0,o=n-16)}r.rangeStart=o,r.rangeEnd=l}return r}function Ng(s,e){const t=new Error(`GAP ${s.gap?"tag":"attribute"} found`),r={type:ae.MEDIA_ERROR,details:C.FRAG_GAP,fatal:!1,frag:s,error:t,networkDetails:null};return e&&(r.part=e),(e||s).stats.aborted=!0,new Js(r)}function pI(s){return s==="AES-128"||s==="AES-256"}class Js extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class xE extends xs{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class zf{constructor(e,t,r,n=0,i=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=_o(),this.buffering={audio:_o(),video:_o(),audiovideo:_o()},this.level=e,this.sn=t,this.id=r,this.size=n,this.part=i,this.partial=a}}function _o(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Og={length:0,start:()=>0,end:()=>0};class de{static isBuffered(e,t){if(e){const r=de.getBuffered(e);for(let n=r.length;n--;)if(t>=r.start(n)&&t<=r.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=de.getBuffered(e);return de.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const n=de.bufferedRanges(e);if(n.length)return de.bufferedInfo(n,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((u,d)=>u.start-d.start||d.end-u.end);let n=-1,i=[];if(r)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(n=u);const d=i.length;if(d){const f=i[d-1].end;e[u].start-f<r?e[u].end>f&&(i[d-1].end=e[u].end):i.push(e[u])}else i.push(e[u])}else i=e;let a=0,o,l=t,c=t;for(let u=0;u<i.length;u++){const d=i[u].start,f=i[u].end;if(n===-1&&t>=d&&t<=f&&(n=u),t+r>=d&&t<f)l=d,c=f,a=c-t;else if(t+r<d){o=d;break}}return{len:a,start:l||0,end:c||0,nextStart:o,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||Og}catch(t){return Le.log("failed to get media.buffered",t),Og}}}const vE=/\{\$([a-zA-Z0-9-_]+)\}/g;function Mg(s){return vE.test(s)}function dh(s,e){if(s.variableList!==null||s.hasVariableRefs){const t=s.variableList;return e.replace(vE,r=>{const n=r.substring(2,r.length-1),i=t==null?void 0:t[n];return i===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),r):i})}return e}function Fg(s,e,t){let r=s.variableList;r||(s.variableList=r={});let n,i;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(n))i=a.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(a){s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else n=e.NAME,i=e.VALUE;n in r?s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):r[n]=i||""}function gI(s,e,t){const r=e.IMPORT;if(t&&r in t){let n=s.variableList;n||(s.variableList=n={}),n[r]=t[r]}else s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const yI=/^(\d+)x(\d+)$/,jg=/(.+?)=(".*?"|.*?)(?:,|$)/g;class $e{constructor(e,t){typeof e=="string"&&(e=$e.parseAttrList(e,t)),Re(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(n*2,n*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((n,i)=>(n[i.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=yI.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const n={},i='"';for(jg.lastIndex=0;(r=jg.exec(e))!==null;){const a=r[1].trim();let o=r[2];const l=o.indexOf(i)===0&&o.lastIndexOf(i)===o.length-1;let c=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))o=dh(t,o);else if(!c&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Le.warn(`${e}: attribute ${a} is missing quotes`)}n[a]=o}return n}}const xI="com.apple.hls.interstitial";function vI(s){return s!=="ID"&&s!=="CLASS"&&s!=="CUE"&&s!=="START-DATE"&&s!=="DURATION"&&s!=="END-DATE"&&s!=="END-ON-NEXT"}function EI(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"||s==="SCTE35-CMD"}class EE{constructor(e,t,r=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(n=t==null?void 0:t.tagOrder)!=null?n:r,t){const i=t.attr;for(const a in i)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==i[a]){Le.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Re(new $e({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);ee(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Le.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ee(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===xI}get isValid(){return!!this.id&&!this._badValueForSameId&&ee(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const SI=10;class TI{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?ee(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||SI}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Wl(s,e){return s.length===e.length?!s.some((t,r)=>t!==e[r]):!1}function $g(s,e){return!s&&!e?!0:!s||!e?!1:Wl(s,e)}function ii(s){return s==="AES-128"||s==="AES-256"||s==="AES-256-CTR"}function Kf(s){switch(s){case"AES-128":case"AES-256":return Hr.cbc;case"AES-256-CTR":return Hr.ctr;default:throw new Error(`invalid full segment method ${s}`)}}function Wf(s){return Uint8Array.from(atob(s),e=>e.charCodeAt(0))}function hh(s){return Uint8Array.from(unescape(encodeURIComponent(s)),e=>e.charCodeAt(0))}function bI(s){const e=hh(s).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function SE(s){const e=function(r,n,i){const a=r[n];r[n]=r[i],r[i]=a};e(s,0,3),e(s,1,2),e(s,4,5),e(s,6,7)}function TE(s){const e=s.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),n=r[r.length-1].split(",");if(n.length===2){const i=n[0]==="base64",a=n[1];i?(r.splice(-1,1),t=Wf(a)):t=bI(a)}}return t}const Yl=typeof self<"u"?self:void 0;var Be={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},yt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function rl(s){switch(s){case yt.FAIRPLAY:return Be.FAIRPLAY;case yt.PLAYREADY:return Be.PLAYREADY;case yt.WIDEVINE:return Be.WIDEVINE;case yt.CLEARKEY:return Be.CLEARKEY}}function _u(s){switch(s){case Be.FAIRPLAY:return yt.FAIRPLAY;case Be.PLAYREADY:return yt.PLAYREADY;case Be.WIDEVINE:return yt.WIDEVINE;case Be.CLEARKEY:return yt.CLEARKEY}}function Yi(s){const{drmSystems:e,widevineLicenseUrl:t}=s,r=e?[Be.FAIRPLAY,Be.WIDEVINE,Be.PLAYREADY,Be.CLEARKEY].filter(n=>!!e[n]):[];return!r[Be.WIDEVINE]&&t&&r.push(Be.WIDEVINE),r}const bE=function(s){return Yl!=null&&(s=Yl.navigator)!=null&&s.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function wI(s,e,t,r){let n;switch(s){case Be.FAIRPLAY:n=["cenc","sinf"];break;case Be.WIDEVINE:case Be.PLAYREADY:n=["cenc"];break;case Be.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${s}`)}return AI(n,e,t,r)}function AI(s,e,t,r){return[{initDataTypes:s,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function LI(s){var e;return!!s&&(s.sessionType==="persistent-license"||!!((e=s.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function wE(s){const e=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=Wf(o).subarray(0,16);return SE(l),l}}return null}let kn={};class Ur{static clearKeyUriToKeyIdMap(){kn={}}static setKeyIdForUri(e,t){kn[e]=t}static addKeyIdForUri(e){const t=Object.keys(kn).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),kn[e]=r,r}constructor(e,t,r,n=[1],i=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=n,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ii(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(Jv(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Wl(e.keyFormatVersions,this.keyFormatVersions)&&$g(e.iv,this.iv)&&$g(e.keyId,this.keyId)}isSupported(){if(this.method){if(ii(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case yt.FAIRPLAY:case yt.WIDEVINE:case yt.PLAYREADY:case yt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(ii(this.method)){let i=this.iv;return i||(typeof e!="number"&&(Le.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=RI(e)),new Ur(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=kn[this.uri];if(i&&!Wl(this.keyId,i)&&Ur.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=TE(this.uri);if(r)switch(this.keyFormat){case yt.WIDEVINE:if(this.pssh=r,!this.keyId){const i=CR(r.buffer);if(i.length){var n;const a=i[0];this.keyId=(n=a.kids)!=null&&n.length?a.kids[0]:null}}this.keyId||(this.keyId=Ug(t));break;case yt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=kR(i,null,r),this.keyId=wE(r);break}default:{let i=r.subarray(0,16);if(i.length!==16){const a=new Uint8Array(16);a.set(i,16-i.length),i=a}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=_I(t),i||(i=Ug(t),i||(i=kn[this.uri])),i&&(this.keyId=i,Ur.setKeyIdForUri(this.uri,i))}return this}}function _I(s){const e=s==null?void 0:s[yt.WIDEVINE];return e?e.keyId:null}function Ug(s){const e=s==null?void 0:s[yt.PLAYREADY];if(e){const t=TE(e.uri);if(t)return wE(t)}return null}function RI(s){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=s>>8*(15-t)&255;return e}const Bg=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Vg=/#EXT-X-MEDIA:(.*)/g,II=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ru=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),kI=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Us{static findGroup(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n.id===t)return n}}static resolve(e,t){return jf.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return II.test(e)}static parseMasterPlaylist(e,t){const r=Mg(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];if(Bg.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let a;for(;(a=Bg.exec(e))!=null;)if(a[1]){var o;const c=new $e(a[1],n),u=dh(n,a[2]),d={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Us.resolve(u,t)},f=c.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),zg(c.CODECS,d);const p=c["SUPPLEMENTAL-CODECS"];p&&(d.supplemental={},zg(p,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||i.push(d),n.levels.push(d)}else if(a[3]){const c=a[3],u=a[4];switch(c){case"SESSION-DATA":{const d=new $e(u,n),f=d["DATA-ID"];f&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[f]=d);break}case"SESSION-KEY":{const d=Gg(u,t,n);d.encrypted&&d.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(d)):Le.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const d=new $e(u,n);Fg(n,d,t)}break}case"CONTENT-STEERING":{const d=new $e(u,n);n.contentSteering={uri:Us.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=Hg(u);break}}}const l=i.length>0&&i.length<n.levels.length;return n.levels=l?i:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,r){let n;const i={},a=r.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Vg.lastIndex=0;(n=Vg.exec(e))!==null;){const c=new $e(n[1],r),u=c.TYPE;if(u){const d=o[u],f=i[u]||[];i[u]=f;const p=c.LANGUAGE,m=c["ASSOC-LANGUAGE"],y=c.CHANNELS,g=c.CHARACTERISTICS,x=c["INSTREAM-ID"],v={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||p||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:p,url:c.URI?Us.resolve(c.URI,t):""};if(m&&(v.assocLang=m),y&&(v.channels=y),g&&(v.characteristics=g),x&&(v.instreamId=x),d!=null&&d.length){const E=Us.findGroup(d,v.groupId)||d[0];Kg(v,E,"audioCodec"),Kg(v,E,"textCodec")}f.push(v)}}return i}static parseLevelPlaylist(e,t,r,n,i,a){var o;const l={url:t},c=new TI(t),u=c.fragments,d=[];let f=null,p=0,m=0,y=0,g=0,x=0,v=null,E=new wu(n,l),T,w,R,b=-1,_=!1,I=null,L;if(Ru.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Mg(e),((o=Ru.exec(e))==null?void 0:o[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(T=Ru.exec(e))!==null;){_&&(_=!1,E=new wu(n,l),E.playlistOffset=y,E.setStart(y),E.sn=p,E.cc=g,x&&(E.bitrate=x),E.level=r,f&&(E.initSegment=f,f.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),I&&(E.setByteRange(I),I=null)));const G=T[1];if(G){E.duration=parseFloat(G);const Y=(" "+T[2]).slice(1);E.title=Y||null,E.tagList.push(Y?["INF",G,Y]:["INF",G])}else if(T[3]){if(ee(E.duration)){E.playlistOffset=y,E.setStart(y),R&&Yg(E,R,c),E.sn=p,E.level=r,E.cc=g,u.push(E);const Y=(" "+T[3]).slice(1);E.relurl=dh(c,Y),fh(E,v,d),v=E,y+=E.duration,p++,m=0,_=!0}}else{if(T=T[0].match(kI),!T){Le.warn("No matches on slow regex match for level playlist!");continue}for(w=1;w<T.length&&T[w]===void 0;w++);const Y=(" "+T[w]).slice(1),U=(" "+T[w+1]).slice(1),W=T[w+2]?(" "+T[w+2]).slice(1):null;switch(Y){case"BYTERANGE":v?E.setByteRange(U,v):E.setByteRange(U);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=U,E.tagList.push(["PROGRAM-DATE-TIME",U]),b===-1&&(b=u.length);break;case"PLAYLIST-TYPE":c.type&&qs(c,Y,T),c.type=U.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?qs(c,Y,T):u.length>0&&qg(c,Y,T),p=c.startSN=parseInt(U);break;case"SKIP":{c.skippedSegments&&qs(c,Y,T);const P=new $e(U,c),B=P.decimalInteger("SKIPPED-SEGMENTS");if(ee(B)){c.skippedSegments+=B;for(let O=B;O--;)u.push(null);p+=B}const K=P.enumeratedString("RECENTLY-REMOVED-DATERANGES");K&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(K.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&qs(c,Y,T),c.targetduration=Math.max(parseInt(U),1);break;case"VERSION":c.version!==null&&qs(c,Y,T),c.version=parseInt(U);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||qs(c,Y,T),c.live=!1;break;case"#":(U||W)&&E.tagList.push(W?[U,W]:[U]);break;case"DISCONTINUITY":g++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([Y]);break;case"BITRATE":E.tagList.push([Y,U]),x=parseInt(U)*1e3,ee(x)?E.bitrate=x:x=0;break;case"DATERANGE":{const P=new $e(U,c),B=new EE(P,c.dateRanges[P.ID],c.dateRangeTagCount);c.dateRangeTagCount++,B.isValid||c.skippedSegments?c.dateRanges[B.id]=B:Le.warn(`Ignoring invalid DATERANGE tag: "${U}"`),E.tagList.push(["EXT-X-DATERANGE",U]);break}case"DEFINE":{{const P=new $e(U,c);"IMPORT"in P?gI(c,P,a):Fg(c,P,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?qs(c,Y,T):u.length>0&&qg(c,Y,T),c.startCC=g=parseInt(U);break;case"KEY":{const P=Gg(U,t,c);if(P.isSupported()){if(P.method==="NONE"){R=void 0;break}R||(R={});const B=R[P.keyFormat];B!=null&&B.matches(P)||(B&&(R=Re({},R)),R[P.keyFormat]=P)}else Le.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${U}"`);break}case"START":c.startTimeOffset=Hg(U);break;case"MAP":{const P=new $e(U,c);if(E.duration){const B=new wu(n,l);Wg(B,P,r,R),f=B,E.initSegment=f,f.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime)}else{const B=E.byteRangeEndOffset;if(B){const K=E.byteRangeStartOffset;I=`${B-K}@${K}`}else I=null;Wg(E,P,r,R),f=E,_=!0}f.cc=g;break}case"SERVER-CONTROL":{L&&qs(c,Y,T),L=new $e(U),c.canBlockReload=L.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=L.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&L.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=L.optionalFloat("PART-HOLD-BACK",0),c.holdBack=L.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&qs(c,Y,T);const P=new $e(U);c.partTarget=P.decimalFloatingPoint("PART-TARGET");break}case"PART":{let P=c.partList;P||(P=c.partList=[]);const B=m>0?P[P.length-1]:void 0,K=m++,O=new $e(U,c),F=new gR(O,E,l,K,B);P.push(F),E.duration+=F.duration;break}case"PRELOAD-HINT":{const P=new $e(U,c);c.preloadHint=P;break}case"RENDITION-REPORT":{const P=new $e(U,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(P);break}default:Le.warn(`line parsed but not handled: ${T}`);break}}}v&&!v.relurl?(u.pop(),y-=v.duration,c.partList&&(c.fragmentHint=v)):c.partList&&(fh(E,v,d),E.cc=g,c.fragmentHint=E,R&&Yg(E,R,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const N=u.length,M=u[0],$=u[N-1];if(y+=c.skippedSegments*c.targetduration,y>0&&N&&$){c.averagetargetduration=y/N;const G=$.sn;c.endSN=G!=="initSegment"?G:0,c.live||($.endList=!0),b>0&&(PI(u,b),M&&d.unshift(M))}return c.fragmentHint&&(y+=c.fragmentHint.duration),c.totalduration=y,d.length&&c.dateRangeTagCount&&M&&AE(d,c),c.endCC=g,c}}function AE(s,e){let t=s.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];s.push(o),t++}else return;const r=s[t-1],n=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let o=i.length;o--;){const l=e.dateRanges[i[o]],c=l.startDate.getTime();l.tagAnchor=r.ref;for(let u=t;u--;){var a;if(((a=s[u])==null?void 0:a.sn)<e.startSN)break;const d=CI(e,c,s,u,n);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function CI(s,e,t,r,n){const i=t[r];if(i){const o=i.programDateTime;if(e>=o||r===0){var a;const l=(((a=t[r+1])==null?void 0:a.start)||n)-i.start;if(e<=o+l*1e3){const c=t[r].sn-s.startSN;if(c<0)return-1;const u=s.fragments;if(u.length>t.length){const f=(t[r+1]||u[u.length-1]).sn-s.startSN;for(let p=f;p>c;p--){const m=u[p].programDateTime;if(e>=m&&e<m+u[p].duration*1e3)return p}}return c}}}return-1}function Gg(s,e,t){var r,n;const i=new $e(s,t),a=(r=i.METHOD)!=null?r:"",o=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,u=(n=i.KEYFORMAT)!=null?n:"identity";o&&i.IV&&!l&&Le.error(`Invalid IV: ${i.IV}`);const d=o?Us.resolve(o,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Ur(a,d,u,f,l,i.KEYID)}function Hg(s){const t=new $e(s).decimalFloatingPoint("TIME-OFFSET");return ee(t)?t:null}function zg(s,e){let t=(s||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const n=t.filter(i=>Bf(i,r));n.length&&(e[`${r}Codec`]=n.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>n.indexOf(i)===-1))}),e.unknownCodecs=t}function Kg(s,e,t){const r=e[t];r&&(s[t]=r)}function PI(s,e){let t=s[e];for(let r=e;r--;){const n=s[r];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function fh(s,e,t){s.rawProgramDateTime?t.push(s):e!=null&&e.programDateTime&&(s.programDateTime=e.endProgramDateTime)}function Wg(s,e,t,r){s.relurl=e.URI,e.BYTERANGE&&s.setByteRange(e.BYTERANGE),s.level=t,s.sn="initSegment",r&&(s.levelkeys=r),s.initSegment=null}function Yg(s,e,t){s.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&r.push(s)}function qs(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function qg(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Iu(s,e){const t=e.startPTS;if(ee(t)){let r=0,n;e.sn>s.sn?(r=t-s.start,n=s):(r=s.start-t,n=e),n.duration!==r&&n.setDuration(r)}else e.sn>s.sn?s.cc===e.cc&&s.minEndPTS?e.setStart(s.start+(s.minEndPTS-s.start)):e.setStart(s.start+s.duration):e.setStart(Math.max(s.start-e.duration,0))}function LE(s,e,t,r,n,i,a){r-t<=0&&(a.warn("Fragment should have a positive duration",e),r=t+e.duration,i=n+e.duration);let l=t,c=r;const u=e.startPTS,d=e.endPTS;if(ee(u)){const x=Math.abs(u-t);s&&x>s.totalduration?a.warn(`media timestamps and playlist times differ by ${x}s for level ${e.level} ${s.url}`):ee(e.deltaPTS)?e.deltaPTS=Math.max(x,e.deltaPTS):e.deltaPTS=x,l=Math.max(t,u),t=Math.min(t,u),n=e.startDTS!==void 0?Math.min(n,e.startDTS):n,c=Math.min(r,d),r=Math.max(r,d),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=n,e.endPTS=r,e.minEndPTS=c,e.endDTS=i;const p=e.sn;if(!s||p<s.startSN||p>s.endSN)return 0;let m;const y=p-s.startSN,g=s.fragments;for(g[y]=e,m=y;m>0;m--)Iu(g[m],g[m-1]);for(m=y;m<g.length-1;m++)Iu(g[m],g[m+1]);return s.fragmentHint&&Iu(g[g.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,f}function DI(s,e,t){if(s===e)return;let r=null;const n=s.fragments;for(let u=n.length-1;u>=0;u--){const d=n[u].initSegment;if(d){r=d;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;let i;MI(s,e,(u,d,f,p)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==u.cc){const m=u.cc-d.cc;for(let y=f;y<p.length;y++)p[y].cc+=m;e.endCC=p[p.length-1].cc}ee(u.startPTS)&&ee(u.endPTS)&&(d.setStart(d.startPTS=u.startPTS),d.startDTS=u.startDTS,d.maxStartPTS=u.maxStartPTS,d.endPTS=u.endPTS,d.endDTS=u.endDTS,d.minEndPTS=u.minEndPTS,d.setDuration(u.endPTS-u.startPTS),d.duration&&(i=d),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(d.elementaryStreams=u.elementaryStreams),d.loader=u.loader,u.hasStats&&(d.stats=u.stats),u.initSegment&&(d.initSegment=u.initSegment,r=u.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(r&&o.forEach(u=>{var d;u&&(!u.initSegment||u.initSegment.relurl===((d=r)==null?void 0:d.relurl))&&(u.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=NI(s.dateRanges,e,t));const u=s.fragments.filter(d=>d.rawProgramDateTime);if(s.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<o.length;d++)o[d].programDateTime===null&&fh(o[d],o[d-1],u);AE(u,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const u=IE(s,e.startSN-1);e.startCC=(l=u==null?void 0:u.cc)!=null?l:a[0].cc}OI(s.partList,e.partList,(u,d)=>{d.elementaryStreams=u.elementaryStreams,d.stats=u.stats}),i?LE(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):_E(s,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=s.driftStartTime,e.driftStart=s.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const u=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=u),e.driftEndTime=c,e.driftEnd=u}else e.driftEndTime=s.driftEndTime,e.driftEnd=s.driftEnd,e.advancedDateTime=s.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=s.requestScheduled)}function NI(s,e,t){const{dateRanges:r,recentlyRemovedDateranges:n}=e,i=Re({},s);n&&n.forEach(l=>{delete i[l]});const o=Object.keys(i).length;return o?(Object.keys(r).forEach(l=>{const c=i[l],u=new EE(r[l].attr,c);u.isValid?(i[l]=u,c||(u.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ce(r[l].attr)}"`)}),i):r}function OI(s,e,t){if(s&&e){let r=0;for(let n=0,i=s.length;n<=i;n++){const a=s[n],o=e[n+r];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):r--}}}function MI(s,e,t){const r=e.skippedSegments,n=Math.max(s.startSN,e.startSN)-e.startSN,i=(s.fragmentHint?1:0)+(r?e.endSN:Math.min(s.endSN,e.endSN))-e.startSN,a=e.startSN-s.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments;for(let c=n;c<=i;c++){const u=l[a+c];let d=o[c];if(r&&!d&&u&&(d=e.fragments[c]=u),u&&d){t(u,d,c,o);const f=u.relurl,p=d.relurl;if(f&&FI(f,p)){e.playlistParsingError=Xg(`media sequence mismatch ${d.sn}:`,s,e,u,d);return}else if(u.cc!==d.cc){e.playlistParsingError=Xg(`discontinuity sequence mismatch (${u.cc}!=${d.cc})`,s,e,u,d);return}}}}function Xg(s,e,t,r,n){return new Error(`${s} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function _E(s,e,t=!0){const r=e.startSN+e.skippedSegments-s.startSN,n=s.fragments,i=r>=0;let a=0;if(i&&r<n.length)a=n[r].start;else if(i&&e.startSN===s.endSN+1)a=s.fragmentEnd;else if(i&&t)a=s.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=s.fragmentStart;else return;mh(e,a)}function mh(s,e){if(e){const t=s.fragments;for(let r=s.skippedSegments;r<t.length;r++)t[r].addStart(e);s.fragmentHint&&s.fragmentHint.addStart(e)}}function RE(s,e=1/0){let t=1e3*s.targetduration;if(s.updated){const r=s.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function IE(s,e,t){if(!s)return null;let r=s.fragments[e-s.startSN];return r||(r=s.fragmentHint,r&&r.sn===e)?r:e<s.startSN&&t&&t.sn===e?t:null}function Qg(s,e,t){return s?kE(s.partList,e,t):null}function kE(s,e,t){if(s)for(let r=s.length;r--;){const n=s[r];if(n.index===t&&n.fragment.sn===e)return n}return null}function CE(s){s.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function FI(s,e){return s!==e&&e?Jg(s)!==Jg(e):!1}function Jg(s){return s.replace(/\?[^?]*$/,"")}function ia(s,e){for(let r=0,n=s.length;r<n;r++){var t;if(((t=s[r])==null?void 0:t.cc)===e)return s[r]}return null}function jI(s,e){return!!(s&&e.startCC<s.endCC&&e.endCC>s.startCC)}function Zg(s,e){const t=s.start+e;s.startPTS=t,s.setStart(t),s.endPTS=t+s.duration}function PE(s,e){const t=e.fragments;for(let r=0,n=t.length;r<n;r++)Zg(t[r],s);e.fragmentHint&&Zg(e.fragmentHint,s),e.alignedSliding=!0}function $I(s,e){s&&(DE(e,s),e.alignedSliding||ql(e,s),!e.alignedSliding&&!e.skippedSegments&&_E(s,e,!1))}function DE(s,e){if(!jI(e,s))return;const t=Math.min(e.endCC,s.endCC),r=ia(e.fragments,t),n=ia(s.fragments,t);if(!r||!n)return;Le.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-n.start;PE(i,s)}function ql(s,e){if(!s.hasProgramDateTime||!e.hasProgramDateTime)return;const t=s.fragments,r=e.fragments;if(!t.length||!r.length)return;let n,i;const a=Math.min(e.endCC,s.endCC);e.startCC<a&&s.startCC<a&&(n=ia(r,a),i=ia(t,a)),(!n||!i)&&(n=r[Math.floor(r.length/2)],i=ia(t,n.cc)||t[Math.floor(t.length/2)]);const o=n.programDateTime,l=i.programDateTime;if(!o||!l)return;const c=(l-o)/1e3-(i.start-n.start);PE(c,s)}function Ct(s,e,t){Gt(s,e,t),s.addEventListener(e,t)}function Gt(s,e,t){s.removeEventListener(e,t)}const UI={toString:function(s){let e="";const t=s.length;for(let r=0;r<t;r++)e+=`[${s.start(r).toFixed(3)}-${s.end(r).toFixed(3)}]`;return e}},V={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Yf extends xE{constructor(e,t,r,n,i){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=V.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:c,state:u}=this,d=l?l.currentTime:0,f=de.bufferInfo(c||l,d,a.maxBufferHole),p=!f.len;if(this.log(`Media seeking to ${ee(d)?d.toFixed(3):d}, state: ${u}, ${p?"out of":"in"} buffer`),this.state===V.ENDED)this.resetLoadingState();else if(o){const m=a.maxFragLookUpTolerance,y=o.start-m,g=o.start+o.duration+m;if(p||g<f.start||y>f.end){const x=d>g;(d<y||x)&&(x&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const m=this.lastCurrentTime;if(d>m&&(this.lastCurrentTime=d),!this.loadingParts){const y=Math.max(f.end,d),g=this.shouldLoadParts(this.getLevelDetails(),y);g&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${y.toFixed(2)}`),this.loadingParts=g)}}this.hls.hasEnoughToStart||(this.log(`Setting ${p?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,p&&(this.startPosition=d)),p&&this.state===V.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new mI(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Hf(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===V.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=V.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,n=this.config.timelineOffset||0;if(r<=n)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=de.bufferedInfo(i,e.start,0));const a=e.nextStart;if(a&&a>n&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return de.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;Ct(r,"seeking",this.onMediaSeeking),Ct(r,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===V.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Gt(n,"seeking",this.onMediaSeeking),Gt(n,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=V.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const n=i=>{const a=i.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(a,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,n).then(i=>{if(!i)return;const a=this.state,o=i.frag;if(this.fragContextChanged(o)){(a===V.FRAG_LOADING||!this.fragCurrent&&a===V.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=V.IDLE);return}"payload"in i&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(S.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===V.STOPPED||this.state===V.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===at.APPENDING){const i=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,i),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===at.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:r};this.hls.trigger(S.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const n=r==null?void 0:r.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:n}=this,{frag:i,payload:a}=r,o=i.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&ii(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,Kf(o.method)).catch(c=>{throw n.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:i}),c}).then(c=>{const u=self.performance.now();return n.trigger(S.FRAG_DECRYPTED,{frag:i,payload:c,stats:{tstart:l,tdecrypt:u}}),r.payload=c,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===V.STOPPED||this.state===V.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==V.STOPPED&&(this.state=V.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,n;const i=e.tracks;if(i&&!t.encrypted&&((r=i.audio)!=null&&r.encrypted||(n=i.video)!=null&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(S.ERROR,{type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?UI.toString(de.getBuffered(r)):"(detached)"})`),Ze(e)){var n;if(e.type!==re.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=V.IDLE;return}}const i=(n=this.levels)==null?void 0:n[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=V.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:n,partsLoaded:i}=e,a=!i||i.length===0||i.some(l=>!l),o=new zf(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,n){var i;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=V.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(S.KEY_LOADED,f),this.state===V.KEY_LOADING&&(this.state=V.IDLE),f}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Ze(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(r=Math.max(e.start,r||0),this.loadingParts&&Ze(e)){const f=a.partList;if(f&&n){r>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const p=this.getNextPart(f,e,r);if(p>-1){const m=f[p];e=this.fragCurrent=m.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${m.index} (${p}/${f.length-1}) of ${this.fragInfo(e,!1,m)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=m.start+m.duration,this.state=V.FRAG_LOADING;let y;return o?y=o.then(g=>!g||this.fragContextChanged(g.frag)?null:this.doFragPartsLoad(e,m,t,n)).catch(g=>this.handleFragLoadError(g)):y=this.doFragPartsLoad(e,m,t,n).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:m,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(f,r))return Promise.resolve(null)}}if(Ze(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=a.partList)==null?void 0:c.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),ee(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=V.FRAG_LOADING;const u=this.config.progressive&&e.type!==re.SUBTITLE;let d;return u&&o?d=o.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,n)).catch(f=>this.handleFragLoadError(f)):d=Promise.all([this.fragmentLoader.load(e,u?n:void 0),o]).then(([f])=>(!u&&n&&n(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,r,n){return new Promise((i,a)=>{var o;const l=[],c=(o=r.details)==null?void 0:o.partList,u=d=>{this.fragmentLoader.loadPart(e,d,n).then(f=>{l[d.index]=f;const p=f.part;this.hls.trigger(S.FRAG_LOADED,f);const m=Qg(r.details,e.sn,d.index+1)||kE(c,e.sn,d.index+1);if(m)u(m);else return i({frag:e,part:p,partsLoaded:l})}).catch(a)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===C.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ae.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(S.ERROR,t)}else this.hls.trigger(S.ERROR,{type:ae.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==V.PARSING){!this.fragCurrent&&this.state!==V.STOPPED&&this.state!==V.ERROR&&(this.state=V.IDLE);return}const{frag:r,part:n,level:i}=t,a=self.performance.now();r.stats.parsing.end=a,n&&(n.stats.parsing.end=a);const o=this.getLevelDetails(),c=o&&r.sn>o.endSN||this.shouldLoadParts(o,r.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(r,n,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===re.SUBTITLE)return!1;const a=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=a){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:n,sn:i,part:a}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const o=t[n],l=o.details,c=a>-1?Qg(l,i,a):null,u=c?c.fragment:IE(l,i,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:c,level:o}):null}bufferFragmentData(e,t,r,n,i){if(this.state!==V.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=ys(a,o)),!l.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,d={type:e.type,frag:t,part:r,chunkMeta:n,offset:u,parent:t.type,data:l};if(this.hls.trigger(S.BUFFER_APPENDING,d),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!de.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,n=de.bufferInfo(t,r,0),i=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),o=Math.max(Math.min(e.start-a,n.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var r;const n=this.getLoadPosition();if(!ee(n))return null;const a=this.lastCurrentTime>n||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,a)}getFwdBufferInfoAtPos(e,t,r,n){const i=de.bufferInfo(e,t,n);if(i.len===0&&i.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&(i.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(i.nextStart,a.end)-t,n);return de.bufferInfo(e,t,o)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,n=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,n);return i>=n?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=re.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,n=r.length;if(!n)return null;const{config:i}=this,a=r[0].start,o=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=i.initialLiveManifestSize;if(n<d)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var c;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,p=this.hls.liveSyncPosition,m=l?(f!==-1&&f>=a?f:p)||l.start:e;this.log(`Setting startPosition to ${m} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${p} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=m}}else e<=a&&(l=r[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const d=l.sn-t.startSN;u=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===at.OK||r===at.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,n,i){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&r.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n,0);if(o!==null&&r.len+o.len>=i){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(e0(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(e0(this.config)&&e.type!==re.SUBTITLE){const r=this.hls.interstitialsManager,n=r==null?void 0:r.bufferingItem;if(n){const a=n.event;if(a){if(a.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&(t==null?void 0:t.live)===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const i=r==null?void 0:r.playerQueue;if(i)for(let a=i.length;a--;){const o=i[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let n=-1,i=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const c=e[o];if(a=a&&!c.independent,n>-1&&r<c.start)break;const u=c.loaded;u?n=-1:(i||(c.independent||a)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${c.start}`),n=o),i=u}return n}loadedEndOfParts(e,t){let r;for(let n=e.length;n--;){if(r=e[n],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let n=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),n=sI(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const a=t[i-e.startSN];r.cc===a.cc&&(n=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=pE(e,r.cc,r.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(n=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,r){const{config:n}=this;let{fragPrevious:i}=this,{fragments:a,endSN:o}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:c}=n,u=r.partList,d=!!(this.loadingParts&&u!=null&&u.length&&l);d&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let f;if(e<t){var p;const y=e<this.lastCurrentTime||e>t-c||(p=this.media)!=null&&p.paused||!this.startFragRequested?0:c;f=bn(i,a,e,y)}else f=a[a.length-1];if(f){const m=f.sn-r.startSN,y=this.fragmentTracker.getState(f);if((y===at.OK||y===at.PARTIAL&&f.gap)&&(i=f),i&&f.sn===i.sn&&(!d||u[0].fragment.sn>f.sn||!r.live)&&f.level===i.level){const x=a[m+1];f.sn<o&&this.fragmentTracker.getState(x)!==at.OK?f=x:f=null}}return f}alignPlaylists(e,t,r){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,a=!t,o=e.alignedSliding&&ee(i);if(a||!o&&!i){$I(r,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const n=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,a=i?this.startTimeOffset:e.startTimeOffset;a!==null&&ee(a)?(r=t+a,a<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${a} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+n}this.nextLoadPosition=r+n}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ze(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==V.FRAG_LOADING_WAITING_RETRY)&&(this.state=V.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const x=this.getCurrentContext(t.chunkMeta);x&&(t.frag=x.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var i;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const a=t.details===C.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(n,!0);const o=t.errorAction;if(!o){this.state=V.ERROR;return}const{action:l,flags:c,retryCount:u=0,retryConfig:d}=o,f=!!d,p=f&&l===pt.RetryRequest,m=f&&!o.resolved&&c===es.MoveAllAlternatesMatchingHost,y=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!p&&m&&Ze(n)&&!n.endList&&y&&!yE(t))this.resetFragmentErrors(e),this.treatAsGap(n),o.resolved=!0;else if((p||m)&&u<d.maxNumRetry){var g;const x=uh((g=t.response)==null?void 0:g.code),v=Gf(d,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+v,this.state=V.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,x){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${u+1}/${d.maxNumRetry} in ${v}ms`)}else if(d)if(this.resetFragmentErrors(e),u<d.maxNumRetry)!a&&l!==pt.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else l===pt.SendAlternateToPenaltyBox?this.state=V.WAITING_LEVEL:this.state=V.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!uh(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=V.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===V.PARSING||this.state===V.PARSED){const t=e.frag,r=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,r),i=n&&n.len>.5;i&&this.reduceMaxBufferLength(n.len,(t==null?void 0:t.duration)||10);const a=!i;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===re.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==V.STOPPED&&(this.state=V.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const n=de.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,r),this.state===V.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==V.STOPPED&&(this.state=V.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,n){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const f=n?0:LE(i,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:i,level:r,drift:f,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var o;const l=((o=this.transmuxer)==null?void 0:o.error)===null;if((r.fragmentError===0||l&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),l){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=V.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===re.MAIN?"level":"track"}fragInfo(e,t=!0,r){var n,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((n=t&&!r?e.startPTS:(r||e).start)!=null?n:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function e0(s){return!!s.interstitialsController&&s.enableInterstitialPlayback!==!1}class NE{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=BI(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function BI(s,e){const t=new Uint8Array(e);let r=0;for(let n=0;n<s.length;n++){const i=s[n];t.set(i,r),r+=i.length}return t}var ku={exports:{}},t0;function VI(){return t0||(t0=1,function(s){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function n(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,d,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new n(u,d||l,f),m=t?t+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],p]:l._events[m].push(p):(l._events[m]=p,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,p=d.length,m=new Array(p);f<p;f++)m[f]=d[f].fn;return m},o.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,f,p,m){var y=t?t+c:c;if(!this._events[y])return!1;var g=this._events[y],x=arguments.length,v,E;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),x){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,f),!0;case 5:return g.fn.call(g.context,u,d,f,p),!0;case 6:return g.fn.call(g.context,u,d,f,p,m),!0}for(E=1,v=new Array(x-1);E<x;E++)v[E-1]=arguments[E];g.fn.apply(g.context,v)}else{var T=g.length,w;for(E=0;E<T;E++)switch(g[E].once&&this.removeListener(c,g[E].fn,void 0,!0),x){case 1:g[E].fn.call(g[E].context);break;case 2:g[E].fn.call(g[E].context,u);break;case 3:g[E].fn.call(g[E].context,u,d);break;case 4:g[E].fn.call(g[E].context,u,d,f);break;default:if(!v)for(w=1,v=new Array(x-1);w<x;w++)v[w-1]=arguments[w];g[E].fn.apply(g[E].context,v)}}return!0},o.prototype.on=function(c,u,d){return i(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return i(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,f){var p=t?t+c:c;if(!this._events[p])return this;if(!u)return a(this,p),this;var m=this._events[p];if(m.fn)m.fn===u&&(!f||m.once)&&(!d||m.context===d)&&a(this,p);else{for(var y=0,g=[],x=m.length;y<x;y++)(m[y].fn!==u||f&&!m[y].once||d&&m[y].context!==d)&&g.push(m[y]);g.length?this._events[p]=g.length===1?g[0]:g:a(this,p)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&a(this,u)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,s.exports=o}(ku)),ku.exports}var GI=VI(),qf=mR(GI);const ka="1.6.15",Ei={};function HI(){return typeof __HLS_WORKER_BUNDLE__=="function"}function zI(){const s=Ei[ka];if(s)return s.clientCount++,s;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return Ei[ka]=n,n}function KI(s){const e=Ei[s];if(e)return e.clientCount++,e;const t=new self.URL(s,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Ei[s]=n,n}function WI(s){const e=Ei[s||ka];if(e&&e.clientCount--===1){const{worker:r,objectURL:n}=e;delete Ei[s||ka],n&&self.URL.revokeObjectURL(n),r.terminate()}}function OE(s,e){return e+10<=s.length&&s[e]===51&&s[e+1]===68&&s[e+2]===73&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function Xf(s,e){return e+10<=s.length&&s[e]===73&&s[e+1]===68&&s[e+2]===51&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function kc(s,e){let t=0;return t=(s[e]&127)<<21,t|=(s[e+1]&127)<<14,t|=(s[e+2]&127)<<7,t|=s[e+3]&127,t}function Ca(s,e){const t=e;let r=0;for(;Xf(s,e);){r+=10;const n=kc(s,e+6);r+=n,OE(s,e+10)&&(r+=10),e+=r}if(r>0)return s.subarray(t,t+r)}function YI(s,e,t,r){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],a=i>>2&15;if(a>12){const p=new Error(`invalid ADTS sampling index:${a}`);s.emit(S.ERROR,S.ERROR,{type:ae.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!0,error:p,reason:p.message});return}const o=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,c="mp4a.40."+o,u=n[a];let d=a;(o===5||o===29)&&(d-=3);const f=[o<<3|(d&14)>>1,(d&1)<<7|l<<3];return Le.log(`manifest codec:${r}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${o} sampling index:${a})`),{config:f,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:r}}function ME(s,e){return s[e]===255&&(s[e+1]&246)===240}function FE(s,e){return s[e+1]&1?7:9}function Qf(s,e){return(s[e+3]&3)<<11|s[e+4]<<3|(s[e+5]&224)>>>5}function qI(s,e){return e+5<s.length}function Xl(s,e){return e+1<s.length&&ME(s,e)}function XI(s,e){return qI(s,e)&&ME(s,e)&&Qf(s,e)<=s.length-e}function QI(s,e){if(Xl(s,e)){const t=FE(s,e);if(e+t>=s.length)return!1;const r=Qf(s,e);if(r<=t)return!1;const n=e+r;return n===s.length||Xl(s,n)}return!1}function jE(s,e,t,r,n){if(!s.samplerate){const i=YI(e,t,r,n);if(!i)return;Re(s,i)}}function $E(s){return 1024*9e4/s}function JI(s,e){const t=FE(s,e);if(e+t<=s.length){const r=Qf(s,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function UE(s,e,t,r,n){const i=$E(s.samplerate),a=r+n*i,o=JI(e,t);let l;if(o){const{frameLength:d,headerLength:f}=o,p=f+d,m=Math.max(0,t+p-e.length);m?(l=new Uint8Array(p-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+p);const y={unit:l,pts:a};return m||s.samples.push(y),{sample:y,length:p,missing:m}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:c,missing:-1}}function ZI(s,e){return Xf(s,e)&&kc(s,e+6)+10<=s.length-e}function ek(s){return s instanceof ArrayBuffer?s:s.byteOffset==0&&s.byteLength==s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer}function Cu(s,e=0,t=1/0){return tk(s,e,t,Uint8Array)}function tk(s,e,t,r){const n=sk(s);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const a=rk(s)?s.byteOffset:0,o=(a+s.byteLength)/i,l=(a+e)/i,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(t,0),o));return new r(n,c,u-c)}function sk(s){return s instanceof ArrayBuffer?s:s.buffer}function rk(s){return s&&s.buffer instanceof ArrayBuffer&&s.byteLength!==void 0&&s.byteOffset!==void 0}function nk(s){const e={key:s.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(s.size<2)return;if(s.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=s.data.subarray(1).indexOf(0);if(r===-1)return;const n=os(Cu(s.data,1,r)),i=s.data[2+r],a=s.data.subarray(3+r).indexOf(0);if(a===-1)return;const o=os(Cu(s.data,3+r,a));let l;return n==="-->"?l=os(Cu(s.data,4+r+a)):l=ek(s.data.subarray(4+r+a)),e.mimeType=n,e.pictureType=i,e.description=o,e.data=l,e}function ik(s){if(s.size<2)return;const e=os(s.data,!0),t=new Uint8Array(s.data.subarray(e.length+1));return{key:s.type,info:e,data:t.buffer}}function ak(s){if(s.size<2)return;if(s.type==="TXXX"){let t=1;const r=os(s.data.subarray(t),!0);t+=r.length+1;const n=os(s.data.subarray(t));return{key:s.type,info:r,data:n}}const e=os(s.data.subarray(1));return{key:s.type,info:"",data:e}}function ok(s){if(s.type==="WXXX"){if(s.size<2)return;let t=1;const r=os(s.data.subarray(t),!0);t+=r.length+1;const n=os(s.data.subarray(t));return{key:s.type,info:r,data:n}}const e=os(s.data);return{key:s.type,info:"",data:e}}function lk(s){return s.type==="PRIV"?ik(s):s.type[0]==="W"?ok(s):s.type==="APIC"?nk(s):ak(s)}function ck(s){const e=String.fromCharCode(s[0],s[1],s[2],s[3]),t=kc(s,4),r=10;return{type:e,size:t,data:s.subarray(r,r+t)}}const Ro=10,uk=10;function BE(s){let e=0;const t=[];for(;Xf(s,e);){const r=kc(s,e+6);s[e+5]>>6&1&&(e+=Ro),e+=Ro;const n=e+r;for(;e+uk<n;){const i=ck(s.subarray(e)),a=lk(i);a&&t.push(a),e+=i.size+Ro}OE(s,e)&&(e+=Ro)}return t}function VE(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"}function dk(s){if(s.data.byteLength===8){const e=new Uint8Array(s.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Jf(s){const e=BE(s);for(let t=0;t<e.length;t++){const r=e[t];if(VE(r))return dk(r)}}let rs=function(s){return s.audioId3="org.id3",s.dateRange="com.apple.quicktime.HLS",s.emsg="https://aomedia.org/emsg/ID3",s.misbklv="urn:misb:KLV:bin:1910.1",s}({});function Fs(s="",e=9e4){return{type:s,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Zf{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=ys(this.cachedData,e),this.cachedData=null);let r=Ca(e,0),n=r?r.length:0,i;const a=this._audioTrack,o=this._id3Track,l=r?Jf(r):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&ee(l))&&(this.basePTS=hk(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:rs.audioId3,duration:Number.POSITIVE_INFINITY});n<c;){if(this.canParse(e,n)){const u=this.appendFrame(a,e,n);u?(this.frameIndex++,this.lastPTS=u.sample.pts,n+=u.length,i=n):n=c}else ZI(e,n)?(r=Ca(e,n),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:rs.audioId3,duration:Number.POSITIVE_INFINITY}),n+=r.length,i=n):n++;if(n===c&&i!==c){const u=e.slice(i);this.cachedData?this.cachedData=ys(this.cachedData,u):this.cachedData=u}}return{audioTrack:a,videoTrack:Fs(),id3Track:o,textTrack:Fs()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Fs(),id3Track:this._id3Track,textTrack:Fs()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const hk=(s,e,t)=>{if(ee(s))return s*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Io=null;const fk=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],mk=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],pk=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],gk=[0,1,1,4];function GE(s,e,t,r,n){if(t+24>e.length)return;const i=HE(e,t);if(i&&t+i.frameLength<=e.length){const a=i.samplesPerFrame*9e4/i.sampleRate,o=r+n*a,l={unit:e.subarray(t,t+i.frameLength),pts:o,dts:o};return s.config=[],s.channelCount=i.channelCount,s.samplerate=i.sampleRate,s.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function HE(s,e){const t=s[e+1]>>3&3,r=s[e+1]>>1&3,n=s[e+2]>>4&15,i=s[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&i!==3){const a=s[e+2]>>1&1,o=s[e+3]>>6,l=t===3?3-r:r===3?3:4,c=fk[l*14+n-1]*1e3,d=mk[(t===3?0:t===2?1:2)*3+i],f=o===3?1:2,p=pk[t][r],m=gk[r],y=p*8*m,g=Math.floor(p*c/d+a)*m;if(Io===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Io=E?parseInt(E[1]):0}return!!Io&&Io<=87&&r===2&&c>=224e3&&o===0&&(s[e+3]=s[e+3]|128),{sampleRate:d,channelCount:f,frameLength:g,samplesPerFrame:y}}}function em(s,e){return s[e]===255&&(s[e+1]&224)===224&&(s[e+1]&6)!==0}function zE(s,e){return e+1<s.length&&em(s,e)}function yk(s,e){return em(s,e)&&4<=s.length-e}function KE(s,e){if(e+1<s.length&&em(s,e)){const r=HE(s,e);let n=4;r!=null&&r.frameLength&&(n=r.frameLength);const i=e+n;return i===s.length||zE(s,i)}return!1}class xk extends Zf{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=Ca(e,0);let n=(r==null?void 0:r.length)||0;if(KE(e,n))return!1;for(let i=e.length;n<i;n++)if(QI(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return XI(e,t)}appendFrame(e,t,r){jE(e,this.observer,t,r,e.manifestCodec);const n=UE(e,t,r,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const WE=(s,e)=>{let t=0,r=5;e+=r;const n=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=s[e];const o=Math.min(r,8),l=8-o;i[0]=4278190080>>>24+l<<l,n[0]=(a[0]&i[0])>>l,t=t?t<<o|n[0]:n[0],e+=1,r-=o}return t};class vk extends Zf{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const n=YE(e,t,r,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=Ca(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Jf(t)!==void 0&&WE(e,r)<16}}function YE(s,e,t,r,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const o=[48e3,44100,32e3][i],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+u>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const p=(e[t+6]<<8|e[t+7])>>12-f&1,y=[2,1,2,3,3,4,4,5][d]+p,g=e[t+5]>>3,x=e[t+5]&7,v=new Uint8Array([i<<6|g<<1|x>>2,(x&3)<<6|d<<3|p<<2|l>>4,l<<4&224]),E=1536/o*9e4,T=r+n*E,w=e.subarray(t,t+u);return s.config=v,s.channelCount=y,s.samplerate=o,s.samples.push({unit:w,pts:T}),u}class Ek extends Zf{resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Ca(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Jf(t)!==void 0&&WE(e,r)<=16)return!1;for(let n=e.length;r<n;r++)if(KE(e,r))return Le.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return yk(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return GE(e,t,r,this.basePTS,this.frameIndex)}}const Sk=/\/emsg[-/]ID3/i;class Tk{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,n){const i=this.videoTrack=Fs("video",1),a=this.audioTrack=Fs("audio",1),o=this.txtTrack=Fs("text",1);if(this.id3Track=Fs("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=nE(e);if(l.video){const{id:c,timescale:u,codec:d,supplemental:f}=l.video;i.id=c,i.timescale=o.timescale=u,i.codec=d,i.supplemental=f}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;a.id=c,a.timescale=u,a.codec=d}o.id=tE.text,i.sampleDuration=0,i.duration=a.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return vR(e)}demux(e,t){this.timeOffset=t;let r=e;const n=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=ys(this.remainderData,e));const o=LR(r);this.remainderData=o.remainder,n.samples=o.valid||new Uint8Array}else n.samples=r;const a=this.extractID3Track(n,t);return i.samples=vg(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return r.samples=vg(e,t),{videoTrack:t,audioTrack:Fs(),id3Track:n,textTrack:Fs()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const n=pe(e.samples,["emsg"]);n&&n.forEach(i=>{const a=RR(i);if(Sk.test(a.schemeIdUri)){const o=s0(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=a.payload;r.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:rs.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=s0(a,t);r.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:rs.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function s0(s,e){return ee(s.presentationTime)?s.presentationTime/s.timeScale:e+s.presentationTimeDelta/s.timeScale}class bk{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Hf(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Hr.cbc)}decryptAacSample(e,t,r){const n=e[t].unit;if(n.length<=16)return;const i=n.subarray(16,n.length-n.length%16),a=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);n.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let n=0;for(let i=32;i<e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let n=0;for(let i=32;i<e.length-16;i+=160,n+=16)e.set(r.subarray(n,n+16),i);return e}decryptAvcSample(e,t,r,n,i){const a=oE(i.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,n)}).catch(n)}decryptAvcSamples(e,t,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){n();return}const i=e[t].units;for(;!(r>=i.length);r++){const a=i[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,r,n,a),!this.decrypter.isSync()))return}}}}class qE{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,n;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;n=i[i.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,n=r.length;if(n){const i=r[n-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const n=t.byteLength;let i=e.naluState||0;const a=i,o=[];let l=0,c,u,d,f=-1,p=0;for(i===-1&&(f=0,p=this.getNALuType(t,0),i=0,l=1);l<n;){if(c=t[l++],!i){i=c?0:1;continue}if(i===1){i=c?0:2;continue}if(!c)i=3;else if(c===1){if(u=l-i-1,f>=0){const m={data:t.subarray(f,u),type:p};o.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(a&&l<=4-a&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-a)),u>0&&(m.data=ys(m.data,t.subarray(0,u)),m.state=0))}l<n?(d=this.getNALuType(t,l),f=l,p=d,i=0):i=-1}else i=0}if(f>=0&&i>=0){const m={data:t.subarray(f,n),type:p,state:i};o.push(m)}if(o.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=ys(m.data,t))}return e.naluState=i,o}}class aa{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Le.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class wk extends qE{parsePES(e,t,r,n){const i=this.parseNALu(e,r.data,n);let a=this.VideoSample,o,l=!1;r.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(c=>{var u,d;switch(c.type){case 1:{let y=!1;o=!0;const g=c.data;if(l&&g.length>4){const x=this.readSliceType(g);(x===2||x===4||x===7||x===9)&&(y=!0)}if(y){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.frame=!0,a.key=y;break}case 5:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Uf(c.data,1,r.pts,t.samples);break}case 7:{var p,m;o=!0,l=!0;const y=c.data,g=this.readSPS(y);if(!e.sps||e.width!==g.width||e.height!==g.height||((p=e.pixelRatio)==null?void 0:p[0])!==g.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==g.pixelRatio[1]){e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.sps=[y];const x=y.subarray(1,4);let v="avc1.";for(let E=0;E<3;E++){let T=x[E].toString(16);T.length<2&&(T="0"+T),v+=T}e.codec=v}break}case 8:o=!0,e.pps=[c.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(c)}),n&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new aa(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,n=8,i;for(let a=0;a<e;a++)n!==0&&(i=t.readEG(),n=(r+i+256)%256),r=n===0?r:n}readSPS(e){const t=new aa(e);let r=0,n=0,i=0,a=0,o,l,c;const u=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),p=t.readBoolean.bind(t),m=t.skipBits.bind(t),y=t.skipEG.bind(t),g=t.skipUEG.bind(t),x=this.skipScalingList.bind(this);u();const v=u();if(d(5),m(3),u(),g(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){const _=f();if(_===3&&m(1),g(),g(),m(1),p())for(l=_!==3?8:12,c=0;c<l;c++)p()&&(c<6?x(16,t):x(64,t))}g();const E=f();if(E===0)f();else if(E===1)for(m(1),y(),y(),o=f(),c=0;c<o;c++)y();g(),m(1);const T=f(),w=f(),R=d(1);R===0&&m(1),m(1),p()&&(r=f(),n=f(),i=f(),a=f());let b=[1,1];if(p()&&p())switch(u()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:{b=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((T+1)*16-r*2-n*2),height:(2-R)*(w+1)*16-(R?2:4)*(i+a),pixelRatio:b}}}class Ak extends qE{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,n){const i=this.parseNALu(e,r.data,n);let a=this.VideoSample,o,l=!1;r.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(c=>{var u,d;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Uf(c.data,2,r.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Re(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const p=this.readSPS(c.data);e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.codec=p.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const m in p.params)e.params[m]=p.params[m]}this.pushParameterSet(e.sps,c.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const p=this.readPPS(c.data);for(const m in p)e.params[m]=p[m]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:o=!1;break}a&&o&&a.units.push(c)}),n&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[r]=e[n],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new aa(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:n}}readSPS(e){const t=new aa(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const n=t.readBits(2),i=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),y=t.readUByte(),g=t.readUByte(),x=t.readUByte(),v=[],E=[];for(let ue=0;ue<r;ue++)v.push(t.readBoolean()),E.push(t.readBoolean());if(r>0)for(let ue=r;ue<8;ue++)t.readBits(2);for(let ue=0;ue<r;ue++)v[ue]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[ue]&&t.readUByte();t.readUEG();const T=t.readUEG();T==3&&t.skipBits(1);const w=t.readUEG(),R=t.readUEG(),b=t.readBoolean();let _=0,I=0,L=0,N=0;b&&(_+=t.readUEG(),I+=t.readUEG(),L+=t.readUEG(),N+=t.readUEG());const M=t.readUEG(),$=t.readUEG(),G=t.readUEG(),Y=t.readBoolean();for(let ue=Y?0:r;ue<=r;ue++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let me=0;me<4;me++)for(let be=0;be<(me===3?2:6);be++)if(!t.readBoolean())t.readUEG();else{const Ot=Math.min(64,1<<4+(me<<1));me>1&&t.readEG();for(let Ks=0;Ks<Ot;Ks++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const P=t.readUEG();let B=0;for(let ue=0;ue<P;ue++){let me=!1;if(ue!==0&&(me=t.readBoolean()),me){ue===P&&t.readUEG(),t.readBoolean(),t.readUEG();let be=0;for(let Et=0;Et<=B;Et++){const Ot=t.readBoolean();let Ks=!1;Ot||(Ks=t.readBoolean()),(Ot||Ks)&&be++}B=be}else{const be=t.readUEG(),Et=t.readUEG();B=be+Et;for(let Ot=0;Ot<be;Ot++)t.readUEG(),t.readBoolean();for(let Ot=0;Ot<Et;Ot++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ue=t.readUEG();for(let me=0;me<ue;me++){for(let be=0;be<G+4;be++)t.readBits(1);t.readBits(1)}}let O=0,F=1,Z=1,te=!0,z=1,Q=0;t.readBoolean(),t.readBoolean();let ge=!1;if(t.readBoolean()){if(t.readBoolean()){const Ws=t.readUByte(),_i=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],St=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ws>0&&Ws<16?(F=_i[Ws-1],Z=St[Ws-1]):Ws===255&&(F=t.readBits(16),Z=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ge=t.readBoolean(),ge&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(z=t.readBits(32),Q=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const St=t.readBoolean(),Ri=t.readBoolean();let qt=!1;(St||Ri)&&(qt=t.readBoolean(),qt&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),qt&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Ii=0;Ii<=r;Ii++){te=t.readBoolean();const eo=te||t.readBoolean();let Ys=!1;eo?t.readEG():Ys=t.readBoolean();const Xt=Ys?1:t.readUEG()+1;if(St)for(let Mt=0;Mt<Xt;Mt++)t.readUEG(),t.readUEG(),qt&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Ri)for(let Mt=0;Mt<Xt;Mt++)t.readUEG(),t.readUEG(),qt&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),O=t.readUEG())}let fe=w,X=R;if(b){let ue=1,me=1;T===1?ue=me=2:T==2&&(ue=2),fe=w-ue*I-ue*_,X=R-me*N-me*L}const Pe=n?["A","B","C"][n]:"",Ee=o<<24|l<<16|c<<8|u;let Se=0;for(let ue=0;ue<32;ue++)Se=(Se|(Ee>>ue&1)<<31-ue)>>>0;let De=Se.toString(16);return a===1&&De==="2"&&(De="6"),{codecString:`hvc1.${Pe}${a}.${De}.${i?"H":"L"}${x}.B0`,params:{general_tier_flag:i,general_profile_idc:a,general_profile_space:n,general_profile_compatibility_flags:[o,l,c,u],general_constraint_indicator_flags:[d,f,p,m,y,g],general_level_idc:x,bit_depth:M+8,bit_depth_luma_minus8:M,bit_depth_chroma_minus8:$,min_spatial_segmentation_idc:O,chroma_format_idc:T,frame_rate:{fixed:te,fps:Q/z}},width:fe,height:X,pixelRatio:[F,Z]}}readPPS(e){const t=new aa(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),i=t.readBoolean();let a=1;return i&&n?a=0:i?a=3:n&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ct=188;class wr{constructor(e,t,r,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=n,this.videoParser=null}static probe(e,t){const r=wr.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(ct*5,t-ct)+1,n=0;for(;n<r;){let i=!1,a=-1,o=0;for(let l=n;l<t;l+=ct)if(e[l]===71&&(t-l===ct||e[l+ct]===71)){if(o++,a===-1&&(a=l,a!==0&&(r=Math.min(a+ct*99,e.length-ct)+1)),i||(i=ph(e,l)===0),i&&o>1&&(a===0&&o>2||l+ct>r))return a}else{if(o)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:tE[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=wr.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=wr.createTrack("audio",n),this._id3Track=wr.createTrack("id3"),this._txtTrack=wr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,n=!1){r||(this.sampleAes=null);let i;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=a.pid,d=a.pesData,f=o.pid,p=l.pid,m=o.pesData,y=l.pesData,g=null,x=this.pmtParsed,v=this._pmtId,E=e.length;if(this.remainderData&&(e=ys(this.remainderData,e),E=e.length,this.remainderData=null),E<ct&&!n)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};const T=Math.max(0,wr.syncOffset(e));E-=(E-T)%ct,E<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let w=0;for(let b=T;b<E;b+=ct)if(e[b]===71){const _=!!(e[b+1]&64),I=ph(e,b),L=(e[b+3]&48)>>4;let N;if(L>1){if(N=b+5+e[b+4],N===b+ct)continue}else N=b+4;switch(I){case u:_&&(d&&(i=Cn(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,c,i,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(N,b+ct)),d.size+=b+ct-N);break;case f:if(_){if(m&&(i=Cn(m,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,i);break;case"mp3":this.parseMPEGPES(o,i);break;case"ac3":this.parseAC3PES(o,i);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(N,b+ct)),m.size+=b+ct-N);break;case p:_&&(y&&(i=Cn(y,this.logger))&&this.parseID3PES(l,i),y={data:[],size:0}),y&&(y.data.push(e.subarray(N,b+ct)),y.size+=b+ct-N);break;case 0:_&&(N+=e[N]+1),v=this._pmtId=Lk(e,N);break;case v:{_&&(N+=e[N]+1);const M=_k(e,N,this.typeSupported,r,this.observer,this.logger);u=M.videoPid,u>0&&(a.pid=u,a.segmentCodec=M.segmentVideoCodec),f=M.audioPid,f>0&&(o.pid=f,o.segmentCodec=M.segmentAudioCodec),p=M.id3Pid,p>0&&(l.pid=p),g!==null&&!x&&(this.logger.warn(`MPEG-TS PMT found at ${b} after unknown PID '${g}'. Backtracking to sync byte @${T} to parse all TS packets.`),g=null,b=T-188),x=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=I;break}}else w++;w>0&&gh(this.observer,new Error(`Found ${w} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=m,l.pesData=y;const R={audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};return n&&this.extractRemainingSamples(R),R}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:n,textTrack:i}=e,a=r.pesData,o=t.pesData,l=n.pesData;let c;if(a&&(c=Cn(a,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,i,c,!0),r.pesData=null)):r.pesData=a,o&&(c=Cn(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(c=Cn(l,this.logger))?(this.parseID3PES(n,c),n.pesData=null):n.pesData=l}demuxSampleAes(e,t,r){const n=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new bk(this.observer,this.config,t);return this.decrypt(n,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new wk:e==="hevc"&&(this.videoParser=new Ak))}decrypt(e,t){return new Promise(r=>{const{audioTrack:n,videoTrack:i}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const n=this.aacOverFlow;let i=t.data;if(n){this.aacOverFlow=null;const d=n.missing,f=n.sample.unit.byteLength;if(d===-1)i=ys(n.sample.unit,i);else{const p=f-d;n.sample.unit.set(i.subarray(0,d),p),e.samples.push(n.sample),r=n.missing}}let a,o;for(a=r,o=i.length;a<o-1&&!Xl(i,a);a++);if(a!==r){let d;const f=a<o-1;if(f?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",gh(this.observer,new Error(d),f,this.logger),!f)return}jE(e,this.observer,i,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(n){const d=$E(e.samplerate);l=n.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;a<o;)if(u=UE(e,i,a,l,c),a+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;a<o-1&&!Xl(i,a);a++);}parseMPEGPES(e,t){const r=t.data,n=r.length;let i=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<n;)if(zE(r,a)){const l=GE(e,r,a,o,i);if(l)a+=l.length,i++;else break}else a++}parseAC3PES(e,t){{const r=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let a=0,o=0,l;for(;o<i&&(l=YE(e,r,o,n,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=Re({},t,{type:this._videoTrack?rs.emsg:rs.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function ph(s,e){return((s[e+1]&31)<<8)+s[e+2]}function Lk(s,e){return(s[e+10]&31)<<8|s[e+11]}function _k(s,e,t,r,n,i){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(s[e+1]&15)<<8|s[e+2],l=e+3+o-4,c=(s[e+10]&15)<<8|s[e+11];for(e+=12+c;e<l;){const u=ph(s,e),d=(s[e+3]&15)<<8|s[e+4];switch(s[e]){case 207:if(!r){Pu("ADTS AAC",i);break}case 15:a.audioPid===-1&&(a.audioPid=u);break;case 21:a.id3Pid===-1&&(a.id3Pid=u);break;case 219:if(!r){Pu("H.264",i);break}case 27:a.videoPid===-1&&(a.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="mp3");break;case 193:if(!r){Pu("AC-3",i);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let f=e+5,p=d;for(;p>2;){switch(s[f]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=u,a.segmentAudioCodec="ac3");break}const y=s[f+1]+2;f+=y,p-=y}}break;case 194:case 135:return gh(n,new Error("Unsupported EC-3 in M2TS found"),void 0,i),a;case 36:a.videoPid===-1&&(a.videoPid=u,a.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=d+5}return a}function gh(s,e,t,r){r.warn(`parsing error: ${e.message}`),s.emit(S.ERROR,S.ERROR,{type:ae.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Pu(s,e){e.log(`${s} with AES-128-CBC encryption found in unencrypted stream`)}function Cn(s,e){let t=0,r,n,i,a,o;const l=s.data;if(!s||s.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=ys(l[0],l[1]),l.splice(1,1);if(r=l[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(n=(r[4]<<8)+r[5],n&&n>s.size-6)return null;const u=r[7];u&192&&(a=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,u&64?(o=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),i=r[8];let d=i+9;if(s.size<=d)return null;s.size-=d;const f=new Uint8Array(s.size);for(let p=0,m=l.length;p<m;p++){r=l[p];let y=r.byteLength;if(d)if(d>y){d-=y;continue}else r=r.subarray(d),y-=d,d=0;f.set(r,t),t+=y}return n&&(n-=i+3),{data:f,pts:a,dts:o,len:n}}return null}class Rk{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const vr=Math.pow(2,32)-1;class k{static init(){k.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in k.types)k.types.hasOwnProperty(e)&&(k.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);k.HDLR_TYPES={video:t,audio:r};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);k.STTS=k.STSC=k.STCO=i,k.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),k.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),k.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),k.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);k.FTYP=k.box(k.types.ftyp,a,l,a,o),k.DINF=k.box(k.types.dinf,k.box(k.types.dref,n))}static box(e,...t){let r=8,n=t.length;const i=n;for(;n--;)r+=t[n].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),n=0,r=8;n<i;n++)a.set(t[n],r),r+=t[n].byteLength;return a}static hdlr(e){return k.box(k.types.hdlr,k.HDLR_TYPES[e])}static mdat(e){return k.box(k.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(vr+1)),n=Math.floor(t%(vr+1));return k.box(k.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return k.box(k.types.mdia,k.mdhd(e.timescale||0,e.duration||0),k.hdlr(e.type),k.minf(e))}static mfhd(e){return k.box(k.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?k.box(k.types.minf,k.box(k.types.smhd,k.SMHD),k.DINF,k.stbl(e)):k.box(k.types.minf,k.box(k.types.vmhd,k.VMHD),k.DINF,k.stbl(e))}static moof(e,t,r){return k.box(k.types.moof,k.mfhd(e),k.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=k.trak(e[t]);return k.box.apply(null,[k.types.moov,k.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(k.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=k.trex(e[t]);return k.box.apply(null,[k.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(vr+1)),n=Math.floor(t%(vr+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return k.box(k.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let n,i;for(n=0;n<t.length;n++)i=t[n].flags,r[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return k.box(k.types.sdtp,r)}static stbl(e){return k.box(k.types.stbl,k.stsd(e),k.box(k.types.stts,k.STTS),k.box(k.types.stsc,k.STSC),k.box(k.types.stsz,k.STSZ),k.box(k.types.stco,k.STCO))}static avc1(e){let t=[],r=[],n,i,a;for(n=0;n<e.sps.length;n++)i=e.sps[n],a=i.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(i));for(n=0;n<e.pps.length;n++)i=e.pps[n],a=i.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(i));const o=k.box(k.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return k.box(k.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return k.box(k.types.mp4a,k.audioStsd(e),k.box(k.types.esds,k.esds(e)))}static mp3(e){return k.box(k.types[".mp3"],k.audioStsd(e))}static ac3(e){return k.box(k.types["ac-3"],k.audioStsd(e),k.box(k.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return k.box(k.types.stsd,k.STSD,k.mp4a(e));if(t==="ac3"&&e.config)return k.box(k.types.stsd,k.STSD,k.ac3(e));if(t==="mp3"&&e.codec==="mp3")return k.box(k.types.stsd,k.STSD,k.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return k.box(k.types.stsd,k.STSD,k.avc1(e));if(t==="hevc"&&e.vps)return k.box(k.types.stsd,k.STSD,k.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),n=e.width||0,i=e.height||0,a=Math.floor(r/(vr+1)),o=Math.floor(r%(vr+1));return k.box(k.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=k.sdtp(e),n=e.id,i=Math.floor(t/(vr+1)),a=Math.floor(t%(vr+1));return k.box(k.types.traf,k.box(k.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),k.box(k.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,a>>24,a>>16&255,a>>8&255,a&255])),k.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,k.box(k.types.trak,k.tkhd(e),k.mdia(e))}static trex(e){const t=e.id;return k.box(k.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],n=r.length,i=12+16*n,a=new Uint8Array(i);let o,l,c,u,d,f;for(t+=8+i,a.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<n;o++)l=r[o],c=l.duration,u=l.size,d=l.flags,f=l.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*o);return k.box(k.types.trun,a)}static initSegment(e){k.types||k.init();const t=k.moov(e);return ys(k.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],n=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let a=i.length;for(let m=0;m<r.length;m+=1){a+=3;for(let y=0;y<r[m].length;y+=1)a+=2+r[m][y].length}const o=new Uint8Array(a);o.set(i,0),a=i.length;const l=r.length-1;for(let m=0;m<r.length;m+=1){o.set(new Uint8Array([32+m|(m===l?128:0),0,r[m].length]),a),a+=3;for(let y=0;y<r[m].length;y+=1)o.set(new Uint8Array([r[m][y].length>>8,r[m][y].length&255]),a),a+=2,o.set(r[m][y],a),a+=r[m][y].length}const c=k.box(k.types.hvcC,o),u=e.width,d=e.height,f=e.pixelRatio[0],p=e.pixelRatio[1];return k.box(k.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,k.box(k.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),k.box(k.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,p>>24,p>>16&255,p>>8&255,p&255])))}}k.types=void 0;k.HDLR_TYPES=void 0;k.STTS=void 0;k.STSC=void 0;k.STCO=void 0;k.STSZ=void 0;k.VMHD=void 0;k.SMHD=void 0;k.STSD=void 0;k.FTYP=void 0;k.DINF=void 0;const XE=9e4;function tm(s,e,t=1,r=!1){const n=s*e*t;return r?Math.round(n):n}function Ik(s,e,t=1,r=!1){return tm(s,e,1/t,r)}function Bi(s,e=!1){return tm(s,1e3,1/XE,e)}function kk(s,e=1){return tm(s,XE,1/e)}function r0(s){const{baseTime:e,timescale:t,trackId:r}=s;return`${e/t} (${e}/${t}) trackId: ${r}`}const Ck=10*1e3,Pk=1024,Dk=1152,Nk=1536;let Pn=null,Du=null;function n0(s,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:s?2:1,isNonSync:s?0:1}}}class nl extends xs{constructor(e,t,r,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Pn===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Pn=a?parseInt(a[1]):0}if(Du===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);Du=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&r0(t)} > ${e&&r0(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,n=e.reduce((i,a)=>{let o=a.pts,l=o-i;return l<-4294967296&&(t=!0,o=ts(o,r),l=o-i),l>0?i:o},r);return t&&this.debug("PTS rollover detected"),n}remux(e,t,r,n,i,a,o,l){let c,u,d,f,p,m,y=i,g=i;const x=e.pid>-1,v=t.pid>-1,E=t.samples.length,T=e.samples.length>0,w=o&&E>0||E>1;if((!x||T)&&(!v||w)||this.ISGenerated||o){if(this.ISGenerated){var b,_,I,L;const G=this.videoTrackConfig;(G&&(t.width!==G.width||t.height!==G.height||((b=t.pixelRatio)==null?void 0:b[0])!==((_=G.pixelRatio)==null?void 0:_[0])||((I=t.pixelRatio)==null?void 0:I[1])!==((L=G.pixelRatio)==null?void 0:L[1]))||!G&&w||this.nextAudioTs===null&&T)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,i,a));const N=this.isVideoContiguous;let M=-1,$;if(w&&(M=Ok(t.samples),!N&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,M>0){this.warn(`Dropped ${M} out of ${E} video samples due to a missing keyframe`);const G=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(M),t.dropped+=M,g+=(t.samples[0].pts-G)/t.inputTimeScale,$=g}else M===-1&&(this.warn(`No keyframe found out of ${E} video samples`),m=!1);if(this.ISGenerated){if(T&&w){const G=this.getVideoStartPts(t.samples),U=(ts(e.samples[0].pts,G)-G)/t.inputTimeScale;y+=Math.max(0,U),g+=Math.max(0,-U)}if(T){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,a)),u=this.remuxAudio(e,y,this.isAudioContiguous,a,v||w||l===re.AUDIO?g:void 0),w){const G=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,a)),c=this.remuxVideo(t,g,N,G)}}else w&&(c=this.remuxVideo(t,g,N,0));c&&(c.firstKeyFrame=M,c.independent=M!==-1,c.firstKeyFramePTS=$)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(p=QE(r,i,this._initPTS,this._initDTS)),n.samples.length&&(f=JE(n,i,this._initPTS))),{audio:u,video:c,initSegment:d,independent:m,text:f,id3:p}}computeInitPts(e,t,r,n){const i=Math.round(r*t);let a=ts(e,i);if(a<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-a)/t} ${n}`);a<i+t;)a+=8589934592;return a-i}generateIS(e,t,r,n){const i=e.samples,a=t.samples,o=this.typeSupported,l={},c=this._initPTS;let u=!c||n,d="audio/mp4",f,p,m,y=-1;if(u&&(f=p=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):k.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(y=e.id,m=e.inputTimeScale,!c||m!==c.timescale?f=p=this.computeInitPts(i[0].pts,m,r,"audio"):u=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:k.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(y=t.id,m=t.inputTimeScale,!c||m!==c.timescale){const g=this.getVideoStartPts(a),x=ts(a[0].dts,g),v=this.computeInitPts(x,m,r,"video"),E=this.computeInitPts(g,m,r,"video");p=Math.min(p,v),f=Math.min(f,E)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${r} ${f/m} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${f/m} (${f}/${m}) trackId: ${y}`),this._initPTS={baseTime:f,timescale:m,trackId:y},this._initDTS={baseTime:p,timescale:m,trackId:y}):f=m=void 0,{tracks:l,initPTS:f,timescale:m,trackId:y}}remuxVideo(e,t,r,n){const i=e.inputTimeScale,a=e.samples,o=[],l=a.length,c=this._initPTS,u=c.baseTime*i/c.timescale;let d=this.nextVideoTs,f=8,p=this.videoSampleDuration,m,y,g=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,v=!1;if(!r||d===null){const O=u+t*i,F=a[0].pts-ts(a[0].dts,a[0].pts);Pn&&d!==null&&Math.abs(O-F-(d+u))<15e3?r=!0:d=O-F-u}const E=d+u;for(let O=0;O<l;O++){const F=a[O];F.pts=ts(F.pts,E),F.dts=ts(F.dts,E),F.dts<a[O>0?O-1:O].dts&&(v=!0)}v&&a.sort(function(O,F){const Z=O.dts-F.dts,te=O.pts-F.pts;return Z||te}),m=a[0].dts,y=a[a.length-1].dts;const T=y-m,w=T?Math.round(T/(l-1)):p||e.inputTimeScale/30;if(r){const O=m-E,F=O>w,Z=O<-1;if((F||Z)&&(F?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Bi(O,!0)} ms (${O}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Bi(-O,!0)} ms (${O}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Z||E>=a[0].pts||Pn)){m=E;const te=a[0].pts-O;if(F)a[0].dts=m,a[0].pts=te;else{let z=!0;for(let Q=0;Q<a.length&&!(a[Q].dts>te&&z);Q++){const ge=a[Q].pts;if(a[Q].dts-=O,a[Q].pts-=O,Q<a.length-1){const se=a[Q+1].pts,fe=a[Q].pts,X=se<=fe,Pe=se<=ge;z=X==Pe}}}this.log(`Video: Initial PTS/DTS adjusted: ${Bi(te,!0)}/${Bi(m,!0)}, delta: ${Bi(O,!0)} ms`)}}m=Math.max(0,m);let R=0,b=0,_=m;for(let O=0;O<l;O++){const F=a[O],Z=F.units,te=Z.length;let z=0;for(let Q=0;Q<te;Q++)z+=Z[Q].data.length;b+=z,R+=te,F.length=z,F.dts<_?(F.dts=_,_+=w/4|0||1):_=F.dts,g=Math.min(F.pts,g),x=Math.max(F.pts,x)}y=a[l-1].dts;const I=b+4*R+8;let L;try{L=new Uint8Array(I)}catch(O){this.observer.emit(S.ERROR,S.ERROR,{type:ae.MUX_ERROR,details:C.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:I,reason:`fail allocating video mdat ${I}`});return}const N=new DataView(L.buffer);N.setUint32(0,I),L.set(k.types.mdat,4);let M=!1,$=Number.POSITIVE_INFINITY,G=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY,U=Number.NEGATIVE_INFINITY;for(let O=0;O<l;O++){const F=a[O],Z=F.units;let te=0;for(let ge=0,se=Z.length;ge<se;ge++){const fe=Z[ge],X=fe.data,Pe=fe.data.byteLength;N.setUint32(f,Pe),f+=4,L.set(X,f),f+=Pe,te+=4+Pe}let z;if(O<l-1)p=a[O+1].dts-F.dts,z=a[O+1].pts-F.pts;else{const ge=this.config,se=O>0?F.dts-a[O-1].dts:w;if(z=O>0?F.pts-a[O-1].pts:w,ge.stretchShortVideoTrack&&this.nextAudioTs!==null){const fe=Math.floor(ge.maxBufferHole*i),X=(n?g+n*i:this.nextAudioTs+u)-F.pts;X>fe?(p=X-se,p<0?p=se:M=!0,this.log(`It is approximately ${X/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=se}else p=se}const Q=Math.round(F.pts-F.dts);$=Math.min($,p),Y=Math.max(Y,p),G=Math.min(G,z),U=Math.max(U,z),o.push(n0(F.key,p,te,Q))}if(o.length){if(Pn){if(Pn<70){const O=o[0].flags;O.dependsOn=2,O.isNonSync=0}}else if(Du&&U-G<Y-$&&w/Y<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let O=m;for(let F=0,Z=o.length;F<Z;F++){const te=O+o[F].duration,z=O+o[F].cts;if(F<Z-1){const Q=te+o[F+1].cts;o[F].duration=Q-z}else o[F].duration=F?o[F-1].duration:w;o[F].cts=0,O=te}}}p=M||!p?w:p;const W=y+p;this.nextVideoTs=d=W-u,this.videoSampleDuration=p,this.isVideoContiguous=!0;const K={data1:k.moof(e.sequenceNumber++,m,Re(e,{samples:o})),data2:L,startPTS:(g-u)/i,endPTS:(x+p-u)/i,startDTS:(m-u)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,K}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Dk;case"ac3":return Nk;default:return Pk}}remuxAudio(e,t,r,n,i){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,c=this.getSamplesPerFrame(e),u=c*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,p=[],m=i!==void 0;let y=e.samples,g=f?0:8,x=this.nextAudioTs||-1;const v=d.baseTime*a/d.timescale,E=v+t*a;if(this.isAudioContiguous=r=r||y.length&&x>0&&(n&&Math.abs(E-(x+v))<9e3||Math.abs(ts(y[0].pts,E)-(x+v))<20*u),y.forEach(function(U){U.pts=ts(U.pts,E)}),!r||x<0){const U=y.length;if(y=y.filter(W=>W.pts>=0),U!==y.length&&this.warn(`Removed ${y.length-U} of ${U} samples (initPTS ${v} / ${a})`),!y.length)return;i===0?x=0:n&&!m?x=Math.max(0,E-v):x=y[0].pts-v}if(e.segmentCodec==="aac"){const U=this.config.maxAudioFramesDrift;for(let W=0,P=x+v;W<y.length;W++){const B=y[W],K=B.pts,O=K-P,F=Math.abs(1e3*O/a);if(O<=-U*u&&m)W===0&&(this.warn(`Audio frame @ ${(K/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*O/a)} ms.`),this.nextAudioTs=x=K-v,P=K);else if(O>=U*u&&F<Ck&&m){let Z=Math.round(O/u);for(P=K-Z*u;P<0&&Z&&u;)Z--,P+=u;W===0&&(this.nextAudioTs=x=P-v),this.warn(`Injecting ${Z} audio frames @ ${((P-v)/a).toFixed(3)}s due to ${Math.round(1e3*O/a)} ms gap.`);for(let te=0;te<Z;te++){let z=Rk.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);z||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),z=B.unit.subarray()),y.splice(W,0,{unit:z,pts:P}),P+=u,W++}}B.pts=P,P+=u}}let T=null,w=null,R,b=0,_=y.length;for(;_--;)b+=y[_].unit.byteLength;for(let U=0,W=y.length;U<W;U++){const P=y[U],B=P.unit;let K=P.pts;if(w!==null){const F=p[U-1];F.duration=Math.round((K-w)/l)}else if(r&&e.segmentCodec==="aac"&&(K=x+v),T=K,b>0){b+=g;try{R=new Uint8Array(b)}catch(F){this.observer.emit(S.ERROR,S.ERROR,{type:ae.MUX_ERROR,details:C.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:b,reason:`fail allocating audio mdat ${b}`});return}f||(new DataView(R.buffer).setUint32(0,b),R.set(k.types.mdat,4))}else return;R.set(B,g);const O=B.byteLength;g+=O,p.push(n0(!0,c,O,0)),w=K}const I=p.length;if(!I)return;const L=p[p.length-1];x=w-v,this.nextAudioTs=x+l*L.duration;const N=f?new Uint8Array(0):k.moof(e.sequenceNumber++,T/l,Re({},e,{samples:p}));e.samples=[];const M=(T-v)/a,$=this.nextAudioTs/a,Y={data1:N,data2:R,startPTS:M,endPTS:$,startDTS:M,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,Y}}function ts(s,e){let t;if(e===null)return s;for(e<s?t=-8589934592:t=8589934592;Math.abs(s-e)>4294967296;)s+=t;return s}function Ok(s){for(let e=0;e<s.length;e++)if(s[e].key)return e;return-1}function QE(s,e,t,r){const n=s.samples.length;if(!n)return;const i=s.inputTimeScale;for(let o=0;o<n;o++){const l=s.samples[o];l.pts=ts(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=ts(l.dts-r.baseTime*i/r.timescale,e*i)/i}const a=s.samples;return s.samples=[],{samples:a}}function JE(s,e,t){const r=s.samples.length;if(!r)return;const n=s.inputTimeScale;for(let a=0;a<r;a++){const o=s.samples[a];o.pts=ts(o.pts-t.baseTime*n/t.timescale,e*n)/n}s.samples.sort((a,o)=>a.pts-o.pts);const i=s.samples;return s.samples=[],{samples:i}}class Mk extends xs{constructor(e,t,r,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,n){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:a}=this.initData=nE(e);if(t)bR(e,t);else{const l=i||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(r=i0(i,Ie.AUDIO,this)),a&&(n=i0(a,Ie.VIDEO,this));const o={};i&&a?o.audiovideo={container:"video/mp4",codec:r+","+n,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:i?o.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:n,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,r,n,i,a){var o,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};ee(u)||(u=this.lastEndTime=i||0);const f=t.samples;if(!f.length)return d;const p={initPTS:void 0,timescale:void 0,trackId:void 0};let m=this.initData;if((o=m)!=null&&o.length||(this.generateInitSegment(f),m=this.initData),!((l=m)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1);const y=AR(f,m,this),g=m.audio?y[m.audio.id]:null,x=m.video?y[m.video.id]:null,v=ko(x,1/0),E=ko(g,1/0),T=ko(x,0,!0),w=ko(g,0,!0);let R=i,b=0;const _=g&&(!x||!c&&E<v||c&&c.trackId===m.audio.id),I=_?g:x;if(I){const P=I.timescale,B=I.start-i*P,K=_?m.audio.id:m.video.id;R=I.start/P,b=_?w-E:T-v,(a||!c)&&(Fk(c,R,i,b)||P!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${i} ${B/P} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${R-i} (${B}/${P}) trackId: ${K}`),c=null,p.initPTS=B,p.timescale=P,p.trackId=K)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);c?(p.initPTS=c.baseTime,p.timescale=c.timescale,p.trackId=c.trackId):((!p.timescale||p.trackId===void 0||p.initPTS===void 0)&&(this.warn("Could not set initPTS"),p.initPTS=R,p.timescale=1,p.trackId=-1),this.initPTS=c={baseTime:p.initPTS,timescale:p.timescale,trackId:p.trackId});const L=R-c.baseTime/c.timescale,N=L+b;b>0?this.lastEndTime=N:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const M=!!m.audio,$=!!m.video;let G="";M&&(G+="audio"),$&&(G+="video");const Y=(m.audio?m.audio.encrypted:!1)||(m.video?m.video.encrypted:!1),U={data1:f,startPTS:L,startDTS:L,endPTS:N,endDTS:N,type:G,hasAudio:M,hasVideo:$,nb:1,dropped:0,encrypted:Y};d.audio=M&&!$?U:void 0,d.video=$?U:void 0;const W=x==null?void 0:x.sampleCount;if(W){const P=x.keyFrameIndex,B=P!==-1;U.nb=W,U.dropped=P===0||this.isVideoContiguous?0:B?P:W,U.independent=B,U.firstKeyFrame=P,B&&x.keyFrameStart&&(U.firstKeyFramePTS=(x.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(d.independent=B),this.isVideoContiguous||(this.isVideoContiguous=B),U.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${P}/${W} dropped: ${U.dropped} start: ${U.firstKeyFramePTS||"NA"}`)}return d.initSegment=p,d.id3=QE(r,i,c,c),n.samples.length&&(d.text=JE(n,i,c)),d}}function ko(s,e,t=!1){return(s==null?void 0:s.start)!==void 0?(s.start+(t?s.duration:0))/s.timescale:e}function Fk(s,e,t,r){if(s===null)return!0;const n=Math.max(r,1),i=e-s.baseTime/s.timescale;return Math.abs(i-t)>n}function i0(s,e,t){const r=s.codec;return r&&r.length>4?r:e===Ie.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?Vl(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let Zs;try{Zs=self.performance.now.bind(self.performance)}catch{Zs=Date.now}const il=[{demux:Tk,remux:Mk},{demux:wr,remux:nl},{demux:xk,remux:nl},{demux:Ek,remux:nl}];il.splice(2,0,{demux:vk,remux:nl});class a0{constructor(e,t,r,n,i,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,n){const i=r.transmuxing;i.executeStart=Zs();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;n&&(this.currentTransmuxState=n);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:f,timeOffset:p,initSegmentChange:m}=n||o,{audioCodec:y,videoCodec:g,defaultInitPts:x,duration:v,initSegmentData:E}=l,T=jk(a,t);if(T&&ii(T.method)){const _=this.getDecrypter(),I=Kf(T.method);if(_.isSync()){let L=_.softwareDecrypt(a,T.key.buffer,T.iv.buffer,I);if(r.part>-1){const M=_.flush();L=M&&M.buffer}if(!L)return i.executeEnd=Zs(),Nu(r);a=new Uint8Array(L)}else return this.asyncResult=!0,this.decryptionPromise=_.webCryptoDecrypt(a,T.key.buffer,T.iv.buffer,I).then(L=>{const N=this.push(L,null,r);return this.decryptionPromise=null,N}),this.decryptionPromise}const w=this.needsProbing(u,d);if(w){const _=this.configureTransmuxer(a);if(_)return this.logger.warn(`[transmuxer] ${_.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:ae.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,fatal:!1,error:_,reason:_.message}),i.executeEnd=Zs(),Nu(r)}(u||d||m||w)&&this.resetInitSegment(E,y,g,v,t),(u||m||w)&&this.resetInitialTimestamp(x),c||this.resetContiguity();const R=this.transmux(a,T,p,f,r);this.asyncResult=Pa(R);const b=this.currentTransmuxState;return b.contiguous=!0,b.discontinuity=!1,b.trackSwitch=!1,i.executeEnd=Zs(),R}flush(e){const t=e.transmuxing;t.executeStart=Zs();const{decrypter:r,currentTransmuxState:n,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const a=[],{timeOffset:o}=n;if(r){const d=r.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=Zs();const d=[Nu(e)];return this.asyncResult?Promise.resolve(d):d}const u=l.flush(o);return Pa(u)?(this.asyncResult=!0,u.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,u,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,r){const{audioTrack:n,videoTrack:i,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===re.MAIN?"level":"track"} ${r.level}`);const u=this.remuxer.remux(n,i,a,o,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=Zs()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,n,i){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,r,n),o.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,n,i){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,r,n,i):a=this.transmuxUnencrypted(e,r,n,i),a}transmuxUnencrypted(e,t,r,n){const{audioTrack:i,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,a,o,l,t,r,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,r,n,i){return this.demuxer.demuxSampleAes(e,t,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,n,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:n}=this;let i;for(let d=0,f=il.length;d<f;d++){var a;if((a=il[d].demux)!=null&&a.probe(e,this.logger)){i=il[d];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,c=i.remux,u=i.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(r,t,n,this.logger)),(!o||!(o instanceof u))&&(this.demuxer=new u(r,t,n,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Hf(this.config)),e}}function jk(s,e){let t=null;return s.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Nu=s=>({remuxResult:{},chunkMeta:s});function Pa(s){return"then"in s&&s.then instanceof Function}class $k{constructor(e,t,r,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=n,this.defaultInitPts=i||null}}class Uk{constructor(e,t,r,n,i,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=i,this.initSegmentChange=a}}let o0=0;class ZE{constructor(e,t,r,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=o0++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:ae.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=n;const a=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===S.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new qf,this.observer.on(S.FRAG_DECRYPTED,a),this.observer.on(S.ERROR,a);const o=Tg(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||HI()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=KI(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=zI());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:Ce(i)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new a0(this.observer,o,i,"",t,e.logger)}return}}this.transmuxer=new a0(this.observer,o,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=o0++;const t=this.hls.config,r=Tg(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:Ce(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),WI(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,n,i,a,o,l,c,u){var d,f;c.transmuxing.start=self.performance.now();const{instanceNo:p,transmuxer:m}=this,y=a?a.start:i.start,g=i.decryptdata,x=this.frag,v=!(x&&i.cc===x.cc),E=!(x&&c.level===x.level),T=x?c.sn-x.sn:-1,w=this.part?c.part-this.part.index:-1,R=T===0&&c.id>1&&c.id===(x==null?void 0:x.stats.chunkCount),b=!E&&(T===1||T===0&&(w===1||R&&w<=0)),_=self.performance.now();(E||T||i.stats.parsing.start===0)&&(i.stats.parsing.start=_),a&&(w||!b)&&(a.stats.parsing.start=_);const I=!(x&&((d=i.initSegment)==null?void 0:d.url)===((f=x.initSegment)==null?void 0:f.url)),L=new Uk(v,b,l,E,y,I);if(!b||v||I){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===re.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${v}
        trackSwitch: ${E}
        contiguous: ${b}
        accurateTimeOffset: ${l}
        timeOffset: ${y}
        initSegmentChange: ${I}`);const N=new $k(r,n,t,o,u);this.configureTransmuxer(N)}if(this.frag=i,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:p,cmd:"demux",data:e,decryptdata:g,chunkMeta:c,state:L},e instanceof ArrayBuffer?[e]:[]);else if(m){const N=m.push(e,g,c,L);Pa(N)?N.then(M=>{this.handleTransmuxComplete(M)}).catch(M=>{this.transmuxerError(M,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(N)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const n=r.flush(e);Pa(n)?n.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const l0=100;class Bk extends Yf{constructor(e,t,r){super(e,t,r,"audio-stream-controller",re.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i,trackId:a}){if(r===re.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:n,timescale:i,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${n/i} (${n}/${i}) trackId: ${a}`),this.mainAnchor=t,this.state===V.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==o)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===V.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const n=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(n==null?void 0:n.cc)===t.cc)return;const i=(n||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=pE(a,i,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===V.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=V.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(l0),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=V.IDLE):this.state=V.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case V.IDLE:this.doTickIdle();break;case V.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e==null?void 0:e[t],n=r==null?void 0:r.details;if(n&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(n))break;this.state=V.WAITING_INIT_PTS}break}case V.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case V.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:n,complete:i}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=V.FRAG_LOADING;const o=n.flush().buffer,l={frag:t,part:r,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=V.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:n,trackId:i}=this,a=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(r!=null&&r[i]))return;const o=r[i],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=V.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,Ie.AUDIO,re.AUDIO));const u=this.getFwdBufferInfo(c,re.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=V.ENDED;return}const d=u.len,f=t.maxBufferLength,p=l.fragments,m=p[0].start,y=this.getLoadPosition(),g=this.flushing?y:u.end;if(this.switchingTrack&&n){const E=y;l.PTSKnown&&E<m&&(u.end>m||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=m+.05)}if(d>=f&&!this.switchingTrack&&g<p[p.length-1].start)return;let x=this.getNextFragment(g,l);if(x&&this.isLoopLoading(x,g)&&(x=this.getNextFragmentLoopLoading(x,l,u,re.MAIN,f)),!x){this.bufferFlushed=!0;return}let v=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&Ze(x)&&!x.endList&&(!l.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===at.OK&&(this.mainFragLoading=v=null),v&&Ze(v))){if(x.start>v.end){const T=this.fragmentTracker.getFragAtPos(g,re.MAIN);T&&T.end>v.end&&(v=T,this.mainFragLoading={frag:T,targetBufferTime:null})}if(x.start>v.end)return}this.loadFragment(x,o,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Ia(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==V.STOPPED&&(this.setInterval(l0),this.state=V.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:n}=this,{details:i,id:a,groupId:o,track:l}=t;if(!n){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const c=this.mainDetails;if(!c||i.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==V.STOPPED&&(this.state=V.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const u=n[a];let d=0;if(i.live||(r=u.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(u.details){var f;d=this.alignPlaylists(i,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}i.alignedSliding||(DE(i,c),i.alignedSliding||ql(i,c),d=i.fragmentStart)}u.details=i,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,d),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:i,id:a,groupId:t.groupId}),this.state===V.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=V.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:n,payload:i}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new ZE(this.hls,re.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const p=this.initPTS[r.cc],m=(t=r.initSegment)==null?void 0:t.data;if(p!==void 0){const g=n?n.index:-1,x=g!==-1,v=new zf(r.level,r.sn,r.stats.chunkCount,i.byteLength,g,x);f.push(i,m,d,"",r,n,u.totalduration,!1,v,p)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${o}`);const{cache:y}=this.waitingData=this.waitingData||{frag:r,part:n,cache:new NE,complete:!1};y.push(new Uint8Array(i)),this.state!==V.STOPPED&&(this.state=V.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===re.MAIN&&Ze(t.frag)&&(this.mainFragLoading=t,this.state===V.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:n}=t;if(r.type!==re.AUDIO){!this.audioOnly&&r.type===re.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ze(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,Ae({},i)))}this.fragBufferedComplete(r,n),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=V.ERROR;return}switch(t.details){case C.FRAG_GAP:case C.FRAG_PARSING_ERROR:case C.FRAG_DECRYPT_ERROR:case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(re.AUDIO,t);break;case C.AUDIO_TRACK_LOAD_ERROR:case C.AUDIO_TRACK_LOAD_TIMEOUT:case C.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===V.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===ye.AUDIO_TRACK&&(this.state=V.IDLE);break;case C.BUFFER_ADD_CODEC_ERROR:case C.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case C.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case C.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ie.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ie.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===V.ENDED&&(this.state=V.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,re.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:n}=this,{remuxResult:i,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:u}=o,{details:d}=u,{audio:f,text:p,id3:m,initSegment:y}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=V.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),y!=null&&y.tracks){const g=l.initSegment||l;if(this.unhandledEncryptionError(y,l))return;this._bufferInitSegment(u,y.tracks,g,a),n.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:r,tracks:y.tracks})}if(f){const{startPTS:g,endPTS:x,startDTS:v,endDTS:E}=f;c&&(c.elementaryStreams[Ie.AUDIO]={startPTS:g,endPTS:x,startDTS:v,endDTS:E}),l.setElementaryStreamInfo(Ie.AUDIO,g,x,v,E),this.bufferFragmentData(f,l,c,a)}if(m!=null&&(t=m.samples)!=null&&t.length){const g=Re({id:r,frag:l,details:d},m);n.trigger(S.FRAG_PARSING_METADATA,g)}if(p){const g=Re({id:r,frag:l,details:d},p);n.trigger(S.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,t,r,n){if(this.state!==V.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=re.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${a}/${i.codec}]`),a&&a.split(",").length===1&&(i.levelCodec=a),this.hls.trigger(S.BUFFER_CODECS,t);const o=i.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:n,parent:r.type,data:o};this.hls.trigger(S.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===at.NOT_LOADED||n===at.PARTIAL){var i;if(!Ze(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=V.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&ql(t.details,a)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:n,characteristics:i,audioCodec:a,channels:o}=this.bufferedTrack;mn({name:t,lang:r,assocLang:n,characteristics:i,audioCodec:a,channels:o},e,rn)||(Hl(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(S.AUDIO_TRACK_SWITCHED,Ae({},e))}}class sm extends xs{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const n=t==null?void 0:t.renditionReports;if(n){let i=-1;for(let a=0;a<n.length;a++){const o=n[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=o.URI||""}if(l===e){i=a;break}else l===e.substring(0,l.length)&&(i=a)}if(i!==-1){const a=n[i],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=r&&bg(r);return new wg(o,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:n,stats:i}=t,a=self.performance.now(),o=i.loading.first?Math.max(0,a-i.loading.first):0;n.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==n.appliedTimelineOffset){const u=Math.max(l||0,0);n.appliedTimelineOffset=u,n.fragments.forEach(d=>{d.setStart(d.playlistOffset+u)})}if(n.live||r!=null&&r.live){const u="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(r),r&&n.fragments.length>0){DI(r,n,this);const v=n.playlistParsingError;if(v){this.warn(v);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var c;const{networkDetails:T}=t;E.trigger(S.ERROR,{type:ae.NETWORK_ERROR,details:C.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:v,reason:v.message,level:t.level||void 0,parent:(c=n.fragments[0])==null?void 0:c.type,networkDetails:T,stats:i});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=i.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,p=(n.edge-f)*1e3,m=RE(n,p);if(n.requestScheduled+m<a?n.requestScheduled=a:n.requestScheduled+=m,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let y,g,x;if(n.canBlockReload&&n.endSN&&n.advanced){const v=this.hls.config.lowLatencyMode,E=n.lastPartSn,T=n.endSN,w=n.lastPartIndex,R=w!==-1,b=E===T;R?b?(g=T+1,x=v?0:w):(g=E,x=v?w+1:n.maxPartIndex):g=T+1;const _=n.age,I=_+n.ageHeader;let L=Math.min(I-n.partTarget,n.targetduration*1.5);if(L>0){if(I>n.targetduration*3)this.log(`Playlist last advanced ${_.toFixed(2)}s ago. Omitting segment and part directives.`),g=void 0,x=void 0;else if(r!=null&&r.tuneInGoal&&I-n.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${L} with playlist age: ${n.age}`),L=0;else{const N=Math.floor(L/n.targetduration);if(g+=N,x!==void 0){const M=Math.round(L%n.targetduration/n.partTarget);x+=M}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${_.toFixed(2)}s goal: ${L} skip sn ${N} to part ${x}`)}n.tuneInGoal=L}if(y=this.getDeliveryDirectives(n,t.deliveryDirectives,g,x),v||!b){n.requestScheduled=a,this.loadingPlaylist(u,y);return}}else(n.canBlockReload||n.canSkipUntil)&&(y=this.getDeliveryDirectives(n,t.deliveryDirectives,g,x));y&&g!==void 0&&n.canBlockReload&&(n.requestScheduled=i.loading.first+Math.max(m-o*2,m/2)),this.scheduleLoading(u,y,n)}else this.clearTimer()}scheduleLoading(e,t,r){const n=r||e.details;if(!n){this.loadingPlaylist(e,t);return}const i=self.performance.now(),a=n.requestScheduled;if(i>=a){this.loadingPlaylist(e,t);return}const o=a-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,r,n){let i=bg(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,i=sl.No),new wg(r,n,i)}checkRetry(e){const t=e.details,r=zl(e),n=e.errorAction,{action:i,retryCount:a=0,retryConfig:o}=n||{},l=!!n&&!!o&&(i===pt.RetryRequest||!n.resolved&&i===pt.SendAlternateToPenaltyBox);if(l){var c;if(a>=o.maxNumRetry)return!1;if(r&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=Gf(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,n.resolved=!0}return l}}function eS(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(!Da(s[t].attrs,e[t].attrs))return!1;return!0}function Da(s,e,t){const r=s["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>s[n]!==e[n])}function yh(s,e){return e.label.toLowerCase()===s.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(s.lang||"").toLowerCase())}class Vk extends sm{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:n,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==n){this.warn(`Audio track with id:${r} and group:${n} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(n==null?void 0:n.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(n==null?void 0:n.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,p)=>{f.id=p});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!i&&l){const f=$s(l,o,rn);if(f>-1)i=o[f];else{const p=$s(l,this.tracks);i=this.tracks[p]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const u={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,u);const d=this.trackId;if(c!==-1&&d===-1)this.setAudioTrack(c);else if(o.length&&d===-1){var a;const f=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(f.message),this.hls.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===ye.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const n=this.currentTrack;if(n&&mn(e,n,rn))return n;const i=$s(e,this.tracksInGroup,rn);if(i>-1){const a=this.tracksInGroup[i];return this.setAudioTrack(i),a}else if(n){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=eI(e,t.levels,r,a,rn);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=$s(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e],i=n.details&&!n.details.live;if(e===this.trackId&&n===r&&i||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,Ae({},n)),i))return;const a=this.switchParams(n.url,r==null?void 0:r.details,n.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if(!(this.selectDefaultTrack&&!n.default)&&(!e||mn(e,n,rn)))return r}if(e){const{name:r,lang:n,assocLang:i,characteristics:a,audioCodec:o,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(mn({name:r,lang:n,assocLang:i,characteristics:a,audioCodec:o,channels:l},u,rn))return c}for(let c=0;c<t.length;c++){const u=t[c];if(Da(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(Da(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Hl(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,n=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:t||null,track:e})}}class Gk{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(i){var r;if(n.onError(i),this.queues===null||this.tracks===null)return;const a=(r=this.tracks[e])==null?void 0:r.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],n=r==null?void 0:r.buffer;return n?`SourceBuffer${n.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const c0=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,tS="HlsJsTrackRemovedError";class Hk extends Error{constructor(e){super(e),this.name=tS}}class zk extends xs{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:n,mediaSource:i}=this;r&&this.log("Media source opened"),!(!n||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:n,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:n}=this;r!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=fR(Gr(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const a=this.isQueued();(i||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?Re(r,n.tracks):this.sourceBuffers.forEach(i=>{const[a]=i;a&&(r[a]=Re({},this.tracks[a]),this.removeBuffer(a)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const n=Gr(this.appendSource);if(n){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(a),i)this._objectUrl=r.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&a instanceof l,u0(r),Kk(r,o),r.load()}catch{r.src=o}else r.src=o}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,n=t.tracks,i=n?Object.keys(n):null,a=i?i.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&i&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ce(r,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${Ce(n,(l,c)=>l==="initSegment"?void 0:c)}}`),!Qv(n,r)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(r)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,i.forEach(l=>{const c=l,u=n[c];if(u){const d=u.buffer;if(d){const f=this.fragmentTracker,p=u.id;if(f.hasFragments(p)||f.hasParts(p)){const g=de.getBuffered(d);f.detectEvictedFragments(c,g,p,null,!0)}const m=Ou(c),y=[c,d];this.sourceBuffers[m]=y,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:i,_objectUrl:a}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=i.readyState==="open";try{const l=i.sourceBuffers;for(let c=l.length;c--;)o&&l[c].abort(),i.removeSourceBuffer(l[c]);o&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),r||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(n.removeAttribute("src"),this.appendSource&&u0(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Ou(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Gk(this.tracks)}onBufferCodecs(e,t){var r;const n=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&i.some(l=>!n[l]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${i}" SourceBuffers`);return}i.forEach(l=>{var c,u;const d=t[l],{id:f,codec:p,levelCodec:m,container:y,metadata:g,supplemental:x}=d;let v=n[l];const E=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[l],T=E!=null&&E.buffer?E:v,w=(T==null?void 0:T.pendingCodec)||(T==null?void 0:T.codec),R=T==null?void 0:T.levelCodec;v||(v=n[l]={buffer:void 0,listeners:[],codec:p,supplemental:x,container:y,levelCodec:m,metadata:g,id:f});const b=tl(w,R),_=b==null?void 0:b.replace(c0,"$1");let I=tl(p,m);const L=(u=I)==null?void 0:u.replace(c0,"$1");I&&b&&_!==L&&(l.slice(0,5)==="audio"&&(I=Vl(I,this.appendSource)),this.log(`switching codec ${w} to ${I}`),I!==(v.pendingCodec||v.codec)&&(v.pendingCodec=I),v.container=y,this.appendChangeType(l,y,I))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const n=`${t};codecs=${r}`,i={label:`change-type=${n}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),o.changeType(n),a.codec=r,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,n=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,re.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>n||l!=null&&l.buffer&&de.isBuffered(l.buffer,n)||((o=this.fragmentTracker.getAppendedFrag(n,re.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:n,type:i,parent:a,frag:o,part:l,chunkMeta:c,offset:u}=t,d=c.buffering[i],{sn:f,cc:p}=o,m=self.performance.now();d.start=m;const y=o.stats.buffering,g=l?l.stats.buffering:null;y.start===0&&(y.start=m),g&&g.start===0&&(g.start=m);const x=r.audio;let v=!1;i==="audio"&&(x==null?void 0:x.container)==="audio/mpeg"&&(v=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const E=r.video,T=E==null?void 0:E.buffer;if(T&&f!=="initSegment"){const b=l||o,_=this.blockedAudioAppend;if(i==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(E.ending||E.ended)){const L=b.start+b.duration*.05,N=T.buffered,M=this.currentOp("video");!N.length&&!M?this.blockAudio(b):!M&&!de.isBuffered(T,L)&&this.lastVideoAppendEnd<L&&this.blockAudio(b)}else if(i==="video"){const I=b.end;if(_){const L=_.frag.start;(I>L||I<this.lastVideoAppendEnd||de.isBuffered(T,L))&&this.unblockAudio()}this.lastVideoAppendEnd=I}}const w=(l||o).start,R={label:`append-${i}`,execute:()=>{var b;d.executeStart=self.performance.now();const _=(b=this.tracks[i])==null?void 0:b.buffer;_&&(v?this.updateTimestampOffset(_,w,.1,i,f,p):u!==void 0&&ee(u)&&this.updateTimestampOffset(_,u,1e-6,i,f,p)),this.appendExecutor(n,i)},onStart:()=>{},onComplete:()=>{const b=self.performance.now();d.executeEnd=d.end=b,y.first===0&&(y.first=b),g&&g.first===0&&(g.first=b);const _={};this.sourceBuffers.forEach(([I,L])=>{I&&(_[I]=de.getBuffered(L))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:i,frag:o,part:l,chunkMeta:c,parent:o.type,timeRanges:_})},onError:b=>{var _;const I={type:ae.MEDIA_ERROR,parent:o.type,details:C.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:o,part:l,chunkMeta:c,error:b,err:b,fatal:!1},L=(_=this.media)==null?void 0:_.error;if(b.code===DOMException.QUOTA_EXCEEDED_ERR||b.name=="QuotaExceededError"||"quota"in b)I.details=C.BUFFER_FULL_ERROR;else if(b.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!L)I.errorAction=ni(!0);else if(b.name===tS&&this.sourceBufferCount===0)I.errorAction=ni(!0);else{const N=++this.appendErrors[i];this.warn(`Failed ${N}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${L||"no media error"})`),(N>=this.hls.config.appendErrorMaxRetry||L)&&(I.fatal=!0)}this.hls.trigger(S.ERROR,I)}};this.log(`queuing "${i}" append sn: ${f}${l?" p: "+l.index:""} of ${o.type===re.MAIN?"level":"track"} ${o.level} cc: ${p}`),this.append(R,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:r,startOffset:n,endOffset:i}=t;r?this.append(this.getFlushOp(r,n,i),r):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,n,i),a)})}onFragParsed(e,t){const{frag:r,part:n}=t,i=[],a=n?n.elementaryStreams:r.elementaryStreams;a[Ie.AUDIOVIDEO]?i.push("audiovideo"):(a[Ie.AUDIO]&&i.push("audio"),a[Ie.VIDEO]&&i.push("video"));const o=()=>{const l=self.performance.now();r.stats.buffering.end=l,n&&(n.stats.buffering.end=l);const c=n?n.stats:r.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:r,part:n,stats:c,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(o,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const n=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===C.BUFFER_APPEND_ERROR&&t.frag){var r;const n=(r=t.errorAction)==null?void 0:r.nextAutoLevel;ee(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const n=e.config,i=r.currentTime,a=t.levelTargetDuration,o=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(ee(o)&&o>=0){const c=Math.max(o,a),u=Math.floor(i/a)*a-c;this.flushBackBuffer(i,a,u)}const l=n.frontBufferFlushThreshold;if(ee(l)&&l>0){const c=Math.max(n.maxBufferLength,l),u=Math.max(c,a),d=Math.floor(i/a)*a+u;this.flushFrontBuffer(i,a,d)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([n,i])=>{if(i){const o=de.getBuffered(i);if(o.length>0&&r>o.start(0)){var a;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:r});const l=this.tracks[n];if((a=this.details)!=null&&a.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l!=null&&l.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:n})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([n,i])=>{if(i){const a=de.getBuffered(i),o=a.length;if(o<2)return;const l=a.start(o-1),c=a.end(o-1);if(r>l||e>=l&&e<=c)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,n);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return ee(i)?{duration:i}:null;const a=this.media.duration,o=ee(r.duration)?r.duration:0;return n>o&&n>a||!ee(a)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:r}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(ee(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${r}.`),n.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ce(r)}`),this.tracksReady){var n;const i=(n=this.transferData)==null?void 0:n.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const n=this.tracks[t];e[t]={buffer:r,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const a=i,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),c=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(a)?" Queued":""} ${Ce(o)}`);try{const u=r.addSourceBuffer(c),d=Ou(a),f=[a,u];t[d]=f,o.buffer=u}catch(u){var n;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(a),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[a],this.hls.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:a,mimeType:c,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let n=e.codec;r&&(t==="video"||t==="audiovideo")&&_a(r,"video")&&(n=OR(n,r));const i=tl(n,e.levelCodec);return i?t.slice(0,5)==="audio"?Vl(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${n}`,t),this.hls.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const i=this.currentOp(e);i&&i.onError(n)}updateTimestampOffset(e,t,r,n,i,a){const o=t-e.timestampOffset;Math.abs(o)>=r&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:n,mediaSource:i}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!n||!i||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=ee(n.duration)?n.duration:1/0,c=ee(i.duration)?i.duration:1/0,u=Math.max(0,t),d=Math.min(r,l,c);d>u&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${u},${d}] from the ${e} SourceBuffer`),o.remove(u,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],n=r==null?void 0:r.buffer;if(!n)throw new Hk(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,n=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(a=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const n=(r=this.tracks[t])==null?void 0:r.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const n=this.tracks[e];if(!n)return;const i=n.buffer;if(!i)return;const a=r.bind(this,e);n.listeners.push({event:t,listener:a}),i.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(n=>{r.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function u0(s){const e=s.querySelectorAll("source");[].slice.call(e).forEach(t=>{s.removeChild(t)})}function Kk(s,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,s.appendChild(t)}function Ou(s){return s==="audio"?1:0}class rm{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ee(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((n,i)=>this.isLevelAllowed(n)&&i<=e);return this.clientRect=null,rm.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const n=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let i=e.length-1;const a=Math.max(t,r);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&n(l,e[o+1])){i=o;break}}return i}}const Wk={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ft=Wk,Yk={HLS:"h"},qk=Yk;class Hs{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Hs?r:new Hs(r))),this.value=e,this.params=t}}const Xk="Dict";function Qk(s){return Array.isArray(s)?JSON.stringify(s):s instanceof Map?"Map{}":s instanceof Set?"Set{}":typeof s=="object"?JSON.stringify(s):String(s)}function Jk(s,e,t,r){return new Error(`failed to ${s} "${Qk(e)}" as ${t}`,{cause:r})}function zs(s,e,t){return Jk("serialize",s,e,t)}class sS{constructor(e){this.description=e}}const d0="Bare Item",Zk="Boolean";function eC(s){if(typeof s!="boolean")throw zs(s,Zk);return s?"?1":"?0"}function tC(s){return btoa(String.fromCharCode(...s))}const sC="Byte Sequence";function rC(s){if(ArrayBuffer.isView(s)===!1)throw zs(s,sC);return`:${tC(s)}:`}const nC="Integer";function iC(s){return s<-999999999999999||999999999999999<s}function rS(s){if(iC(s))throw zs(s,nC);return s.toString()}function aC(s){return`@${rS(s.getTime()/1e3)}`}function nS(s,e){if(s<0)return-nS(-s,e);const t=Math.pow(10,e);if(Math.abs(s*t%1-.5)<Number.EPSILON){const n=Math.floor(s*t);return(n%2===0?n:n+1)/t}else return Math.round(s*t)/t}const oC="Decimal";function lC(s){const e=nS(s,3);if(Math.floor(Math.abs(e)).toString().length>12)throw zs(s,oC);const t=e.toString();return t.includes(".")?t:`${t}.0`}const cC="String",uC=/[\x00-\x1f\x7f]+/;function dC(s){if(uC.test(s))throw zs(s,cC);return`"${s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function hC(s){return s.description||s.toString().slice(7,-1)}const fC="Token";function h0(s){const e=hC(s);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw zs(e,fC);return e}function xh(s){switch(typeof s){case"number":if(!ee(s))throw zs(s,d0);return Number.isInteger(s)?rS(s):lC(s);case"string":return dC(s);case"symbol":return h0(s);case"boolean":return eC(s);case"object":if(s instanceof Date)return aC(s);if(s instanceof Uint8Array)return rC(s);if(s instanceof sS)return h0(s);default:throw zs(s,d0)}}const mC="Key";function vh(s){if(/^[a-z*][a-z0-9\-_.*]*$/.test(s)===!1)throw zs(s,mC);return s}function nm(s){return s==null?"":Object.entries(s).map(([e,t])=>t===!0?`;${vh(e)}`:`;${vh(e)}=${xh(t)}`).join("")}function iS(s){return s instanceof Hs?`${xh(s.value)}${nm(s.params)}`:xh(s)}function pC(s){return`(${s.value.map(iS).join(" ")})${nm(s.params)}`}function gC(s,e={whitespace:!0}){if(typeof s!="object"||s==null)throw zs(s,Xk);const t=s instanceof Map?s.entries():Object.entries(s),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([n,i])=>{i instanceof Hs||(i=new Hs(i));let a=vh(n);return i.value===!0?a+=nm(i.params):(a+="=",Array.isArray(i.value)?a+=pC(i):a+=iS(i)),a}).join(`,${r}`)}function aS(s,e){return gC(s,e)}const Ds="CMCD-Object",We="CMCD-Request",Zr="CMCD-Session",Er="CMCD-Status",yC={br:Ds,ab:Ds,d:Ds,ot:Ds,tb:Ds,tpb:Ds,lb:Ds,tab:Ds,lab:Ds,url:Ds,pb:We,bl:We,tbl:We,dl:We,ltc:We,mtp:We,nor:We,nrr:We,rc:We,sn:We,sta:We,su:We,ttfb:We,ttfbb:We,ttlb:We,cmsdd:We,cmsds:We,smrt:We,df:We,cs:We,ts:We,cid:Zr,pr:Zr,sf:Zr,sid:Zr,st:Zr,v:Zr,msd:Zr,bs:Er,bsd:Er,cdn:Er,rtp:Er,bg:Er,pt:Er,ec:Er,e:Er},xC={REQUEST:We};function vC(s){return Object.keys(s).reduce((e,t)=>{var r;return(r=s[t])===null||r===void 0||r.forEach(n=>e[n]=t),e},{})}function EC(s,e){const t={};if(!s)return t;const r=Object.keys(s),n=e?vC(e):{};return r.reduce((i,a)=>{var o;const l=yC[a]||n[a]||xC.REQUEST,c=(o=i[l])!==null&&o!==void 0?o:i[l]={};return c[a]=s[a],i},t)}function SC(s){return["ot","sf","st","e","sta"].includes(s)}function TC(s){return typeof s=="number"?ee(s):s!=null&&s!==""&&s!==!1}const oS="event";function bC(s,e){const t=new URL(s),r=new URL(e);if(t.origin!==r.origin)return s;const n=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;n[0]===i[0];)n.shift(),i.shift();for(;i.length;)i.shift(),n.unshift("..");return n.join("/")+t.search+t.hash}const al=s=>Math.round(s),Eh=(s,e)=>Array.isArray(s)?s.map(t=>Eh(t,e)):s instanceof Hs&&typeof s.value=="string"?new Hs(Eh(s.value,e),s.params):(e.baseUrl&&(s=bC(s,e.baseUrl)),e.version===1?encodeURIComponent(s):s),Co=s=>al(s/100)*100,wC=(s,e)=>{let t=s;return e.version>=2&&(s instanceof Hs&&typeof s.value=="string"?t=new Hs([s]):typeof s=="string"&&(t=[s])),Eh(t,e)},AC={br:al,d:al,bl:Co,dl:Co,mtp:Co,nor:wC,rtp:Co,tb:al},lS="request",cS="response",im=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],LC=["e"],_C=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Cc(s){return _C.test(s)}function RC(s){return im.includes(s)||LC.includes(s)||Cc(s)}const uS=["d","dl","nor","ot","rtp","su"];function IC(s){return im.includes(s)||uS.includes(s)||Cc(s)}const kC=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function CC(s){return im.includes(s)||uS.includes(s)||kC.includes(s)||Cc(s)}const PC=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function DC(s){return PC.includes(s)||Cc(s)}const NC={[cS]:CC,[oS]:RC,[lS]:IC};function dS(s,e={}){const t={};if(s==null||typeof s!="object")return t;const r=e.version||s.v||1,n=e.reportingMode||lS,i=r===1?DC:NC[n];let a=Object.keys(s).filter(i);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=n===cS||n===oS;l&&!a.includes("ts")&&a.push("ts"),r>1&&!a.includes("v")&&a.push("v");const c=Re({},AC,e.formatters),u={version:r,reportingMode:n,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let f=s[d];const p=c[d];if(typeof p=="function"&&(f=p(f,u)),d==="v"){if(r===1)return;f=r}d=="pr"&&f===1||(l&&d==="ts"&&!ee(f)&&(f=Date.now()),TC(f)&&(SC(d)&&typeof f=="string"&&(f=new sS(f)),t[d]=f))}),t}function OC(s,e={}){const t={};if(!s)return t;const r=dS(s,e),n=EC(r,e==null?void 0:e.customHeaderMap);return Object.entries(n).reduce((i,[a,o])=>{const l=aS(o,{whitespace:!1});return l&&(i[a]=l),i},t)}function MC(s,e,t){return Re(s,OC(e,t))}const FC="CMCD";function jC(s,e={}){return s?aS(dS(s,e),{whitespace:!1}):""}function $C(s,e={}){if(!s)return"";const t=jC(s,e);return encodeURIComponent(t)}function UC(s,e={}){if(!s)return"";const t=$C(s,e);return`${FC}=${t}`}const f0=/CMCD=[^&#]+/;function BC(s,e,t){const r=UC(e,t);if(!r)return s;if(f0.test(s))return s.replace(f0,r);const n=s.includes("?")?"&":"?";return`${s}${n}${r}`}class VC{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:Ft.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=n=>{try{const{frag:i,part:a}=n,o=this.hls.levels[i.level],l=this.getObjectType(i),c={d:(a||i).duration*1e3,ot:l};(l===Ft.VIDEO||l===Ft.AUDIO||l==Ft.MUXED)&&(c.br=o.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=a?this.getNextPart(a):this.getNextFrag(i);u!=null&&u.url&&u.url!==i.url&&(c.nor=u.url),this.apply(n,c)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,n;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:qk.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Re(t,this.createData());const r=t.ot===Ft.INIT||t.ot===Ft.VIDEO||t.ot===Ft.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((a,o)=>(n.includes(o)&&(a[o]=t[o]),a),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),MC(e.headers,t,i)):e.url=BC(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const n=e.sn-r.startSN;return r.fragments[n+1]}}getNextPart(e){var t;const{index:r,fragment:n}=e,i=(t=this.hls.levels[n.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:a}=n;for(let o=i.length-1;o>=0;o--){const l=i[o];if(l.index===r&&l.fragment.sn===a)return i[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ft.TIMED_TEXT;if(e.sn==="initSegment")return Ft.INIT;if(t==="audio")return Ft.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ft.VIDEO:Ft.MUXED}getTopBandwidth(e){let t=0,r;const n=this.hls;if(e===Ft.AUDIO)r=n.audioTracks;else{const i=n.maxAutoLevel,a=i>-1?i+1:n.levels.length;r=n.levels.slice(0,a)}return r.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===Ft.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:de.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,a,o){t(i),this.loader.load(i,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,a,o){t(i),this.loader.load(i,a,o)}}}}const GC=3e5;class HC extends xs{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===pt.SendAlternateToPenaltyBox&&r.flags===es.MoveAllAlternatesMatchingHost){const n=this.levels;let i=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:c}=t.context;o&&n?a=this.getPathwayForGroupId(o,c,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!i&&n&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==a),t.details===C.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${n&&n.length} priorities: ${Ce(i)} penalized: ${Ce(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach(i=>{n-r[i]>GC&&delete r[i]});for(let i=0;i<e.length;i++){const a=e[i];if(a in r)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,CE(t),this.hls.trigger(S.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,r){const n=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<n.length;i++)if(t===ye.AUDIO_TRACK&&n[i].hasAudioGroup(e)||t===ye.SUBTITLE_TRACK&&n[i].hasSubtitleGroup(e))return n[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},n={};e.forEach(i=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=i;if(t.some(u=>u.pathwayId===a))return;const c=this.getLevelsForPathway(o).map(u=>{const d=new $e(u.attrs);d["PATHWAY-ID"]=a;const f=d.AUDIO&&`${d.AUDIO}_clone_${a}`,p=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),p&&(n[d.SUBTITLES]=p,d.SUBTITLES=p);const m=hS(u.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),y=new Ia({attrs:d,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:m,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let g=1;g<u.audioGroups.length;g++)y.addGroupId("audio",`${u.audioGroups[g]}_clone_${a}`);if(u.subtitleGroups)for(let g=1;g<u.subtitleGroups.length;g++)y.addGroupId("text",`${u.subtitleGroups[g]}_clone_${a}`);return y});t.push(...c),m0(this.audioTracks,r,l,a),m0(this.subtitleTracks,n,l,a)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+u)}const i={responseType:"json",url:n.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(u,d,f,p)=>{this.log(`Loaded steering manifest: "${n}"`);const m=u.data;if((m==null?void 0:m.VERSION)!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":y,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":x}=m;if(y)try{this.uri=new self.URL(y,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${y}`);return}this.scheduleRefresh(this.uri||f.url),g&&this.clonePathways(g);const v={steeringManifest:m,url:n.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,v),x&&this.updatePathwayPriority(x)},onError:(u,d,f,p)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let m=this.timeToLoad*1e3;if(u.code===429){const y=this.loader;if(typeof(y==null?void 0:y.getResponseHeader)=="function"){const g=y.getResponseHeader("Retry-After");g&&(m=parseFloat(g)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,m)},onTimeout:(u,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(i,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const n=(r=this.hls)==null?void 0:r.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function m0(s,e,t,r){s&&Object.keys(e).forEach(n=>{const i=s.filter(a=>a.groupId===n).map(a=>{const o=Re({},a);return o.details=void 0,o.attrs=new $e(o.attrs),o.url=o.attrs.URI=hS(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[n],o.attrs["PATHWAY-ID"]=r,o});s.push(...i)})}function hS(s,e,t,r){const{HOST:n,PARAMS:i,[t]:a}=r;let o;e&&(o=a==null?void 0:a[e],o&&(s=o));const l=new self.URL(s);return n&&!o&&(l.host=n),i&&Object.keys(i).sort().forEach(c=>{c&&l.searchParams.set(c,i[c])}),l.href}class ai extends xs{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=ai.CDMCleanupPromise?[ai.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:n}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),n!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Yi(this.config));const o=a.map(_u).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=rl(a);if(r!=="sinf"||o!==Be.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${o}`);return}let l;try{const p=nt(new Uint8Array(n)),m=Wf(JSON.parse(p).sinf),y=aE(m);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(y.subarray(8,24))}catch(p){this.warn(`${i} Failed to parse sinf: ${p}`);return}const c=gt(l),{keyIdToKeySessionPromise:u,mediaKeySessions:d}=this;let f=u[c];for(let p=0;p<d.length;p++){const m=d[p],y=m.decryptdata;if(!y.keyId)continue;const g=gt(y.keyId);if(Wl(l,y.keyId)||y.uri.replace(/-/g,"").indexOf(c)!==-1){if(f=u[g],!f)continue;if(y.pssh)break;delete u[g],y.pssh=new Uint8Array(n),y.keyId=l,f=u[c]=f.then(()=>this.generateRequestWithPreferredKeySession(m,r,n,"encrypted-event-key-match")),f.catch(x=>this.handleError(x));break}}f||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,n=t==null?void 0:t[e];if(n)return n.licenseUrl;if(e===Be.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t==null?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(a,o,l)=>!!a&&l.indexOf(a)===o,n=t.map(a=>a.audioCodec).filter(r),i=t.map(a=>a.videoCodec).filter(r);return n.length+i.length===0&&i.push("avc1.42e01e"),new Promise((a,o)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,n,i).then(d=>a({keySystem:u,mediaKeys:d})).catch(d=>{c.length?l(c):d instanceof Zt?o(d):o(new Zt({type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${r}`;return bE===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return r(e,t)}getMediaKeysPromise(e,t,r){var n;const i=wI(e,t,r,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(n=a)==null?void 0:n.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ce(i)}`),o=this.requestMediaKeySystemAccess(e,i);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),o.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=c.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,u.then(p=>p?this.setMediaKeysServerCertificate(f,e,p):f)));return d.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),d})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${gt(e.keyId||[])} keyUri: ${e.uri}`);const n=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),n=Po(t),i="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${gt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>_u(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const i=_u(n);i?t(i):r(new Error(`Unable to find format for key-system "${n}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Yi(this.config),r=e.map(rl).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const n=zC(e,t[r]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,r=Po(t),n=this.bannedKeyIds[r];if(n||this.getKeyStatus(t)==="internal-error"){const o=p0(n||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const a=this.keyIdToKeySessionPromise[r];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,u,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[r]=o,o}return a.catch(o=>{if(o instanceof Zt){const l=Ae({},o.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const c=new Zt(l,o.message);this.handleError(c,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Zt){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${gt(r.keyId||[])})`:""}`),this.hls.trigger(S.ERROR,e.data)}else this.error(e.message),this.hls.trigger(S.ERROR,{type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Po(e),r=this.keyIdToKeySessionPromise[t];if(!r){const n=rl(e.keyFormat),i=n?[n]:Yi(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Yi(this.config)),e.length===0)throw new Zt({type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ce({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,n){var i;const a=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(a)try{const m=a.call(this.hls,t,r,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");t=m.initDataType,r=m.initData?m.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(m){if(this.warn(m.message),this.hls&&this.hls.config.debug)throw m}if(r===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const o=Po(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${n}" keyId: ${o} URI: ${l} (init data type: ${t} length: ${r.byteLength})`);const c=new qf,u=e._onmessage=m=>{const y=e.mediaKeysSession;if(!y){c.emit("error",new Error("invalid state"));return}const{messageType:g,message:x}=m;this.log(`"${g}" message event for session "${y.sessionId}" message size: ${x.byteLength}`),g==="license-request"||g==="license-renewal"?this.renewLicense(e,x).catch(v=>{c.eventNames().length?c.emit("error",v):this.handleError(v)}):g==="license-release"?e.keySystem===Be.FAIRPLAY&&this.updateKeySession(e,hh("acknowledged")).then(()=>this.removeSession(e)).catch(v=>this.handleError(v)):this.warn(`unhandled media key message type "${g}"`)},d=(m,y)=>{y.keyStatus=m;let g;m.startsWith("usable")?c.emit("resolved"):m==="internal-error"||m==="output-restricted"||m==="output-downscaled"?g=p0(m,y.decryptdata):m==="expired"?g=new Error(`key expired (keyId: ${o})`):m==="released"?g=new Error("key released"):m==="status-pending"||this.warn(`unhandled key status change "${m}" (keyId: ${o})`),g&&(c.eventNames().length?c.emit("error",g):this.handleError(g))},f=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const g=this.getKeyStatuses(e);if(!Object.keys(g).some(T=>g[T]!=="status-pending"))return;if(g[o]==="expired"){this.log(`Expired key ${Ce(g)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let v=g[o];if(v)d(v,e);else{var E;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(E=e.keyStatusTimeouts)[o]||(E[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const w=this.getKeyStatus(e.decryptdata);if(w&&w!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${w} from other session.`),d(w,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),v="internal-error",d(v,e)},1e3)),this.log(`No status for keyId ${o} (${Ce(g)}).`)}};Ct(e.mediaKeysSession,"message",u),Ct(e.mediaKeysSession,"keystatuseschange",f);const p=new Promise((m,y)=>{c.on("error",y),c.on("resolved",m)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${l}`)}).catch(m=>{throw new Zt({type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_NO_SESSION,error:m,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>p).catch(m=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw m}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,n)=>{if(typeof n=="string"&&typeof r=="object"){const o=n;n=r,r=o}const i="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);if(e.keySystem===Be.PLAYREADY&&i.length===16){const o=gt(i);t[o]=r,SE(i)}const a=gt(i);r==="internal-error"&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,n=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:i},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,p,m,y)=>{a(f.data)},onError:(f,p,m,y)=>{o(new Zt({type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:Ae({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${i}). Status: ${f.code} (${f.text})`))},onTimeout:(f,p,m)=>{o(new Zt({type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(f,p,m)=>{o(new Error("aborted"))}};n.load(l,u,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((n,i)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),n(e)}).catch(a=>{i(new Zt({type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(n=>{throw new Zt({type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:n,fatal:!1},n.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(r,"application/xml"),i=n.querySelectorAll("HttpHeader");if(i.length>0){let u;for(let d=0,f=i.length;d<f;d++){var a,o;u=i[d];const p=(a=u.querySelector("name"))==null?void 0:a.textContent,m=(o=u.querySelector("value"))==null?void 0:o.textContent;p&&m&&e.setRequestHeader(p,m)}}const l=n.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return hh(atob(c))}setupLicenseXHR(e,t,r,n){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,n)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),i.call(this.hls,e,t,r,n)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((n,i)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,a,e)}catch(u){this.error(u)}n(l)}else{const l=r.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)i(new Zt({type:ae.KEY_SYSTEM_ERROR,details:C.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(n,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==Be.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,Ct(r,"encrypted",this.onMediaEncrypted),Ct(r,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(Gt(e,"encrypted",this.onMediaEncrypted),Gt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ur.clearKeyUriToKeyIdMap();const i=n.length;ai.CDMCleanupPromise=Promise.all(n.map(a=>this.removeSession(a)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(S.ERROR,{type:ae.OTHER_ERROR,details:C.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(S.ERROR,{type:ae.OTHER_ERROR,details:C.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((n,i)=>(n.indexOf(i.keyFormat)===-1&&n.push(i.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:n}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${gt((n==null?void 0:n.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(c=>self.clearTimeout(a[c]));const{drmSystemOptions:o}=this.config;return(LI(o)?new Promise((c,u)=>{self.setTimeout(()=>u(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(u)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(S.ERROR,{type:ae.OTHER_ERROR,details:C.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(S.ERROR,{type:ae.OTHER_ERROR,details:C.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}ai.CDMCleanupPromise=void 0;function Po(s){if(!s)throw new Error("Could not read keyId of undefined decryptdata");if(s.keyId===null)throw new Error("keyId is null");return gt(s.keyId)}function zC(s,e){if(s.keyId&&e.mediaKeysSession.keyStatuses.has(s.keyId))return e.mediaKeysSession.keyStatuses.get(s.keyId);if(s.matches(e.decryptdata))return e.keyStatus}class Zt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function p0(s,e){const t=s==="output-restricted",r=t?C.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:C.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Zt({type:ae.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${s}"`)}class KC{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const n=performance.now();if(t){if(this.lastTime){const i=n-this.lastTime,a=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/i,c=this.hls;if(c.trigger(S.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),l>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function fS(s,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=s,e.dispatchEvent(t)}function mS(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(e.id))try{if(s.addCue(e),!s.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Le.debug(`[texttrack-utils]: ${r}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,s.addCue(n)}catch(n){Le.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(s.mode=t)}function Xn(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues)for(let r=s.cues.length;r--;)e&&s.cues[r].removeEventListener("enter",e),s.removeCue(s.cues[r]);t==="disabled"&&(s.mode=t)}function Sh(s,e,t,r){const n=s.mode;if(n==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0){const i=YC(s.cues,e,t);for(let a=0;a<i.length;a++)(!r||r(i[a]))&&s.removeCue(i[a])}n==="disabled"&&(s.mode=n)}function WC(s,e){if(e<=s[0].startTime)return 0;const t=s.length-1;if(e>s[t].endTime)return-1;let r=0,n=t,i;for(;r<=n;)if(i=Math.floor((n+r)/2),e<s[i].startTime)n=i-1;else if(e>s[i].startTime&&r<t)r=i+1;else return i;return s[r].startTime-e<e-s[n].startTime?r:n}function YC(s,e,t){const r=[],n=WC(s,e);if(n>-1)for(let i=n,a=s.length;i<a;i++){const o=s[i];if(o.startTime>=e&&o.endTime<=t)r.push(o);else if(o.startTime>t)return r}return r}function ol(s){const e=[];for(let t=0;t<s.length;t++){const r=s[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(s[t])}return e}class qC extends sm{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=ol(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;ol(r.textTracks).forEach(a=>{Xn(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:n,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==n){this.warn(`Subtitle track with id:${r} and group:${n} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(n==null?void 0:n.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(n==null?void 0:n.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(u=>!r||r.indexOf(u.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(u=>u.default)&&(this.selectDefaultTrack=!1),a.forEach((u,d)=>{u.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!i&&o){this.selectDefaultTrack=!1;const u=$s(o,a);if(u>-1)i=a[u];else{const d=$s(o,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const i=t[n];if(!(r&&!i.default||!r&&!e)&&(!e||mn(i,e)))return n}if(e){for(let n=0;n<t.length;n++){const i=t[n];if(Da(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const i=t[n];if(Da(e.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if(yh(n,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ye.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&mn(e,r))return r;const n=$s(e,this.tracksInGroup);if(n>-1){const i=this.tracksInGroup[n];return this.setSubtitleTrack(n),i}else{if(r)return null;{const i=$s(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,n=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=ol(e.textTracks),r=this.currentTrack;let n;if(r&&(n=t.filter(i=>yh(r,i))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==n&&(i.mode="disabled")}),n){const i=this.subtitleDisplay?"showing":"hidden";n.mode!==i&&(n.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ee(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!n.details&&!n.details.live;if(e===this.trackId&&n===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:a,groupId:o="",name:l,type:c,url:u}=n;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:c,url:u});const d=this.switchParams(n.url,r==null?void 0:r.details,n.details);this.loadPlaylist(d)}}function XC(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?i:i&3|8).toString(16)})}}}function oa(s){let e=5381,t=s.length;for(;t;)e=e*33^s.charCodeAt(--t);return(e>>>0).toString()}const oi=.025;let Ql=function(s){return s[s.Point=0]="Point",s[s.Range=1]="Range",s}({});function QC(s,e,t){return`${s.identifier}-${t+1}-${oa(e)}`}class JC{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Mu(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Mu(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ee(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Mu(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<oi))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Ql.Range:Ql.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return ZC(this)}}function Mu(s,e){return s-e.start<e.duration/2&&!(Math.abs(s-(e.start+e.duration))<oi)?e.start:e.start+e.duration}function pS(s,e,t){const r=new self.URL(s,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function Fu(s,e){for(;(t=s.assetList[++e])!=null&&t.error;)var t;return e}function ZC(s){return`["${s.identifier}" ${s.cue.pre?"<pre>":s.cue.post?"<post>":""}${s.timelineStart.toFixed(2)}-${s.resumeTime.toFixed(2)}]`}function On(s){const e=s.timelineStart,t=s.duration||0;return`["${s.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class eP{constructor(e,t,r,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=n;const a=()=>{this.hasDetails=!0};i.once(S.LEVEL_LOADED,a),i.once(S.AUDIO_TRACK_LOADED,a),i.once(S.SUBTITLE_TRACK_LOADED,a),i.on(S.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(S.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,i.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=pS(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,i=de.bufferInfo(e,n,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=de.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var n;(n=this.hls)==null||n.on(e,t)}once(e,t,r){var n;(n=this.hls)==null||n.once(e,t)}off(e,t,r){var n;(n=this.hls)==null||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${On(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const g0=.033;class tP extends xs{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=n[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let n=0;n<r.length;n++){let i=r[n];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return n}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let n=e;n<=t&&r[n];n++){const i=r[n].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var r;if(((r=t[n].event)==null?void 0:r.identifier)===e)return n}return-1}findAssetIndex(e,t){const r=e.assetList,n=r.length;if(n>1)for(let i=0;i<n;i++){const a=r[i];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||i===n-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,n=r[r.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:n}=r,i=this.events,a=this.parseDateRanges(n,{url:r.url},t),o=Object.keys(n),l=i?i.filter(c=>!o.includes(c.identifier)):[];a.length&&a.sort((c,u)=>{const d=c.cue.pre,f=c.cue.post,p=u.cue.pre,m=u.cue.post;if(d&&!p)return-1;if(p&&!d||f&&!m)return 1;if(m&&!f)return-1;if(!d&&!p&&!f&&!m){const y=c.startTime,g=u.startTime;if(y!==g)return y-g}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=a,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],r=!1){const n=this.events||[];if(n.length||t.length||this.length<2){const i=this.items,a=this.parseSchedule(n,e);(r||t.length||(i==null?void 0:i.length)!==a.length||a.some((l,c)=>Math.abs(l.playout.start-i[c].playout.start)>.005||Math.abs(l.playout.end-i[c].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const n=[],i=Object.keys(e);for(let a=0;a<i.length;a++){const o=i[a],l=e[o];if(l.isInterstitial){let c=this.eventMap[o];c?c.setDateRange(l):(c=new JC(l,t),this.eventMap[o]=c,r===!1&&(c.appendInPlace=r)),n.push(c)}}return n}parseSchedule(e,t){const r=[],n=t.main.details,i=n.live?1/0:n.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,d)=>{const f=u.cue.pre,p=u.cue.post,m=e[d-1]||null,y=u.appendInPlace,g=p?i:u.startOffset,x=u.duration,v=u.timelineOccupancy===Ql.Range?x:0,E=u.resumptionOffset,T=(m==null?void 0:m.startTime)===g,w=g+u.cumulativeDuration;let R=y?w+x:g+E;if(f||!p&&g<=0){const _=c;c+=v,u.timelineStart=w;const I=a;a+=x,r.push({event:u,start:w,end:R,playout:{start:I,end:a},integrated:{start:_,end:c}})}else if(g<=i){if(!T){const L=g-l;if(L>g0){const N=l,M=c;c+=L;const $=a;a+=L;const G={previousEvent:e[d-1]||null,nextEvent:u,start:N,end:N+L,playout:{start:$,end:a},integrated:{start:M,end:c}};r.push(G)}else L>0&&m&&(m.cumulativeDuration+=L,r[r.length-1].end=g)}p&&(R=w),u.timelineStart=w;const _=c;c+=v;const I=a;a+=x,r.push({event:u,start:w,end:R,playout:{start:I,end:a},integrated:{start:_,end:c}})}else return;const b=u.resumeTime;p||b>i?l=i:l=b}),l<i){var o;const u=l,d=c,f=i-l;c+=f;const p=a;a+=f,r.push({previousEvent:((o=r[r.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:u+f,playout:{start:p,end:a},integrated:{start:d,end:c}})}this.setDurations(i,a,c)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,n=r.live?1/0:r.edge;let i=0,a=-1;e.forEach((o,l)=>{const c=o.cue.pre,u=o.cue.post,d=c?0:u?n:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=i:(i=0,a=d),!u&&o.snapOptions.in&&(o.resumeAnchor=bn(null,r.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<g0&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const p=ee(o.resumeOffset)?o.resumeOffset:o.duration;i+=p})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(r-n)>oi?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${n}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(r>=l)return this.log(`"${e.identifier}" resumption ${r} past ${a} playlist end ${l}`),!1;const c=bn(null,o.fragments,r);if(!c)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const u=a==="audio"?.175:0;return Math.abs(c.start-r)<oi+u||Math.abs(c.end-r)<oi+u?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${a} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,n=!1,i=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+r;o.startOffset=r,o.timelineStart=l,n||(n=o.duration===null),i||(i=!!o.error);const c=o.error?0:o.duration||0;r+=c}n&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Es(s){return`[${s.event?'"'+s.event.identifier+'"':"primary"}: ${s.start.toFixed(2)}-${s.end.toFixed(2)}]`}class sP{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let n;try{n=pS(r,this.hls.sessionId,e.baseUrl)}catch(f){const p=this.assignAssetListError(e,C.ASSET_LIST_LOAD_ERROR,f,r);this.hls.trigger(S.ERROR,p);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,a=i.loader,o=new a(i),l={responseType:"json",url:n.href},c=i.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,p,m,y)=>{const g=f.data,x=g==null?void 0:g.ASSETS;if(!Array.isArray(x)){const v=this.assignAssetListError(e,C.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,p,y);this.hls.trigger(S.ERROR,v);return}e.assetListResponse=g,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:g,networkDetails:y})},onError:(f,p,m,y)=>{const g=this.assignAssetListError(e,C.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${p.url})`),p.url,y,m);this.hls.trigger(S.ERROR,g)},onTimeout:(f,p,m)=>{const y=this.assignAssetListError(e,C.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${p.url})`),p.url,f,m);this.hls.trigger(S.ERROR,y)}};return o.load(l,u,d),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,r,n,i,a){return e.error=r,{type:ae.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:r,networkDetails:a,stats:i}}}function y0(s){var e;s==null||(e=s.play())==null||e.catch(()=>{})}function Do(s,e){return`[${s}] Advancing timeline position to ${e}`}class rP extends xs{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const n=r-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const a=n<=-.01;this.timelinePos=r,this.bufferedPos=r;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(r,r-n)&&this.updateSchedule(!0),this.checkBuffer(),a&&r<o.start||r>=o.end){var l;const p=this.findItemIndex(o);let m=this.schedule.findItemIndexAtTime(r);if(m===-1&&(m=p+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${r} (resolving from ${p} to ${m})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&m>p){const y=this.schedule.findJumpRestrictedIndex(p+1,m);if(y>p){this.setSchedulePosition(y);return}}this.setSchedulePosition(m);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(o)){const p=o.event.assetList[0];p&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,p))}return}const u=c.timelineStart,d=c.duration||0;if(a&&r<u||r>=u+d){var f;(f=o.event)!=null&&f.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,c)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(r>=n.end){this.timelinePos=n.end;const o=this.findItemIndex(n);this.setSchedulePosition(o+1)}const i=this.playingAsset;if(!i)return;const a=i.timelineStart+(i.duration||0);r>=a&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,n)=>{const i=this.schedule;if(!i)return;const a=this.playingItem,o=i.events||[],l=i.items||[],c=i.durations,u=r.map(y=>y.identifier),d=!!(o.length||u.length);(d||n)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(y=>Es(y))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let f=null,p=null;a&&(f=this.updateItem(a,this.timelinePos),this.itemsMatch(a,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const m=this.bufferingItem;if(m&&(p=this.updateItem(m,this.bufferedPos),this.itemsMatch(m,p)?this.bufferingItem=p:m.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(m.event,null))),r.forEach(y=>{y.assetList.forEach(g=>{this.clearAssetPlayer(g.identifier,null)})}),this.playerQueue.forEach(y=>{if(y.interstitial.appendInPlace){const g=y.assetItem.timelineStart,x=y.timelineOffset-g;if(x)try{y.timelineOffset=g}catch(v){Math.abs(x)>oi&&this.warn(`${v} ("${y.assetId}" ${y.timelineOffset}->${g})`)}}}),d||n){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(a)&&u.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(f,a),m&&p!==f&&this.trimInPlace(p,m),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new sP(e),this.schedule=new tP(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Gt(e,"play",this.onPlay),Gt(e,"pause",this.onPause),Gt(e,"seeking",this.onSeeking),Gt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;Ct(r,"seeking",this.onSeeking),Ct(r,"timeupdate",this.onTimeupdate),Ct(r,"play",this.onPlay),Ct(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!n){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,n=this.media;if(this.media=null,!r&&(n&&this.removeMediaListeners(n),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),n=(d,f,p,m,y)=>{if(d){let g=d[f].start;const x=d.event;if(x){if(f==="playout"||x.timelineOccupancy!==Ql.Point){const v=r(p);(v==null?void 0:v.interstitial)===x&&(g+=v.assetItem.startOffset+v[y])}}else{const v=m==="bufferedPos"?a():e[m];g+=v-d.start}return g}return 0},i=(d,f)=>{var p;if(d!==0&&f!=="primary"&&(p=e.schedule)!=null&&p.length){var m;const y=e.schedule.findItemIndexAtTime(d),g=(m=e.schedule.items)==null?void 0:m[y];if(g){const x=g[f].start-g.start;return d+x}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var f,p;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((p=e.schedule)==null?void 0:p.durations[d])||0},l=(d,f)=>{var p,m;const y=e.effectivePlayingItem;if(y!=null&&(p=y.event)!=null&&p.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${f}"`);const g=e.effectivePlayingItem,x=e.schedule.findItemIndexAtTime(d,f),v=(m=e.schedule.items)==null?void 0:m[x],E=e.getBufferingPlayer(),T=E==null?void 0:E.interstitial,w=T==null?void 0:T.appendInPlace,R=g&&e.itemsMatch(g,v);if(g&&(w||R)){const b=r(e.playingAsset),_=(b==null?void 0:b.media)||e.primaryMedia;if(_){const I=f==="primary"?_.currentTime:n(g,f,e.playingAsset,"timelinePos","currentTime"),L=d-I,N=(w?I:_.currentTime)+L;if(N>=0&&(!b||w||N<=b.duration)){_.currentTime=N;return}}}if(v){let b=d;if(f!=="primary"){const I=v[f].start,L=d-I;b=v.start+L}const _=!e.isInterstitial(v);if((!e.isInterstitial(g)||g.event.appendInPlace)&&(_||v.event.appendInPlace)){const I=e.media||(w?E==null?void 0:E.media:null);I&&(I.currentTime=b)}else if(g){const I=e.findItemIndex(g);if(x>I){const N=e.schedule.findJumpRestrictedIndex(I+1,x);if(N>I){e.setSchedulePosition(N);return}}let L=0;if(_)e.timelinePos=b,e.checkBuffer();else{const N=v.event.assetList,M=d-(v[f]||v).start;for(let $=N.length;$--;){const G=N[$];if(G.duration&&M>=G.startOffset&&M<G.startOffset+G.duration){L=$;break}}}e.setSchedulePosition(x,L)}}},c=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},u={get bufferedEnd(){const d=t(),f=e.bufferingItem;if(f&&f===d){var p;return n(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((p=e.bufferingAsset)==null?void 0:p.startOffset)||0}return 0},get currentTime(){const d=c(),f=e.effectivePlayingItem;return f&&f===d?n(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=c(),p=e.effectivePlayingItem;p&&p===f&&l(d+p.playout.start,"playout")},get duration(){const d=c();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=c())==null?void 0:d.event.assetList;return f?f.map(p=>e.getAssetPlayer(p.identifier)):[]},get playingIndex(){var d;const f=(d=c())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return i(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const p=e.findItemIndex(d);if(f.appendInPlace){const m=d.playout.start+d.event.duration;l(m+.001,"playout")}else e.advanceAfterAssetEnded(f,p,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(n=this.primaryMedia);const i=(t=n)==null?void 0:t.currentTime;if(!(i===void 0||!ee(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,n=e.media;if(r&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ce(i)}`),this.detachedData=i}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var r,n;if(e.media===t)return;let i=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,c=(r=this.detachedData)==null?void 0:r.mediaSource;let u;if(a.media)l&&(i=a.transferMedia(),this.detachedData=i),u="Primary";else if(c){const m=this.getBufferingPlayer();m?(i=m.transferMedia(),u=`${m}`):u="detached MediaSource"}else u="detached media";if(!i){if(c)i=this.detachedData,this.log(`using detachedData: MediaSource ${Ce(i)}`);else if(!this.detachedData||a.media===t){const m=this.playerQueue;m.length>1&&m.forEach(y=>{if(o&&y.interstitial.appendInPlace!==l){const g=y.interstitial;this.clearInterstitial(y.interstitial,null),g.appendInPlace=!1,g.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${g}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=i&&"mediaSource"in i&&((n=i.mediaSource)==null?void 0:n.readyState)!=="closed",f=d&&i?i:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const p=this.schedule;if(f===i&&p){const m=o&&e.assetId===p.assetIdAtEnd;f.overrides={duration:p.duration,endOfStream:!o||m,cueRemoval:!o}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,n=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.log(Do("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(i>=0||!this.primaryLive){const a=this.timelinePos=i>0?i:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(n&&!this.playingItem){const i=e.findItemIndex(n);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const r=e.event,n=r.findAssetIndex(t),i=Fu(r,n);if(!r.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,r){const n=Fu(e,r);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const i=this.schedule.items;if(i){const a=t+1,o=i.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Do("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const i=e.assetList[n];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const n=t.parentIdentifier,i=r.getEvent(n);if(i){const a=r.findEventIndex(n),o=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,a,o-1)}}setSchedulePosition(e,t){var r;const n=(r=this.schedule)==null?void 0:r.items;if(!n||this.playbackDisabled)return;const i=e>=0?n[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&Es(i)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const u=a.event,d=this.playingAsset,f=d==null?void 0:d.identifier,p=f?this.getAssetPlayer(f):null;if(p&&f&&(!this.eventItemsMatch(a,i)||t!==void 0&&f!==u.assetList[t].identifier)){var l;const m=u.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${m+1}/${u.assetList.length} ${On(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:m,event:u,schedule:n.slice(0),scheduleIndex:e,player:p}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(f,i),p.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&p.detachMedia()}if(!this.eventItemsMatch(a,i)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${Es(a)}`),u.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:u,schedule:n.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const m=(c=this.schedule)==null?void 0:c.items;if(i&&m){const y=this.findItemIndex(i);this.advanceSchedule(y,m,t,a,o)}return}}this.advanceSchedule(e,n,t,a,o)}advanceSchedule(e,t,r,n,i){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const d=u.interstitial,f=a.findEventIndex(d.identifier);(f<e||f>e+1)&&this.clearInterstitial(d,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const u=o.event;if(r===void 0){r=a.findAssetIndex(u,this.timelinePos);const m=Fu(u,r-1);if(u.isAssetPastPlayoutLimit(m)||u.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(u,e,r);return}r=m}const d=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let f=this.preloadAssets(u,r);if(this.eventItemsMatch(o,d||n)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${Es(o)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const p=u.assetList[r];if(!p){this.advanceAfterAssetEnded(u,e,r||0);return}if(f||(f=this.getAssetPlayer(p.identifier)),f===null||f.destroyed){const m=u.assetList.length;this.warn(`asset ${r+1}/${m} player destroyed ${u}`),f=this.createAssetPlayer(u,p,r),f.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(p))return;this.startAssetPlayer(f,r,t,e,l),this.shouldPlay&&y0(f.media)}else o?(this.resumePrimary(o,e,n),this.shouldPlay&&y0(this.hls.media)):i&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var n,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Es(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(Do("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!r)return;const a=(i=this.schedule)==null?void 0:i.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Es(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(r<n.fragmentStart||r>n.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:de.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,n),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(Do("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((r=n.mainForwardBufferInfo)==null?void 0:r.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const n=Ae(Ae({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Ae(Ae({},this.altSelection),{},{audio:r});return}const i=Ae(Ae({},n),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Ae(Ae({},this.altSelection),{},{subtitles:r});return}const i=Ae(Ae({},n),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=Lg(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setAudioOption(t)||n.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=Lg(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setSubtitleOption(t)||t.id!==-1&&n.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const i=t[n];if(i.cue.post){var r;const a=this.schedule.findEventIndex(i.identifier),o=(r=this.schedule.items)==null?void 0:r[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const n=(r=this.schedule)==null?void 0:r.items;if(e&&n){const i=this.findItemIndex(e,t);return n[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(i.identifier,null)});const r=e.end+.25,n=de.bufferInfo(this.primaryMedia,r,0);(n.end>r||(n.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${Es(e)} (was ${Es(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const n=de.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,r,e)}updateBufferedPos(e,t,r){const n=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(i),d=Math.min(u+1,t.length-1),f=t[d];if((l===-1&&i&&e>=i.end||(c=f.event)!=null&&c.appendInPlace&&e+.01>=f.start)&&(l=d),this.isInterstitial(i)){const p=i.event;if(d-o>1&&p.appendInPlace===!1||p.assetList.length===0&&p.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>o)this.bufferedToItem(f);else{const p=this.primaryDetails;this.primaryLive&&p&&e>p.edge-p.targetduration&&f.start<p.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else r&&a&&!this.itemsMatch(a,i)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const i=this.getAssetPlayer(n.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:n,events:i}=r;if(!n||!i)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Es(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const c=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,d)=>{const f=this.getAssetPlayer(u.identifier);f&&(d===c&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,n=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(n||!i){const a=this.preloadAssets(r,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const r=e.assetUrl,n=e.assetList.length,i=n===0&&!e.assetListLoader,a=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var o;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(o=f.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const f=u-l;f>0&&(c=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:n} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),r)return this.createAsset(e,0,0,l,e.duration,r);const d=this.assetListLoader.loadAssetList(e,c);d&&(e.assetListLoader=d)}else if(!a&&n){for(let c=t;c<n;c++){const u=e.assetList[c],d=this.getAssetPlayerQueueIndex(u.identifier);(d===-1||this.playerQueue[d].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,n,i,a){const o={parentIdentifier:e.identifier,identifier:QC(e,a,t),duration:i,startOffset:r,timelineStart:n,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,r){const n=this.hls,i=n.userConfig;let a=i.videoPreference;const o=n.loadLevelObj||n.levels[n.currentLevel];(a||o)&&(a=Re({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=n.audioTracks[n.audioTrack],c=n.subtitleTracks[n.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const T=this.timelinePos-t.timelineStart;if(T>1){const w=t.duration;w&&T<w&&(u=T)}}const d=t.identifier,f=Ae(Ae({},i),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||i.audioPreference,subtitlePreference:c||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const p=f.cmcd;p!=null&&p.sessionId&&p.contentId&&(f.cmcd=Re({},p,{contentId:oa(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const m=new eP(this.HlsPlayerClass,f,e,t);this.playerQueue.push(m),e.assetList[r]=t;let y=!0;const g=T=>{if(T.live){var w;const _=new Error(`Interstitials MUST be VOD assets ${e}`),I={fatal:!0,type:ae.OTHER_ERROR,details:C.INTERSTITIAL_ASSET_ITEM_ERROR,error:_},L=((w=this.schedule)==null?void 0:w.findEventIndex(e.identifier))||-1;this.handleAssetItemError(I,e,L,r,_.message);return}const R=T.edge-T.fragmentStart,b=t.duration;(y||b===null||R>b)&&(y=!1,this.log(`Interstitial asset "${d}" duration change ${b} > ${R}`),t.duration=R,this.updateSchedule())};m.on(S.LEVEL_UPDATED,(T,{details:w})=>g(w)),m.on(S.LEVEL_PTS_UPDATED,(T,{details:w})=>g(w)),m.on(S.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const x=(T,w)=>{const R=this.getAssetPlayer(d);if(R&&w.tracks){R.off(S.BUFFER_CODECS,x),R.tracks=w.tracks;const b=this.primaryMedia;this.bufferingAsset===R.assetItem&&b&&!R.media&&this.bufferAssetPlayer(R,b)}};m.on(S.BUFFER_CODECS,x);const v=()=>{var T;const w=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${w}`),!w||!this.schedule)return;const R=this.schedule.findEventIndex(e.identifier),b=(T=this.schedule.items)==null?void 0:T[R];this.isInterstitial(b)&&this.advanceAssetBuffering(b,t)};m.on(S.BUFFERED_TO_END,v);const E=T=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const R=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,R,T)};return m.once(S.MEDIA_ENDED,E(r)),m.once(S.PLAYOUT_LIMIT_REACHED,E(1/0)),m.on(S.ERROR,(T,w)=>{if(!this.schedule)return;const R=this.getAssetPlayer(d);if(w.details===C.BUFFER_STALLED_ERROR){if(R!=null&&R.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${w.error} ${e}`)}),m.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const w=new Error(`Asset player destroyed unexpectedly ${d}`),R={fatal:!0,type:ae.OTHER_ERROR,details:C.INTERSTITIAL_ASSET_ITEM_ERROR,error:w};this.handleAssetItemError(R,e,this.schedule.findEventIndex(e.identifier),r,w.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${On(t)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:m}),m}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const n=this.playerQueue[r];this.log(`clear ${n} toSegment: ${t&&Es(t)}`),this.transferMediaFromPlayer(n,t),this.playerQueue.splice(r,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,n,i){const{interstitial:a,assetItem:o,assetId:l}=e,c=a.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,r[n]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${On(o)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:r.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,n;if(!this.schedule)return;const{interstitial:i,assetItem:a}=e,o=this.schedule.findEventIndex(i.identifier),l=(r=this.schedule.items)==null?void 0:r[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const u=i.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const d=(c==null?void 0:c.tracks)||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(u&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!Qv(d,e.tracks)){const f=new Error(`Asset ${On(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),p={fatal:!0,type:ae.OTHER_ERROR,details:C.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},m=i.findAssetIndex(a);this.handleAssetItemError(p,i,o,m,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const n=r.currentTime,i=t.findAssetIndex(e,n),a=e.assetList[i];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||n-a.timelineStart,c=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${o} ${e} (media.currentTime: ${n})`),l&&(c/r.playbackRate<.5||o.bufferedInPlaceToEnd(r))&&o.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,n,i){if(e.details===C.BUFFER_STALLED_ERROR)return;const a=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&On(a)} ${e.error}`),!this.schedule)return;const o=(a==null?void 0:a.identifier)||"",l=this.getAssetPlayerQueueIndex(o),c=this.playerQueue[l]||null,u=this.schedule.items,d=Re({},e,{fatal:!1,errorAction:ni(!0),asset:a,assetListIndex:n,event:t,schedule:u,scheduleIndex:r,player:c});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,p=this.bufferingAsset,m=new Error(i);if(a&&(this.clearAssetPlayer(o,null),a.error=m),!t.assetList.some(y=>!y.error))t.error=m;else for(let y=n;y<t.assetList.length;y++)this.resetAssetPlayer(t.assetList[y].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===o?this.advanceAfterAssetEnded(t,r,n):p&&p.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,p)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let n=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${n} playing: ${Es(r)} error: ${e.error}`),n===-1&&(n=this.hls.startPosition);const a=this.updateItem(r,n);this.itemsMatch(r,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(n===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var r,n;const i=t.event,a=i.identifier,o=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(a)))return;const l=i.timelineStart,c=i.duration;let u=0;o.forEach((y,g)=>{const x=parseFloat(y.DURATION);this.createAsset(i,g,u,l+u,x,y.URI),u+=x}),i.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${i}`);const d=this.waitingItem,f=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const p=(n=this.bufferingItem)==null?void 0:n.event;if(f){var m;const y=this.schedule.findEventIndex(a),g=(m=this.schedule.items)==null?void 0:m[y];if(g){if(!this.playingItem&&this.timelinePos>g.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y){i.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(g)}this.setSchedulePosition(y)}else if((p==null?void 0:p.identifier)===a){const y=i.assetList[0];if(y){const g=this.getAssetPlayer(y.identifier);if(p.appendInPlace){const x=this.primaryMedia;g&&x&&this.bufferAssetPlayer(g,x)}else g&&g.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case C.ASSET_LIST_PARSING_ERROR:case C.ASSET_LIST_LOAD_ERROR:case C.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case C.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const x0=500;class nP extends Yf{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",re.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=V.IDLE,this.setInterval(x0),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:n}=t;if(this.fragContextChanged(r)||(Ze(r)&&(this.fragPrevious=r),this.state=V.IDLE),!n)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let a;const o=r.start;for(let c=0;c<i.length;c++)if(o>=i[c].start&&o<=i[c].end){a=i[c];break}const l=r.start+r.duration;a?a.end=l:(a={start:o,end:l},i.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:n}=t;if(r===0&&n!==Number.POSITIVE_INFINITY){const i=n-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=i){a.shift();continue}else if(a[o].start<i)a[o].start=i;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(r,i,re.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===re.SUBTITLE&&(t.details===C.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==V.STOPPED&&(this.state=V.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&eS(this.levels,t)){this.levels=t.map(r=>new Ia(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const n=new Ia(r);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,re.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==V.STOPPED&&this.setInterval(x0)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:n,levels:i}=this,{details:a,id:o}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=i[o];if(o>=i.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(r=l.details)!=null&&r.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(ql(a,d),c=a.fragmentStart):f&&(c=f.start,mh(a,c));else{var u;c=this.alignPlaylists(a,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&f&&(c=f.start,mh(a,c))}d&&!this.startFragRequested&&this.setStartPosition(d,c)}l.details=a,this.levelLastLoaded=l,o===n&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===V.IDLE&&(bn(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,n=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&n!=null&&n.key&&n.iv&&ii(n.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer,Kf(n.method)).catch(o=>{throw i.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();i.trigger(S.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=V.IDLE})}}doTick(){if(!this.media){this.state=V.IDLE;return}if(this.state===V.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:n}=this,i=this.getLoadPosition(),a=de.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,n.maxBufferHole),{end:o,len:l}=a,c=r.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const d=c.fragments,f=d.length,p=c.edge;let m=null;const y=this.fragPrevious;if(o<p){const v=n.maxFragLookUpTolerance,E=o>p-v?0:v;m=bn(y,d,Math.max(d[0].start,o),E),!m&&y&&y.start<d[0].start&&(m=d[0])}else m=d[f-1];if(m=this.filterReplacedPrimary(m,r.details),!m)return;const g=m.sn-c.startSN,x=d[g-1];if(x&&x.cc===m.cc&&this.fragmentTracker.getState(x)===at.NOT_LOADED&&(m=x),this.fragmentTracker.getState(m)===at.NOT_LOADED){const v=this.mapToInitFragWhenRequired(m);v&&this.loadFragment(v,r,o)}}}loadFragment(e,t,r){Ze(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new iP(this.tracksBuffered[this.currentTrackId]||[])}}class iP{constructor(e){this.buffered=void 0;const t=(r,n,i)=>{if(n=n>>>0,n>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${i})`);return e[n][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const aP={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},gS=s=>String.fromCharCode(aP[s]||s),Ss=15,Xs=100,oP={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},lP={17:2,18:4,21:6,22:8,23:10,19:13,20:15},cP={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},uP={25:2,26:4,29:6,30:8,31:10,27:13,28:15},dP=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class hP{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Le.log(`${this.time} [${e}] ${r}`)}}}const en=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class yS{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class fP{constructor(){this.uchar=" ",this.penState=new yS}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class mP{constructor(e){this.chars=[],this.pos=0,this.currPenState=new yS,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Xs;t++)this.chars.push(new fP);this.logger=e}equals(e){for(let t=0;t<Xs;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Xs;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Xs;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Xs&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Xs)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=gS(e);if(this.pos>=Xs){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Xs;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Xs;r++){const n=this.chars[r].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class ju{constructor(e){this.rows=[],this.currRow=Ss-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Ss;t++)this.rows.push(new mP(e));this.logger=e}reset(){for(let e=0;e<Ss;e++)this.rows[e].clear();this.currRow=Ss-1}equals(e){let t=!0;for(let r=0;r<Ss;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<Ss;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ss;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ce(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<Ss;o++)this.rows[o].clear();const i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[i].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[i+c])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,a=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ce(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",n=-1;for(let i=0;i<Ss;i++){const a=this.rows[i].getTextString();a&&(n=i+1,e?t.push("Row "+n+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class v0{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new ju(r),this.nonDisplayedMemory=new ju(r),this.lastOutputScreen=new ju(r),this.currRollUpRow=this.displayedMemory.rows[Ss-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Ss-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[r]}this.logger.log(2,"MIDROW: "+Ce(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class E0{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=gP(),this.logger=void 0;const n=this.logger=new hP;this.channels=[null,new v0(e,t,n),new v0(e+1,r,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const n=t[r]&127,i=t[r+1]&127;let a=!1,o=null;if(n===0&&i===0)continue;this.logger.log(3,()=>"["+en([t[r],t[r+1]])+"] -> ("+en([n,i])+")");const l=this.cmdHistory;if(n>=16&&n<=31){if(pP(n,i,l)){No(null,null,l),this.logger.log(3,()=>"Repeated command ("+en([n,i])+") is dropped");continue}No(n,i,this.cmdHistory),a=this.parseCmd(n,i),a||(a=this.parseMidrow(n,i)),a||(a=this.parsePAC(n,i)),a||(a=this.parseBackgroundAttributes(n,i))}else No(null,null,l);if(!a&&(o=this.parseChars(n,i),o)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+en([n,i])+" orig: "+en([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(r||n))return!1;const i=e===20||e===21||e===23?1:2,a=this.channels[i];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[r];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+en([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(n||i))return!1;const a=e<=23?1:2;t>=64&&t<=95?r=a===1?oP[e]:cP[e]:r=a===1?lP[e]:uP[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let r;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,n.underline=(r&1)===1,r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((r-16)/2)*4,n}parseChars(e,t){let r,n=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let a;i===17?a=t+80:i===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+gS(a)+"' in channel "+r),n=[a]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+en(n).join(",")),n}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(r||n))return!1;let i;const a={};e===16||e===24?(i=Math.floor((t-32)/2),a.background=dP[i],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}No(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function No(s,e,t){t.a=s,t.b=e}function pP(s,e,t){return t.a===s&&t.b===e}function gP(){return{a:null,b:null}}var am=function(){if(Yl!=null&&Yl.VTTCue)return self.VTTCue;const s=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const c=l.toLowerCase();return~o.indexOf(c)?c:!1}function r(o){return t(s,o)}function n(o){return t(e,o)}function i(o,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)o[d]=u[d]}return o}function a(o,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let f="",p=!1,m=o,y=l,g=c,x=null,v="",E=!0,T="auto",w="start",R=50,b="middle",_=50,I="middle";Object.defineProperty(u,"id",i({},d,{get:function(){return f},set:function(L){f=""+L}})),Object.defineProperty(u,"pauseOnExit",i({},d,{get:function(){return p},set:function(L){p=!!L}})),Object.defineProperty(u,"startTime",i({},d,{get:function(){return m},set:function(L){if(typeof L!="number")throw new TypeError("Start time must be set to a number.");m=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",i({},d,{get:function(){return y},set:function(L){if(typeof L!="number")throw new TypeError("End time must be set to a number.");y=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",i({},d,{get:function(){return g},set:function(L){g=""+L,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",i({},d,{get:function(){return x},set:function(L){x=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",i({},d,{get:function(){return v},set:function(L){const N=r(L);if(N===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",i({},d,{get:function(){return E},set:function(L){E=!!L,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",i({},d,{get:function(){return T},set:function(L){if(typeof L!="number"&&L!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",i({},d,{get:function(){return w},set:function(L){const N=n(L);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");w=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",i({},d,{get:function(){return R},set:function(L){if(L<0||L>100)throw new Error("Position must be between 0 and 100.");R=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",i({},d,{get:function(){return b},set:function(L){const N=n(L);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");b=N,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",i({},d,{get:function(){return _},set:function(L){if(L<0||L>100)throw new Error("Size must be between 0 and 100.");_=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",i({},d,{get:function(){return I},set:function(L){const N=n(L);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");I=N,this.hasBeenReset=!0}})),u.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class yP{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function xS(s){function e(r,n,i,a){return(r|0)*3600+(n|0)*60+(i|0)+parseFloat(a||0)}const t=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class xP{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function vS(s,e,t,r){const n=r?s.split(r):[s];for(const i in n){if(typeof n[i]!="string")continue;const a=n[i].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const Th=new am(0,0,""),Oo=Th.align==="middle"?"middle":"center";function vP(s,e,t){const r=s;function n(){const o=xS(s);if(o===null)throw new Error("Malformed timestamp: "+r);return s=s.replace(/^[^\sa-zA-Z-]+/,""),o}function i(o,l){const c=new xP;vS(o,function(f,p){let m;switch(f){case"region":for(let y=t.length-1;y>=0;y--)if(t[y].id===p){c.set(f,t[y].region);break}break;case"vertical":c.alt(f,p,["rl","lr"]);break;case"line":m=p.split(","),c.integer(f,m[0]),c.percent(f,m[0])&&c.set("snapToLines",!1),c.alt(f,m[0],["auto"]),m.length===2&&c.alt("lineAlign",m[1],["start",Oo,"end"]);break;case"position":m=p.split(","),c.percent(f,m[0]),m.length===2&&c.alt("positionAlign",m[1],["start",Oo,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,p);break;case"align":c.alt(f,p,["start",Oo,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&Th.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",Oo);let d=c.get("position","auto");d==="auto"&&Th.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){s=s.replace(/^\s+/,"")}if(a(),e.startTime=n(),a(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);s=s.slice(3),a(),e.endTime=n(),a(),i(s,e)}function ES(s){return s.replace(/<br(?: \/)?>/gi,`
`)}class EP{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new yP,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,a=0;for(i=ES(i);a<i.length&&i[a]!=="\r"&&i[a]!==`
`;)++a;const o=i.slice(0,a);return i[a]==="\r"&&++a,i[a]===`
`&&++a,t.buffer=i.slice(a),o}function n(i){vS(i,function(a,o){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const o=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:i=r(),t.state){case"HEADER":/:/.test(i)?n(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new am(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{vP(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=i.indexOf("-->")!==-1;if(!i||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const SP=/\r\n|\n\r|\n|\r/g,$u=function(e,t,r=0){return e.slice(r,r+t.length)===t},TP=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ee(t)||!ee(r)||!ee(n)||!ee(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*n,t+=60*60*1e3*i,t};function om(s,e,t){return oa(s.toString())+oa(e.toString())+oa(t)}const bP=function(e,t,r){let n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(a=i)!=null&&a.new;){var a;e.ccOffset+=n.start-i.start,n.new=!1,n=i,i=e[n.prevCC]}e.presentationOffset=r};function wP(s,e,t,r,n,i,a){const o=new EP,l=os(new Uint8Array(s)).trim().replace(SP,`
`).split(`
`),c=[],u=e?kk(e.baseTime,e.timescale):0;let d="00:00.000",f=0,p=0,m,y=!0;o.oncue=function(g){const x=t[r];let v=t.ccOffset;const E=(f-u)/9e4;if(x!=null&&x.new&&(p!==void 0?v=t.ccOffset=x.start:bP(t,r,E)),E){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}v=E-t.presentationOffset}const T=g.endTime-g.startTime,w=ts((g.startTime+v-p)*9e4,n*9e4)/9e4;g.startTime=Math.max(w,0),g.endTime=Math.max(w+T,0);const R=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(R)),g.id||(g.id=om(g.startTime,g.endTime,R)),g.endTime>0&&c.push(g)},o.onparsingerror=function(g){m=g},o.onflush=function(){if(m){a(m);return}i(c)},l.forEach(g=>{if(y)if($u(g,"X-TIMESTAMP-MAP=")){y=!1,g.slice(16).split(",").forEach(x=>{$u(x,"LOCAL:")?d=x.slice(6):$u(x,"MPEGTS:")&&(f=parseInt(x.slice(7)))});try{p=TP(d)/1e3}catch(x){m=x}return}else g===""&&(y=!1);o.parse(g+`
`)}),o.flush()}const Uu="stpp.ttml.im1t",SS=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TS=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,AP={left:"start",center:"center",right:"end",start:"start",end:"end"};function S0(s,e,t,r){const n=pe(new Uint8Array(s),["mdat"]);if(n.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=n.map(o=>os(o)),a=Ik(e.baseTime,1,e.timescale);try{i.forEach(o=>t(LP(o,a)))}catch(o){r(o)}}function LP(s,e){const n=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(i).reduce((d,f)=>(d[f]=n.getAttribute(`ttp:${f}`)||i[f],d),{}),o=n.getAttribute("xml:space")!=="preserve",l=T0(Bu(n,"styling","style")),c=T0(Bu(n,"layout","region")),u=Bu(n,"body","[begin]");return[].map.call(u,d=>{const f=bS(d,o);if(!f||!d.hasAttribute("begin"))return null;const p=Gu(d.getAttribute("begin"),a),m=Gu(d.getAttribute("dur"),a);let y=Gu(d.getAttribute("end"),a);if(p===null)throw b0(d);if(y===null){if(m===null)throw b0(d);y=p+m}const g=new am(p-e,y-e,f);g.id=om(g.startTime,g.endTime,g.text);const x=c[d.getAttribute("region")],v=l[d.getAttribute("style")],E=_P(x,v,l),{textAlign:T}=E;if(T){const w=AP[T];w&&(g.lineAlign=w),g.align=T}return Re(g,E),g}).filter(d=>d!==null)}function Bu(s,e,t){const r=s.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function T0(s){return s.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function bS(s,e){return[].slice.call(s.childNodes).reduce((t,r,n)=>{var i;return r.nodeName==="br"&&n?t+`
`:(i=r.childNodes)!=null&&i.length?bS(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function _P(s,e,t){const r="http://www.w3.org/ns/ttml#styling";let n=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=s!=null&&s.hasAttribute("style")?s.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(n=t[a]),i.reduce((o,l)=>{const c=Vu(e,r,l)||Vu(s,r,l)||Vu(n,r,l);return c&&(o[l]=c),o},{})}function Vu(s,e,t){return s&&s.hasAttributeNS(e,t)?s.getAttributeNS(e,t):null}function b0(s){return new Error(`Could not parse ttml timestamp ${s}`)}function Gu(s,e){if(!s)return null;let t=xS(s);return t===null&&(SS.test(s)?t=RP(s,e):TS.test(s)&&(t=IP(s,e))),t}function RP(s,e){const t=SS.exec(s),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function IP(s,e){const t=TS.exec(s),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Mo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class kP{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=A0(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Mo(this,"textTrack1"),t=new Mo(this,"textTrack2"),r=new Mo(this,"textTrack3"),n=new Mo(this,"textTrack4");this.cea608Parser1=new E0(1,e,t),this.cea608Parser2=new E0(3,r,n)}addCues(e,t,r,n,i){let a=!1;for(let o=i.length;o--;){const l=i[o],c=CP(l[0],l[1],t,r);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),a=!0,c/(r-t)>.5))return}if(a||i.push([t,r]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,r,n)}else{const o=this.Cues.newCue(null,t,r,n);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i,trackId:a}){const{unparsedVttFrags:o}=this;r===re.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:i,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(S.FRAG_LOADED,l):this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let n=0;n<r.textTracks.length;n++){const i=r.textTracks[n];if(w0(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:n}=this,{label:i,languageCode:a}=t[e],o=this.getExistingTrack(i,a);if(o)r[e]=o,Xn(r[e]),fS(r[e],n);else{const l=this.createTextTrack("captions",i,a);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,n={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,r){const n=this.media;if(n)return n.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:n}=this;Object.keys(n).forEach(i=>{Xn(n[i]),delete n[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=A0(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Xn(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],n=r.some(i=>i.textCodec===Uu);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(eS(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,o=a?ol(a.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(o){let d=null;for(let f=0;f<o.length;f++)if(o[f]&&w0(o[f],l)){d=o[f],o[f]=null;break}d&&(u=d)}if(u)Xn(u);else{const d=wS(l);u=this.createTextTrack(d,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),o!=null&&o.length){const l=o.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const n=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!n)return;const i=`textTrack${n[1]}`,a=this.captionsProperties[i];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===re.MAIN){var r,n;const{cea608Parser1:i,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:c}=t.frag,u=(r=(n=t.part)==null?void 0:n.index)!=null?r:-1;i&&a&&(c!==o+1||c===o&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),a.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:r,payload:n}=t;if(r.type===re.SUBTITLE)if(n.byteLength){const i=r.decryptdata,a="stats"in t;if(i==null||!i.encrypted||a){const o=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),o&&o.textCodec===Uu?this._parseIMSC1(r,n):this._parseVTTs(t)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;S0(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{r.logger.log(`Failed to parse IMSC1: ${n}`),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:r,payload:n}=e,{initPTS:i,unparsedVttFrags:a}=this,o=i.length-1;if(!i[r.cc]&&o===-1){a.push(e);return}const l=this.hls,c=(t=r.initSegment)!=null&&t.data?ys(r.initSegment.data,new Uint8Array(n)).buffer:n;wP(c,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,u=>{this._appendCues(u,r.level),l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},u=>{const d=u.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(r,n),l.logger.log(`Failed to parse VTT cue: ${u}`),!(d&&o>r.cc)&&l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:u})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||S0(t,this.initPTS[e.cc],()=>{r.textCodec=Uu,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(i=>mS(n,i))}else{const n=this.tracks[t];if(!n)return;const i=n.default?"default":"subtitles"+t;r.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===re.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:n}=t;if(!(r.type===re.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<n.length;i++){const a=n[i].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(n[i].pts,o[0]),this.cea608Parser2.addData(n[i].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:n,type:i}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!i||i==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>Sh(o[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>Sh(o[l],t,n))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let n=2;for(let i=0;i<r;i++){const a=e[n++],o=127&e[n++],l=127&e[n++];if(o===0&&l===0)continue;if((4&a)!==0){const u=3&a;(u===0||u===1)&&(t[u].push(o),t[u].push(l))}}return t}}function wS(s){return s.characteristics&&/transcribes-spoken-dialog/gi.test(s.characteristics)&&/describes-music-and-sound/gi.test(s.characteristics)?"captions":"subtitles"}function w0(s,e){return!!s&&s.kind===wS(e)&&yh(e,s)}function CP(s,e,t,r){return Math.min(e,r)-Math.max(s,t)}function A0(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const PP=/\s/,DP={newCue(s,e,t,r){const n=[];let i,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(i=r.rows[f],o=!0,l=0,c="",!i.isEmpty()){var d;for(let y=0;y<i.chars.length;y++)PP.test(i.chars[y].uchar)&&o?l++:(c+=i.chars[y].uchar,o=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const p=ES(c.trim()),m=om(e,t,p);s!=null&&(d=s.cues)!=null&&d.getCueById(m)||(a=new u(e,t,p),a.id=m,a.line=f+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),n.push(a))}return s&&n.length&&(n.sort((f,p)=>f.line==="auto"||p.line==="auto"?0:f.line>8&&p.line>8?p.line-f.line:f.line-p.line),n.forEach(f=>mS(s,f))),n}};function NP(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const OP=/(\d+)-(\d+)\/(\d+)/;class L0{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||$P,this.controller=new self.AbortController,this.stats=new $f}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const i=MP(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&ee(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(Pa(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const p=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},c-(p-n.loading.start)),!d.ok){const{status:y,statusText:g}=d;throw new UP(g||"fetch, bad network response",y,d)}n.loading.first=p,n.total=jP(d.headers)||n.total;const m=(f=this.callbacks)==null?void 0:f.onProgress;return m&&ee(t.highWaterMark)?this.loadProgressively(d,n,e,t.highWaterMark,m):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,p;const m=this.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const y=d[o];y&&(n.loaded=n.total=y);const g={url:m.url,data:d,code:m.status},x=(f=this.callbacks)==null?void 0:f.onProgress;x&&!ee(t.highWaterMark)&&x(n,e,d,m),(p=this.callbacks)==null||p.onSuccess(g,n,e,m)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const p=d&&d.code||0,m=d?d.message:null;(f=this.callbacks)==null||f.onError({code:p,text:m},e,d?d.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,n=0,i){const a=new NE,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return a.dataLength&&i(t,r,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return t.loaded+=d,d<n||a.dataLength?(a.push(u),a.dataLength>=n&&i(t,r,a.flush().buffer,e)):i(t,r,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function MP(s,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Re({},s.headers))};return s.rangeEnd&&t.headers.set("Range","bytes="+s.rangeStart+"-"+String(s.rangeEnd-1)),t}function FP(s){const e=OP.exec(s);if(e)return parseInt(e[2])-parseInt(e[1])+1}function jP(s){const e=s.get("Content-Range");if(e){const r=FP(e);if(ee(r))return r}const t=s.get("Content-Length");if(t)return parseInt(t)}function $P(s,e){return new self.Request(s.url,e)}class UP extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const BP=/^age:\s*[\d.]+\s*$/im;class AS{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new $f,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:r.status,text:a.message},t,r,n)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:a}=r.loadPolicy;if(n)for(const o in n)e.setRequestHeader(o,n[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&ee(i)?i:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const n=t.readyState,i=this.config;if(!r.aborted&&n>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const m=u??t.response;if(m!=null){var a,o;r.loading.end=Math.max(self.performance.now(),r.loading.first);const y=t.responseType==="arraybuffer"?m.byteLength:m.length;r.loaded=r.total=y,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const g=(a=this.callbacks)==null?void 0:a.onProgress;g&&g(r,e,m,t);const x={url:t.responseURL,data:m,code:c};(o=this.callbacks)==null||o.onSuccess(x,r,e,t);return}}const d=i.loadPolicy.errorRetry,f=r.retry,p={url:e.url,data:void 0,code:c};if(Kl(d,f,!1,p))this.retry(d);else{var l;Le.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Kl(e,t,!0))this.retry(e);else{var r;Le.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Gf(e,r.retry),r.retry++,Le.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&BP.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const VP={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},GP=Ae(Ae({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:AS,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:tI,bufferController:zk,capLevelController:rm,errorController:aI,fpsController:KC,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:bE,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:VP},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},HP()),{},{subtitleStreamController:nP,subtitleTrackController:qC,timelineController:kP,audioStreamController:Bk,audioTrackController:Vk,emeController:ai,cmcdController:VC,contentSteeringController:HC,interstitialsController:rP});function HP(){return{cueHandler:DP,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function zP(s,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=bh(s),n=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,c=[];i.forEach(u=>{const d=`${a}Loading${u}`,f=e[d];if(f!==void 0&&l){c.push(d);const p=r[o].default;switch(e[o]={default:p},u){case"TimeOut":p.maxLoadTimeMs=f,p.maxTimeToFirstByteMs=f;break;case"MaxRetry":p.errorRetry.maxNumRetry=f,p.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":p.errorRetry.retryDelayMs=f,p.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":p.errorRetry.maxRetryDelayMs=f,p.timeoutRetry.maxRetryDelayMs=f;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${o}": ${Ce(e[o])}`)}),Ae(Ae({},r),e)}function bh(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(bh):Object.keys(s).reduce((e,t)=>(e[t]=bh(s[t]),e),{}):s}function KP(s,e){const t=s.loader;t!==L0&&t!==AS?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):NP()&&(s.loader=L0,s.progressive=!0,s.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ll=2,WP=.1,YP=.05,qP=100;class XP extends xE{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(qP),this.mediaSource=t.mediaSource;const r=this.media=t.media;Ct(r,"playing",this.onMediaPlaying),Ct(r,"waiting",this.onMediaWaiting),Ct(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(Gt(r,"playing",this.onMediaPlaying),Gt(r,"waiting",this.onMediaWaiting),Gt(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,n;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,c=!this.seeking&&o,u=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!de.getBuffered(a).length){this.nudgeRetry=0;return}const d=de.bufferInfo(a,e,0),f=d.nextStart||0,p=this.fragmentTracker;if(o&&p&&this.hls){const R=_0(this.hls.inFlightFragments,e),b=d.len>ll,_=!f||R||f-e>ll&&!p.getPartialFragment(e);if(b||_)return;this.moved=!1}const m=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&p){if(!(d.len>0)&&!f)return;const b=Math.max(f,d.start||0)-e,I=!!(m!=null&&m.live)?m.targetduration*2:ll,L=Fo(e,p);if(b>0&&(b<=I||L)){a.paused||this._trySkipBufferHole(L);return}}const y=i.detectStallWithCurrentTimeMs,g=self.performance.now(),x=this.waiting;let v=this.stalled;if(v===null)if(x>0&&g-x<y)v=this.stalled=x;else{this.stalled=g;return}const E=g-v;if(!o&&(E>=y||x)&&this.hls){var T;if(((T=this.mediaSource)==null?void 0:T.readyState)==="ended"&&!(m!=null&&m.live)&&Math.abs(e-((m==null?void 0:m.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const w=de.bufferInfo(a,e,i.maxBufferHole);this._tryFixBufferStall(w,E,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&n&&n.length>1&&e>n.end(0)){const i=de.bufferedInfo(de.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const a=de.timeRangesToArray(n),o=de.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=de.bufferedInfo(a,e,0).bufferedIndex,c=a[o].end,u=a[o+1].start;if((l===-1||l>o)&&u-c<1&&e-c<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=Fo(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const p=de.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:p.len,bufferInfo:p})}}}}}_tryFixBufferStall(e,t,r){var n,i;const{fragmentTracker:a,media:o}=this,l=(n=this.hls)==null?void 0:n.config;if(!o||!a||!l)return;const c=(i=this.hls)==null?void 0:i.latestLevelDetails,u=Fo(r,a);if((u||c!=null&&c.live&&r<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,r);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-r<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,n=e.nextStart;if(r&&n){const i=r.getFragAtPos(t,re.MAIN),a=r.getFragAtPos(n,re.MAIN);if(i&&a)return a.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:n,stalled:i}=this;if(!n&&i!==null&&r&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${Ce(e)})`);this.warn(a.message),t.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:n}=this,i=(t=this.hls)==null?void 0:t.config;if(!n||!r||!i)return 0;const a=n.currentTime,o=de.bufferInfo(n,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const u=o.len<=i.maxBufferHole,d=o.len>0&&o.len<1&&n.readyState<3,f=l-a;if(f>0&&(u||d)){if(f>i.maxBufferHole){let m=!1;if(a===0){const y=r.getAppendedFrag(0,re.MAIN);y&&l<y.end&&(m=!0)}if(!m&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||_0(this.hls.inFlightFragments,l))return 0;let g=!1,x=e.end;for(;x<l;){const v=Fo(x,r);if(v)x+=v.duration;else{g=!0;break}}if(g)return 0}}const p=Math.max(l+YP,a+WP);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${p}`),this.moved=!0,n.currentTime=p,!(e!=null&&e.gap)){const m=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${p}`),y={type:ae.MEDIA_ERROR,details:C.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?y.part=e:y.frag=e),this.hls.trigger(S.ERROR,y)}return p}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:n}=this,i=t==null?void 0:t.config;if(!r||!i)return 0;const a=r.currentTime;if(this.nudgeRetry++,n<i.nudgeMaxRetry){const o=a+(n+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),r.currentTime=o,t.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${i.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function _0(s,e){const t=R0(s.main);if(t&&t.start<=e)return t;const r=R0(s.audio);return r&&r.start<=e?r:null}function R0(s){if(!s)return null;switch(s.state){case V.IDLE:case V.STOPPED:case V.ENDED:case V.ERROR:return null}return s.frag}function Fo(s,e){return e.getAppendedFrag(s,re.MAIN)||e.getPartialFragment(s)}const QP=.25;function wh(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Hu(s,e,t,r,n){let i=new s(e,t,"");try{i.value=r,n&&(i.type=n)}catch{i=new s(e,t,Ce(n?Ae({type:n},r):r))}return i}const jo=(()=>{const s=wh();try{s&&new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class JP{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Xn(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return fS(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:n}=this.hls.config;if(!r&&!n)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=wh();if(a)for(let o=0;o<i.length;o++){const l=i[o].type;if(l===rs.emsg&&!r||!n)continue;const c=BE(i[o].data),u=i[o].pts;let d=u+i[o].duration;d>jo&&(d=jo),d-u<=0&&(d=u+QP);for(let p=0;p<c.length;p++){const m=c[p];if(!VE(m)){this.updateId3CueEnds(u,l);const y=Hu(a,u,d,m,l);y&&this.id3Track.addCue(y)}}}}updateId3CueEnds(e,t){var r;const n=(r=this.id3Track)==null?void 0:r.cues;if(n)for(let i=n.length;i--;){const a=n[i];a.type===t&&a.startTime<e&&a.endTime===jo&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:n}){const{id3Track:i,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(i&&(o||l)){let c;n==="audio"?c=u=>u.type===rs.audioId3&&l:n==="video"?c=u=>u.type===rs.emsg&&o:c=u=>u.type===rs.audioId3&&l||u.type===rs.emsg&&o,Sh(i,t,r,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:n,enableDateRangeMetadataCues:i,interstitialsController:a}=this.hls.config;if(!i)return;const o=wh();if(r&&n&&!a){const{fragmentStart:y,fragmentEnd:g}=e;let x=this.assetCue;x?(x.startTime=y,x.endTime=g):o&&(x=this.assetCue=Hu(o,y,g,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),x&&(x.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(x),x.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let d=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const y=Object.keys(d).filter(g=>!u.includes(g));for(let g=y.length;g--;){var p;const x=y[g],v=(p=d[x])==null?void 0:p.cues;delete d[x],v&&Object.keys(v).forEach(E=>{const T=v[E];if(T){T.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(T)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const m=e.fragments[e.fragments.length-1];if(!(u.length===0||!ee(m==null?void 0:m.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let y=0;y<u.length;y++){const g=u[y],x=c[g],v=x.startTime,E=d[g],T=(E==null?void 0:E.cues)||{};let w=(E==null?void 0:E.durationKnown)||!1,R=jo;const{duration:b,endDate:_}=x;if(_&&b!==null)R=v+b,w=!0;else if(x.endOnNext&&!w){const L=u.reduce((N,M)=>{if(M!==x.id){const $=c[M];if($.class===x.class&&$.startDate>x.startDate&&(!N||x.startDate<N.startDate))return $}return N},null);L&&(R=L.startTime,w=!0)}const I=Object.keys(x.attr);for(let L=0;L<I.length;L++){const N=I[L];if(!vI(N))continue;const M=T[N];if(M)w&&!(E!=null&&E.durationKnown)?M.endTime=R:Math.abs(M.startTime-v)>.01&&(M.startTime=v,M.endTime=R);else if(o){let $=x.attr[N];EI(N)&&($=Jv($));const Y=Hu(o,v,R,{key:N,data:$},rs.dateRange);Y&&(Y.id=g,this.id3Track.addCue(Y),T[N]=Y,a&&(N==="X-ASSET-LIST"||N==="X-ASSET-URL")&&Y.addEventListener("enter",this.onEventCueEnter))}}d[g]={cues:T,dateRange:x,durationKnown:w}}}}}class ZP{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:a}=this.config;if(!i||a===1||!r.live)return;const o=this.targetLatency;if(o===null)return;const l=n-o,c=Math.min(this.maxLatency,o+r.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,p=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,p)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:n}=e,{liveSyncDuration:i,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let c=o&&r||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=i!==void 0?i:a*n);const u=n;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const n=r.edge,i=e-t-this.edgeStalled,a=n-r.totalduration,o=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,i),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===C.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,n;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class eD extends sm{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,n=[],i={},a={};let o=!1,l=!1,c=!1;t.levels.forEach(u=>{const d=u.attrs;let{audioCodec:f,videoCodec:p}=u;f&&(u.audioCodec=f=Vl(f,r)||void 0),p&&(p=u.videoCodec=MR(p));const{width:m,height:y,unknownCodecs:g}=u,x=(g==null?void 0:g.length)||0;if(o||(o=!!(m&&y)),l||(l=!!p),c||(c=!!f),x||f&&!this.isAudioSupported(f)||p&&!this.isVideoSupported(p)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:v,"FRAME-RATE":E,"HDCP-LEVEL":T,"PATHWAY-ID":w,RESOLUTION:R,"VIDEO-RANGE":b}=d,I=`${`${w||"."}-`}${u.bitrate}-${R}-${E}-${v}-${b}-${T}`;if(i[I])if(i[I].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const L=a[I]+=1;u.attrs["PATHWAY-ID"]=new Array(L+1).join(".");const N=this.createLevel(u);i[I]=N,n.push(N)}else i[I].addGroupId("audio",d.AUDIO),i[I].addGroupId("text",d.SUBTITLES);else{const L=this.createLevel(u);i[I]=L,a[I]=1,n.push(L)}}),this.filterAndSortMediaOptions(n,t,o,l,c)}createLevel(e){const t=new Ia(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(n.message),t.supportedResult=uE(n,[])}return t}isAudioSupported(e){return _a(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return _a(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,n,i){var a;let o=[],l=[],c=e;const u=((a=t.stats)==null?void 0:a.parsing)||{};if((r||n)&&i&&(c=c.filter(({videoCodec:v,videoRange:E,width:T,height:w})=>(!!v||!!(T&&w))&&KR(E))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let v="no level with compatible codecs found in manifest",E=v;t.levels.length&&(E=`one or more CODECS in variant not supported: ${Ce(t.levels.map(w=>w.attrs.CODECS).filter((w,R,b)=>b.indexOf(w)===R))}`,this.warn(E),v+=` (${E})`);const T=new Error(v);this.hls.trigger(S.ERROR,{type:ae.MEDIA_ERROR,details:C.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:T,reason:E})}}),u.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(v=>!v.audioCodec||this.isAudioSupported(v.audioCodec)),I0(o)),t.subtitles&&(l=t.subtitles,I0(l));const d=c.slice(0);c.sort((v,E)=>{if(v.attrs["HDCP-LEVEL"]!==E.attrs["HDCP-LEVEL"])return(v.attrs["HDCP-LEVEL"]||"")>(E.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&v.height!==E.height)return v.height-E.height;if(v.frameRate!==E.frameRate)return v.frameRate-E.frameRate;if(v.videoRange!==E.videoRange)return Gl.indexOf(v.videoRange)-Gl.indexOf(E.videoRange);if(v.videoCodec!==E.videoCodec){const T=Eg(v.videoCodec),w=Eg(E.videoCodec);if(T!==w)return w-T}if(v.uri===E.uri&&v.codecSet!==E.codecSet){const T=Bl(v.codecSet),w=Bl(E.codecSet);if(T!==w)return w-T}return v.averageBitrate!==E.averageBitrate?v.averageBitrate-E.averageBitrate:0});let f=d[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==d.length)){for(let v=0;v<d.length;v++)if(d[v].pathwayId===c[0].pathwayId){f=d[v];break}}this._levels=c;for(let v=0;v<c.length;v++)if(c[v]===f){var p;this._firstLevel=v;const E=f.bitrate,T=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${E}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){const w=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);w>T&&T===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=w)}break}const m=i&&!n,y=this.hls.config,g=!!(y.audioStreamController&&y.audioTrackController),x={levels:c,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:n,altAudio:g&&!m&&o.some(v=>!!v.url)};u.end=performance.now(),this.hls.trigger(S.MANIFEST_PARSED,x)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(S.ERROR,{type:ae.OTHER_ERROR,details:C.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,n=this.currentLevel,i=n?n.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&n&&i===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${r}${i?" with Pathway "+i:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,l);const c=a.details;if(!c||c.live){const u=this.switchParams(a.uri,n==null?void 0:n.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===ye.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===re.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var r;const{level:n,details:i}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${n}`),(o=t.deliveryDirectives)!=null&&o.skip&&(i.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(n,t,l)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(S.LEVEL_LOADING,{url:r,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(o=>o.level=-1)),!1));CE(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=r.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(S.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function I0(s){const e={};s.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function LS(){return self.SourceBuffer||self.WebKitSourceBuffer}function _S(){if(!Gr())return!1;const e=LS();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function tD(){if(!_S())return!1;const s=Gr();return typeof(s==null?void 0:s.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>s.isTypeSupported(Ra(e,"video")))||["mp4a.40.2","fLaC"].some(e=>s.isTypeSupported(Ra(e,"audio"))))}function sD(){var s;const e=LS();return typeof(e==null||(s=e.prototype)==null?void 0:s.changeType)=="function"}const rD=100;class nD extends Yf{constructor(e,t,r){super(e,t,r,"stream-controller",re.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,i=n?n.currentTime:null;if(i===null||!ee(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const a=this.getFwdBufferInfoAtPos(n,i,re.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:n}=this;if(this.stopLoad(),this.setInterval(rD),this.level=-1,!this.startFragRequested){let i=n.startLevel;i===-1&&(n.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=n.firstAutoLevel),n.nextLoadLevel=i,this.level=n.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=V.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=V.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case V.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e==null?void 0:e[t],n=r==null?void 0:r.details;if(n&&(!n.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(n))break;this.state=V.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=V.IDLE;break}break}case V.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===V.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const a=r[i],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const y={};this.altAudio===2&&(y.type="video"),this.hls.trigger(S.BUFFER_EOS,y),this.state=V.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const c=a.details;if(!c||this.state===V.WAITING_LEVEL||this.waitForLive(a)){this.level=i,this.state=V.WAITING_LEVEL,this.startFragRequested=!1;return}const u=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(u>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:o.end;let p=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&p&&Ze(p)&&this.fragmentTracker.getState(p)!==at.OK){var m;const g=((m=this.backtrackFragment)!=null?m:p).sn-c.startSN,x=c.fragments[g-1];x&&p.cc===x.cc&&(p=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,f)){if(!p.gap){const g=this.audioOnly&&!this.altAudio?Ie.AUDIO:Ie.VIDEO,x=(g===Ie.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;x&&this.afterBufferFlushed(x,g,re.MAIN)}p=this.getNextFragmentLoopLoading(p,c,o,re.MAIN,d)}p&&(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,a,f))}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);n===at.NOT_LOADED||n===at.PARTIAL?Ze(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,re.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<i.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],c=this.fragLastKbps;c&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:r=0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,u=Math.max(a.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case V.KEY_LOADING:case V.FRAG_LOADING:case V.FRAG_LOADING_WAITING_RETRY:case V.PARSING:case V.PARSED:this.state=V.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;Ct(r,"playing",this.onMediaPlaying),Ct(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(Gt(r,"playing",this.onMediaPlaying),Gt(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,n=!1;for(let i=0;i<t.levels.length;i++){const a=t.levels[i].audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,n=n||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&n&&!sD(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==V.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=V.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:n,startFragRequested:i}=this,a=t.level,o=t.details,l=o.totalduration;if(!n){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===V.FRAG_LOADING||this.state===V.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let d=0;if(o.live||(r=c.details)!=null&&r.live){var f;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(c.details=o,this.levelLastLoaded=c,i||this.setStartPosition(o,d),this.hls.trigger(S.LEVEL_UPDATED,{details:o,level:a}),this.state===V.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=V.IDLE}i&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const n=this.hls.liveSyncPosition,i=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=i>=a-t.maxFragLookUpTolerance&&i<=o;if(n!==null&&r.duration>n&&(i<n||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&r.readyState<4||i<o-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const d=de.bufferInfo(r,n,0);if(!((c=d.buffered)!=null&&c.length)){r.currentTime=n;return}if(d.start<=i){r.currentTime=n;return}const{nextStart:p}=de.bufferedInfo(d.buffered,i,0);p&&(r.currentTime=p)}else r.currentTime=n}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:n,payload:i}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const o=a[r.level];if(!o){this.warn(`Level ${r.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const c=o.videoCodec,u=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(o),p=this.transmuxer=this.transmuxer||new ZE(this.hls,re.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=n?n.index:-1,y=m!==-1,g=new zf(r.level,r.sn,r.stats.chunkCount,i.byteLength,m,y),x=this.initPTS[r.cc];p.push(i,d,f,c,r,n,l.totalduration,u,g,x)}onAudioTrackSwitching(e,t){const r=this.hls,n=this.altAudio!==0;if(Hl(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(S.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(S.AUDIO_TRACK_SWITCHED,t)}),r.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(S.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=Hl(t.url,this.hls);if(r){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let n,i,a=!1;for(const o in r){const l=r[o];if(l.id==="main"){if(i=o,n=l,o==="video"){const c=r[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&n?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:n}=t,i=r.type===re.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===V.PARSED&&(this.state=V.IDLE);return}const o=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),Ze(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}const a=this.media;a&&(!this._hasEnoughToStart&&de.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=V.ERROR;return}switch(t.details){case C.FRAG_GAP:case C.FRAG_PARSING_ERROR:case C.FRAG_DECRYPT_ERROR:case C.FRAG_LOAD_ERROR:case C.FRAG_LOAD_TIMEOUT:case C.KEY_LOAD_ERROR:case C.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(re.MAIN,t);break;case C.LEVEL_LOAD_ERROR:case C.LEVEL_LOAD_TIMEOUT:case C.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===V.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===ye.LEVEL&&(this.state=V.IDLE);break;case C.BUFFER_ADD_CODEC_ERROR:case C.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case C.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case C.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=V.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ie.AUDIO||!this.altAudio){const r=(t===Ie.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,re.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&r&&(r+=n);const i=this.getLevelDetails(),a=de.getBuffered(e),o=a.length?a.start(0):0,l=o-r,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),r+=l,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${o}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:n}=this,i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=V.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=i.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),n.trigger(S.FRAG_LOADED,r),i.bitrateTest=!1}).catch(r=>{this.state===V.STOPPED||this.state===V.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:n,chunkMeta:i}=e,a=this.getCurrentContext(i);if(!a){this.resetWhenMissingContext(i);return}const{frag:o,part:l,level:c}=a,{video:u,text:d,id3:f,initSegment:p}=n,{details:m}=c,y=this.altAudio?void 0:n.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=V.PARSING,p){const g=p.tracks;if(g){const T=o.initSegment||o;if(this.unhandledEncryptionError(p,o))return;this._bufferInitSegment(c,g,T,i),r.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:t,tracks:g})}const x=p.initPTS,v=p.timescale,E=this.initPTS[o.cc];if(ee(x)&&(!E||E.baseTime!==x||E.timescale!==v)){const T=p.trackId;this.initPTS[o.cc]={baseTime:x,timescale:v,trackId:T},r.trigger(S.INIT_PTS_FOUND,{frag:o,id:t,initPTS:x,timescale:v,trackId:T})}}if(u&&m){y&&u.type==="audiovideo"&&this.logMuxedErr(o);const g=m.fragments[o.sn-1-m.startSN],x=o.sn===m.startSN,v=!g||o.cc>g.cc;if(n.independent!==!1){const{startPTS:E,endPTS:T,startDTS:w,endDTS:R}=u;if(l)l.elementaryStreams[u.type]={startPTS:E,endPTS:T,startDTS:w,endDTS:R};else if(u.firstKeyFrame&&u.independent&&i.id===1&&!v&&(this.couldBacktrack=!0),u.dropped&&u.independent){const b=this.getMainFwdBufferInfo(),_=(b?b.end:this.getLoadPosition())+this.config.maxBufferHole,I=u.firstKeyFramePTS?u.firstKeyFramePTS:E;if(!x&&_<I-this.config.maxBufferHole&&!v){this.backtrack(o);return}else v&&(o.gap=!0);o.setElementaryStreamInfo(u.type,o.start,T,o.start,R,!0)}else x&&E-(m.appliedTimelineOffset||0)>ll&&(o.gap=!0);o.setElementaryStreamInfo(u.type,E,T,w,R),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(u,o,l,i,x||v)}else if(x||v)o.gap=!0;else{this.backtrack(o);return}}if(y){const{startPTS:g,endPTS:x,startDTS:v,endDTS:E}=y;l&&(l.elementaryStreams[Ie.AUDIO]={startPTS:g,endPTS:x,startDTS:v,endDTS:E}),o.setElementaryStreamInfo(Ie.AUDIO,g,x,v,E),this.bufferFragmentData(y,o,l,i)}if(m&&f!=null&&f.samples.length){const g={id:t,frag:o,details:m,samples:f.samples};r.trigger(S.FRAG_PARSING_METADATA,g)}if(m&&d){const g={id:t,frag:o,details:m,samples:d.samples};r.trigger(S.FRAG_PARSING_USERDATA,g)}}logMuxedErr(e){this.warn(`${Ze(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,n){if(this.state!==V.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:a,audiovideo:o}=t;if(i){const c=e.audioCodec;let u=tl(i.codec,c);u==="mp4a"&&(u="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const f=i.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),i.levelCodec=u,i.id=re.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${i.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=re.MAIN;const c=a.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${a.codec!==c?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(S.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const d=t[c].initSegment;d!=null&&d.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:c,data:d,frag:r,part:null,chunkMeta:n,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,re.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=V.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(de.isBuffered(e,r)?t=this.getAppendedFrag(r):de.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,i=t.level;(!n||t.sn!==n.sn||n.level!==i)&&(this.fragPlaying=t,this.hls.trigger(S.FRAG_CHANGED,{frag:t}),(!n||n.level!==i)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ee(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ee(t)){const r=this.getLevelDetails(),n=this.currentFrag||(r?bn(null,r.fragments,t):null);if(n){const i=n.programDateTime;if(i!==null){const a=i+(t-n.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class iD extends xs{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[r].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=C.KEY_LOAD_ERROR,r,n,i){return new Js({type:ae.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:n})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,i=t.length;n<i;n++){const a=t[n];if(e.cc<=a.cc&&(!Ze(e)||!Ze(a)||e.sn<a.sn)||!r&&n==i-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=rl(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const n=Yi(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,n;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,C.KEY_LOAD_ERROR,c))}const a=i.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,C.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=zu(i);let l=this.keyIdToKeyInfo[o];if((r=l)!=null&&r.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(n=l)!=null&&n.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(u=>{const{keyInfo:d}=u;return i.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${i.keyId?" keyId: "+gt(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,C.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&(n=t.initSegment)!=null&&n.data){const a=wR(t.initSegment.data);if(a.length){let o=a[0];o.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${gt(o)}`),Ur.setKeyIdForUri(e.decryptdata.uri,o)):(o=Ur.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${gt(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!Ze(t))return Promise.resolve(r);const i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(a=>(e.mediaKeySessionContext=a,r))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,n=r.loader,i=new n(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=r.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,p,m,y)=>{const{frag:g,keyInfo:x}=m,v=zu(x.decryptdata);if(!g.decryptdata||x!==this.keyIdToKeyInfo[v])return o(this.createKeyLoadError(g,C.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),y));x.decryptdata.key=g.decryptdata.key=new Uint8Array(f.data),g.keyLoader=null,x.loader=null,a({frag:g,keyInfo:x})},onError:(f,p,m,y)=>{this.resetLoader(p),o(this.createKeyLoadError(t,C.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),m,Ae({url:l.url,data:void 0},f)))},onTimeout:(f,p,m)=>{this.resetLoader(p),o(this.createKeyLoadError(t,C.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(f,p,m)=>{this.resetLoader(p),o(this.createKeyLoadError(t,C.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};i.load(l,u,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:n}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const a=zu(r.decryptdata)||n;delete this.keyIdToKeyInfo[a],i&&i.destroy()}}function zu(s){if(s.keyFormat!==yt.FAIRPLAY){const e=s.keyId;if(e)return gt(e)}return s.uri}function k0(s){const{type:e}=s;switch(e){case ye.AUDIO_TRACK:return re.AUDIO;case ye.SUBTITLE_TRACK:return re.SUBTITLE;default:return re.MAIN}}function Ku(s,e){let t=s.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class aD{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,n=t.loader,i=r||n,a=new i(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ye.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:n,pathwayId:i,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:r,level:n,pathwayId:i,responseType:"text",type:ye.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:ye.AUDIO_TRACK,url:i,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:ye.SUBTITLE_TRACK,url:i,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const r=this.loaders[ye.LEVEL];if(r){const n=r.context;n&&!t.levels.some(i=>i===n.levelOrTrack)&&(r.abort(),delete this.loaders[ye.LEVEL])}}load(e){var t;const r=this.hls.config;let n=this.getInternalLoader(e);if(n){const c=this.hls.logger,u=n.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let i;if(e.type===ye.MANIFEST?i=r.manifestLoadPolicy.default:i=Re({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),ee((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===ye.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===ye.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===ye.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const f=Math.max(u*3,d*.8)*1e3;i=Re({},i,{maxTimeToFirstByteMs:Math.min(f,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,i.maxTimeToFirstByteMs)})}}}const a=i.errorRetry||i.timeoutRetry||{},o={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,u,d,f)=>{const p=this.getInternalLoader(d);this.resetInternalLoader(d.type);const m=c.data;u.parsing.start=performance.now(),Us.isMediaPlaylist(m)||d.type!==ye.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,d,f||null,p):this.handleMasterPlaylist(c,u,d,f)},onError:(c,u,d,f)=>{this.handleNetworkError(u,d,!1,c,f)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}};n.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,n){const i=this.hls,a=e.data,o=Ku(e,r),l=Us.parseMasterPlaylist(a,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,l.playlistParsingError,n,t);return}const{contentSteering:c,levels:u,sessionData:d,sessionKeys:f,startTimeOffset:p,variableList:m}=l;this.variableList=m,u.forEach(v=>{const{unknownCodecs:E}=v;if(E){const{preferManagedMediaSource:T}=this.hls.config;let{audioCodec:w,videoCodec:R}=v;for(let b=E.length;b--;){const _=E[b];_a(_,"audio",T)?(v.audioCodec=w=w?`${w},${_}`:_,vi.audio[w.substring(0,4)]=2,E.splice(b,1)):_a(_,"video",T)&&(v.videoCodec=R=R?`${R},${_}`:_,vi.video[R.substring(0,4)]=2,E.splice(b,1))}}});const{AUDIO:y=[],SUBTITLES:g,"CLOSED-CAPTIONS":x}=Us.parseMasterPlaylistMedia(a,o,l);y.length&&!y.some(E=>!E.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new $e({}),bitrate:0,url:""})),i.trigger(S.MANIFEST_LOADED,{levels:u,audioTracks:y,subtitles:g,captions:x,contentSteering:c,url:o,stats:t,networkDetails:n,sessionData:d,sessionKeys:f,startTimeOffset:p,variableList:m})}handleTrackOrLevelPlaylist(e,t,r,n,i){const a=this.hls,{id:o,level:l,type:c}=r,u=Ku(e,r),d=ee(l)?l:ee(o)?o:0,f=k0(r),p=Us.parseLevelPlaylist(e.data,u,d,f,0,this.variableList);if(c===ye.MANIFEST){const m={attrs:new $e({}),bitrate:0,details:p,name:"",url:u};p.requestScheduled=t.loading.start+RE(p,0),a.trigger(S.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=p,this.handlePlaylistLoaded(p,e,t,r,n,i)}handleManifestParsingError(e,t,r,n,i){this.hls.trigger(S.ERROR,{type:ae.NETWORK_ERROR,details:C.MANIFEST_PARSING_ERROR,fatal:t.type===ye.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:n,stats:i})}handleNetworkError(e,t,r=!1,n,i){let a=`A network ${r?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===ye.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===ye.AUDIO_TRACK||e.type===ye.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=C.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case ye.MANIFEST:l=r?C.MANIFEST_LOAD_TIMEOUT:C.MANIFEST_LOAD_ERROR,c=!0;break;case ye.LEVEL:l=r?C.LEVEL_LOAD_TIMEOUT:C.LEVEL_LOAD_ERROR,c=!1;break;case ye.AUDIO_TRACK:l=r?C.AUDIO_TRACK_LOAD_TIMEOUT:C.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case ye.SUBTITLE_TRACK:l=r?C.SUBTITLE_TRACK_LOAD_TIMEOUT:C.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const d={type:ae.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:o,networkDetails:t,stats:i};if(n){const f=(t==null?void 0:t.url)||e.url;d.response=Ae({url:f,data:void 0},n)}this.hls.trigger(S.ERROR,d)}handlePlaylistLoaded(e,t,r,n,i,a){const o=this.hls,{type:l,level:c,levelOrTrack:u,id:d,groupId:f,deliveryDirectives:p}=n,m=Ku(t,n),y=k0(n);let g=typeof n.level=="number"&&y===re.MAIN?c:void 0;const x=e.playlistParsingError;if(x){if(this.hls.logger.warn(`${x} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(S.ERROR,{type:ae.NETWORK_ERROR,details:C.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:x,reason:x.message,response:t,context:n,level:g,parent:y,networkDetails:i,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const v=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(S.ERROR,{type:ae.NETWORK_ERROR,details:C.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:v,reason:v.message,response:t,context:n,level:g,parent:y,networkDetails:i,stats:r});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ye.MANIFEST:case ye.LEVEL:if(g){if(!u)g=0;else if(u!==o.levels[g]){const v=o.levels.indexOf(u);v>-1&&(g=v)}}o.trigger(S.LEVEL_LOADED,{details:e,levelInfo:u||o.levels[0],level:g||0,id:d||0,stats:r,networkDetails:i,deliveryDirectives:p,withoutMultiVariant:l===ye.MANIFEST});break;case ye.AUDIO_TRACK:o.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:u,id:d||0,groupId:f||"",stats:r,networkDetails:i,deliveryDirectives:p});break;case ye.SUBTITLE_TRACK:o.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:d||0,groupId:f||"",stats:r,networkDetails:i,deliveryDirectives:p});break}}}class ns{static get version(){return ka}static isMSESupported(){return _S()}static isSupported(){return tD()}static getMediaSource(){return Gr()}static get Events(){return S}static get MetadataSchema(){return rs}static get ErrorTypes(){return ae}static get ErrorDetails(){return C}static get DefaultConfig(){return ns.defaultConfig?ns.defaultConfig:GP}static set DefaultConfig(e){ns.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new qf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=hR(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=zP(ns.DefaultConfig,e,t);this.userConfig=e,r.progressive&&KP(r,t);const{abrController:n,bufferController:i,capLevelController:a,errorController:o,fpsController:l}=r,c=new o(this),u=this.abrController=new n(this),d=new oI(this),f=r.interstitialsController,p=f?this.interstitialsController=new f(this,ns):null,m=this.bufferController=new i(this,d),y=this.capLevelController=new a(this),g=new l(this),x=new aD(this),v=r.contentSteeringController,E=v?new v(this):null,T=this.levelController=new eD(this,E),w=new JP(this),R=new iD(this.config,this.logger),b=this.streamController=new nD(this,d,R),_=this.gapController=new XP(this,d);y.setStreamController(b),g.setStreamController(b);const I=[x,T,b];p&&I.splice(1,0,p),E&&I.splice(1,0,E),this.networkControllers=I;const L=[u,m,_,y,g,w,d];this.audioTrackController=this.createController(r.audioTrackController,I);const N=r.audioStreamController;N&&I.push(this.audioStreamController=new N(this,d,R)),this.subtitleTrackController=this.createController(r.subtitleTrackController,I);const M=r.subtitleStreamController;M&&I.push(this.subtititleStreamController=new M(this,d,R)),this.createController(r.timelineController,L),R.emeController=this.emeController=this.createController(r.emeController,L),this.cmcdController=this.createController(r.cmcdController,L),this.latencyController=this.createController(ZP,L),this.coreComponents=L,I.push(c);const $=c.onErrorOut;typeof $=="function"&&this.on(S.ERROR,$,c),this.on(S.MANIFEST_LOADED,x.onManifestLoaded,x)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,n){this._emitter.off(e,t,r,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const n=e===S.ERROR;this.trigger(S.ERROR,{type:ae.OTHER_ERROR,details:C.INTERNAL_EXCEPTION,fatal:n,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:ae.OTHER_ERROR,details:C.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,n=t?e:{media:r};this._media=r,this.trigger(S.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,n=this._url=jf.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[re.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[re.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[re.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=XC()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){zR(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let n=0;n<r;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,r)for(let i=n;i--;){const a=e[i].attrs["HDCP-LEVEL"];if(a&&a<=r)return i}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=fE(t);return dE(e,r,navigator.mediaCapabilities)}}ns.defaultConfig=void 0;const oD=[{id:"hianime-scrap",label:"HiAnime"},{id:"animekai",label:"AnimeKai"},{id:"animepahe",label:"AnimePahe"}],C0=s=>s.find(e=>{var t;return((t=e.name)==null?void 0:t.toLowerCase().replace(/\s+/g,""))==="hd-2"}),lD=()=>{const{id:s}=Ba(),[e]=Va(),t=Rs(),r=e.get("ep"),n=e.get("provider"),i=r?parseInt(r):1,[a,o]=A.useState(null),[l,c]=A.useState([]),[u,d]=A.useState([]),[f,p]=A.useState({sub:[],dub:[],raw:[]}),[m,y]=A.useState(i),[g,x]=A.useState(null),[v,E]=A.useState(null),[T,w]=A.useState(!0),[R,b]=A.useState(null),[_,I]=A.useState(!1),[L,N]=A.useState("sub"),[M,$]=A.useState(null),[G,Y]=A.useState(n||"hianime-scrap"),[U,W]=A.useState(null),[P,B]=A.useState(!1),[K,O]=A.useState(!1);A.useEffect(()=>{let se=!0;const fe=new AbortController;let X=!1;return(async()=>{var Ee,Se;try{w(!0);const De=await Wv(s,{signal:fe.signal});if(!se||(o(De.data),X))return;const lt=await Yv(s,G,{signal:fe.signal});if(!se)return;if(X=!0,lt&&lt.data){d(lt.data);const ue=lt.data.map((me,be)=>({number:me.number||me.episodeNumber||be+1,id:me.id,title:me.title||me.alternativeTitle||`Episode ${me.number||me.episodeNumber||be+1}`,isFiller:me.isFiller||!1}));c(ue)}else{const ue=((Se=(Ee=De.data)==null?void 0:Ee.episodes)==null?void 0:Se.eps)||0;if(ue>0){const me=Array.from({length:ue},(be,Et)=>({number:Et+1,id:`${s}::ep=${Et+1}`}));c(me)}}}catch(De){if(De.message==="Request cancelled"||!se)return;b(De.message||"Failed to load anime")}finally{se&&w(!1)}})(),()=>{se=!1,fe.abort()}},[s,G]),A.useEffect(()=>{if(!s||!m||u.length===0)return;let se=!0;const fe=new AbortController;let X=!1;return(async()=>{if(!X)try{const Ee=u.find(lt=>lt.number===m),Se=(Ee==null?void 0:Ee.id)||`${s}::ep=${m}`,De=await qv(Se,{signal:fe.signal});if(!se)return;if(X=!0,De&&De.data){const lt=De.data,ue={sub:lt.sub||[],dub:lt.dub||[],raw:lt.raw||[]};p(ue),x({episode:lt.episode});const me=ue[L]||ue.sub||[],be=C0(me);$(be||me[0]||null)}}catch(Ee){if(Ee.message==="Request cancelled"||!se)return;console.error("Error fetching servers:",Ee)}})(),()=>{se=!1,fe.abort()}},[s,m,G,u]),A.useEffect(()=>{if(!s||!m||!M||u.length===0)return;let se=!0;const fe=new AbortController;let X=!1;return(async()=>{var Ee,Se;if(!X){I(!0);try{const De=u.find(be=>be.number===m),lt=(De==null?void 0:De.id)||`${s}::ep=${m}`,ue=M.name||M,me=await ih(lt,ue,L,G,{signal:fe.signal});if(!se)return;if(X=!0,me&&me.data){E(me.data);const be=((Ee=me.data.link)==null?void 0:Ee.file)||((Se=me.data.link)==null?void 0:Se.directUrl)||me.data.streamingLink;if(be){const Et=H_(be);W(Et)}else b("No stream URL available")}else b("Failed to load stream data")}catch(De){if(De.message==="Request cancelled"||!se)return;b(`Failed to load stream: ${De.message}`)}finally{se&&I(!1)}}})(),()=>{se=!1,fe.abort()}},[s,m,L,M,u]);const F=se=>{y(se),x(null),W(null),E(null),B(!1),t(`?ep=${se}&provider=${G}`,{replace:!0})},Z=se=>{$(se),O(!1),W(null),E(null)},te=se=>{N(se);const fe=f[se]||[],X=C0(fe);$(X||fe[0]||null),W(null),E(null)},z=se=>{Y(se),$(null),x(null),W(null),E(null),t(`?ep=${m}&provider=${se}`,{replace:!0})},Q=()=>{m<l.length&&F(m+1)};if(T)return h.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col items-center justify-center",children:[h.jsx("div",{className:"relative",children:h.jsx(gi,{className:"animate-spin text-white text-5xl relative z-10"})}),h.jsx("p",{className:"mt-8 text-gray-500 text-sm tracking-wide uppercase",children:"Loading anime..."})]});if(R)return h.jsx("div",{className:"min-h-screen bg-gray-950 flex items-center justify-center p-4",children:h.jsxs("div",{className:"bg-gray-900/80 backdrop-blur-xl border border-red-500/20 rounded-2xl p-8 max-w-md text-center shadow-2xl",children:[h.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-2xl flex items-center justify-center mx-auto mb-6",children:h.jsx(En,{className:"text-red-400 text-2xl"})}),h.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Failed to Load"}),h.jsx("p",{className:"text-red-400/80 text-sm mb-8",children:R}),h.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/30 rounded-xl transition-all duration-200 text-sm font-medium",children:"Try Again"})]})});const ge=Rc(a==null?void 0:a.poster);return h.jsxs("div",{className:"min-h-screen bg-gray-950 text-white",children:[h.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-gray-950/80 backdrop-blur-xl border-b border-white/5",children:h.jsxs("div",{className:"container mx-auto flex items-center justify-between px-3 sm:px-4 py-2 sm:py-3",children:[h.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg bg-white/5 hover:bg-white/10 transition-all duration-200 group touch-manipulation",children:[h.jsx(xc,{size:16,className:"sm:w-[18px] sm:h-[18px] text-gray-400 group-hover:text-white transition-colors"}),h.jsx("span",{className:"text-xs sm:text-sm text-gray-400 group-hover:text-white transition-colors",children:"Back"})]}),h.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 max-w-xs sm:max-w-md",children:[ge&&h.jsx("img",{src:ge,alt:a==null?void 0:a.title,className:"w-6 h-9 sm:w-8 sm:h-11 object-cover rounded-md shadow-lg hidden md:block"}),h.jsx("h1",{className:"font-semibold text-xs sm:text-sm md:text-base truncate max-w-[120px] sm:max-w-xs md:max-w-md text-white/90",children:a==null?void 0:a.title})]}),h.jsx("button",{className:"p-1.5 sm:p-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 hover:text-red-400 transition-all duration-200 touch-manipulation",children:h.jsx(qr,{size:16,className:"sm:w-[18px] sm:h-[18px]"})})]})}),h.jsxs("div",{className:"pt-14",children:[h.jsx("div",{className:"relative bg-black aspect-video w-full",children:_?h.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-950",children:[h.jsxs("div",{className:"relative",children:[h.jsx("div",{className:"absolute inset-0 bg-violet-500/20 blur-2xl rounded-full animate-pulse"}),h.jsx(gi,{className:"animate-spin text-violet-500 text-4xl relative z-10"})]}),h.jsx("p",{className:"mt-6 text-gray-500 text-sm tracking-wide uppercase",children:"Loading stream..."})]}):U?h.jsx(cD,{src:U,poster:ge,tracks:(v==null?void 0:v.tracks)||[],animeId:s,episodeNumber:m,onNextEpisode:Q}):h.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-950",children:h.jsxs("div",{className:"text-center p-8",children:[h.jsx("div",{className:"w-16 h-16 bg-gray-800 rounded-2xl flex items-center justify-center mx-auto mb-4",children:h.jsx(En,{size:32,className:"text-gray-400"})}),h.jsx("p",{className:"text-gray-300 text-base font-medium",children:M?"Preparing your stream...":"Select a server to start watching"}),h.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Choose from available servers below"})]})})}),h.jsxs("div",{className:"bg-gray-900/50 border-t border-white/5",children:[h.jsxs("div",{className:"container mx-auto px-4 py-4 flex flex-wrap items-center justify-between gap-4",children:[h.jsxs("div",{className:"flex items-center gap-2 bg-gray-900/80 rounded-xl p-1.5 border border-white/5",children:[h.jsx("button",{disabled:m<=1,onClick:()=>F(m-1),className:"p-2.5 bg-gray-800 hover:bg-gray-700 disabled:opacity-30 disabled:hover:bg-gray-800 rounded-lg transition-all duration-200",children:h.jsx(wf,{size:18})}),h.jsxs("div",{className:"px-4 py-2 min-w-[100px] text-center",children:[h.jsx("span",{className:"text-gray-500 text-[10px] uppercase tracking-wider block",children:"Episode"}),h.jsxs("p",{className:"font-semibold text-white text-sm",children:[m," ",h.jsxs("span",{className:"text-gray-500 font-normal",children:["/ ",l.length]})]})]}),h.jsx("button",{disabled:m>=l.length,onClick:()=>F(m+1),className:"p-2.5 bg-gray-800 hover:bg-violet-600 disabled:opacity-30 disabled:hover:bg-gray-800 rounded-lg transition-all duration-200",children:h.jsx(Af,{size:18})})]}),h.jsxs("div",{className:"flex gap-1.5 sm:gap-2 flex-wrap",children:[h.jsxs("div",{className:"relative",children:[h.jsx("select",{value:G,onChange:se=>z(se.target.value),className:"px-2 sm:px-3 py-2 sm:py-2.5 bg-gray-900/80 border border-white/10 rounded-xl text-white text-xs sm:text-sm appearance-none pr-7 sm:pr-9 cursor-pointer hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:border-white/50 min-w-[100px] sm:min-w-[120px] touch-manipulation",children:oD.map(se=>h.jsx("option",{value:se.id,children:se.label},se.id))}),h.jsx(IA,{className:"absolute right-2 sm:right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none w-3 h-3 sm:w-[14px] sm:h-[14px]"})]}),h.jsxs("button",{onClick:()=>B(!P),className:`flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl transition-all duration-200 text-xs sm:text-sm font-medium border touch-manipulation ${P?"bg-white border-white text-black":"bg-gray-900/80 border-white/10 hover:bg-gray-800 text-gray-300"}`,children:[h.jsx(pv,{size:14,className:"sm:w-4 sm:h-4"}),h.jsx("span",{className:"hidden xs:inline",children:"Episodes"}),h.jsx("span",{className:"xs:hidden",children:"Eps"})]}),h.jsxs("button",{onClick:()=>O(!K),className:`flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl transition-all duration-200 text-xs sm:text-sm font-medium border touch-manipulation ${K?"bg-violet-600 border-violet-500 text-white":"bg-gray-900/80 border-white/10 hover:bg-gray-800 text-gray-300"}`,children:[h.jsx(_f,{size:14,className:"sm:w-4 sm:h-4"}),h.jsx("span",{children:"Server"})]})]}),h.jsx("div",{className:"flex bg-gray-900/80 rounded-xl p-1 border border-white/5",children:["sub","dub","raw"].map(se=>h.jsx("button",{onClick:()=>te(se),className:`px-4 py-2 rounded-lg capitalize text-sm font-medium transition-all duration-200 ${L===se?"bg-white text-black":"text-gray-400 hover:text-white hover:bg-white/5"}`,children:se},se))})]}),P&&h.jsx(uD,{episodes:l,currentEpisode:m,onSelect:F}),K&&h.jsx(dD,{servers:f,selectedType:L,selectedServer:M,onServerChange:Z,onTypeChange:te})]})]})]})},cD=({src:s,poster:e,tracks:t=[],animeId:r,episodeNumber:n,onNextEpisode:i})=>{const a=A.useRef(null),o=A.useRef(null),l=A.useRef(null),c=A.useRef(null),u=A.useRef(0),d=A.useRef(0),f=A.useRef(0),p=A.useRef(0),[m,y]=A.useState(!1),[g,x]=A.useState(!1),[v,E]=A.useState(1),[T,w]=A.useState(0),[R,b]=A.useState(0),[_,I]=A.useState(0),[L,N]=A.useState(0),[M,$]=A.useState(!0),[G,Y]=A.useState(null),[U,W]=A.useState(!1),[P,B]=A.useState(0),[K,O]=A.useState(1),[F,Z]=A.useState("auto"),[te,z]=A.useState([]),[Q,ge]=A.useState(!0),[se,fe]=A.useState(!1),[X,Pe]=A.useState(!1),[Ee,Se]=A.useState(null),[De,lt]=A.useState(!1),[ue,me]=A.useState(!1),[be,Et]=A.useState(null),[Ot,Ks]=A.useState(!1),[Ws,_i]=A.useState(!1),[St,Ri]=A.useState([]),[qt,Ii]=A.useState([]),eo=A.useRef(null),Ys=A.useRef(new Set),[Xt,Mt]=A.useState("none"),[Fc,mm]=A.useState(1),[to,so]=A.useState(null),[Jr,jc]=A.useState("fit"),[pm,gm]=A.useState(0),[mT,pT]=A.useState(1),[ro,$c]=A.useState(1),[ym,gT]=A.useState({x:0,y:0}),[xm,vm]=A.useState(!1),no=D=>{const H=D.replace(/\r/g,"").split(/\n\s*\n/);let ne=`WEBVTT

`;for(const J of H){const oe=J.split(`
`).map(gr=>gr.trim()).filter(Boolean);if(oe.length<2)continue;let we=0;/^\d+$/.test(oe[0])&&(we=1);const Ke=oe[we];if(!Ke||!Ke.includes("-->"))continue;const Fe=Ke.replace(/,/g,"."),pr=oe.slice(we+1).map(gr=>gr.replace(/xywh=\d+,\d+,\d+,\d+/gi,"").replace(/^[^a-zA-Z0-9]*[a-z0-9_\-]{2,20}={1,3}/gi,"").replace(/{\\.*?}/g,"").replace(/sprite-\d+\.[a-z]+/gi,"").replace(/\b\d{3,4},\d{3,4},\d{3,4},\d{3,4}\b/g,"").replace(/={2,}/g,"").trim()).filter(gr=>gr.length>0);pr.length&&(ne+=Fe+`
`,ne+=pr.join(`
`)+`

`)}return ne},yT=async D=>{try{console.log("[VideoPlayer] Trying direct subtitle fetch:",D);const H=await fetch(D,{method:"GET",headers:{Accept:"*/*, text/plain, application/octet-stream"}});if(H.ok){const ne=await H.text();if(ne.length>0&&!ne.includes("<!DOCTYPE")){console.log("[VideoPlayer] Direct fetch successful, content length:",ne.length);const J=no(ne),oe=new Blob([J],{type:"text/vtt"}),we=URL.createObjectURL(oe);return Ys.current.add(we),we}}}catch(H){console.log("[VideoPlayer] Direct subtitle fetch failed:",H.message)}try{const H=z_(D);console.log("[VideoPlayer] Trying proxied subtitle fetch:",H);const ne=await fetch(H,{method:"GET",headers:{Accept:"*/*"}});if(ne.ok){const J=await ne.text();if(J.length>0&&!J.includes("<!DOCTYPE")){console.log("[VideoPlayer] Proxied fetch successful, content length:",J.length);const oe=no(J),we=new Blob([oe],{type:"text/vtt"}),Ke=URL.createObjectURL(we);return Ys.current.add(Ke),Ke}}else console.log("[VideoPlayer] Proxied fetch returned status:",ne.status)}catch(H){console.log("[VideoPlayer] Proxied subtitle fetch failed:",H.message)}return console.log("[VideoPlayer] All subtitle fetch strategies failed for:",D),null},xT=()=>{if(U){try{const H=new URL(s).searchParams.get("url");if(H)return decodeURIComponent(H)}catch(D){console.error("Error parsing proxy URL:",D)}return s}return s};A.useEffect(()=>{if(r&&n){const D=`watch-progress-${r}-${n}`,H=localStorage.getItem(D);if(H){const{time:ne,timestamp:J}=JSON.parse(H);if((Date.now()-J)/(1e3*60*60*24)<30&&ne>10){const we=a.current;we&&(we.currentTime=ne,N(ne))}}}},[r,n]),A.useEffect(()=>{if(!r||!n||!L)return;const D=setInterval(()=>{const H=`watch-progress-${r}-${n}`;localStorage.setItem(H,JSON.stringify({time:L,duration:_,timestamp:Date.now()}))},5e3);return()=>clearInterval(D)},[r,n,L,_]),A.useEffect(()=>{const D=localStorage.getItem("player-volume"),H=localStorage.getItem("player-playback-rate"),ne=localStorage.getItem("player-quality"),J=localStorage.getItem("player-brightness");D&&E(parseFloat(D)),H&&O(parseFloat(H)),ne&&Z(ne),J&&mm(parseFloat(J))},[]),A.useEffect(()=>{const D=a.current,H=xT();if(!D||!H)return;if(Y(null),o.current&&(o.current.detachMedia(),o.current.destroy(),o.current=null),D.pause(),D.removeAttribute("src"),D.load(),(H.includes(".m3u8")||H.includes("playlist"))&&ns.isSupported()){const J=new ns({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:600,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:3,xhrSetup:function(oe){oe.withCredentials=!1}});J.loadSource(H),J.attachMedia(D),o.current=J,J.on(ns.Events.MANIFEST_PARSED,(oe,we)=>{const Ke=we.levels.map((Fe,Qt)=>({index:Qt,height:Fe.height,width:Fe.width,bitrate:Fe.bitrate,label:Fe.height?`${Fe.height}p`:`Quality ${Qt+1}`})).sort((Fe,Qt)=>(Qt.height||0)-(Fe.height||0));if(z([{index:-1,label:"Auto"},...Ke]),F!=="auto"&&J){const Fe=Ke.find(Qt=>Qt.label===F);Fe&&(J.currentLevel=Fe.index)}D.play().catch(()=>{})}),J.on(ns.Events.ERROR,(oe,we)=>{if(we.fatal)switch(we.type){case ns.ErrorTypes.NETWORK_ERROR:P<2?(B(Ke=>Ke+1),J.startLoad()):U?(Y("Network error: Unable to load stream."),J.destroy()):(W(!0),B(0));break;case ns.ErrorTypes.MEDIA_ERROR:J.recoverMediaError();break;default:U?(Y("Failed to load video stream."),J.destroy()):W(!0);break}})}else D.src=H,D.load(),D.play().catch(()=>{});return()=>{o.current&&(o.current.detachMedia(),o.current.destroy(),o.current=null)}},[s,U,P]),A.useEffect(()=>{const D=a.current;D&&(m?D.play().catch(H=>{console.error("Play error:",H),y(!1)}):D.pause())},[m]),A.useEffect(()=>{const D=a.current;D&&(D.volume=v,D.muted=g||v===0,localStorage.setItem("player-volume",v.toString()))},[v,g]),A.useEffect(()=>{localStorage.setItem("player-brightness",Fc.toString())},[Fc]),A.useEffect(()=>{localStorage.setItem("player-zoom-mode",Jr),$c(1),gT({x:0,y:0})},[Jr]),A.useEffect(()=>{const D=a.current;D&&(D.playbackRate=K,localStorage.setItem("player-playback-rate",K.toString()))},[K]),A.useEffect(()=>((async()=>{if(t.length===0){console.log("[VideoPlayer] No tracks available"),Ri([]);return}console.log("[VideoPlayer] Converting tracks:",t.length,t);const ne=(await Promise.all(t.map(async(J,oe)=>{const we=await yT(J.file);return{...J,vttUrl:we,index:oe}}))).filter(J=>J.vttUrl!==null);console.log("[VideoPlayer] Successfully converted tracks:",ne.length,ne),Ri(ne)})(),()=>{St.forEach(H=>{H.vttUrl&&H.vttUrl.startsWith("blob:")&&URL.revokeObjectURL(H.vttUrl)})}),[t]),A.useEffect(()=>{const D=a.current;if(!D||St.length===0)return;console.log("[VideoPlayer] Setting up text tracks, converted:",St.length);const H=()=>{console.log("[VideoPlayer] Metadata loaded, textTracks:",D.textTracks.length);const ne=D.textTracks;for(let J=0;J<ne.length;J++){const oe=ne[J];console.log(`[VideoPlayer] Track ${J}: kind=${oe.kind}, mode=${oe.mode}, label=${oe.label}`),(oe.kind==="subtitles"||oe.kind==="captions")&&(oe.mode=Q?"showing":"hidden",console.log(`[VideoPlayer] Set track ${J} mode to:`,oe.mode))}};return D.addEventListener("loadedmetadata",H),D.readyState>=1&&H(),()=>{D.removeEventListener("loadedmetadata",H)}},[St,Q]),A.useEffect(()=>{const D=St&&St.length>0,H=qt&&qt.length>0;(J=>{if(!J||J==="none")return!1;if(J.startsWith("user-")){const oe=Number(J.split("-")[1]);return!isNaN(oe)&&qt[oe]}if(J.startsWith("cloud-")){const oe=Number(J.split("-")[1]);return!isNaN(oe)&&St[oe]}return!1})(Xt)||Mt(H?"user-0":D?"cloud-0":"none")},[St,qt]),A.useEffect(()=>()=>{try{Ys.current.forEach(D=>{D&&D.startsWith&&D.startsWith("blob:")&&URL.revokeObjectURL(D)})}catch{}Ys.current.clear()},[]);const vT=A.useCallback(D=>{if(Z(D),localStorage.setItem("player-quality",D),o.current)if(D==="auto")o.current.currentLevel=-1;else{const H=te.find(ne=>ne.label===D);H&&H.index>=0&&(o.current.currentLevel=H.index)}},[te]),ET=A.useCallback(()=>{const D=a.current;if(!D)return;const H=D.textTracks,ne=!Q;for(let J=0;J<H.length;J++)(H[J].kind==="subtitles"||H[J].kind==="captions")&&(H[J].mode=ne?"showing":"hidden");ge(ne)},[Q]),ST=async D=>{var ne;const H=(ne=D.target.files)==null?void 0:ne[0];if(H)try{const J=await H.text();let oe=J;H.name.toLowerCase().endsWith(".srt")?oe=no(J):J.trim().startsWith("WEBVTT")||(oe=no(J));const we=new Blob([oe],{type:"text/vtt"}),Ke=URL.createObjectURL(we);Ys.current.add(Ke);const Fe={vttUrl:Ke,label:H.name,lang:"en",index:`user-${Date.now()}`};Ii(Qt=>{const pr=[...Qt,Fe];return Mt(`user-${pr.length-1}`),pr}),ge(!0)}catch(J){console.error("Failed to load subtitle file",J)}finally{D.target&&(D.target.value="")}},TT=D=>{const H=Number(D);isNaN(H)||Ii(ne=>{const J=ne[H];if(J&&J.vttUrl&&J.vttUrl.startsWith("blob:")){try{URL.revokeObjectURL(J.vttUrl)}catch{}Ys.current.delete(J.vttUrl)}const oe=ne.filter((we,Ke)=>Ke!==H);return Xt===`user-${H}`&&(oe.length>0?Mt("user-0"):St.length>0?Mt("cloud-0"):Mt("none")),oe})};A.useEffect(()=>{const D=H=>{if(H.target.tagName==="INPUT"||H.target.tagName==="TEXTAREA")return;const ne=a.current;if(ne)switch(H.key.toLowerCase()){case" ":case"k":H.preventDefault(),y(oe=>!oe);break;case"arrowleft":case"j":H.preventDefault(),ne.currentTime=Math.max(0,ne.currentTime-10),mr("backward");break;case"arrowright":case"l":H.preventDefault(),ne.currentTime=Math.min(ne.duration,ne.currentTime+10),mr("forward");break;case"arrowup":H.preventDefault(),E(oe=>Math.min(1,oe+.1));break;case"arrowdown":H.preventDefault(),E(oe=>Math.max(0,oe-.1));break;case"f":H.preventDefault(),Em();break;case"m":H.preventDefault(),x(oe=>!oe);break;case"t":H.preventDefault(),fe(oe=>!oe);break;case"z":H.preventDefault(),Sm();break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":H.preventDefault();const J=parseInt(H.key)*10;ne.currentTime=J/100*ne.duration;break}};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[]),A.useEffect(()=>{const D=()=>{lt(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",D),()=>document.removeEventListener("fullscreenchange",D)},[]);const bT=D=>{if(u.current=D.touches[0].clientX,d.current=D.touches[0].clientY,f.current=Date.now(),D.touches.length===2){const H=D.touches[0],ne=D.touches[1],J=Math.sqrt(Math.pow(ne.clientX-H.clientX,2)+Math.pow(ne.clientY-H.clientY,2));gm(J),pT(ro),vm(!0)}},wT=D=>{if(D.touches.length===2&&pm>0){D.preventDefault();const H=D.touches[0],ne=D.touches[1],oe=Math.sqrt(Math.pow(ne.clientX-H.clientX,2)+Math.pow(ne.clientY-H.clientY,2))/pm,we=Math.max(.5,Math.min(3,mT*oe));$c(we),we<=1?jc("fit"):jc("zoom")}},AT=D=>{const H=D.changedTouches[0].clientX,ne=D.changedTouches[0].clientY,J=Date.now()-f.current,oe=Date.now();if(D.touches.length<2&&(gm(0),vm(!1)),D.touches.length===0&&!xm){const we=H-u.current,Ke=ne-d.current;if(J<250&&J>50&&Math.abs(we)<20&&Math.abs(Ke)<20)if(p.current&&oe-p.current<300){const Fe=a.current;if(Fe){const Qt=Fe.getBoundingClientRect();u.current-Qt.left<Qt.width/2?(Fe.currentTime=Math.max(0,Fe.currentTime-10),mr("backward")):(Fe.currentTime=Math.min(Fe.duration,Fe.currentTime+10),mr("forward"))}p.current=0;return}else p.current=oe;if(Math.abs(Ke)>Math.abs(we)&&Math.abs(Ke)>50&&J>100){const Fe=window.innerWidth,pr=u.current<Fe/2,gr=-(Ke/window.innerHeight)*.5;pr?mm(Uc=>{const Ci=Math.max(.3,Math.min(2,Uc+gr));return so({type:"brightness",value:Math.round(Ci*100)}),setTimeout(()=>so(null),1500),Ci}):E(Uc=>{const Ci=Math.max(0,Math.min(1,Uc+gr));return so({type:"volume",value:Math.round(Ci*100)}),setTimeout(()=>so(null),1500),Ci})}else J<250&&Math.abs(we)<20&&Math.abs(Ke)<20&&($(!0),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>$(!1),4e3))}},mr=D=>{me(D),setTimeout(()=>me(!1),800)};A.useEffect(()=>{if(!i||!_)return;const D=a.current;if(!D)return;const ne=setInterval(()=>{const J=_-D.currentTime;J<15&&J>0&&!be?Et(Math.ceil(J)):J<=0&&be&&i()},1e3);return()=>clearInterval(ne)},[_,i,be]),A.useEffect(()=>{if(be===null||be<=0)return;const D=setTimeout(()=>{Et(H=>H>1?H-1:0)},1e3);return()=>clearTimeout(D)},[be]);const LT=()=>{const D=a.current;if(D&&(N(D.currentTime),I(D.duration),D.duration>0&&w(D.currentTime/D.duration*100),D.buffered.length>0)){const H=D.buffered.end(D.buffered.length-1);b(H/D.duration*100)}},_T=()=>Ks(!0),RT=()=>Ks(!1),IT=D=>{const H=a.current;if(!H)return;const ne=D.target.value/100*H.duration;H.currentTime=ne,w(D.target.value)},Em=()=>{var D;document.fullscreenElement?document.exitFullscreen():(D=l.current)==null||D.requestFullscreen()},kT=D=>{if(D.preventDefault(),"ontouchstart"in window||navigator.maxTouchPoints>0)return;const H=a.current;if(H){const ne=H.getBoundingClientRect();D.clientX-ne.left<ne.width/2?(H.currentTime=Math.max(0,H.currentTime-10),mr("backward")):(H.currentTime=Math.min(H.duration,H.currentTime+10),mr("forward"))}},CT=()=>{const D=a.current;D&&(D.currentTime=Math.min(D.duration,D.currentTime+10),mr("forward"))},PT=()=>{const D=a.current;D&&(D.currentTime=Math.max(0,D.currentTime-10),mr("backward"))},DT=()=>{Et(null)},Sm=A.useCallback(()=>{const D=["fit","fill","stretch","zoom"],ne=(D.indexOf(Jr)+1)%D.length,J=D[ne];jc(J),J==="zoom"&&ro<=1&&$c(1.5)},[Jr,ro]),NT=()=>{switch(Jr){case"fit":return{objectFit:"contain",transform:"scale(1)",transformOrigin:"center"};case"fill":return{objectFit:"cover",transform:"scale(1)",transformOrigin:"center"};case"stretch":return{objectFit:"fill",transform:"scale(1)",transformOrigin:"center"};case"zoom":return{objectFit:"cover",transform:`scale(${ro}) translate(${ym.x}px, ${ym.y}px)`,transformOrigin:"center",transition:xm?"none":"transform 0.3s ease-out"};default:return{objectFit:"contain",transform:"scale(1)",transformOrigin:"center"}}},ki=D=>{if(!D||isNaN(D))return"0:00";const H=Math.floor(D/60),ne=Math.floor(D%60);return`${H}:${ne.toString().padStart(2,"0")}`};return h.jsxs("div",{ref:l,className:`relative group w-full bg-black overflow-hidden flex items-center justify-center transition-all duration-300 ${se?"h-[85vh]":"h-full"}`,onMouseMove:()=>{$(!0),c.current&&clearTimeout(c.current),m&&(c.current=setTimeout(()=>$(!1),3e3))},onMouseLeave:()=>m&&$(!1),onDoubleClick:kT,onTouchStart:bT,onTouchMove:wT,onTouchEnd:AT,children:[G?h.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center bg-gray-900 text-red-500",children:[h.jsx(En,{size:48,className:"mb-2"}),h.jsx("p",{children:G}),h.jsxs("div",{className:"flex gap-2 mt-4",children:[!U&&h.jsx("button",{onClick:()=>{W(!0),Y(null),B(0)},className:"px-4 py-2 bg-blue-600 rounded text-white hover:bg-blue-700",children:"Try Direct URL"}),h.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-purple-600 rounded text-white hover:bg-purple-700",children:"Reload Player"})]})]}):h.jsx("video",{ref:a,className:"w-full h-full",poster:e,onTimeUpdate:LT,onWaiting:_T,onCanPlay:RT,onClick:()=>{$(!0),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>$(!1),4e3)},muted:g||v===0,playsInline:!0,crossOrigin:"anonymous",style:{filter:`brightness(${Fc})`,...NT()},children:(()=>{if(Xt==="none")return null;let D=null;if(Xt.startsWith("user-")){const H=Number(Xt.split("-")[1]);D=qt[H]}else if(Xt.startsWith("cloud-")){const H=Number(Xt.split("-")[1]);D=St[H]}return D?h.jsx("track",{kind:"subtitles",src:D.vttUrl,srclang:D.lang||"en",label:D.label||"English",default:!0},`track-${D.index}`):null})()}),Ot&&h.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 z-10 pointer-events-none",children:h.jsx("div",{className:"relative",children:h.jsx(gi,{className:"animate-spin text-white text-4xl relative z-10"})})}),ue&&h.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:h.jsx("div",{className:"bg-black/80 backdrop-blur-md rounded-2xl px-8 py-6 transform transition-all duration-300",children:ue==="forward"?h.jsxs("div",{className:"flex items-center gap-3 text-white",children:[h.jsx(Up,{size:32,className:"text-white"}),h.jsx("span",{className:"text-xl font-semibold",children:"+10s"})]}):h.jsxs("div",{className:"flex items-center gap-3 text-white",children:[h.jsx(Vp,{size:32,className:"text-white"}),h.jsx("span",{className:"text-xl font-semibold",children:"-10s"})]})})}),to&&h.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none z-20",children:h.jsx("div",{className:"bg-black/80 backdrop-blur-md rounded-2xl px-6 py-4 transform transition-all duration-300",children:h.jsx("div",{className:"flex items-center gap-3 text-white",children:to.type==="volume"?h.jsxs(h.Fragment,{children:[h.jsx(Qd,{size:24,className:"text-white"}),h.jsxs("span",{className:"text-lg font-semibold",children:[to.value,"%"]})]}):h.jsxs(h.Fragment,{children:[h.jsx(gu,{size:24,className:"text-white"}),h.jsxs("span",{className:"text-lg font-semibold",children:[to.value,"%"]})]})})})}),be!==null&&i&&h.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center z-30",children:h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-gray-400 text-sm uppercase tracking-wider mb-4",children:"Next episode in"}),h.jsx("div",{className:"text-5xl font-bold text-white mb-8",children:be}),h.jsxs("div",{className:"flex gap-3 justify-center",children:[h.jsx("button",{onClick:DT,className:"px-5 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-gray-300 text-sm font-medium transition-all duration-200",children:"Cancel"}),h.jsxs("button",{onClick:i,className:"px-5 py-2 bg-white hover:bg-gray-200 rounded-lg text-black text-sm font-medium transition-all duration-200 flex items-center gap-2",children:[h.jsx(kA,{size:16})," Play Now"]})]})]})}),h.jsxs("div",{className:`absolute inset-0 flex flex-col justify-between transition-opacity duration-300 ${M||!m||X?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:D=>D.stopPropagation(),children:[h.jsxs("div",{className:"p-4 sm:p-6 flex items-center justify-between bg-gradient-to-b from-black/80 via-black/40 to-transparent",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[e&&h.jsx("img",{src:e,alt:"",className:"w-10 h-14 object-cover rounded-lg shadow-lg hidden sm:block opacity-80"}),h.jsxs("div",{children:[h.jsxs("p",{className:"text-white/90 font-medium text-sm sm:text-base line-clamp-1",children:["Episode ",n]}),h.jsxs("p",{className:"text-white/40 text-xs mt-0.5",children:[ki(L)," / ",ki(_)]})]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsxs("button",{onClick:()=>fe(!se),className:`p-2 rounded-lg transition-all duration-200 group relative ${se?"bg-white text-black":"bg-white/10 hover:bg-white/20 text-white/80 hover:text-white"}`,onMouseEnter:()=>Se("theater"),onMouseLeave:()=>Se(null),children:[h.jsx(gu,{size:18}),Ee==="theater"&&h.jsx("span",{className:"absolute top-full mt-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900/90 text-white text-xs rounded-md whitespace-nowrap border border-white/10",children:"Theater Mode (T)"})]}),h.jsxs("button",{onClick:Sm,className:"p-2 rounded-lg transition-all duration-200 group relative bg-white/10 hover:bg-white/20 text-white/80 hover:text-white",onMouseEnter:()=>Se("zoom"),onMouseLeave:()=>Se(null),children:[h.jsx(gu,{size:18}),Ee==="zoom"&&h.jsxs("span",{className:"absolute top-full mt-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900/90 text-white text-xs rounded-md whitespace-nowrap border border-white/10",children:["Zoom: ",Jr.charAt(0).toUpperCase()+Jr.slice(1)," (Z)"]})]})]})]}),h.jsx("div",{className:"flex-1 flex items-center justify-center",children:!m&&!Ot&&h.jsx("button",{onClick:()=>y(!0),className:"p-4 sm:p-6 bg-white rounded-full text-black transform transition-all duration-200 hover:scale-110 group touch-manipulation",children:h.jsx(ke,{size:24,className:"sm:w-8 sm:h-8 ml-0.5 sm:ml-1 group-hover:scale-105 transition-transform"})})}),h.jsxs("div",{className:"p-4 sm:p-6 bg-gradient-to-t from-black via-black/90 to-transparent",children:[h.jsxs("div",{className:"relative mb-4 group",children:[h.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-0 h-1.5 bg-gray-600/50 rounded-full pointer-events-none",style:{width:`${R}%`}}),h.jsx("input",{type:"range",className:"relative z-10 w-full h-1 bg-white/30 rounded-full appearance-none cursor-pointer transition-all",min:"0",max:"100",value:T||0,onChange:IT,style:{background:`linear-gradient(to right, #ffffff 0%, #ffffff ${T}%, transparent ${T}%, transparent 100%)`}}),h.jsx("div",{className:"absolute -top-8 left-0 bg-gray-900/90 backdrop-blur-sm px-2 py-1 rounded text-xs text-white opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:ki(L)})]}),h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 sm:gap-4",children:[h.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[h.jsxs("button",{onClick:()=>y(!m),className:"p-2.5 sm:p-3 rounded-full bg-white/10 hover:bg-white/20 transition-all duration-300 hover:scale-110 group relative",onMouseEnter:()=>Se("play"),onMouseLeave:()=>Se(null),children:[m?h.jsx(RA,{size:20}):h.jsx(ke,{size:20}),Ee==="play"&&h.jsx("span",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-black/90 text-white text-xs rounded whitespace-nowrap",children:m?"Pause (Space)":"Play (Space)"})]}),h.jsxs("button",{onClick:PT,className:"p-2 sm:p-2.5 rounded-full bg-white/10 hover:bg-white/20 transition-all duration-300 hover:scale-110 group relative hidden sm:block",onMouseEnter:()=>Se("back"),onMouseLeave:()=>Se(null),children:[h.jsx(Vp,{size:18}),Ee==="back"&&h.jsx("span",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-black/90 text-white text-xs rounded whitespace-nowrap",children:"-10s ()"})]}),h.jsxs("button",{onClick:CT,className:"p-2 sm:p-2.5 rounded-full bg-white/10 hover:bg-white/20 transition-all duration-300 hover:scale-110 group relative hidden sm:block",onMouseEnter:()=>Se("forward"),onMouseLeave:()=>Se(null),children:[h.jsx(Up,{size:18}),Ee==="forward"&&h.jsx("span",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-black/90 text-white text-xs rounded whitespace-nowrap",children:"+10s ()"})]}),h.jsxs("div",{className:"flex items-center gap-2 bg-white/10 rounded-full p-1.5 sm:p-2 hover:bg-white/20 transition-all group/volume",onMouseEnter:()=>_i(!0),onMouseLeave:()=>_i(!1),children:[h.jsx("button",{onClick:()=>x(!g),className:"p-1 rounded-full hover:bg-white/10 transition-all",children:g||v===0?h.jsx(xv,{size:18}):v<.5?h.jsx(PA,{size:18}):h.jsx(Qd,{size:18})}),h.jsx("div",{className:`overflow-hidden transition-all duration-300 ${Ws?"w-24 opacity-100":"w-0 opacity-0"}`,children:h.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:v,onChange:D=>E(parseFloat(D.target.value)),className:"w-full h-1 bg-gray-600 rounded-full appearance-none cursor-pointer"})})]}),h.jsx("div",{className:"bg-gray-900/60 backdrop-blur-sm px-3 py-1.5 rounded-lg border border-white/10 hidden sm:block",children:h.jsxs("span",{className:"text-sm font-mono text-gray-300",children:[h.jsx("span",{className:"text-white font-semibold",children:ki(L)}),h.jsx("span",{className:"mx-1 text-gray-500",children:"/"}),h.jsx("span",{className:"text-gray-400",children:ki(_)})]})})]}),h.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 md:gap-3",children:[h.jsxs("div",{className:"relative",children:[h.jsxs("button",{onClick:()=>Pe(!X),className:`p-2 sm:p-2.5 rounded-full transition-all duration-300 group relative touch-manipulation ${X?"bg-white text-black":"bg-white/10 hover:bg-white/20 text-white"}`,onMouseEnter:()=>Se("settings"),onMouseLeave:()=>Se(null),children:[h.jsx(_f,{size:18,className:"sm:w-5 sm:h-5"}),Ee==="settings"&&h.jsx("span",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-black/90 text-white text-xs rounded whitespace-nowrap",children:"Settings"})]}),X&&h.jsx("div",{className:"absolute bottom-full mb-2 right-0 w-44 sm:w-48 bg-gray-900/95 backdrop-blur-md rounded-xl border border-white/10 shadow-2xl p-2 sm:p-3 z-50",children:h.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-xs text-gray-400 mb-1 sm:mb-1.5",children:"Speed"}),h.jsxs("select",{value:K,onChange:D=>O(parseFloat(D.target.value)),className:"w-full px-2 py-1.5 bg-gray-800 rounded-lg text-sm text-white border border-white/10 focus:outline-none focus:border-white/50 touch-manipulation",children:[h.jsx("option",{value:.5,children:"0.5x"}),h.jsx("option",{value:.75,children:"0.75x"}),h.jsx("option",{value:1,children:"1x"}),h.jsx("option",{value:1.25,children:"1.25x"}),h.jsx("option",{value:1.5,children:"1.5x"}),h.jsx("option",{value:2,children:"2x"})]})]}),te.length>1&&h.jsxs("div",{children:[h.jsx("p",{className:"text-xs text-gray-400 mb-1 sm:mb-1.5",children:"Quality"}),h.jsx("select",{value:F,onChange:D=>vT(D.target.value),className:"w-full px-2 py-1.5 bg-gray-800 rounded-lg text-sm text-white border border-white/10 focus:outline-none focus:border-purple-500 touch-manipulation",children:te.map(D=>h.jsx("option",{value:D.label,children:D.label},D.label))})]}),(t.length>0||qt.length>0)&&h.jsxs("button",{onClick:ET,className:"w-full flex items-center justify-between px-2 py-1.5 bg-gray-800 rounded-lg text-sm text-white hover:bg-gray-700 transition-all touch-manipulation",children:[h.jsx("span",{children:"Subtitles"}),h.jsx("span",{className:`w-7 sm:w-8 h-3.5 sm:h-4 rounded-full relative transition-colors ${Q?"bg-white":"bg-gray-600"}`,children:h.jsx("span",{className:`absolute top-0.5 left-0.5 w-2.5 sm:w-3 h-2.5 sm:h-3 bg-black rounded-full transition-transform ${Q?"translate-x-3 sm:translate-x-4":"translate-x-0"}`})})]}),h.jsxs("div",{className:"mt-2 space-y-2",children:[h.jsx("input",{ref:eo,type:"file",accept:"text/plain,text/vtt,.srt,.vtt",className:"hidden",onChange:ST}),h.jsxs("div",{className:"flex gap-2 min-w-0 items-center",children:[h.jsxs("select",{value:Xt,onChange:D=>Mt(D.target.value),className:"flex-1 min-w-0 px-2 py-1.5 bg-gray-800 rounded-lg text-sm text-white border border-white/10 focus:outline-none truncate",children:[h.jsx("option",{value:"none",children:"No Subtitles"}),St.map((D,H)=>h.jsx("option",{value:`cloud-${H}`,children:`Cloud: ${D.label||D.lang||"Subtitle "+(H+1)}`},`cloud-${H}`)),qt.map((D,H)=>h.jsx("option",{value:`user-${H}`,children:`Uploaded: ${D.label||"File "+(H+1)}`},`user-${H}`))]}),h.jsx("button",{onClick:()=>{var D;return(D=eo.current)==null?void 0:D.click()},className:"px-3 py-1.5 bg-gray-800 rounded-lg text-sm text-white hover:bg-gray-700 flex-shrink-0",children:"Upload"})]}),Xt.startsWith("user-")&&h.jsx("div",{className:"flex gap-2 min-w-0",children:h.jsx("button",{onClick:()=>TT(Xt.split("-")[1]),className:"flex-1 px-3 py-1.5 bg-red-700 rounded-lg text-sm text-white hover:bg-red-600 min-w-0",children:"Delete Uploaded"})})]})]})})]}),h.jsxs("button",{onClick:Em,className:"p-2 sm:p-2.5 rounded-full bg-white/10 hover:bg-white/20 transition-all duration-300 group relative touch-manipulation",onMouseEnter:()=>Se("fullscreen"),onMouseLeave:()=>Se(null),children:[De?h.jsx(_A,{size:18,className:"sm:w-5 sm:h-5"}):h.jsx(bA,{size:18,className:"sm:w-5 sm:h-5"}),Ee==="fullscreen"&&h.jsx("span",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-black/90 text-white text-xs rounded whitespace-nowrap",children:"Fullscreen (F)"})]})]})]})]})]})]})},uD=({episodes:s,currentEpisode:e,onSelect:t})=>{const r=s.filter(n=>n.isFiller).length;return h.jsxs("div",{className:"mt-4 bg-gray-900/40 rounded-xl p-5 border border-white/5",children:[h.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3",children:[h.jsxs("h3",{className:"text-base font-semibold flex items-center gap-2 text-white/90",children:[h.jsx(Ga,{className:"text-white",size:18})," Select Episode"]}),h.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[h.jsxs("div",{className:"text-gray-500",children:[s.length," Episodes"]}),r>0&&h.jsxs("div",{className:"flex items-center gap-1.5 text-amber-400/80 bg-amber-400/10 px-2.5 py-1 rounded-full border border-amber-400/20",children:[h.jsx(Ml,{size:12}),h.jsxs("span",{className:"font-medium",children:[r," Filler"]})]})]})]}),r>0&&h.jsxs("div",{className:"mb-4 p-2.5 bg-amber-400/5 border border-amber-400/10 rounded-lg flex items-start gap-2 text-xs text-amber-200/70",children:[h.jsx(Ml,{size:14,className:"mt-0.5 flex-shrink-0"}),h.jsxs("span",{children:["Filler episodes marked in ",h.jsx("span",{className:"text-amber-400 font-medium",children:"amber"})]})]}),h.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8 gap-2 max-h-80 overflow-y-auto pr-2 custom-scrollbar",children:s.map(n=>{const i=e===n.number,a=n.isFiller;return h.jsxs("button",{onClick:()=>t(n.number),className:`
                group relative p-2.5 rounded-lg text-left transition-all duration-200 border
                ${i?"bg-violet-600 border-violet-500 shadow-lg shadow-violet-600/20":a?"bg-amber-950/30 border-amber-800/30 hover:bg-amber-950/50 hover:border-amber-700/40":"bg-gray-800/50 border-white/5 hover:bg-gray-800 hover:border-white/10"}
              `,children:[h.jsxs("div",{className:"flex items-center justify-between mb-1",children:[h.jsxs("span",{className:`
                  text-xs font-semibold
                  ${i?"text-white":a?"text-amber-400/80":"text-gray-400"}
                `,children:["EP ",n.number]}),i&&h.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white animate-pulse"})]}),a&&h.jsx("span",{className:"inline-block text-[9px] font-medium text-amber-500/90 uppercase tracking-wider",children:"Filler"}),h.jsx("p",{className:`
                text-[11px] font-medium line-clamp-1 leading-tight mt-0.5
                ${i?"text-white/90":a?"text-amber-200/60":"text-gray-500"}
              `,children:n.title||`Episode ${n.number}`})]},n.number)})})]})},dD=({servers:s,selectedType:e,selectedServer:t,onServerChange:r,onTypeChange:n})=>{const i=s[e]||[];return h.jsxs("div",{className:"mt-3 sm:mt-4 bg-gray-900/40 rounded-xl p-3 sm:p-4 md:p-5 border border-white/5",children:[h.jsx("div",{className:"flex gap-1.5 sm:gap-2 mb-3 sm:mb-4 flex-wrap",children:["sub","dub","raw"].map(a=>{var o;return h.jsxs("button",{onClick:()=>n(a),className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg capitalize transition-all duration-200 text-xs sm:text-sm font-medium flex items-center gap-1.5 sm:gap-2 touch-manipulation ${e===a?"bg-violet-600 text-white":"bg-gray-800/80 hover:bg-gray-700/80 text-gray-400 border border-white/5"}`,children:[h.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${e===a?"bg-white":"bg-gray-500"}`}),a,h.jsx("span",{className:`text-[9px] sm:text-[10px] px-1 sm:px-1.5 py-0.5 rounded-full ${e===a?"bg-white/20":"bg-gray-700"}`,children:((o=s[a])==null?void 0:o.length)||0})]},a)})}),h.jsxs("div",{children:[h.jsxs("p",{className:"text-xs text-gray-500 mb-2 sm:mb-3 flex items-center gap-1.5 sm:gap-2 uppercase tracking-wider",children:[h.jsx(gv,{size:12,className:"sm:w-[14px] sm:h-[14px] text-white"})," Available Servers"]}),i.length>0?h.jsx("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:i.map((a,o)=>h.jsxs("button",{onClick:()=>r(a),className:`px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm rounded-lg transition-all duration-200 font-medium flex items-center gap-1.5 sm:gap-2 touch-manipulation ${(t==null?void 0:t.name)===a.name?"bg-violet-600 text-white shadow-lg shadow-violet-600/20":"bg-gray-800/80 hover:bg-gray-700/80 text-gray-300 border border-white/5 hover:border-white/10"}`,children:[h.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${(t==null?void 0:t.name)===a.name?"bg-white":"bg-gray-500"}`}),a.name||`Server ${o+1}`]},a.name||o))}):h.jsxs("div",{className:"bg-gray-800/30 rounded-lg p-3 sm:p-4 text-center border border-white/5",children:[h.jsxs("p",{className:"text-gray-500 text-xs sm:text-sm",children:["No servers available for ",e]}),h.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Try switching to a different type"})]})]})]})},RS=({movie:s,showInfoOnHover:e=!0,size:t="md"})=>{const[r,n]=A.useState(!1),[i,a]=A.useState(!1),o=Rs(),{isInWatchlist:l,addToWatchlist:c,removeFromWatchlist:u}=za(),d=l(s.id),f=s.media_type||"movie",p={sm:"w-28 sm:w-32 md:w-40",md:"w-32 sm:w-40 md:w-48",lg:"w-40 sm:w-48 md:w-56",xl:"w-48 sm:w-56 md:w-64"}[t],m={sm:"h-42 sm:h-48 md:h-60",md:"h-48 sm:h-60 md:h-72",lg:"h-60 sm:h-72 md:h-84",xl:"h-72 sm:h-84 md:h-96"}[t],y=x=>{x.preventDefault(),x.stopPropagation(),d?u(s.id):c({id:s.id,title:s.title||s.name,poster_path:s.poster_path,backdrop_path:s.backdrop_path,vote_average:s.vote_average,release_date:s.release_date||s.first_air_date,media_type:f})},g=x=>{x.preventDefault(),x.stopPropagation(),o(f==="tv"?`/watch/${f}/${s.id}?season=1&episode=1`:`/watch/${f}/${s.id}`)};return h.jsx("div",{className:"relative group flex-shrink-0",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:h.jsxs(ve,{to:`/${f}/${s.id}`,className:"block",children:[h.jsxs("div",{className:`
            ${p} ${m} 
            rounded-lg overflow-hidden
            transition-all duration-300
            ${i&&e?"scale-105 shadow-2xl":""}
            movie-card
          `,children:[r?h.jsx("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center",children:h.jsx("span",{className:"text-gray-500 text-sm",children:"No Image"})}):h.jsx("img",{src:Ms(s.poster_path,"w500"),alt:s.title||s.name,className:"w-full h-full object-cover",onError:()=>n(!0),loading:"lazy"}),i&&e&&h.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent flex flex-col justify-end p-4 transition-opacity duration-300",children:[h.jsx("h3",{className:"font-bold text-white text-lg mb-1 line-clamp-2",children:s.title||s.name}),h.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300 mb-3",children:[h.jsx("span",{children:Gs(s.release_date||s.first_air_date)}),h.jsx("span",{children:""}),h.jsx("span",{className:"text-yellow-400",children:Zd(s.vote_average)}),s.adult&&h.jsxs(h.Fragment,{children:[h.jsx("span",{children:""}),h.jsx("span",{className:"text-red-500",children:"18+"})]})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(Ul,{size:"sm",onClick:g,leftIcon:h.jsx(ke,{size:14}),className:"flex-1",children:f==="tv"?"Watch":"Play"}),f==="tv"&&s.imdb_id&&h.jsx("a",{href:`https://vidsrcme.ru/embed/tv?imdb=${s.imdb_id.startsWith("tt")?s.imdb_id:`tt${s.imdb_id}`}&season=1&episode=1`,target:"_blank",rel:"noopener noreferrer",className:"p-2 rounded-full bg-green-600 text-white hover:bg-green-700 transition-colors",title:"Play for Free - vidsrc",onClick:x=>x.stopPropagation(),children:h.jsx(ke,{size:16})}),h.jsx("button",{onClick:y,className:`
                    p-2 rounded-full transition-colors
                    ${d?"bg-netflix-red text-white":"bg-gray-700 text-white hover:bg-gray-600"}
                  `,title:d?"Remove from Watchlist":"Add to Watchlist",children:d?h.jsx(qr,{size:16,fill:"currentColor"}):h.jsx(Lf,{size:16})}),h.jsx(ve,{to:`/${f}/${s.id}`,onClick:x=>x.stopPropagation(),className:"p-2 rounded-full bg-gray-700 text-white hover:bg-gray-600 transition-colors",title:"More Info",children:h.jsx(Ai,{size:16})})]})]})]}),!e&&h.jsxs("div",{className:"mt-2",children:[h.jsx("h3",{className:"font-medium text-white text-sm line-clamp-1 hover:text-netflix-red transition-colors",children:s.title||s.name}),h.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:Gs(s.release_date||s.first_air_date)})]})]})})},hD=({mediaType:s="movie",selectedGenre:e,onGenreChange:t,className:r=""})=>{var c;const[n,i]=A.useState(!1),a=yi[s.toUpperCase()]||yi.MOVIE,o=u=>{t==null||t(u),i(!1)},l=((c=a.find(u=>u.id===e))==null?void 0:c.name)||"All Genres";return h.jsxs("div",{className:`relative ${r}`,children:[h.jsxs("button",{onClick:()=>i(!n),className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors",children:[h.jsx("span",{children:l}),h.jsx(vc,{size:16,className:`transition-transform ${n?"rotate-180":""}`})]}),n&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>i(!1)}),h.jsxs("div",{className:"absolute top-full left-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-xl overflow-hidden z-50 max-h-80 overflow-y-auto",children:[h.jsx("button",{onClick:()=>o(null),className:`
                w-full text-left px-4 py-3 hover:bg-gray-700 transition-colors
                ${e===null?"text-netflix-red":"text-white"}
              `,children:"All Genres"}),a.map(u=>h.jsx("button",{onClick:()=>o(u.id),className:`
                  w-full text-left px-4 py-3 hover:bg-gray-700 transition-colors
                  ${e===u.id?"text-netflix-red":"text-white"}
                `,children:u.name},u.id))]})]})]})},fD=({options:s=[],selectedOption:e,onSortChange:t,className:r=""})=>{var c;const[n,i]=A.useState(!1),a=[{id:"popularity.desc",label:"Most Popular"},{id:"vote_average.desc",label:"Highest Rated"},{id:"primary_release_date.desc",label:"Newest First"},{id:"revenue.desc",label:"Highest Grossing"}],o=s.length>0?s:a,l=((c=o.find(u=>u.id===e))==null?void 0:c.label)||"Sort By";return h.jsxs("div",{className:`relative ${r}`,children:[h.jsxs("button",{onClick:()=>i(!n),className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors",children:[h.jsx("span",{children:l}),h.jsx(vc,{size:16,className:`transition-transform ${n?"rotate-180":""}`})]}),n&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>i(!1)}),h.jsx("div",{className:"absolute top-full right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-xl overflow-hidden z-50",children:o.map(u=>h.jsx("button",{onClick:()=>{t(u.id),i(!1)},className:`
                  w-full text-left px-4 py-3 hover:bg-gray-700 transition-colors
                  ${e===u.id?"text-netflix-red":"text-white"}
                `,children:u.label},u.id))})]})]})},mD=({selectedYear:s,onYearChange:e,startYear:t=1900,endYear:r=new Date().getFullYear(),className:n=""})=>{const[i,a]=A.useState(!1),o=Array.from({length:r-t+1},(l,c)=>r-c);return h.jsxs("div",{className:`relative ${n}`,children:[h.jsxs("button",{onClick:()=>a(!i),className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors",children:[h.jsx("span",{children:s||"Year"}),h.jsx(vc,{size:16,className:`transition-transform ${i?"rotate-180":""}`})]}),i&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>a(!1)}),h.jsxs("div",{className:"absolute top-full left-0 mt-2 w-32 bg-gray-800 rounded-lg shadow-xl overflow-hidden z-50 max-h-80 overflow-y-auto",children:[h.jsx("button",{onClick:()=>{e(null),a(!1)},className:`
                w-full text-left px-4 py-3 hover:bg-gray-700 transition-colors
                ${s===null?"text-netflix-red":"text-white"}
              `,children:"Any Year"}),o.map(l=>h.jsx("button",{onClick:()=>{e(l),a(!1)},className:`
                  w-full text-left px-4 py-3 hover:bg-gray-700 transition-colors
                  ${s===l?"text-netflix-red":"text-white"}
                `,children:l},l))]})]})]})},pD=({selectedRating:s,onRatingChange:e,className:t=""})=>{const[r,n]=A.useState(!1),i=[{id:9,label:"9+ Excellent"},{id:8,label:"8+ Great"},{id:7,label:"7+ Good"},{id:6,label:"6+ Fair"}];return h.jsxs("div",{className:`relative ${t}`,children:[h.jsxs("button",{onClick:()=>n(!r),className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-full hover:bg-gray-700 transition-colors",children:[h.jsx("span",{children:s?`${s}+`:"Rating"}),h.jsx(vc,{size:16,className:`transition-transform ${r?"rotate-180":""}`})]}),r&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>n(!1)}),h.jsxs("div",{className:"absolute top-full left-0 mt-2 w-40 bg-gray-800 rounded-lg shadow-xl overflow-hidden z-50",children:[h.jsx("button",{onClick:()=>{e(null),n(!1)},className:`
                w-full text-left px-4 py-3 hover:bg-gray-700 transition-colors
                ${s===null?"text-netflix-red":"text-white"}
              `,children:"Any Rating"}),i.map(a=>h.jsx("button",{onClick:()=>{e(a.id),n(!1)},className:`
                  w-full text-left px-4 py-3 hover:bg-gray-700 transition-colors
                  ${s===a.id?"text-netflix-red":"text-white"}
                `,children:a.label},a.id))]})]})]})},gD=()=>{var w;const[s,e]=Va(),[t,r]=A.useState([]),[n,i]=A.useState([]),[a,o]=A.useState(!0),[l,c]=A.useState(null),[u,d]=A.useState("grid"),[f,p]=A.useState("all"),m=s.get("q")||"";s.get("type");const y=s.get("genre")?parseInt(s.get("genre")):null,g=s.get("sort")||"popularity.desc",x=s.get("year")?parseInt(s.get("year")):null,v=s.get("rating")?parseInt(s.get("rating")):null,E=A.useCallback(async()=>{var R,b;o(!0),c(null);try{let _;if(m){const[I,L]=await Promise.all([A_(m),zv(m)]);if(f==="movie")r(I.results||[]),i([]);else if(f==="tv"){const N=((R=L.results)==null?void 0:R.filter(Y=>Y.media_type==="tv"))||[],M=N.map(Y=>ug(Y.id)),$=await Promise.all(M),G=N.map((Y,U)=>({...Y,...$[U],media_type:"tv"}));r([]),i(G)}else{const N=I.results||[],M=((b=L.results)==null?void 0:b.filter(W=>W.media_type==="tv"))||[],$=M.map(W=>ug(W.id)),G=await Promise.all($),Y=M.map((W,P)=>({...W,...G[P],media_type:"tv"})),U=[...N,...Y].sort((W,P)=>P.popularity-W.popularity);r(U),i([])}}else{const I={page:1,sort_by:g,include_adult:!1,language:"en-US"};if(y&&(I.with_genres=y),x&&(I.primary_release_year=x),v&&(I.vote_average_gte=v),f==="tv"){const N=((await hg(I)).results||[]).map(M=>({...M,media_type:"tv"}));r([]),i(N)}else if(f==="movie"){const L=await dg(I);r(L.results||[]),i([])}else{const[L,N]=await Promise.all([dg(I),hg(I)]),M=[...(L.results||[]).map($=>({...$,media_type:"movie"})),...(N.results||[]).map($=>({...$,media_type:"tv"}))].sort(($,G)=>G.popularity-$.popularity);r(M),i([])}}}catch(_){console.error("Error fetching movies:",_),c(_.message||"Failed to load movies")}finally{o(!1)}},[m,y,g,x,v,f]);A.useEffect(()=>{E()},[E]);const T=(R,b)=>{const _=new URLSearchParams(s);b===null||b===""||R==="genre"&&b===null?_.delete(R):_.set(R,b),e(_)};return h.jsxs("div",{className:"min-h-screen bg-gray-900",children:[h.jsx("div",{className:"bg-gray-800/50 border-b border-gray-800",children:h.jsxs("div",{className:"container mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[h.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-white mb-4 sm:mb-6",children:m?`Search Results for "${m}"`:"Browse Movies & TV Shows"}),h.jsx("div",{className:"mb-4 sm:mb-6",children:h.jsx(nh,{})}),h.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3 md:gap-4",children:[h.jsxs("div",{className:"flex items-center bg-gray-700 rounded-lg p-0.5 sm:p-1",children:[h.jsx("button",{onClick:()=>p("all"),className:`px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm rounded-md transition-colors touch-manipulation ${f==="all"?"bg-netflix-red text-white":"text-gray-300 hover:text-white"}`,children:"All"}),h.jsx("button",{onClick:()=>p("movie"),className:`px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm rounded-md transition-colors touch-manipulation ${f==="movie"?"bg-netflix-red text-white":"text-gray-300 hover:text-white"}`,children:"Movies"}),h.jsx("button",{onClick:()=>p("tv"),className:`px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm rounded-md transition-colors touch-manipulation ${f==="tv"?"bg-netflix-red text-white":"text-gray-300 hover:text-white"}`,children:"TV Shows"})]}),h.jsx(hD,{mediaType:f,selectedGenre:y,onGenreChange:R=>T("genre",R)}),h.jsx(fD,{selectedOption:g,onSortChange:R=>T("sort",R)}),h.jsx(mD,{selectedYear:x,onYearChange:R=>T("year",R)}),h.jsx(pD,{selectedRating:v,onRatingChange:R=>T("rating",R)}),h.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 ml-auto",children:[h.jsx("button",{onClick:()=>d("grid"),className:`p-1.5 sm:p-2 rounded-md transition-colors touch-manipulation ${u==="grid"?"bg-netflix-red text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:h.jsx(pv,{size:16,className:"sm:w-5 sm:h-5"})}),h.jsx("button",{onClick:()=>d("list"),className:`p-1.5 sm:p-2 rounded-md transition-colors touch-manipulation ${u==="list"?"bg-netflix-red text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:h.jsx(Ga,{size:16,className:"sm:w-5 sm:h-5"})})]})]}),(y||x||v)&&h.jsxs("div",{className:"flex flex-wrap gap-1.5 sm:gap-2 mt-3 sm:mt-4",children:[y&&h.jsxs("button",{onClick:()=>T("genre",null),className:"inline-flex items-center gap-1 px-2 sm:px-3 py-1 bg-netflix-red text-white text-xs sm:text-sm rounded-full hover:bg-red-700 transition-colors touch-manipulation",children:[(w=(f==="tv"?yi.TV:yi.MOVIE).find(R=>R.id===y))==null?void 0:w.name,h.jsx("span",{className:"ml-1",children:""})]}),x&&h.jsxs("button",{onClick:()=>T("year",null),className:"inline-flex items-center gap-1 px-2 sm:px-3 py-1 bg-netflix-red text-white text-xs sm:text-sm rounded-full hover:bg-red-700 transition-colors touch-manipulation",children:[x,h.jsx("span",{className:"ml-1",children:""})]}),v&&h.jsxs("button",{onClick:()=>T("rating",null),className:"inline-flex items-center gap-1 px-2 sm:px-3 py-1 bg-netflix-red text-white text-xs sm:text-sm rounded-full hover:bg-red-700 transition-colors touch-manipulation",children:[v,"+ Rating",h.jsx("span",{className:"ml-1",children:""})]})]})]})}),h.jsxs("div",{className:"container mx-auto px-2 sm:px-4 py-8",children:[h.jsx("p",{className:"text-gray-400 mb-6",children:a?"Loading...":f==="tv"?`${n.length} TV shows found`:f==="all"?`${t.length} results found`:`${t.length} movies found`}),a&&h.jsx("div",{className:u==="grid"?"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4":"space-y-4",children:[...Array(12)].map((R,b)=>h.jsx(Ac,{},b))}),!a&&l&&h.jsx("div",{className:"flex items-center justify-center py-16",children:h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-red-500 mb-4",children:l}),h.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors",children:"Try Again"})]})}),!a&&!l&&(f==="tv"&&n.length===0||f!=="tv"&&t.length===0)&&h.jsx("div",{className:"flex items-center justify-center py-16",children:h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-gray-400 text-lg mb-4",children:f==="tv"?"No TV shows found":"No movies found"}),h.jsx("p",{className:"text-gray-500 text-sm",children:"Try adjusting your filters"})]})}),!a&&!l&&(f==="tv"&&n.length>0||f!=="tv"&&t.length>0)&&h.jsx("div",{className:u==="grid"?"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4":"space-y-4",children:(f==="tv"?n:t).map(R=>h.jsx(RS,{movie:R,size:u==="grid"?"md":"lg",showInfoOnHover:u==="grid"},R.id))}),!a&&(f==="tv"&&n.length>0&&n.length>=20||f!=="tv"&&t.length>0&&t.length>=20)&&h.jsx("div",{className:"flex justify-center mt-8",children:h.jsx("button",{className:"px-8 py-3 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Load More"})})]})]})},an=({title:s,movies:e=[],loading:t=!1,error:r=null,showInfoOnHover:n=!0,size:i="md",className:a=""})=>{const o=A.useRef(null),l=c=>{if(o.current){const u=o.current,d=u.clientWidth*.8;c==="left"?u.scrollBy({left:-d,behavior:"smooth"}):u.scrollBy({left:d,behavior:"smooth"})}};return h.jsxs("div",{className:`py-6 ${a}`,children:[s&&h.jsx("h2",{className:"text-xl md:text-2xl font-bold text-white mb-4 px-4 md:px-8",children:s}),h.jsxs("div",{className:"relative group",children:[e.length>0&&h.jsx("button",{onClick:()=>l("left"),className:"absolute left-0 top-0 bottom-0 z-10 hidden md:flex items-center justify-center w-12 bg-black/50 hover:bg-black/70 text-white transition-colors opacity-0 group-hover:opacity-100","aria-label":"Scroll left",children:h.jsx(wf,{size:24})}),h.jsxs("div",{ref:o,className:"flex gap-3 md:gap-4 overflow-x-auto carousel-container px-4 md:px-8 pb-4 group",style:{scrollBehavior:"smooth"},children:[t&&[...Array(6)].map((c,u)=>h.jsx(Ac,{},u)),r&&h.jsx("div",{className:"flex items-center justify-center w-full h-48 text-gray-400",children:h.jsxs("p",{children:["Error loading movies: ",r]})}),!t&&!r&&e.length===0&&h.jsx("div",{className:"flex items-center justify-center w-full h-48 text-gray-400",children:h.jsx("p",{children:"No movies found"})}),!t&&!r&&e.map(c=>h.jsx(RS,{movie:c,showInfoOnHover:n,size:i},c.id))]}),e.length>0&&h.jsx("button",{onClick:()=>l("right"),className:"absolute right-0 top-0 bottom-0 z-10 hidden md:flex items-center justify-center w-12 bg-black/50 hover:bg-black/70 text-white transition-colors opacity-0 group-hover:opacity-100","aria-label":"Scroll right",children:h.jsx(Af,{size:24})})]})]})},IS=({rating:s=0,maxRating:e=10,size:t="md"})=>{const r={sm:"px-2 py-0.5 text-xs",md:"px-3 py-1 text-sm",lg:"px-4 py-1.5 text-base"}[t],n={sm:"text-xs",md:"text-sm",lg:"text-base"}[t],a=OA(s).replace("text-","bg-");return h.jsxs("div",{className:`inline-flex items-center ${r} ${a} rounded-md font-bold`,children:[h.jsx("span",{className:n,children:s.toFixed(1)}),h.jsxs("span",{className:"ml-0.5 text-xs opacity-70",children:["/ ",e]})]})},yD=()=>{const[s,e]=A.useState([]),[t,r]=A.useState({trending:{data:[],loading:!0,error:null},popular:{data:[],loading:!0,error:null},topRated:{data:[],loading:!0,error:null},upcoming:{data:[],loading:!0,error:null},nowPlaying:{data:[],loading:!0,error:null}}),[n,i]=A.useState(!0);return A.useEffect(()=>{(async()=>{try{const l=(await g_("week")).results.filter(p=>p.backdrop_path);e(l.slice(0,5));const[c,u,d,f]=await Promise.all([y_(1),x_(1),v_(1),E_(1)]);r({trending:{data:l,loading:!1,error:null},popular:{data:c.results,loading:!1,error:null},topRated:{data:u.results,loading:!1,error:null},upcoming:{data:d.results,loading:!1,error:null},nowPlaying:{data:f.results,loading:!1,error:null}})}catch(o){console.error("Error fetching home page data:",o),r({trending:{data:[],loading:!1,error:o.message},popular:{data:[],loading:!1,error:o.message},topRated:{data:[],loading:!1,error:o.message},upcoming:{data:[],loading:!1,error:o.message},nowPlaying:{data:[],loading:!1,error:o.message}})}finally{i(!1)}})()},[]),n?h.jsx(vD,{}):h.jsxs("div",{className:"min-h-screen bg-gray-900",children:[h.jsx("section",{className:"relative",children:s.length>0?h.jsx(xD,{movies:s}):h.jsx(Lc,{})}),h.jsxs("div",{className:"relative -mt-32 z-10 pb-12",style:{marginTop:"1rem"},children:[h.jsx(an,{title:"Trending Now",movies:t.trending.data,loading:t.trending.loading,error:t.trending.error,size:"md"}),h.jsx(an,{title:"Popular Movies",movies:t.popular.data,loading:t.popular.loading,error:t.popular.error,size:"md"}),h.jsx(an,{title:"Top Rated",movies:t.topRated.data,loading:t.topRated.loading,error:t.topRated.error,size:"md"}),h.jsx(an,{title:"Coming Soon",movies:t.upcoming.data,loading:t.upcoming.loading,error:t.upcoming.error,size:"md"}),h.jsx(an,{title:"Now Playing",movies:t.nowPlaying.data,loading:t.nowPlaying.loading,error:t.nowPlaying.error,size:"md"})]}),h.jsx("section",{className:"py-8 sm:py-10 md:py-12 bg-gradient-to-r from-purple-900/50 to-gray-900 border-t border-gray-800",children:h.jsx("div",{className:"container mx-auto px-4 sm:px-6 md:px-8",children:h.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-6 sm:gap-8",children:[h.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[h.jsx("span",{className:"text-3xl sm:text-4xl md:text-5xl",children:""}),h.jsxs("div",{children:[h.jsx("h2",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-white",children:"AnimeFlix"}),h.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"Stream your favorite anime series and movies"})]})]}),h.jsxs(ve,{to:"/anime",className:"inline-flex items-center gap-2 px-6 sm:px-8 py-3 sm:py-4 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-md transition-colors text-base sm:text-lg touch-manipulation",children:[h.jsx("span",{children:"Browse Anime"}),h.jsx(ke,{size:20,className:"sm:w-6 sm:h-6"})]})]})})}),h.jsx("section",{className:"py-16 bg-gradient-to-t from-black to-gray-900",children:h.jsxs("div",{className:"container mx-auto px-8 text-center",children:[h.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"Ready to watch?"}),h.jsx("p",{className:"text-gray-400 text-lg mb-8 max-w-2xl mx-auto",children:"Join millions of users enjoying the latest movies and TV shows. Start your free trial today!"}),h.jsxs(ve,{to:"/browse",className:"inline-flex items-center gap-2 px-8 py-4 bg-netflix-red text-white font-bold rounded-md hover:bg-red-700 transition-colors text-lg",children:[h.jsx(ke,{size:24}),"Start Watching"]})]})})]})},xD=({movies:s})=>{const[e,t]=A.useState(0);A.useEffect(()=>{const n=setInterval(()=>{t(i=>(i+1)%s.length)},5e3);return()=>clearInterval(n)},[s.length]);const r=s[e];return h.jsxs("div",{className:"relative h-[70vh] overflow-hidden",children:[h.jsxs("div",{className:"absolute inset-0",children:[h.jsx("img",{src:`https://image.tmdb.org/t/p/original${r.backdrop_path}`,alt:r.title||r.name,className:"w-full h-full object-cover"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-900/90 via-gray-900/50 to-transparent"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent"})]}),h.jsx("div",{className:"relative h-full flex items-center px-4 sm:px-6 md:px-8 lg:px-16 xl:px-24",children:h.jsxs("div",{className:"max-w-2xl space-y-4 sm:space-y-6",children:[h.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[h.jsx("span",{className:"text-netflix-red font-bold tracking-wider uppercase text-xs sm:text-sm",children:"Featured"}),h.jsx(IS,{rating:r.vote_average,size:"sm"})]}),h.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-white leading-tight",children:r.title||r.name}),h.jsx("p",{className:"text-gray-300 text-sm sm:text-base md:text-lg line-clamp-3",children:r.overview||"No description available for this title."}),h.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 text-xs sm:text-sm text-gray-400",children:[h.jsx("span",{children:new Date(r.release_date||r.first_air_date).getFullYear()}),r.adult&&h.jsx("span",{className:"border border-gray-500 px-1 text-xs",children:"18+"}),h.jsx("span",{className:"capitalize",children:r.media_type})]}),h.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-3 md:gap-4 pt-3 sm:pt-4",children:[h.jsxs(ve,{to:`/watch/${r.media_type||"movie"}/${r.id}`,className:"inline-flex items-center gap-1.5 sm:gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-netflix-red text-white font-semibold rounded-md hover:bg-red-700 transition-colors text-sm sm:text-base touch-manipulation",children:[h.jsx(ke,{size:16,className:"sm:w-5 sm:h-5"}),"Watch Now"]}),h.jsxs(ve,{to:`/watch-trailer/${r.media_type||"movie"}/${r.id}`,className:"inline-flex items-center gap-1.5 sm:gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-gray-700/80 text-white font-semibold rounded-md hover:bg-gray-600 transition-colors text-sm sm:text-base touch-manipulation",children:[h.jsx(ke,{size:16,className:"sm:w-5 sm:h-5"}),"Watch Trailer"]}),h.jsxs(ve,{to:`/${r.media_type||"movie"}/${r.id}`,className:"inline-flex items-center gap-1.5 sm:gap-2 px-4 sm:px-6 py-2 sm:py-3 bg-gray-700/80 text-white font-semibold rounded-md hover:bg-gray-600 transition-colors text-sm sm:text-base touch-manipulation",children:[h.jsx(Ai,{size:16,className:"sm:w-5 sm:h-5"}),"More Info"]})]})]})}),h.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-2",children:s.map((n,i)=>h.jsx("button",{onClick:()=>t(i),className:`
              w-2 h-2 rounded-full transition-all
              ${i===e?"bg-white w-8":"bg-white/50 hover:bg-white/70"}
            `,"aria-label":`Go to slide ${i+1}`},i))})]})},vD=()=>h.jsxs("div",{className:"min-h-screen bg-gray-900",children:[h.jsx(Lc,{}),h.jsxs("div",{className:"relative -mt-32 z-10 pb-12",children:[h.jsx(ri,{title:"Trending Now"}),h.jsx(ri,{title:"Popular Movies"}),h.jsx(ri,{title:"Top Rated"})]})]}),Wu=()=>{var te,z,Q,ge,se,fe;const s=dr(),{type:e=s.pathname.split("/")[[1]],id:t}=Ba(),[r,n]=A.useState(null),[i,a]=A.useState(null),[o,l]=A.useState(null),[c,u]=A.useState([]),[d,f]=A.useState(null),[p,m]=A.useState(null),[y,g]=A.useState(!0),[x,v]=A.useState(null),{isInWatchlist:E,addToWatchlist:T,removeFromWatchlist:w}=za(),R=r&&e!=="person"?E(r.id):!1;A.useEffect(()=>{let X=s.pathname;t&&(async()=>{g(!0),v(null);try{if(X.includes("person")==="person"){const Ee=await L_(t),[Se,De]=await Promise.all([__(t),R_(t)]);n(Ee),f(Se),m(De),a(null),l(null),u([])}else{console.log(),console.log(X.includes("tv"));const[Ee,Se,De,lt]=await Promise.all([X.includes("tv")?Of(t):Nf(t),X.includes("tv")?b_(t):S_(t),X.includes("tv")?Hv(t):Gv(t),X.includes("tv")?w_(t):T_(t)]);n(Ee),a(Se),l(De),u(lt.results||[])}}catch(Ee){console.error("Error fetching details:",Ee),v(Ee.message||"Failed to load details")}finally{g(!1)}})()},[t,e]);const _=o!=null&&o.results?o.results.find(X=>X.type==="Trailer"&&X.site==="YouTube")||o.results.find(X=>X.type==="Teaser"&&X.site==="YouTube")||o.results[0]:null,I=r&&r.genres?MA(r.genres,yi.MOVIE):[],L=(te=i==null?void 0:i.crew)==null?void 0:te.find(X=>X.job==="Director"),N=((z=i==null?void 0:i.cast)==null?void 0:z.slice(0,6))||[],[M,$]=A.useState(1),[G,Y]=A.useState(1),U=(Q=r==null?void 0:r.seasons)==null?void 0:Q.find(X=>X.season_number===M),W=(U==null?void 0:U.episode_count)||1;A.useEffect(()=>{G>W&&Y(1)},[M,W]);const P=e==="person",B=((ge=d==null?void 0:d.cast)==null?void 0:ge.map(X=>({...X,media_type:"movie"})))||[],K=((se=p==null?void 0:p.cast)==null?void 0:se.map(X=>({...X,media_type:"tv"})))||[],O=[...B,...K].sort((X,Pe)=>(Pe.popularity||0)-(X.popularity||0)).slice(0,20),F=()=>{r&&(R?w(r.id):T({id:r.id,title:r.title||r.name,poster_path:r.poster_path,backdrop_path:r.backdrop_path,vote_average:r.vote_average,release_date:r.release_date||r.first_air_date,media_type:e}))},Z=async()=>{const X=window.location.href;if(navigator.share)try{await navigator.share({title:(r==null?void 0:r.title)||(r==null?void 0:r.name),text:`Check out ${(r==null?void 0:r.title)||(r==null?void 0:r.name)} on StreamFlix!`,url:X})}catch{console.log("Share cancelled")}else navigator.clipboard.writeText(X),alert("Link copied to clipboard!")};return y?h.jsx(M_,{}):x||!r?h.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-red-500 text-lg mb-4",children:x||"Content not found"}),h.jsx(ve,{to:"/",className:"px-6 py-3 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors",children:"Go Home"})]})}):P?h.jsxs("div",{className:"min-h-screen bg-gray-900",children:[h.jsx("div",{className:"relative h-[50vh] md:h-[60vh]",children:h.jsxs("div",{className:"absolute inset-0",children:[r.profile_path?h.jsx("img",{src:Ms(r.profile_path,"original"),alt:r.name,className:"w-full h-full object-cover"}):h.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-800 to-gray-900"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/70 to-transparent"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-900 via-transparent to-transparent"})]})}),h.jsxs("div",{className:"container mx-auto px-4 -mt-40 relative z-10 pb-16",children:[h.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[h.jsx("div",{className:"flex-shrink-0",children:h.jsx("div",{className:"w-48 md:w-64 lg:w-80 rounded-lg overflow-hidden shadow-2xl",children:r.profile_path?h.jsx("img",{src:Ms(r.profile_path,"w500"),alt:r.name,className:"w-full h-auto"}):h.jsx("div",{className:"w-full aspect-[2/3] bg-gray-800 flex items-center justify-center",children:h.jsx(Rf,{className:"text-gray-600",size:64})})})}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4",children:r.name}),h.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-gray-300 mb-6",children:[r.birthday&&h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(qd,{size:16}),Gs(r.birthday),r.deathday&&` - ${Gs(r.deathday)}`]}),r.place_of_birth&&h.jsxs("span",{className:"text-gray-400 text-sm",children:[" ",r.place_of_birth]})]}),h.jsxs("div",{className:"mb-8",children:[h.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Biography"}),h.jsx("p",{className:"text-gray-300 leading-relaxed",children:zp(r.biography,1e3)||"No biography available."})]}),O.length>0&&h.jsxs("div",{className:"mb-8",children:[h.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Known For"}),h.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3",children:O.slice(0,6).map(X=>h.jsxs(ve,{to:`/${X.media_type}/${X.id}`,className:"group",children:[X.poster_path?h.jsx("img",{src:Ms(X.poster_path,"w300"),alt:X.title||X.name,className:"w-full rounded-lg shadow-md group-hover:scale-105 transition-transform duration-200"}):h.jsx("div",{className:"aspect-[2/3] bg-gray-800 rounded-lg flex items-center justify-center",children:h.jsx(En,{className:"text-gray-600",size:24})}),h.jsx("p",{className:"text-white text-sm mt-2 truncate group-hover:text-netflix-red transition-colors",children:X.title||X.name})]},`${X.media_type}-${X.id}`))})]}),h.jsx("div",{className:"flex flex-wrap gap-4",children:h.jsxs("button",{onClick:Z,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-700/80 text-white rounded-md hover:bg-gray-600 transition-colors",children:[h.jsx(Gp,{size:20}),"Share"]})})]})]}),O.length>0&&h.jsxs("section",{className:"mt-12",children:[h.jsxs("div",{className:"flex items-center justify-between mb-6",children:[h.jsx("h2",{className:"text-2xl font-bold text-white",children:"Filmography"}),h.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[h.jsxs("span",{className:"flex items-center gap-1 text-gray-400",children:[h.jsx(En,{size:16,className:"text-blue-400"}),B.length," Movies"]}),h.jsxs("span",{className:"flex items-center gap-1 text-gray-400",children:[h.jsx(nn,{size:16,className:"text-purple-400"}),K.length," TV Shows"]})]})]}),h.jsx(an,{title:"All Credits",movies:O,showInfoOnHover:!0,size:"md"})]})]})]}):h.jsxs("div",{className:"min-h-screen bg-gray-900",children:[h.jsx("div",{className:"relative h-[60vh] md:h-[70vh]",children:h.jsxs("div",{className:"absolute inset-0",children:[h.jsx("img",{src:Ms(r.backdrop_path,"w1280"),alt:r.title||r.name,className:"w-full h-full object-cover"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/60 to-transparent"}),h.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-900 via-transparent to-transparent"})]})}),h.jsxs("div",{className:"container mx-auto px-4 -mt-48 relative z-10 pb-16",children:[h.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[h.jsx("div",{className:"hidden md:block flex-shrink-0 w-80",children:h.jsx("img",{src:Ms(r.poster_path,"w500"),alt:r.title||r.name,className:"w-full rounded-lg shadow-2xl"})}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4",children:r.title||r.name}),h.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-gray-300 mb-6",children:[r.release_date&&h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(qd,{size:16}),Gs(r.release_date||r.first_air_date)]}),r.runtime&&h.jsxs("span",{className:"flex items-center gap-1",children:[h.jsx(Fl,{size:16}),NA(r.runtime)]}),h.jsx(IS,{rating:r.vote_average}),r.adult&&h.jsx("span",{className:"border border-gray-500 px-1 text-xs",children:"18+"}),r.status==="Released"&&h.jsx("span",{className:"text-green-500 text-sm",children:"Released"}),s.pathname.includes("tv")&&r.number_of_seasons&&h.jsxs("span",{className:"text-gray-400 text-sm",children:[r.number_of_seasons," Season",r.number_of_seasons!==1?"s":""]})]}),h.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:I.map(X=>{var Pe;return h.jsx(ve,{to:`/browse?genre=${(Pe=yi.MOVIE.find(Ee=>Ee.name===X))==null?void 0:Pe.id}`,className:"px-4 py-1 bg-gray-800 text-white text-sm rounded-full hover:bg-gray-700 transition-colors",children:X},X)})}),r.tagline&&h.jsxs("p",{className:"text-gray-400 italic mb-6 text-lg",children:['"',r.tagline,'"']}),h.jsxs("div",{className:"mb-8",children:[h.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"Overview"}),h.jsx("p",{className:"text-gray-300 leading-relaxed",children:zp(r.overview,500)})]}),h.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-8",children:[L&&h.jsxs("div",{children:[h.jsx("p",{className:"text-gray-500 text-sm",children:"Director"}),h.jsx("p",{className:"text-white font-medium",children:L.name})]}),((fe=r.production_companies)==null?void 0:fe[0])&&h.jsxs("div",{children:[h.jsx("p",{className:"text-gray-500 text-sm",children:"Studio"}),h.jsx("p",{className:"text-white font-medium",children:r.production_companies[0].name})]}),r.budget>0&&h.jsxs("div",{children:[h.jsx("p",{className:"text-gray-500 text-sm",children:"Budget"}),h.jsxs("p",{className:"text-white font-medium",children:["$",r.budget.toLocaleString()]})]})]}),s.pathname.includes("tv")&&r.imdb_id&&h.jsxs("div",{className:"mb-8",children:[h.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(ke,{className:"text-green-500"}),"Watch for Free - vidsrc-embed.ru"]}),h.jsx("div",{className:"bg-gray-800/50 rounded-lg p-6",children:h.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-center",children:[h.jsxs("div",{className:"flex-1",children:[h.jsx("h4",{className:"text-white font-semibold text-lg mb-2",children:r.title||r.name}),h.jsxs("p",{className:"text-gray-400 mb-4",children:["Season ",M,"  Episode ",G]}),h.jsx("div",{className:"flex gap-3",children:h.jsxs("a",{href:`https://vidsrc-embed.ru/embed/tv?tmdb=${r.imdb_id.startsWith("tt")?r.imdb_id:`tt${r.imdb_id}`}&season=${M}&episode=${G}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-3 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition-colors",children:[h.jsx(ke,{size:20}),"Play Now"]})})]}),h.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 text-center",children:[h.jsx("div",{className:"h-16 w-16 bg-gradient-to-br from-purple-600 to-blue-500 rounded-lg flex items-center justify-center mx-auto mb-2",children:h.jsx("span",{className:"text-white font-bold text-sm",children:"VID"})}),h.jsx("p",{className:"text-green-500 text-sm font-medium",children:"Free Streaming"})]})]})})]}),h.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[s.pathname.includes("tv")&&(r==null?void 0:r.seasons)&&h.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[h.jsx("select",{value:M,onChange:X=>$(Number(X.target.value)),className:"bg-gray-800 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-netflix-red",children:r.seasons.filter(X=>X.season_number>0).map(X=>h.jsxs("option",{value:X.season_number,children:["Season ",X.season_number]},X.id))}),h.jsx("select",{value:G,onChange:X=>Y(Number(X.target.value)),className:"bg-gray-800 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-netflix-red",children:[...Array(W)].map((X,Pe)=>h.jsxs("option",{value:Pe+1,children:["Ep ",Pe+1]},Pe+1))})]}),console.log(s.pathname.includes("tv")?`/watch/${e}/${t}?season=${M}&episode=${G}`:`/watch/${e}/${t}`),h.jsxs(ve,{to:s.pathname.includes("tv")?`/watch/${e}/${t}?season=${M}&episode=${G}`:`/watch/${e}/${t}`,className:"inline-flex items-center gap-2 px-6 py-3 bg-netflix-red text-white font-semibold rounded-md hover:bg-red-700 transition-colors",children:[h.jsx(ke,{size:20}),s.pathname.includes("tv")?`Watch S${M}E${G}`:"Watch Now"]}),h.jsxs(ve,{to:`/watch-trailer/${e}/${t}${_?`?v=${_.key}`:""}`,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-700/80 text-white font-semibold rounded-md hover:bg-gray-600 transition-colors",children:[h.jsx(ke,{size:20}),"Watch Trailer"]}),h.jsx("button",{onClick:F,className:`
                  inline-flex items-center gap-2 px-6 py-3 rounded-md font-semibold transition-colors
                  ${R?"bg-netflix-red text-white":"bg-gray-700/80 text-white hover:bg-gray-600"}
                `,children:R?h.jsxs(h.Fragment,{children:[h.jsx(qr,{size:20,fill:"currentColor"})," In Watchlist"]}):h.jsxs(h.Fragment,{children:[h.jsx(Lf,{size:20})," Add to Watchlist"]})}),h.jsxs("button",{onClick:Z,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-700/80 text-white rounded-md hover:bg-gray-600 transition-colors",children:[h.jsx(Gp,{size:20}),"Share"]})]})]})]}),N.length>0&&h.jsxs("section",{className:"mt-12",children:[h.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Top Cast"}),h.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4",children:N.map(X=>h.jsxs(ve,{to:`/person/${X.id}`,className:"text-center group",children:[X.profile_path?h.jsx("img",{src:Ms(X.profile_path,"w185"),alt:X.name,className:"w-24 h-24 mx-auto rounded-full object-cover mb-3 group-hover:scale-105 transition-transform duration-200"}):h.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-gray-800 mb-3 flex items-center justify-center group-hover:bg-gray-700 transition-colors",children:h.jsx("span",{className:"text-gray-500 text-2xl",children:X.name.charAt(0)})}),h.jsx("p",{className:"text-white font-medium text-sm group-hover:text-netflix-red transition-colors",children:X.name}),h.jsx("p",{className:"text-gray-400 text-xs",children:X.character})]},X.id))})]}),c.length>0&&h.jsx("section",{className:"mt-12",children:h.jsx(an,{title:"You May Also Like",movies:c,showInfoOnHover:!0,size:"md"})})]})]})},ED={provider_id:999999,provider_name:"vidsrc-embed.ru",logo_path:null,type:"free",link:null},SD={provider_id:999998,provider_name:"Manual IMDB",logo_path:null,type:"free",link:null},TD=()=>{var B,K,O,F,Z,te;const s=dr(),{type:e=s.pathname.split("/")[[1]],id:t}=Ba(),[r]=Va(),n=Rs(),i=r.get("season"),a=r.get("episode"),[o,l]=A.useState(null),[c,u]=A.useState(null),[d,f]=A.useState(null),[p,m]=A.useState(!0),[y,g]=A.useState(null),[x,v]=A.useState(!1),[E,T]=A.useState(()=>i?Number(i):1),[w,R]=A.useState(()=>a?Number(a):1),[b,_]=A.useState(null),[I,L]=A.useState(t),[N,M]=A.useState(!1);A.useEffect(()=>{t&&(async()=>{var Q,ge;try{m(!0),g(null),_(null);const[se,fe]=await Promise.all([s.pathname.includes("tv")?Of(t):Nf(t),C_(t,e)]);if(l(se),u(fe),s.pathname.includes("tv")){const X=r.get("season"),Pe=r.get("episode");if(X)T(Number(X));else{const Ee=(Q=se.seasons)==null?void 0:Q.find(Se=>Se.season_number>0&&Se.episode_count>0);Ee&&T(Ee.season_number)}Pe&&R(Number(Pe))}((ge=fe==null?void 0:fe.free)==null?void 0:ge.length)>0&&f(fe.free[0])}catch(se){console.error("Error fetching data:",se),g(se.message||"Failed to load movie")}finally{m(!1)}})()},[t,e,r]);const $=()=>{if(!(o!=null&&o.imdb_id))return _("IMDB ID not found for this content"),null;const z=Kp(o.imdb_id,e,E,w);return z||_("Failed to generate streaming URL"),z},G=z=>{f(z),v(!0)},Y=()=>{f(ED),v(!0)},U=z=>{if(z.preventDefault(),I.trim()){const Q=I.trim().startsWith("tt")?I.trim():`tt${I.trim()}`;l(ge=>({...ge,manual_imdb_id:Q})),f(SD),v(!0)}},W=()=>{const z=(o==null?void 0:o.manual_imdb_id)||I;return z?Kp(z,e,E,w):(_("IMDB ID is required"),null)},P=()=>{x?v(!1):n(-1)};return p?h.jsx(bD,{}):y||!o?h.jsx(wD,{error:y,onBack:P}):h.jsxs("div",{className:"min-h-screen bg-black",children:[h.jsx("div",{className:"fixed top-20 left-4 z-50",children:h.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-black/50 hover:bg-black/70 text-white rounded-md transition-colors",children:[h.jsx(xc,{size:20}),h.jsx("span",{className:"hidden sm:inline",children:x?"Back to Options":"Back"})]})}),x&&d?h.jsx("div",{className:"container mx-auto px-4 py-20",children:h.jsxs("div",{className:"max-w-6xl mx-auto",children:[h.jsx("div",{className:"aspect-video bg-gray-900 rounded-lg overflow-hidden mb-6",children:d.provider_id===999999?b?h.jsx(D0,{error:b}):h.jsx("iframe",{src:$(),title:o.title||o.name,style:{width:"100%",height:"100%"},frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; fullscreen; encrypted-media",allowFullScreen:!0}):d.provider_id===999998?b?h.jsx(D0,{error:b}):h.jsx("iframe",{src:W(),title:o.title||o.name,style:{width:"100%",height:"100%"},frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; fullscreen; encrypted-media",allowFullScreen:!0}):d.link?h.jsx("iframe",{src:d.link,title:o.title||o.name,className:"w-full h-full",referrerPolicy:"no-referrer",allow:"autoplay; fullscreen; encrypted-media",allowFullScreen:!0}):h.jsx("div",{className:"w-full h-full flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-gray-400 mb-4",children:"No embedded player available"}),h.jsxs("a",{href:c.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-3 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors",children:[h.jsx(Xd,{size:20}),"Watch on ",d.provider_name]})]})})}),s.pathname.includes("tv")&&h.jsxs("div",{className:"flex gap-4 mb-4",children:[h.jsx("select",{value:E,onChange:z=>{T(Number(z.target.value)),_(null)},className:"bg-gray-800 text-white px-4 py-2 rounded-lg",children:[...Array(Math.min(o.number_of_seasons||1,20))].map((z,Q)=>h.jsxs("option",{value:Q+1,children:["Season ",Q+1]},Q+1))}),h.jsx("select",{value:w,onChange:z=>{R(Number(z.target.value)),_(null)},className:"bg-gray-800 text-white px-4 py-2 rounded-lg",children:[...Array(((K=(B=o.seasons)==null?void 0:B[E-1])==null?void 0:K.episode_count)||10)].map((z,Q)=>h.jsxs("option",{value:Q+1,children:["Episode ",Q+1]},Q+1))})]}),h.jsxs("div",{className:"flex items-start gap-6",children:[o.poster_path&&h.jsx("img",{src:Ms(o.poster_path,"w200"),alt:o.title||o.name,className:"w-24 rounded-lg hidden sm:block"}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:o.title||o.name}),h.jsxs("p",{className:"text-gray-400 mb-2",children:[Gs(o.release_date||o.first_air_date)," ",o.runtime&&` ${Math.floor(o.runtime/60)}h ${o.runtime%60}m`," ",h.jsx("span",{className:"text-green-400 ml-2",children:d.provider_id===999999?"Streaming on vidsrc-embed.ru":d.provider_id===999998?"Streaming on vidsrc-embed.ru (Manual IMDB)":`Streaming on ${d.provider_name}`})]}),o.overview&&h.jsx("p",{className:"text-gray-300 mt-2 line-clamp-2",children:o.overview}),h.jsxs("div",{className:"flex gap-3 mt-4",children:[h.jsx(ve,{to:`/${e}/${t}`,className:"inline-flex items-center gap-2 px-6 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-colors",children:"View Details"}),h.jsxs(ve,{to:`/watch-trailer/${e}/${t}`,className:"inline-flex items-center gap-2 px-6 py-2 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors",children:[h.jsx(ke,{size:18}),"Watch Trailer"]})]})]})]})]})}):h.jsx("div",{className:"container mx-auto px-4 py-20",children:h.jsxs("div",{className:"max-w-5xl mx-auto",children:[h.jsxs("div",{className:"flex flex-col md:flex-row gap-6 mb-8",children:[o.poster_path&&h.jsx("img",{src:Ms(o.poster_path,"w300"),alt:o.title||o.name,className:"w-48 rounded-lg shadow-2xl mx-auto md:mx-0"}),h.jsxs("div",{className:"flex-1 text-center md:text-left",children:[h.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2",children:o.title||o.name}),h.jsxs("p",{className:"text-gray-400 mb-4",children:[Gs(o.release_date||o.first_air_date)," ",o.runtime&&` ${LD(o.runtime)}`," ",o.vote_average&&` ${o.vote_average.toFixed(1)} Rating`]}),o.tagline&&h.jsxs("p",{className:"text-gray-500 italic mb-4",children:['"',o.tagline,'"']}),o.overview&&h.jsx("p",{className:"text-gray-300",children:_D(o.overview,300)})]})]}),h.jsxs("div",{className:"space-y-8",children:[o.imdb_id&&h.jsxs("section",{children:[h.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(ke,{className:"text-green-500"}),"Watch for Free - vidsrc-embed.ru"]}),h.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:h.jsx(P0,{movie:o,type:e,onClick:Y,selected:(d==null?void 0:d.provider_id)===999999})})]}),!o.imdb_id&&s.pathname.includes("tv")&&h.jsxs("section",{children:[h.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(ke,{className:"text-green-500"}),"Watch for Free - vidsrc-embed.ru"]}),h.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:h.jsx(P0,{movie:o,type:e,onClick:U,selected:(d==null?void 0:d.provider_id)===999998})})]}),(c==null?void 0:c.free)&&c.free.length>0&&h.jsxs("section",{children:[h.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(ke,{className:"text-green-500"}),"Watch for Free"]}),h.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:c.free.map(z=>h.jsx($o,{provider:z,onClick:()=>G(z),selected:(d==null?void 0:d.provider_id)===z.provider_id},z.provider_id))})]}),(c==null?void 0:c.flatrate)&&c.flatrate.length>0&&h.jsxs("section",{children:[h.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx(gv,{className:"text-blue-500"}),"Subscription"]}),h.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:c.flatrate.map(z=>h.jsx($o,{provider:z,onClick:()=>G(z),selected:(d==null?void 0:d.provider_id)===z.provider_id},z.provider_id))})]}),(c==null?void 0:c.rent)&&c.rent.length>0&&h.jsxs("section",{children:[h.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx("span",{className:"text-yellow-500",children:"$"}),"Rent"]}),h.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:c.rent.map(z=>h.jsx($o,{provider:z,onClick:()=>G(z),selected:(d==null?void 0:d.provider_id)===z.provider_id,price:z.rent},z.provider_id))})]}),(c==null?void 0:c.buy)&&c.buy.length>0&&h.jsxs("section",{children:[h.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[h.jsx("span",{className:"text-green-500",children:"$"}),"Buy"]}),h.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:c.buy.map(z=>h.jsx($o,{provider:z,onClick:()=>G(z),selected:(d==null?void 0:d.provider_id)===z.provider_id,price:z.buy},z.provider_id))})]}),!((O=c==null?void 0:c.free)!=null&&O.length)&&!((F=c==null?void 0:c.flatrate)!=null&&F.length)&&!((Z=c==null?void 0:c.rent)!=null&&Z.length)&&!((te=c==null?void 0:c.buy)!=null&&te.length)&&!o.imdb_id&&h.jsx(AD,{movie:o,type:e,id:t}),(c==null?void 0:c.link)&&h.jsx("div",{className:"mt-8 text-center",children:h.jsxs("a",{href:c.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-colors",children:[h.jsx(Xd,{size:20}),"View All Watching Options on TMDB"]})})]})]})})]})},P0=({movie:s,type:e,onClick:t,selected:r})=>h.jsxs("button",{onClick:t,className:`
        w-full p-4 rounded-lg transition-all
        ${r?"bg-netflix-red ring-2 ring-netflix-red ring-offset-2 ring-offset-black":"bg-gray-800 hover:bg-gray-700"}
      `,children:[h.jsx("div",{className:"flex items-center justify-center mb-2",children:h.jsx("div",{className:"h-12 w-12 bg-gradient-to-br from-purple-600 to-blue-500 rounded-lg flex items-center justify-center",children:h.jsx("span",{className:"text-white font-bold text-sm",children:"VID"})})}),h.jsx("p",{className:"text-white text-sm font-medium text-center line-clamp-1",children:"vidsrc-embed.ru"}),h.jsx("div",{className:"absolute top-2 right-2",children:h.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-green-500 text-white",children:"Free"})}),r&&h.jsx("div",{className:"absolute -top-2 -right-2 bg-netflix-red rounded-full p-1",children:h.jsx(ke,{size:12,className:"text-white"})}),h.jsx("p",{className:"text-gray-400 text-xs text-center mt-2",children:location.pathname.includes("tv")?`${s.number_of_seasons||0} Seasons`:"Full Movie"})]}),$o=({provider:s,onClick:e,selected:t,price:r})=>h.jsxs("button",{onClick:e,className:`
        relative p-4 rounded-lg transition-all
        ${t?"bg-netflix-red ring-2 ring-netflix-red ring-offset-2 ring-offset-black":"bg-gray-800 hover:bg-gray-700"}
      `,children:[h.jsx("div",{className:"flex items-center justify-center mb-2",children:s.logo_path?h.jsx("img",{src:`https://image.tmdb.org/t/p/original${s.logo_path}`,alt:s.provider_name,className:"h-12 object-contain"}):h.jsx("div",{className:"w-12 h-12 bg-gray-600 rounded-lg flex items-center justify-center",children:h.jsx("span",{className:"text-white font-bold text-lg",children:s.provider_name.charAt(0)})})}),h.jsx("p",{className:"text-white text-sm font-medium text-center line-clamp-1",children:s.provider_name}),r&&h.jsx("p",{className:"text-gray-400 text-xs text-center mt-1",children:r.type==="rent"?`Rent $${r.price}`:`Buy $${r.price}`}),h.jsx("div",{className:"absolute top-2 right-2",children:h.jsx("span",{className:`
          text-xs px-2 py-0.5 rounded
          ${s.type==="free"?"bg-green-500 text-white":""}
          ${s.type==="subscription"?"bg-blue-500 text-white":""}
          ${s.type==="rent"?"bg-yellow-500 text-black":""}
          ${s.type==="buy"?"bg-green-600 text-white":""}
        `,children:DA[s.type]||s.type})}),t&&h.jsx("div",{className:"absolute -top-2 -right-2 bg-netflix-red rounded-full p-1",children:h.jsx(ke,{size:12,className:"text-white"})})]}),bD=()=>h.jsx("div",{className:"min-h-screen bg-black",children:h.jsx("div",{className:"container mx-auto px-4 py-20",children:h.jsxs("div",{className:"max-w-5xl mx-auto",children:[h.jsx(tt,{className:"h-8 w-48 mb-8"}),h.jsxs("div",{className:"flex gap-6 mb-8",children:[h.jsx(tt,{className:"w-48 h-72 rounded-lg"}),h.jsxs("div",{className:"flex-1 space-y-4",children:[h.jsx(tt,{className:"h-8 w-3/4"}),h.jsx(tt,{className:"h-4 w-1/2"}),h.jsx(tt,{className:"h-4 w-full"}),h.jsx(tt,{className:"h-4 w-2/3"})]})]}),h.jsxs("div",{className:"space-y-6",children:[h.jsx(tt,{className:"h-6 w-32 mb-4"}),h.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((s,e)=>h.jsx(tt,{className:"h-28 rounded-lg"},e))})]})]})})}),wD=({error:s,onBack:e})=>h.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsxs("p",{className:"text-red-500 text-lg mb-4",children:["Error: ",s]}),h.jsx("button",{onClick:e,className:"px-6 py-3 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors",children:"Go Back"})]})}),AD=({movie:s,type:e,id:t})=>h.jsxs("div",{className:"text-center py-16 bg-gray-900/50 rounded-lg",children:[h.jsx("div",{className:"mb-6",children:h.jsx("svg",{className:"w-20 h-20 mx-auto text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),h.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Not Available for Streaming"}),h.jsx("p",{className:"text-gray-400 mb-6",children:"This title is not currently available to watch for free or by subscription in your region."}),h.jsxs("div",{className:"flex justify-center gap-4",children:[h.jsxs(ve,{to:`/watch-trailer/${e}/${t}`,className:"inline-flex items-center gap-2 px-6 py-3 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors",children:[h.jsx(ke,{size:20}),"Watch Trailer"]}),h.jsx(ve,{to:`/${e}/${t}`,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-colors",children:"View Details"})]})]}),D0=({error:s})=>h.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-900",children:h.jsxs("div",{className:"text-center max-w-md px-4",children:[h.jsx("div",{className:"mb-4",children:h.jsx("svg",{className:"w-16 h-16 mx-auto text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),h.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Cannot Load Player"}),h.jsx("p",{className:"text-gray-400",children:s}),h.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"This content may not be available for streaming in your region."})]})}),LD=s=>{const e=Math.floor(s/60),t=s%60;return e>0?`${e}h ${t}m`:`${t}m`},_D=(s,e)=>s?s.length<=e?s:s.substring(0,e).trim()+"...":"",RD="modulepreload",ID=function(s){return"/StreamFlix/"+s},N0={},Ut=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(t.map(l=>{if(l=ID(l),l in N0)return;N0[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":RD,c||(d.as="script"),d.crossOrigin="",d.href=l,o&&d.setAttribute("nonce",o),document.head.appendChild(d),c)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})};var kD=function(e,t,r){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("script");typeof t=="function"&&(r=t,t={}),t=t||{},r=r||function(){},i.type=t.type||"text/javascript",i.charset=t.charset||"utf8",i.async="async"in t?!!t.async:!0,i.src=e,t.attrs&&CD(i,t.attrs),t.text&&(i.text=""+t.text);var a="onload"in i?O0:PD;a(i,r),i.onload||O0(i,r),n.appendChild(i)};function CD(s,e){for(var t in e)s.setAttribute(t,e[t])}function O0(s,e){s.onload=function(){this.onerror=this.onload=null,e(null,s)},s.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),s)}}function PD(s,e){s.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,e(null,s))}}var DD=function(e){return ND(e)&&!OD(e)};function ND(s){return!!s&&typeof s=="object"}function OD(s){var e=Object.prototype.toString.call(s);return e==="[object RegExp]"||e==="[object Date]"||jD(s)}var MD=typeof Symbol=="function"&&Symbol.for,FD=MD?Symbol.for("react.element"):60103;function jD(s){return s.$$typeof===FD}function $D(s){return Array.isArray(s)?[]:{}}function Na(s,e){return e.clone!==!1&&e.isMergeableObject(s)?Si($D(s),s,e):s}function UD(s,e,t){return s.concat(e).map(function(r){return Na(r,t)})}function BD(s,e){if(!e.customMerge)return Si;var t=e.customMerge(s);return typeof t=="function"?t:Si}function VD(s){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(s).filter(function(e){return Object.propertyIsEnumerable.call(s,e)}):[]}function M0(s){return Object.keys(s).concat(VD(s))}function kS(s,e){try{return e in s}catch{return!1}}function GD(s,e){return kS(s,e)&&!(Object.hasOwnProperty.call(s,e)&&Object.propertyIsEnumerable.call(s,e))}function HD(s,e,t){var r={};return t.isMergeableObject(s)&&M0(s).forEach(function(n){r[n]=Na(s[n],t)}),M0(e).forEach(function(n){GD(s,n)||(kS(s,n)&&t.isMergeableObject(e[n])?r[n]=BD(n,t)(s[n],e[n],t):r[n]=Na(e[n],t))}),r}function Si(s,e,t){t=t||{},t.arrayMerge=t.arrayMerge||UD,t.isMergeableObject=t.isMergeableObject||DD,t.cloneUnlessOtherwiseSpecified=Na;var r=Array.isArray(e),n=Array.isArray(s),i=r===n;return i?r?t.arrayMerge(s,e,t):HD(s,e,t):Na(e,t)}Si.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(r,n){return Si(r,n,t)},{})};var zD=Si,CS=zD,KD=Object.create,Pc=Object.defineProperty,WD=Object.getOwnPropertyDescriptor,YD=Object.getOwnPropertyNames,qD=Object.getPrototypeOf,XD=Object.prototype.hasOwnProperty,QD=(s,e)=>{for(var t in e)Pc(s,t,{get:e[t],enumerable:!0})},PS=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of YD(e))!XD.call(s,n)&&n!==t&&Pc(s,n,{get:()=>e[n],enumerable:!(r=WD(e,n))||r.enumerable});return s},lm=(s,e,t)=>(t=s!=null?KD(qD(s)):{},PS(!s||!s.__esModule?Pc(t,"default",{value:s,enumerable:!0}):t,s)),JD=s=>PS(Pc({},"__esModule",{value:!0}),s),DS={};QD(DS,{callPlayer:()=>mN,getConfig:()=>hN,getSDK:()=>dN,isBlobUrl:()=>gN,isMediaStream:()=>pN,lazy:()=>sN,omit:()=>fN,parseEndTime:()=>lN,parseStartTime:()=>oN,queryString:()=>uN,randomString:()=>cN,supportsWebKitPresentationMode:()=>yN});var Dc=JD(DS),ZD=lm(A),eN=lm(kD),tN=lm(CS);const sN=s=>ZD.default.lazy(async()=>{const e=await s();return typeof e.default=="function"?e:e.default}),rN=/[?&#](?:start|t)=([0-9hms]+)/,nN=/[?&#]end=([0-9hms]+)/,Ah=/(\d+)(h|m|s)/g,iN=/^\d+$/;function NS(s,e){if(s instanceof Array)return;const t=s.match(e);if(t){const r=t[1];if(r.match(Ah))return aN(r);if(iN.test(r))return parseInt(r)}}function aN(s){let e=0,t=Ah.exec(s);for(;t!==null;){const[,r,n]=t;n==="h"&&(e+=parseInt(r,10)*60*60),n==="m"&&(e+=parseInt(r,10)*60),n==="s"&&(e+=parseInt(r,10)),t=Ah.exec(s)}return e}function oN(s){return NS(s,rN)}function lN(s){return NS(s,nN)}function cN(){return Math.random().toString(36).substr(2,5)}function uN(s){return Object.keys(s).map(e=>`${e}=${s[e]}`).join("&")}function Yu(s){return window[s]?window[s]:window.exports&&window.exports[s]?window.exports[s]:window.module&&window.module.exports&&window.module.exports[s]?window.module.exports[s]:null}const Dn={},dN=function(e,t,r=null,n=()=>!0,i=eN.default){const a=Yu(t);return a&&n(a)?Promise.resolve(a):new Promise((o,l)=>{if(Dn[e]){Dn[e].push({resolve:o,reject:l});return}Dn[e]=[{resolve:o,reject:l}];const c=u=>{Dn[e].forEach(d=>d.resolve(u))};if(r){const u=window[r];window[r]=function(){u&&u(),c(Yu(t))}}i(e,u=>{u?(Dn[e].forEach(d=>d.reject(u)),Dn[e]=null):r||c(Yu(t))})})};function hN(s,e){return(0,tN.default)(e.config,s.config)}function fN(s,...e){const t=[].concat(...e),r={},n=Object.keys(s);for(const i of n)t.indexOf(i)===-1&&(r[i]=s[i]);return r}function mN(s,...e){if(!this.player||!this.player[s]){let t=`ReactPlayer: ${this.constructor.displayName} player could not call %c${s}%c  `;return this.player?this.player[s]||(t+="The method was not available"):t+="The player was not available",console.warn(t,"font-weight: bold",""),null}return this.player[s](...e)}function pN(s){return typeof window<"u"&&typeof window.MediaStream<"u"&&s instanceof window.MediaStream}function gN(s){return/^blob:/.test(s)}function yN(s=document.createElement("video")){const e=/iPhone|iPod/.test(navigator.userAgent)===!1;return s.webkitSupportsPresentationMode&&typeof s.webkitSetPresentationMode=="function"&&e}var cm=Object.defineProperty,xN=Object.getOwnPropertyDescriptor,vN=Object.getOwnPropertyNames,EN=Object.prototype.hasOwnProperty,SN=(s,e)=>{for(var t in e)cm(s,t,{get:e[t],enumerable:!0})},TN=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of vN(e))!EN.call(s,n)&&n!==t&&cm(s,n,{get:()=>e[n],enumerable:!(r=xN(e,n))||r.enumerable});return s},bN=s=>TN(cm({},"__esModule",{value:!0}),s),OS={};SN(OS,{AUDIO_EXTENSIONS:()=>um,DASH_EXTENSIONS:()=>qS,FLV_EXTENSIONS:()=>XS,HLS_EXTENSIONS:()=>hm,MATCH_URL_DAILYMOTION:()=>zS,MATCH_URL_FACEBOOK:()=>$S,MATCH_URL_FACEBOOK_WATCH:()=>US,MATCH_URL_KALTURA:()=>YS,MATCH_URL_MIXCLOUD:()=>KS,MATCH_URL_MUX:()=>jS,MATCH_URL_SOUNDCLOUD:()=>MS,MATCH_URL_STREAMABLE:()=>BS,MATCH_URL_TWITCH_CHANNEL:()=>HS,MATCH_URL_TWITCH_VIDEO:()=>GS,MATCH_URL_VIDYARD:()=>WS,MATCH_URL_VIMEO:()=>FS,MATCH_URL_WISTIA:()=>VS,MATCH_URL_YOUTUBE:()=>Lh,VIDEO_EXTENSIONS:()=>dm,canPlay:()=>AN});var wN=bN(OS),F0=Dc;const Lh=/(?:youtu\.be\/|youtube(?:-nocookie|education)?\.com\/(?:embed\/|v\/|watch\/|watch\?v=|watch\?.+&v=|shorts\/|live\/))((\w|-){11})|youtube\.com\/playlist\?list=|youtube\.com\/user\//,MS=/(?:soundcloud\.com|snd\.sc)\/[^.]+$/,FS=/vimeo\.com\/(?!progressive_redirect).+/,jS=/stream\.mux\.com\/(?!\w+\.m3u8)(\w+)/,$S=/^https?:\/\/(www\.)?facebook\.com.*\/(video(s)?|watch|story)(\.php?|\/).+$/,US=/^https?:\/\/fb\.watch\/.+$/,BS=/streamable\.com\/([a-z0-9]+)$/,VS=/(?:wistia\.(?:com|net)|wi\.st)\/(?:medias|embed)\/(?:iframe\/)?([^?]+)/,GS=/(?:www\.|go\.)?twitch\.tv\/videos\/(\d+)($|\?)/,HS=/(?:www\.|go\.)?twitch\.tv\/([a-zA-Z0-9_]+)($|\?)/,zS=/^(?:(?:https?):)?(?:\/\/)?(?:www\.)?(?:(?:dailymotion\.com(?:\/embed)?\/video)|dai\.ly)\/([a-zA-Z0-9]+)(?:_[\w_-]+)?(?:[\w.#_-]+)?/,KS=/mixcloud\.com\/([^/]+\/[^/]+)/,WS=/vidyard.com\/(?:watch\/)?([a-zA-Z0-9-_]+)/,YS=/^https?:\/\/[a-zA-Z]+\.kaltura.(com|org)\/p\/([0-9]+)\/sp\/([0-9]+)00\/embedIframeJs\/uiconf_id\/([0-9]+)\/partner_id\/([0-9]+)(.*)entry_id.([a-zA-Z0-9-_].*)$/,um=/\.(m4a|m4b|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,dm=/\.(mp4|og[gv]|webm|mov|m4v)(#t=[,\d+]+)?($|\?)/i,hm=/\.(m3u8)($|\?)/i,qS=/\.(mpd)($|\?)/i,XS=/\.(flv)($|\?)/i,_h=s=>{if(s instanceof Array){for(const e of s)if(typeof e=="string"&&_h(e)||_h(e.src))return!0;return!1}return(0,F0.isMediaStream)(s)||(0,F0.isBlobUrl)(s)?!0:um.test(s)||dm.test(s)||hm.test(s)||qS.test(s)||XS.test(s)},AN={youtube:s=>s instanceof Array?s.every(e=>Lh.test(e)):Lh.test(s),soundcloud:s=>MS.test(s)&&!um.test(s),vimeo:s=>FS.test(s)&&!dm.test(s)&&!hm.test(s),mux:s=>jS.test(s),facebook:s=>$S.test(s)||US.test(s),streamable:s=>BS.test(s),wistia:s=>VS.test(s),twitch:s=>GS.test(s)||HS.test(s),dailymotion:s=>zS.test(s),mixcloud:s=>KS.test(s),vidyard:s=>WS.test(s),kaltura:s=>YS.test(s),file:_h};var fm=Object.defineProperty,LN=Object.getOwnPropertyDescriptor,_N=Object.getOwnPropertyNames,RN=Object.prototype.hasOwnProperty,IN=(s,e)=>{for(var t in e)fm(s,t,{get:e[t],enumerable:!0})},kN=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of _N(e))!RN.call(s,n)&&n!==t&&fm(s,n,{get:()=>e[n],enumerable:!(r=LN(e,n))||r.enumerable});return s},CN=s=>kN(fm({},"__esModule",{value:!0}),s),QS={};IN(QS,{default:()=>DN});var PN=CN(QS),jt=Dc,Rt=wN,DN=[{key:"youtube",name:"YouTube",canPlay:Rt.canPlay.youtube,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./YouTube-DkkuKw9p.js").then(s=>s.Y),[]))},{key:"soundcloud",name:"SoundCloud",canPlay:Rt.canPlay.soundcloud,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./SoundCloud-BiFmNHRk.js").then(s=>s.S),[]))},{key:"vimeo",name:"Vimeo",canPlay:Rt.canPlay.vimeo,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./Vimeo-Cjyo0b4b.js").then(s=>s.V),[]))},{key:"mux",name:"Mux",canPlay:Rt.canPlay.mux,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./Mux-CVPeIt2C.js").then(s=>s.M),[]))},{key:"facebook",name:"Facebook",canPlay:Rt.canPlay.facebook,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./Facebook-xBXTonAB.js").then(s=>s.F),[]))},{key:"streamable",name:"Streamable",canPlay:Rt.canPlay.streamable,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./Streamable-D3aE0gSL.js").then(s=>s.S),[]))},{key:"wistia",name:"Wistia",canPlay:Rt.canPlay.wistia,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./Wistia-Dvun-pBf.js").then(s=>s.W),[]))},{key:"twitch",name:"Twitch",canPlay:Rt.canPlay.twitch,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./Twitch-w_z7Kwmk.js").then(s=>s.T),[]))},{key:"dailymotion",name:"DailyMotion",canPlay:Rt.canPlay.dailymotion,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./DailyMotion-rPB5r2rl.js").then(s=>s.D),[]))},{key:"mixcloud",name:"Mixcloud",canPlay:Rt.canPlay.mixcloud,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./Mixcloud-DYeYRnLo.js").then(s=>s.M),[]))},{key:"vidyard",name:"Vidyard",canPlay:Rt.canPlay.vidyard,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./Vidyard-DIpBEiPG.js").then(s=>s.V),[]))},{key:"kaltura",name:"Kaltura",canPlay:Rt.canPlay.kaltura,lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./Kaltura-D-feqq7B.js").then(s=>s.K),[]))},{key:"file",name:"FilePlayer",canPlay:Rt.canPlay.file,canEnablePIP:s=>Rt.canPlay.file(s)&&(document.pictureInPictureEnabled||(0,jt.supportsWebKitPresentationMode)())&&!Rt.AUDIO_EXTENSIONS.test(s),lazyPlayer:(0,jt.lazy)(()=>Ut(()=>import("./FilePlayer-Df69f7aP.js").then(s=>s.F),[]))}],j0=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function NN(s,e){return!!(s===e||j0(s)&&j0(e))}function ON(s,e){if(s.length!==e.length)return!1;for(var t=0;t<s.length;t++)if(!NN(s[t],e[t]))return!1;return!0}function MN(s,e){e===void 0&&(e=ON);var t,r=[],n,i=!1;function a(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];return i&&t===this&&e(o,r)||(n=s.apply(this,o),i=!0,t=this,r=o),n}return a}const FN=Object.freeze(Object.defineProperty({__proto__:null,default:MN},Symbol.toStringTag,{value:"Module"})),jN=MT(FN);var $N=typeof Element<"u",UN=typeof Map=="function",BN=typeof Set=="function",VN=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function cl(s,e){if(s===e)return!0;if(s&&e&&typeof s=="object"&&typeof e=="object"){if(s.constructor!==e.constructor)return!1;var t,r,n;if(Array.isArray(s)){if(t=s.length,t!=e.length)return!1;for(r=t;r--!==0;)if(!cl(s[r],e[r]))return!1;return!0}var i;if(UN&&s instanceof Map&&e instanceof Map){if(s.size!==e.size)return!1;for(i=s.entries();!(r=i.next()).done;)if(!e.has(r.value[0]))return!1;for(i=s.entries();!(r=i.next()).done;)if(!cl(r.value[1],e.get(r.value[0])))return!1;return!0}if(BN&&s instanceof Set&&e instanceof Set){if(s.size!==e.size)return!1;for(i=s.entries();!(r=i.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(VN&&ArrayBuffer.isView(s)&&ArrayBuffer.isView(e)){if(t=s.length,t!=e.length)return!1;for(r=t;r--!==0;)if(s[r]!==e[r])return!1;return!0}if(s.constructor===RegExp)return s.source===e.source&&s.flags===e.flags;if(s.valueOf!==Object.prototype.valueOf&&typeof s.valueOf=="function"&&typeof e.valueOf=="function")return s.valueOf()===e.valueOf();if(s.toString!==Object.prototype.toString&&typeof s.toString=="function"&&typeof e.toString=="function")return s.toString()===e.toString();if(n=Object.keys(s),t=n.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,n[r]))return!1;if($N&&s instanceof Element)return!1;for(r=t;r--!==0;)if(!((n[r]==="_owner"||n[r]==="__v"||n[r]==="__o")&&s.$$typeof)&&!cl(s[n[r]],e[n[r]]))return!1;return!0}return s!==s&&e!==e}var JS=function(e,t){try{return cl(e,t)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},ZS={exports:{}},GN="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",HN=GN,zN=HN;function eT(){}function tT(){}tT.resetWarningCache=eT;var KN=function(){function s(r,n,i,a,o,l){if(l!==zN){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}s.isRequired=s;function e(){return s}var t={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:e,element:s,elementType:s,instanceOf:e,node:s,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:tT,resetWarningCache:eT};return t.PropTypes=t,t};ZS.exports=KN();var WN=ZS.exports,YN=Object.create,Nc=Object.defineProperty,qN=Object.getOwnPropertyDescriptor,XN=Object.getOwnPropertyNames,QN=Object.getPrototypeOf,JN=Object.prototype.hasOwnProperty,ZN=(s,e)=>{for(var t in e)Nc(s,t,{get:e[t],enumerable:!0})},sT=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of XN(e))!JN.call(s,n)&&n!==t&&Nc(s,n,{get:()=>e[n],enumerable:!(r=qN(e,n))||r.enumerable});return s},e2=(s,e,t)=>(t=s!=null?YN(QN(s)):{},sT(!s||!s.__esModule?Nc(t,"default",{value:s,enumerable:!0}):t,s)),t2=s=>sT(Nc({},"__esModule",{value:!0}),s),rT={};ZN(rT,{defaultProps:()=>n2,propTypes:()=>r2});var nT=t2(rT),s2=e2(WN);const{string:ht,bool:It,number:Nn,array:qu,oneOfType:Vi,shape:Jt,object:wt,func:rt,node:$0}=s2.default,r2={url:Vi([ht,qu,wt]),playing:It,loop:It,controls:It,volume:Nn,muted:It,playbackRate:Nn,width:Vi([ht,Nn]),height:Vi([ht,Nn]),style:wt,progressInterval:Nn,playsinline:It,pip:It,stopOnUnmount:It,light:Vi([It,ht,wt]),playIcon:$0,previewTabIndex:Nn,previewAriaLabel:ht,fallback:$0,oEmbedUrl:ht,wrapper:Vi([ht,rt,Jt({render:rt.isRequired})]),config:Jt({soundcloud:Jt({options:wt}),youtube:Jt({playerVars:wt,embedOptions:wt,onUnstarted:rt}),facebook:Jt({appId:ht,version:ht,playerId:ht,attributes:wt}),dailymotion:Jt({params:wt}),vimeo:Jt({playerOptions:wt,title:ht}),mux:Jt({attributes:wt,version:ht}),file:Jt({attributes:wt,tracks:qu,forceVideo:It,forceAudio:It,forceHLS:It,forceSafariHLS:It,forceDisableHls:It,forceDASH:It,forceFLV:It,hlsOptions:wt,hlsVersion:ht,dashVersion:ht,flvVersion:ht}),wistia:Jt({options:wt,playerId:ht,customControls:qu}),mixcloud:Jt({options:wt}),twitch:Jt({options:wt,playerId:ht}),vidyard:Jt({options:wt})}),onReady:rt,onStart:rt,onPlay:rt,onPause:rt,onBuffer:rt,onBufferEnd:rt,onEnded:rt,onError:rt,onDuration:rt,onSeek:rt,onPlaybackRateChange:rt,onPlaybackQualityChange:rt,onProgress:rt,onClickPreview:rt,onEnablePIP:rt,onDisablePIP:rt},ft=()=>{},n2={playing:!1,loop:!1,controls:!1,volume:null,muted:!1,playbackRate:1,width:"640px",height:"360px",style:{},progressInterval:1e3,playsinline:!1,pip:!1,stopOnUnmount:!0,light:!1,fallback:null,wrapper:"div",previewTabIndex:0,previewAriaLabel:"",oEmbedUrl:"https://noembed.com/embed?url={url}",config:{soundcloud:{options:{visual:!0,buying:!1,liking:!1,download:!1,sharing:!1,show_comments:!1,show_playcount:!1}},youtube:{playerVars:{playsinline:1,showinfo:0,rel:0,iv_load_policy:3,modestbranding:1},embedOptions:{},onUnstarted:ft},facebook:{appId:"1309697205772819",version:"v3.3",playerId:null,attributes:{}},dailymotion:{params:{api:1,"endscreen-enable":!1}},vimeo:{playerOptions:{autopause:!1,byline:!1,portrait:!1,title:!1},title:null},mux:{attributes:{},version:"2"},file:{attributes:{},tracks:[],forceVideo:!1,forceAudio:!1,forceHLS:!1,forceDASH:!1,forceFLV:!1,hlsOptions:{},hlsVersion:"1.1.4",dashVersion:"3.1.3",flvVersion:"1.5.0",forceDisableHls:!1},wistia:{options:{},playerId:null,customControls:null},mixcloud:{options:{hide_cover:1}},twitch:{options:{},playerId:null},vidyard:{options:{}}},onReady:ft,onStart:ft,onPlay:ft,onPause:ft,onBuffer:ft,onBufferEnd:ft,onEnded:ft,onError:ft,onDuration:ft,onSeek:ft,onPlaybackRateChange:ft,onPlaybackQualityChange:ft,onProgress:ft,onClickPreview:ft,onEnablePIP:ft,onDisablePIP:ft};var i2=Object.create,Qa=Object.defineProperty,a2=Object.getOwnPropertyDescriptor,o2=Object.getOwnPropertyNames,l2=Object.getPrototypeOf,c2=Object.prototype.hasOwnProperty,u2=(s,e,t)=>e in s?Qa(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,d2=(s,e)=>{for(var t in e)Qa(s,t,{get:e[t],enumerable:!0})},iT=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of o2(e))!c2.call(s,n)&&n!==t&&Qa(s,n,{get:()=>e[n],enumerable:!(r=a2(e,n))||r.enumerable});return s},aT=(s,e,t)=>(t=s!=null?i2(l2(s)):{},iT(!s||!s.__esModule?Qa(t,"default",{value:s,enumerable:!0}):t,s)),h2=s=>iT(Qa({},"__esModule",{value:!0}),s),Qe=(s,e,t)=>(u2(s,typeof e!="symbol"?e+"":e,t),t),oT={};d2(oT,{default:()=>Oc});var f2=h2(oT),U0=aT(A),m2=aT(JS),lT=nT,p2=Dc;const g2=5e3;class Oc extends U0.Component{constructor(){super(...arguments),Qe(this,"mounted",!1),Qe(this,"isReady",!1),Qe(this,"isPlaying",!1),Qe(this,"isLoading",!0),Qe(this,"loadOnReady",null),Qe(this,"startOnPlay",!0),Qe(this,"seekOnPlay",null),Qe(this,"onDurationCalled",!1),Qe(this,"handlePlayerMount",e=>{if(this.player){this.progress();return}this.player=e,this.player.load(this.props.url),this.progress()}),Qe(this,"getInternalPlayer",e=>this.player?this.player[e]:null),Qe(this,"progress",()=>{if(this.props.url&&this.player&&this.isReady){const e=this.getCurrentTime()||0,t=this.getSecondsLoaded(),r=this.getDuration();if(r){const n={playedSeconds:e,played:e/r};t!==null&&(n.loadedSeconds=t,n.loaded=t/r),(n.playedSeconds!==this.prevPlayed||n.loadedSeconds!==this.prevLoaded)&&this.props.onProgress(n),this.prevPlayed=n.playedSeconds,this.prevLoaded=n.loadedSeconds}}this.progressTimeout=setTimeout(this.progress,this.props.progressFrequency||this.props.progressInterval)}),Qe(this,"handleReady",()=>{if(!this.mounted)return;this.isReady=!0,this.isLoading=!1;const{onReady:e,playing:t,volume:r,muted:n}=this.props;e(),!n&&r!==null&&this.player.setVolume(r),this.loadOnReady?(this.player.load(this.loadOnReady,!0),this.loadOnReady=null):t&&this.player.play(),this.handleDurationCheck()}),Qe(this,"handlePlay",()=>{this.isPlaying=!0,this.isLoading=!1;const{onStart:e,onPlay:t,playbackRate:r}=this.props;this.startOnPlay&&(this.player.setPlaybackRate&&r!==1&&this.player.setPlaybackRate(r),e(),this.startOnPlay=!1),t(),this.seekOnPlay&&(this.seekTo(this.seekOnPlay),this.seekOnPlay=null),this.handleDurationCheck()}),Qe(this,"handlePause",e=>{this.isPlaying=!1,this.isLoading||this.props.onPause(e)}),Qe(this,"handleEnded",()=>{const{activePlayer:e,loop:t,onEnded:r}=this.props;e.loopOnEnded&&t&&this.seekTo(0),t||(this.isPlaying=!1,r())}),Qe(this,"handleError",(...e)=>{this.isLoading=!1,this.props.onError(...e)}),Qe(this,"handleDurationCheck",()=>{clearTimeout(this.durationCheckTimeout);const e=this.getDuration();e?this.onDurationCalled||(this.props.onDuration(e),this.onDurationCalled=!0):this.durationCheckTimeout=setTimeout(this.handleDurationCheck,100)}),Qe(this,"handleLoaded",()=>{this.isLoading=!1})}componentDidMount(){this.mounted=!0}componentWillUnmount(){clearTimeout(this.progressTimeout),clearTimeout(this.durationCheckTimeout),this.isReady&&this.props.stopOnUnmount&&(this.player.stop(),this.player.disablePIP&&this.player.disablePIP()),this.mounted=!1}componentDidUpdate(e){if(!this.player)return;const{url:t,playing:r,volume:n,muted:i,playbackRate:a,pip:o,loop:l,activePlayer:c,disableDeferredLoading:u}=this.props;if(!(0,m2.default)(e.url,t)){if(this.isLoading&&!c.forceLoad&&!u&&!(0,p2.isMediaStream)(t)){console.warn(`ReactPlayer: the attempt to load ${t} is being deferred until the player has loaded`),this.loadOnReady=t;return}this.isLoading=!0,this.startOnPlay=!0,this.onDurationCalled=!1,this.player.load(t,this.isReady)}!e.playing&&r&&!this.isPlaying&&this.player.play(),e.playing&&!r&&this.isPlaying&&this.player.pause(),!e.pip&&o&&this.player.enablePIP&&this.player.enablePIP(),e.pip&&!o&&this.player.disablePIP&&this.player.disablePIP(),e.volume!==n&&n!==null&&this.player.setVolume(n),e.muted!==i&&(i?this.player.mute():(this.player.unmute(),n!==null&&setTimeout(()=>this.player.setVolume(n)))),e.playbackRate!==a&&this.player.setPlaybackRate&&this.player.setPlaybackRate(a),e.loop!==l&&this.player.setLoop&&this.player.setLoop(l)}getDuration(){return this.isReady?this.player.getDuration():null}getCurrentTime(){return this.isReady?this.player.getCurrentTime():null}getSecondsLoaded(){return this.isReady?this.player.getSecondsLoaded():null}seekTo(e,t,r){if(!this.isReady){e!==0&&(this.seekOnPlay=e,setTimeout(()=>{this.seekOnPlay=null},g2));return}if(t?t==="fraction":e>0&&e<1){const i=this.player.getDuration();if(!i){console.warn("ReactPlayer: could not seek using fraction duration not yet available");return}this.player.seekTo(i*e,r);return}this.player.seekTo(e,r)}render(){const e=this.props.activePlayer;return e?U0.default.createElement(e,{...this.props,onMount:this.handlePlayerMount,onReady:this.handleReady,onPlay:this.handlePlay,onPause:this.handlePause,onEnded:this.handleEnded,onLoaded:this.handleLoaded,onError:this.handleError}):null}}Qe(Oc,"displayName","Player");Qe(Oc,"propTypes",lT.propTypes);Qe(Oc,"defaultProps",lT.defaultProps);var y2=Object.create,Ja=Object.defineProperty,x2=Object.getOwnPropertyDescriptor,v2=Object.getOwnPropertyNames,E2=Object.getPrototypeOf,S2=Object.prototype.hasOwnProperty,T2=(s,e,t)=>e in s?Ja(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,b2=(s,e)=>{for(var t in e)Ja(s,t,{get:e[t],enumerable:!0})},cT=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of v2(e))!S2.call(s,n)&&n!==t&&Ja(s,n,{get:()=>e[n],enumerable:!(r=x2(e,n))||r.enumerable});return s},Za=(s,e,t)=>(t=s!=null?y2(E2(s)):{},cT(!s||!s.__esModule?Ja(t,"default",{value:s,enumerable:!0}):t,s)),w2=s=>cT(Ja({},"__esModule",{value:!0}),s),Xe=(s,e,t)=>(T2(s,typeof e!="symbol"?e+"":e,t),t),uT={};b2(uT,{createReactPlayer:()=>D2});var A2=w2(uT),Mn=Za(A),L2=Za(CS),Xu=Za(jN),B0=Za(JS),qi=nT,dT=Dc,_2=Za(f2);const R2=(0,dT.lazy)(()=>Ut(()=>import("./Preview-BqwHfL8E.js").then(s=>s.P),[])),I2=typeof window<"u"&&window.document&&typeof document<"u",k2=typeof Bc<"u"&&Bc.window&&Bc.window.document,C2=Object.keys(qi.propTypes),P2=I2||k2?Mn.Suspense:()=>null,Gi=[],D2=(s,e)=>{var t;return t=class extends Mn.Component{constructor(){super(...arguments),Xe(this,"state",{showPreview:!!this.props.light}),Xe(this,"references",{wrapper:r=>{this.wrapper=r},player:r=>{this.player=r}}),Xe(this,"handleClickPreview",r=>{this.setState({showPreview:!1}),this.props.onClickPreview(r)}),Xe(this,"showPreview",()=>{this.setState({showPreview:!0})}),Xe(this,"getDuration",()=>this.player?this.player.getDuration():null),Xe(this,"getCurrentTime",()=>this.player?this.player.getCurrentTime():null),Xe(this,"getSecondsLoaded",()=>this.player?this.player.getSecondsLoaded():null),Xe(this,"getInternalPlayer",(r="player")=>this.player?this.player.getInternalPlayer(r):null),Xe(this,"seekTo",(r,n,i)=>{if(!this.player)return null;this.player.seekTo(r,n,i)}),Xe(this,"handleReady",()=>{this.props.onReady(this)}),Xe(this,"getActivePlayer",(0,Xu.default)(r=>{for(const n of[...Gi,...s])if(n.canPlay(r))return n;return e||null})),Xe(this,"getConfig",(0,Xu.default)((r,n)=>{const{config:i}=this.props;return L2.default.all([qi.defaultProps.config,qi.defaultProps.config[n]||{},i,i[n]||{}])})),Xe(this,"getAttributes",(0,Xu.default)(r=>(0,dT.omit)(this.props,C2))),Xe(this,"renderActivePlayer",r=>{if(!r)return null;const n=this.getActivePlayer(r);if(!n)return null;const i=this.getConfig(r,n.key);return Mn.default.createElement(_2.default,{...this.props,key:n.key,ref:this.references.player,config:i,activePlayer:n.lazyPlayer||n,onReady:this.handleReady})})}shouldComponentUpdate(r,n){return!(0,B0.default)(this.props,r)||!(0,B0.default)(this.state,n)}componentDidUpdate(r){const{light:n}=this.props;!r.light&&n&&this.setState({showPreview:!0}),r.light&&!n&&this.setState({showPreview:!1})}renderPreview(r){if(!r)return null;const{light:n,playIcon:i,previewTabIndex:a,oEmbedUrl:o,previewAriaLabel:l}=this.props;return Mn.default.createElement(R2,{url:r,light:n,playIcon:i,previewTabIndex:a,previewAriaLabel:l,oEmbedUrl:o,onClick:this.handleClickPreview})}render(){const{url:r,style:n,width:i,height:a,fallback:o,wrapper:l}=this.props,{showPreview:c}=this.state,u=this.getAttributes(r),d=typeof l=="string"?this.references.wrapper:void 0;return Mn.default.createElement(l,{ref:d,style:{...n,width:i,height:a},...u},Mn.default.createElement(P2,{fallback:o},c?this.renderPreview(r):this.renderActivePlayer(r)))}},Xe(t,"displayName","ReactPlayer"),Xe(t,"propTypes",qi.propTypes),Xe(t,"defaultProps",qi.defaultProps),Xe(t,"addCustomPlayer",r=>{Gi.push(r)}),Xe(t,"removeCustomPlayers",()=>{Gi.length=0}),Xe(t,"canPlay",r=>{for(const n of[...Gi,...s])if(n.canPlay(r))return!0;return!1}),Xe(t,"canEnablePIP",r=>{for(const n of[...Gi,...s])if(n.canEnablePIP&&n.canEnablePIP(r))return!0;return!1}),t};var N2=Object.create,Mc=Object.defineProperty,O2=Object.getOwnPropertyDescriptor,M2=Object.getOwnPropertyNames,F2=Object.getPrototypeOf,j2=Object.prototype.hasOwnProperty,$2=(s,e)=>{for(var t in e)Mc(s,t,{get:e[t],enumerable:!0})},hT=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of M2(e))!j2.call(s,n)&&n!==t&&Mc(s,n,{get:()=>e[n],enumerable:!(r=O2(e,n))||r.enumerable});return s},U2=(s,e,t)=>(t=s!=null?N2(F2(s)):{},hT(!s||!s.__esModule?Mc(t,"default",{value:s,enumerable:!0}):t,s)),B2=s=>hT(Mc({},"__esModule",{value:!0}),s),fT={};$2(fT,{default:()=>z2});var V2=B2(fT),Rh=U2(PN),G2=A2;const H2=Rh.default[Rh.default.length-1];var z2=(0,G2.createReactPlayer)(Rh.default,H2);const K2=V0(V2),W2=({videoId:s,title:e,onClose:t})=>{const[r,n]=A.useState(1),[i,a]=A.useState(!1),[o,l]=A.useState(!1),[c,u]=A.useState(!0),[d,f]=A.useState(!0),p=()=>{a(!i),n(i?1:0)},m=()=>{document.fullscreenElement?(document.exitFullscreen(),l(!1)):(document.documentElement.requestFullscreen(),l(!0))},y=x=>{const v=parseFloat(x.target.value);n(v),a(v===0)},g=$A(s)||s;return g?h.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden group",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[t&&h.jsx("button",{onClick:t,className:"absolute top-4 right-4 z-20 p-2 bg-black/50 hover:bg-black/70 text-white rounded-full transition-colors opacity-0 group-hover:opacity-100",children:h.jsx(jl,{size:24})}),h.jsx("div",{className:"aspect-video",children:h.jsx(K2,{url:`https://www.youtube.com/watch?v=${g}`,width:"100%",height:"100%",playing:d,volume:r,muted:i,controls:!1,config:{youtube:{playerVars:{autoplay:1,modestbranding:1,rel:0,fs:0}}}})}),h.jsxs("div",{className:`
          absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 to-transparent p-4
          transition-opacity duration-300
          ${c?"opacity-100":"opacity-0"}
        `,children:[h.jsx("div",{className:"w-full h-1 bg-gray-600 rounded-full mb-4 cursor-pointer",children:h.jsx("div",{className:"h-full bg-netflix-red rounded-full",style:{width:"0%"}})}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("button",{onClick:()=>f(!d),className:"text-white hover:text-netflix-red transition-colors",children:d?h.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:h.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):h.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:h.jsx("path",{d:"M8 5v14l11-7z"})})}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("button",{onClick:p,className:"text-white hover:text-netflix-red transition-colors",children:i||r===0?h.jsx(xv,{size:20}):h.jsx(Qd,{size:20})}),h.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:r,onChange:y,className:"w-20 accent-netflix-red"})]}),h.jsx("span",{className:"text-white font-medium hidden md:block",children:e||"Trailer"})]}),h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("button",{className:"text-white hover:text-netflix-red transition-colors hidden md:block",children:h.jsx(_f,{size:20})}),h.jsx("button",{onClick:m,className:"text-white hover:text-netflix-red transition-colors",children:o?h.jsx(LA,{size:20}):h.jsx(TA,{size:20})})]})]})]})]}):h.jsx("div",{className:"flex items-center justify-center h-96 bg-gray-800 rounded-lg",children:h.jsx("p",{className:"text-gray-400",children:"No trailer available"})})},Y2=()=>{const{type:s="movie",id:e}=Ba(),[t]=Va(),r=t.get("v"),n=Rs(),[i,a]=A.useState(null),[o,l]=A.useState(!0),[c,u]=A.useState(null);A.useEffect(()=>{(async()=>{try{const m=s==="tv"?await Of(e):await Nf(e);a(m)}catch(m){console.error("Error fetching movie:",m),u(m.message||"Failed to load trailer")}finally{l(!1)}})()},[e,s]);const[d,f]=A.useState(r);return A.useEffect(()=>{r||(async()=>{var m,y;try{const g=s==="tv"?await Hv(e):await Gv(e),x=((m=g.results)==null?void 0:m.find(v=>v.type==="Trailer"&&v.site==="YouTube"))||((y=g.results)==null?void 0:y.find(v=>v.type==="Teaser"&&v.site==="YouTube"));x&&f(x.key)}catch(g){console.error("Error fetching trailer:",g)}})()},[e,s,r]),o?h.jsx(q2,{}):c?h.jsx(X2,{error:c}):h.jsxs("div",{className:"min-h-screen bg-black",children:[h.jsx("div",{className:"fixed top-20 left-4 z-50",children:h.jsxs("button",{onClick:()=>n(-1),className:"flex items-center gap-2 px-4 py-2 bg-black/50 hover:bg-black/70 text-white rounded-md transition-colors",children:[h.jsx(xc,{size:20}),h.jsx("span",{className:"hidden sm:inline",children:"Back"})]})}),h.jsx("div",{className:"container mx-auto px-4 py-20",children:h.jsx("div",{className:"max-w-6xl mx-auto",children:d?h.jsxs(h.Fragment,{children:[h.jsx(W2,{videoId:d,title:(i==null?void 0:i.title)||(i==null?void 0:i.name)}),i&&h.jsxs("div",{className:"mt-6 flex items-start gap-6",children:[i.poster_path&&h.jsx("img",{src:Ms(i.poster_path,"w200"),alt:i.title||i.name,className:"w-24 rounded-lg hidden sm:block"}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:i.title||i.name}),h.jsxs("p",{className:"text-gray-400",children:[Gs(i.release_date||i.first_air_date)," ",i.vote_average&&` ${i.vote_average.toFixed(1)} Rating`]}),h.jsx("p",{className:"text-gray-300 mt-2 line-clamp-2",children:i.overview}),h.jsxs("div",{className:"flex gap-3 mt-4",children:[h.jsx(ve,{to:`/${s}/${e}`,className:"inline-flex items-center gap-2 px-6 py-2 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors",children:"View Details"}),h.jsxs("a",{href:`https://www.youtube.com/watch?v=${d}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-colors",children:[h.jsx(Xd,{size:18}),"Open in YouTube"]})]})]})]})]}):h.jsx(Q2,{movie:i,type:s,id:e})})})]})},q2=()=>h.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsx(tt,{className:"w-full max-w-4xl aspect-video rounded-lg mb-6"}),h.jsx(tt,{className:"h-8 w-64 mx-auto mb-4"}),h.jsx(tt,{className:"h-4 w-48 mx-auto"})]})}),X2=({error:s})=>h.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsxs("p",{className:"text-red-500 text-lg mb-4",children:["Error: ",s]}),h.jsx(ve,{to:"/",className:"px-6 py-3 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors",children:"Go Home"})]})}),Q2=({movie:s,type:e,id:t})=>h.jsxs("div",{className:"text-center py-16",children:[h.jsx("div",{className:"mb-6",children:h.jsx("svg",{className:"w-20 h-20 mx-auto text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),h.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"No Trailer Available"}),h.jsx("p",{className:"text-gray-400 mb-6",children:"Unfortunately, there's no trailer available for this title."}),s&&h.jsxs("div",{className:"flex justify-center gap-4",children:[h.jsx(ve,{to:`/${e}/${t}`,className:"px-6 py-3 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors",children:"View Details"}),h.jsx(ve,{to:"/browse",className:"px-6 py-3 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-colors",children:"Browse More"})]})]}),J2=()=>{const{watchlist:s,isLoading:e,removeFromWatchlist:t,clearWatchlist:r,sortWatchlist:n,exportWatchlist:i}=za(),a=Rs(),[o,l]=A.useState("grid"),[c,u]=A.useState("addedAt"),[d,f]=A.useState(!1),p=[...s].sort((g,x)=>c==="addedAt"?new Date(x.addedAt)-new Date(g.addedAt):c==="rating"?(x.vote_average||0)-(g.vote_average||0):c==="title"?(g.title||g.name).localeCompare(x.title||x.name):0),m=()=>{r(),f(!1)},y=()=>{const g=i(),x=new Blob([g],{type:"application/json"}),v=URL.createObjectURL(x),E=document.createElement("a");E.href=v,E.download="watchlist.json",E.click(),URL.revokeObjectURL(v)};return e?h.jsx(eO,{}):h.jsxs("div",{className:"min-h-screen bg-gray-900",children:[h.jsx("div",{className:"bg-gray-800/50 border-b border-gray-800",children:h.jsx("div",{className:"container mx-auto px-4 py-8",children:h.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"My Watchlist"}),h.jsxs("p",{className:"text-gray-400",children:[s.length," ",s.length===1?"title":"titles"," saved"]})]}),h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsxs("select",{value:c,onChange:g=>{u(g.target.value),n(g.target.value)},className:"px-4 py-2 bg-gray-800 text-white rounded-md border border-gray-700 focus:outline-none focus:border-netflix-red",children:[h.jsx("option",{value:"addedAt",children:"Recently Added"}),h.jsx("option",{value:"rating",children:"Highest Rated"}),h.jsx("option",{value:"title",children:"Title (A-Z)"})]}),h.jsx(Ul,{variant:"secondary",size:"sm",onClick:y,disabled:s.length===0,children:"Export"}),s.length>1&&h.jsx(Ul,{variant:"danger",size:"sm",onClick:()=>f(!0),children:"Clear All"})]})]})})}),h.jsx("div",{className:"container mx-auto px-4 py-8",children:s.length===0?h.jsx(tO,{}):h.jsx(h.Fragment,{children:h.jsx("div",{className:o==="grid"?"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4":"space-y-4",children:p.map(g=>h.jsx(Z2,{item:g,viewMode:o,onRemove:()=>t(g.id),onPlay:()=>a(`/watch-trailer/${g.media_type}/${g.id}`),onInfo:()=>a(`/${g.media_type}/${g.id}`)},g.uniqueId||g.id))})})}),d&&h.jsx(sO,{isOpen:d,onClose:()=>f(!1),onConfirm:m})]})},Z2=({item:s,viewMode:e,onRemove:t,onPlay:r,onInfo:n})=>{const[i,a]=A.useState(!1);return e==="grid"?h.jsxs("div",{className:"relative group",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[h.jsxs(ve,{to:`/${s.media_type}/${s.id}`,children:[h.jsx("div",{className:"aspect-[2/3] rounded-lg overflow-hidden mb-3",children:h.jsx("img",{src:s.poster_path?`https://image.tmdb.org/t/p/w500${s.poster_path}`:"https://via.placeholder.com/500x750?text=No+Image",alt:s.title||s.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"})}),h.jsx("h3",{className:"font-medium text-white text-sm line-clamp-1 group-hover:text-netflix-red transition-colors",children:s.title||s.name}),h.jsxs("p",{className:"text-gray-400 text-xs mt-1",children:[Gs(s.release_date),"  ",Zd(s.vote_average)]})]}),i&&h.jsxs("div",{className:"absolute inset-0 flex items-center justify-center gap-2 bg-black/70 rounded-lg transition-opacity",children:[h.jsx("button",{onClick:o=>{o.preventDefault(),r()},className:"p-2 bg-netflix-red text-white rounded-full hover:bg-red-700 transition-colors",title:"Watch Trailer",children:h.jsx(ke,{size:18})}),h.jsx("button",{onClick:o=>{o.preventDefault(),n()},className:"p-2 bg-gray-600 text-white rounded-full hover:bg-gray-500 transition-colors",title:"More Info",children:h.jsx(Ai,{size:18})}),h.jsx("button",{onClick:o=>{o.preventDefault(),t()},className:"p-2 bg-gray-600 text-white rounded-full hover:bg-red-600 transition-colors",title:"Remove",children:h.jsx(Hp,{size:18})})]})]}):h.jsxs("div",{className:"flex gap-4 p-4 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition-colors",children:[h.jsx(ve,{to:`/${s.media_type}/${s.id}`,className:"flex-shrink-0",children:h.jsx("img",{src:s.poster_path?`https://image.tmdb.org/t/p/w200${s.poster_path}`:"https://via.placeholder.com/200x300?text=No+Image",alt:s.title||s.name,className:"w-24 h-36 object-cover rounded-md"})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx(ve,{to:`/${s.media_type}/${s.id}`,children:h.jsx("h3",{className:"text-lg font-bold text-white hover:text-netflix-red transition-colors",children:s.title||s.name})}),h.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[Gs(s.release_date)," ",h.jsx("span",{className:"capitalize ml-1",children:s.media_type})," ",h.jsx("span",{className:"text-yellow-400 ml-1",children:Zd(s.vote_average)})]}),h.jsx("p",{className:"text-gray-500 text-sm mt-2 line-clamp-2",children:s.overview||"No description available."}),h.jsxs("p",{className:"text-gray-600 text-xs mt-2",children:["Added on ",new Date(s.addedAt).toLocaleDateString()]})]}),h.jsxs("div",{className:"flex flex-col gap-2 justify-center",children:[h.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-4 py-2 bg-netflix-red text-white rounded-md hover:bg-red-700 transition-colors text-sm",children:[h.jsx(ke,{size:16}),"Trailer"]}),h.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-red-600 transition-colors text-sm",children:[h.jsx(Hp,{size:16}),"Remove"]})]})]})},eO=()=>h.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-netflix-red border-t-transparent rounded-full mx-auto mb-4"}),h.jsx("p",{className:"text-gray-400",children:"Loading watchlist..."})]})}),tO=()=>h.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[h.jsx("div",{className:"w-24 h-24 bg-gray-800 rounded-full flex items-center justify-center mb-6",children:h.jsx(qr,{className:"w-12 h-12 text-gray-600"})}),h.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Your watchlist is empty"}),h.jsx("p",{className:"text-gray-400 mb-6 max-w-md",children:"Start adding movies and TV shows to your watchlist to see them here."}),h.jsx(ve,{to:"/browse",className:"inline-flex items-center gap-2 px-6 py-3 bg-netflix-red text-white font-semibold rounded-md hover:bg-red-700 transition-colors",children:"Browse Movies & Shows"})]}),sO=({isOpen:s,onClose:e,onConfirm:t})=>s?h.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[h.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:e}),h.jsxs("div",{className:"relative bg-gray-900 rounded-lg p-6 max-w-md w-full",children:[h.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Clear Watchlist"}),h.jsx("p",{className:"text-gray-400 mb-6",children:"Are you sure you want to remove all items from your watchlist? This action cannot be undone."}),h.jsxs("div",{className:"flex gap-4 justify-end",children:[h.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-colors",children:"Cancel"}),h.jsx("button",{onClick:t,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Clear All"})]})]})]}):null;function rO(){const[s,e]=A.useState(!0),t=()=>{e(!0)};return s?h.jsx(dA,{children:h.jsxs(sA,{children:[h.jsxs($t,{path:"/",element:h.jsx(N_,{}),children:[h.jsx($t,{index:!0,element:h.jsx(yD,{})}),h.jsx($t,{path:"browse",element:h.jsx(gD,{})}),h.jsx($t,{path:"watchlist",element:h.jsx(J2,{})}),h.jsx($t,{path:"movie/:id",element:h.jsx(Wu,{})}),h.jsx($t,{path:"tv/:id",element:h.jsx(Wu,{})}),h.jsx($t,{path:"person/:id",element:h.jsx(Wu,{})}),h.jsx($t,{path:"anime",element:h.jsx(eR,{})}),h.jsx($t,{path:"anime/:id",element:h.jsx(rR,{})})]}),h.jsx($t,{path:"watch/anime/:id",element:h.jsx(lD,{})}),h.jsx($t,{path:"watch/:type/:id",element:h.jsx(TD,{})}),h.jsx($t,{path:"watch-trailer/:type/:id",element:h.jsx(Y2,{})}),h.jsx($t,{path:"*",element:h.jsx(nO,{})})]})}):h.jsx(yA,{onVerified:t})}const nO=()=>h.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsx("h1",{className:"text-6xl font-bold text-netflix-red mb-4",children:"404"}),h.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Page Not Found"}),h.jsx("p",{className:"text-gray-400 mb-6",children:"Sorry, the page you're looking for doesn't exist."}),h.jsx("a",{href:"/",className:"inline-flex items-center gap-2 px-6 py-3 bg-netflix-red text-white font-semibold rounded-md hover:bg-red-700 transition-colors",children:"Go Home"})]})});Qu.createRoot(document.getElementById("root")).render(h.jsx(rr.StrictMode,{children:h.jsx(UA,{children:h.jsx(rO,{})})}));export{Ut as _,V0 as g,wN as p,A as r,Dc as u};
